<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
      xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <title>Ash.Resource.Change.Builtins - ash v3.5.33</title>
    <meta name="generator" content="ExDoc v0.38.2" />
    <link type="text/css" rel="stylesheet" href="dist/epub-elixir-FNUUKFP7.css" />
    <script src="dist/epub-4WIP524F.js"></script>

  </head>
  <body class="content-inner">

    <h1 id="content">
Ash.Resource.Change.Builtins 
    </h1>


      <section id="moduledoc" class="docstring">
<p>Built in changes that are available to all resources</p><p>The functions in this module are imported by default in the actions section.</p>
      </section>


      <section id="summary" class="details-list">
        <h1 class="section-heading">Summary</h1>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#after_action/2" data-no-tooltip="" translate="no">after_action(callback, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Directly attach an <code class="inline">after_action</code> function to the current change.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#after_transaction/2" data-no-tooltip="" translate="no">after_transaction(callback, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Directly attach an <code class="inline">after_transaction</code> function to the current change.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#atomic_update/3" data-no-tooltip="" translate="no">atomic_update(attribute, expr, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Updates an attribute using an expression. See <a><code class="inline">Ash.Changeset.atomic_update/3</code></a> for more.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#before_action/2" data-no-tooltip="" translate="no">before_action(callback, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Directly attach a <code class="inline">before_action</code> function to the current change.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#before_transaction/2" data-no-tooltip="" translate="no">before_transaction(callback, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Directly attach a <code class="inline">before_transaction</code> function to the current change.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#cascade_destroy/2" data-no-tooltip="" translate="no">cascade_destroy(relationship, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Cascade this resource's destroy action to a related resource's destroy action.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#cascade_update/2" data-no-tooltip="" translate="no">cascade_update(relationship, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>  Cascade a resource's update action to a related resource's update action.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#debug_log/1" data-no-tooltip="" translate="no">debug_log(label \\ nil)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#ensure_selected/1" data-no-tooltip="" translate="no">ensure_selected(value)</a>

      </div>

        <div class="summary-synopsis"><p>Passes the provided value into <a><code class="inline">Ash.Changeset.ensure_selected/2</code></a></p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#filter/1" data-no-tooltip="" translate="no">filter(filter)</a>

      </div>

        <div class="summary-synopsis"><p>Applies a filter to the changeset. Has no effect for create actions.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_and_lock/2" data-no-tooltip="" translate="no">get_and_lock(lock, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Re-fetches the record being updated and locks it with the given type.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_and_lock_for_update/1" data-no-tooltip="" translate="no">get_and_lock_for_update(opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Re-fetches the record being updated and locks it for update.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#increment/2" data-no-tooltip="" translate="no">increment(attribute, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Increments an attribute's value by the amount specified, which defaults to 1.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#load/1" data-no-tooltip="" translate="no">load(value)</a>

      </div>

        <div class="summary-synopsis"><p>Passes the provided value into <code class="inline">Ash.load</code> after the action has completed.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#manage_relationship/3" data-no-tooltip="" translate="no">manage_relationship(argument, relationship_name \\ nil, opts)</a>

      </div>

        <div class="summary-synopsis"><p>Calls <a><code class="inline">Ash.Changeset.manage_relationship/4</code></a> with the changeset and relationship provided, using the value provided for the named argument.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#optimistic_lock/1" data-no-tooltip="" translate="no">optimistic_lock(attribute)</a>

      </div>

        <div class="summary-synopsis"><p>Apply an &quot;optimistic lock&quot; on a record being updated or destroyed.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#prevent_change/1" data-no-tooltip="" translate="no">prevent_change(attribute)</a>

      </div>

        <div class="summary-synopsis"><p>Clears a change off of the changeset before the action runs.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#relate_actor/2" data-no-tooltip="" translate="no">relate_actor(relationship, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Relates the actor to the data being changed, as the provided relationship.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#select/1" data-no-tooltip="" translate="no">select(value)</a>

      </div>

        <div class="summary-synopsis"><p>Passes the provided value into <a><code class="inline">Ash.Changeset.select/3</code></a></p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#set_attribute/3" data-no-tooltip="" translate="no">set_attribute(attribute, value, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Sets the attribute to the value provided.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#set_context/1" data-no-tooltip="" translate="no">set_context(context)</a>

      </div>

        <div class="summary-synopsis"><p>Merges the given query context.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#set_new_attribute/2" data-no-tooltip="" translate="no">set_new_attribute(attribute, value)</a>

      </div>

        <div class="summary-synopsis"><p>Sets the attribute to the value provided if the attribute is not already being changed.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update_change/2" data-no-tooltip="" translate="no">update_change(attribute, function)</a>

      </div>

        <div class="summary-synopsis"><p>Updates an existing attribute change by applying a function to it.</p></div>

    </div>

</div>

      </section>


      <section id="functions" class="details-list">
        <h1 class="section-heading">Functions</h1>
        <div class="functions-list">
<section class="detail" id="after_action/2">

    <span id="after_action/1"></span>

  <div class="detail-header">
    <a href="#after_action/2" class="detail-link" data-no-tooltip="" aria-label="Link to this macro">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">after_action(callback, opts \\ [])</h1>

        <span class="note">(macro)</span>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L389" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Directly attach an <code class="inline">after_action</code> function to the current change.</p><p>See <a href="Ash.Changeset.xhtml#after_action/3"><code class="inline">Ash.Changeset.after_action/3</code></a> for more information.</p><p>Provide the option <code class="inline">prepend?: true</code> to place the hook before all other hooks instead of after.</p><h2 id="after_action/2-example" class="section-heading"><a href="#after_action/2-example" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Example</span></h2><pre><code class="makeup elixir" translate="no"><samp class="n">change</samp><samp class="w"> </samp><samp class="n">after_action</samp><samp class="p" data-group-id="4700472651-1">(</samp><samp class="k" data-group-id="4700472651-2">fn</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">record</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="c">_context</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
  </samp><samp class="nc">Logger</samp><samp class="o">.</samp><samp class="n">debug</samp><samp class="p" data-group-id="4700472651-3">(</samp><samp class="s">&quot;Successfully executed action </samp><samp class="si" data-group-id="4700472651-4">#{</samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">action</samp><samp class="o">.</samp><samp class="n">name</samp><samp class="si" data-group-id="4700472651-4">}</samp><samp class="s"> on </samp><samp class="si" data-group-id="4700472651-5">#{</samp><samp class="n">inspect</samp><samp class="p" data-group-id="4700472651-6">(</samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">resource</samp><samp class="p" data-group-id="4700472651-6">)</samp><samp class="si" data-group-id="4700472651-5">}</samp><samp class="s">&quot;</samp><samp class="p" data-group-id="4700472651-3">)</samp><samp class="w">
  </samp><samp class="p" data-group-id="4700472651-7">{</samp><samp class="ss">:ok</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">record</samp><samp class="p" data-group-id="4700472651-7">}</samp><samp class="w">
</samp><samp class="k" data-group-id="4700472651-2">end</samp><samp class="p" data-group-id="4700472651-1">)</samp></code></pre>
  </section>
</section>
<section class="detail" id="after_transaction/2">

    <span id="after_transaction/1"></span>

  <div class="detail-header">
    <a href="#after_transaction/2" class="detail-link" data-no-tooltip="" aria-label="Link to this macro">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">after_transaction(callback, opts \\ [])</h1>

        <span class="note">(macro)</span>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L419" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Directly attach an <code class="inline">after_transaction</code> function to the current change.</p><p>See <a href="Ash.Changeset.xhtml#after_transaction/3"><code class="inline">Ash.Changeset.after_transaction/3</code></a> for more information.</p><p>Provide the option <code class="inline">prepend?: true</code> to place the hook before all other hooks instead of after.</p><h2 id="after_transaction/2-example" class="section-heading"><a href="#after_transaction/2-example" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Example</span></h2><pre><code class="makeup elixir" translate="no"><samp class="n">change</samp><samp class="w"> </samp><samp class="n">after_transaction</samp><samp class="p" data-group-id="1810369550-1">(</samp><samp class="k" data-group-id="1810369550-2">fn</samp><samp class="w">
  </samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="1810369550-3">{</samp><samp class="ss">:ok</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">record</samp><samp class="p" data-group-id="1810369550-3">}</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="c">_context</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
    </samp><samp class="nc">Logger</samp><samp class="o">.</samp><samp class="n">debug</samp><samp class="p" data-group-id="1810369550-4">(</samp><samp class="s">&quot;Successfully executed transaction for action </samp><samp class="si" data-group-id="1810369550-5">#{</samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">action</samp><samp class="o">.</samp><samp class="n">name</samp><samp class="si" data-group-id="1810369550-5">}</samp><samp class="s"> on </samp><samp class="si" data-group-id="1810369550-6">#{</samp><samp class="n">inspect</samp><samp class="p" data-group-id="1810369550-7">(</samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">resource</samp><samp class="p" data-group-id="1810369550-7">)</samp><samp class="si" data-group-id="1810369550-6">}</samp><samp class="s">&quot;</samp><samp class="p" data-group-id="1810369550-4">)</samp><samp class="w">
    </samp><samp class="p" data-group-id="1810369550-8">{</samp><samp class="ss">:ok</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">record</samp><samp class="p" data-group-id="1810369550-8">}</samp><samp class="w">
  </samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="1810369550-9">{</samp><samp class="ss">:error</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">reason</samp><samp class="p" data-group-id="1810369550-9">}</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="c">_context</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
    </samp><samp class="nc">Logger</samp><samp class="o">.</samp><samp class="n">debug</samp><samp class="p" data-group-id="1810369550-10">(</samp><samp class="s">&quot;Failed to execute transaction for action </samp><samp class="si" data-group-id="1810369550-11">#{</samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">action</samp><samp class="o">.</samp><samp class="n">name</samp><samp class="si" data-group-id="1810369550-11">}</samp><samp class="s"> on </samp><samp class="si" data-group-id="1810369550-12">#{</samp><samp class="n">inspect</samp><samp class="p" data-group-id="1810369550-13">(</samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">resource</samp><samp class="p" data-group-id="1810369550-13">)</samp><samp class="si" data-group-id="1810369550-12">}</samp><samp class="s">, reason: </samp><samp class="si" data-group-id="1810369550-14">#{</samp><samp class="n">inspect</samp><samp class="p" data-group-id="1810369550-15">(</samp><samp class="n">reason</samp><samp class="p" data-group-id="1810369550-15">)</samp><samp class="si" data-group-id="1810369550-14">}</samp><samp class="s">&quot;</samp><samp class="p" data-group-id="1810369550-10">)</samp><samp class="w">
    </samp><samp class="p" data-group-id="1810369550-16">{</samp><samp class="ss">:error</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">reason</samp><samp class="p" data-group-id="1810369550-16">}</samp><samp class="w">
</samp><samp class="k" data-group-id="1810369550-2">end</samp><samp class="p" data-group-id="1810369550-1">)</samp></code></pre>
  </section>
</section>
<section class="detail" id="atomic_update/3">

    <span id="atomic_update/2"></span>

  <div class="detail-header">
    <a href="#atomic_update/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">atomic_update(attribute, expr, opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L170" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> atomic_update(attribute :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(), expr :: <a href="Ash.Expr.xhtml#t:t/0">Ash.Expr.t</a>(), opts :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()) ::
  <a href="Ash.Resource.Change.xhtml#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Updates an attribute using an expression. See <a href="Ash.Changeset.xhtml#atomic_update/3"><code class="inline">Ash.Changeset.atomic_update/3</code></a> for more.</p><p>Options:</p><ul><li><code class="inline">:cast_atomic?</code> - set to <code class="inline">false</code> to ignore atomic type casting logic. Defaults to <code class="inline">true</code>.</li></ul>
  </section>
</section>
<section class="detail" id="before_action/2">

    <span id="before_action/1"></span>

  <div class="detail-header">
    <a href="#before_action/2" class="detail-link" data-no-tooltip="" aria-label="Link to this macro">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">before_action(callback, opts \\ [])</h1>

        <span class="note">(macro)</span>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L446" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Directly attach a <code class="inline">before_action</code> function to the current change.</p><p>See <a href="Ash.Changeset.xhtml#before_action/3"><code class="inline">Ash.Changeset.before_action/3</code></a> for more information.</p><p>Provide the option <code class="inline">prepend?: true</code> to place the hook before all other hooks instead of after.</p><h2 id="before_action/2-example" class="section-heading"><a href="#before_action/2-example" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Example</span></h2><pre><code class="makeup elixir" translate="no"><samp class="n">change</samp><samp class="w"> </samp><samp class="n">before_action</samp><samp class="p" data-group-id="0925730728-1">(</samp><samp class="k" data-group-id="0925730728-2">fn</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="c">_context</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
  </samp><samp class="nc">Logger</samp><samp class="o">.</samp><samp class="n">debug</samp><samp class="p" data-group-id="0925730728-3">(</samp><samp class="s">&quot;About to execute </samp><samp class="si" data-group-id="0925730728-4">#{</samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">action</samp><samp class="o">.</samp><samp class="n">name</samp><samp class="si" data-group-id="0925730728-4">}</samp><samp class="s"> on </samp><samp class="si" data-group-id="0925730728-5">#{</samp><samp class="n">inspect</samp><samp class="p" data-group-id="0925730728-6">(</samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">resource</samp><samp class="p" data-group-id="0925730728-6">)</samp><samp class="si" data-group-id="0925730728-5">}</samp><samp class="s">&quot;</samp><samp class="p" data-group-id="0925730728-3">)</samp><samp class="w">

  </samp><samp class="n">changeset</samp><samp class="w">
</samp><samp class="k" data-group-id="0925730728-2">end</samp><samp class="p" data-group-id="0925730728-1">)</samp></code></pre>
  </section>
</section>
<section class="detail" id="before_transaction/2">

    <span id="before_transaction/1"></span>

  <div class="detail-header">
    <a href="#before_transaction/2" class="detail-link" data-no-tooltip="" aria-label="Link to this macro">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">before_transaction(callback, opts \\ [])</h1>

        <span class="note">(macro)</span>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L473" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Directly attach a <code class="inline">before_transaction</code> function to the current change.</p><p>See <a href="Ash.Changeset.xhtml#before_transaction/3"><code class="inline">Ash.Changeset.before_transaction/3</code></a> for more information.</p><p>Provide the option <code class="inline">prepend?: true</code> to place the hook before all other hooks instead of after.</p><h2 id="before_transaction/2-example" class="section-heading"><a href="#before_transaction/2-example" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Example</span></h2><pre><code class="makeup elixir" translate="no"><samp class="n">change</samp><samp class="w"> </samp><samp class="n">before_transaction</samp><samp class="p" data-group-id="6023132999-1">(</samp><samp class="k" data-group-id="6023132999-2">fn</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="c">_context</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
  </samp><samp class="nc">Logger</samp><samp class="o">.</samp><samp class="n">debug</samp><samp class="p" data-group-id="6023132999-3">(</samp><samp class="s">&quot;About to execute transaction for </samp><samp class="si" data-group-id="6023132999-4">#{</samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">action</samp><samp class="o">.</samp><samp class="n">name</samp><samp class="si" data-group-id="6023132999-4">}</samp><samp class="s"> on </samp><samp class="si" data-group-id="6023132999-5">#{</samp><samp class="n">inspect</samp><samp class="p" data-group-id="6023132999-6">(</samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">resource</samp><samp class="p" data-group-id="6023132999-6">)</samp><samp class="si" data-group-id="6023132999-5">}</samp><samp class="s">&quot;</samp><samp class="p" data-group-id="6023132999-3">)</samp><samp class="w">

  </samp><samp class="n">changeset</samp><samp class="w">
</samp><samp class="k" data-group-id="6023132999-2">end</samp><samp class="p" data-group-id="6023132999-1">)</samp></code></pre>
  </section>
</section>
<section class="detail" id="cascade_destroy/2">

    <span id="cascade_destroy/1"></span>

  <div class="detail-header">
    <a href="#cascade_destroy/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">cascade_destroy(relationship, opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L330" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Cascade this resource's destroy action to a related resource's destroy action.</p><p>Adds an after-action hook that explicitly calls destroy on any records related
via the named relationship.  It will optimise for bulk destroys where
possible.</p><section role="note" class="admonition warning"><h4 class="admonition-title warning">Beware database constraints</h4><p>Think carefully before using this change with data layers which enforce
referential integrity (ie PostgreSQL and SQLite) and you may need to defer
constraints for the relationship in question.</p><p>See also:</p><ol><li><a href="https://hexdocs.pm/ash_postgres/dsl-ashpostgres-datalayer.html#postgres-references-reference-deferrable"><code class="inline">postgres.references.reference.deferrable</code> DSL</a></li><li><a href="https://hexdocs.pm/ash_sqlite/dsl-ashsqlite-datalayer.html#sqlite-references-reference-deferrable"><code class="inline">sqlite.references.reference.deferrable</code> DSL</a></li><li><a href="https://www.postgresql.org/docs/current/sql-set-constraints.html">PostgreSQL's <code class="inline">SET CONSTRAINTS</code> documentation</a></li><li><a href="https://www.sqlite.org/pragma.html#pragma_defer_foreign_keys">SQLite's <code class="inline">PRAGMA defer_foreign_keys</code> documentation</a></li></ol></section><section role="note" class="admonition tip"><h4 class="admonition-title tip">Cascading notifications</h4><p>By default notifications are disabled for the related destroy. This is to avoid potentially sending a <strong>lot</strong> of notifications for high-cardinality relationships.</p></section><h2 id="cascade_destroy/2-options" class="section-heading"><a href="#cascade_destroy/2-options" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Options</span></h2><ul><li><p><code class="inline">:relationship</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">atom/0</code></a>) - Required. The name of the relationship to work on</p></li><li><p><code class="inline">:action</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">atom/0</code></a>) - The name of the destroy action to call on the related resource. Uses the primary destroy by default.</p></li><li><p><code class="inline">:read_action</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">atom/0</code></a>) - The name of the read action to call on the related resource to find results to be destroyed</p></li><li><p><code class="inline">:return_notifications?</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">boolean/0</code></a>) - Return notifications for all destroyed records? The default value is <code class="inline">false</code>.</p></li><li><p><code class="inline">:after_action?</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">boolean/0</code></a>) - If true, cascade destroys are done in after_action hooks. If false, they run as before_action hooks. Defaults to true for atomic action compatibility The default value is <code class="inline">true</code>.</p></li><li><p><code class="inline">:domain</code> (<a href="Ash.Domain.xhtml"><code class="inline">Ash.Domain</code></a>) - </p></li></ul><h2 id="cascade_destroy/2-example" class="section-heading"><a href="#cascade_destroy/2-example" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Example</span></h2><pre><code class="makeup elixir" translate="no"><samp class="n">change</samp><samp class="w"> </samp><samp class="n">cascade_destroy</samp><samp class="p" data-group-id="0096157578-1">(</samp><samp class="ss">:relationship</samp><samp class="p" data-group-id="0096157578-1">)</samp></code></pre>
  </section>
</section>
<section class="detail" id="cascade_update/2">

    <span id="cascade_update/1"></span>

  <div class="detail-header">
    <a href="#cascade_update/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">cascade_update(relationship, opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L370" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>  Cascade a resource's update action to a related resource's update action.</p><p>  Adds an after-action hook that explicitly calls update on any records related
  via the named relationship.  It will optimise for bulk updates where
  possible.</p><p>  Allows you to copy fields from the arguments or changes to the destination,
  this way you can cascade a bunch of changes downstream.</p><section role="note" class="admonition warning"><h4 class="admonition-title warning">Beware database constraints</h4><p>Think carefully before using this change with data layers which enforce
referential integrity (ie PostgreSQL and SQLite) and you may need to defer
constraints for the relationship in question.</p><p>See also:</p><ol><li><a href="https://hexdocs.pm/ash_postgres/dsl-ashpostgres-datalayer.html#postgres-references-reference-deferrable"><code class="inline">postgres.references.reference.deferrable</code> DSL</a></li><li><a href="https://hexdocs.pm/ash_sqlite/dsl-ashsqlite-datalayer.html#sqlite-references-reference-deferrable"><code class="inline">sqlite.references.reference.deferrable</code> DSL</a></li><li><a href="https://www.postgresql.org/docs/current/sql-set-constraints.html">PostgreSQL's <code class="inline">SET CONSTRAINTS</code> documentation</a></li><li><a href="https://www.sqlite.org/pragma.html#pragma_defer_foreign_keys">SQLite's <code class="inline">PRAGMA defer_foreign_keys</code> documentation</a></li></ol></section><section role="note" class="admonition tip"><h4 class="admonition-title tip">Cascading notifications</h4><p>By default notifications are disabled for the related updates. This is to avoid potentially sending a <strong>lot</strong> of notifications for high-cardinality relationships.</p></section><h2 id="cascade_update/2-options" class="section-heading"><a href="#cascade_update/2-options" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Options</span></h2><ul><li><p><code class="inline">:relationship</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">atom/0</code></a>) - Required. The name of the relationship to work on</p></li><li><p><code class="inline">:action</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">atom/0</code></a>) - The name of the update action to call on the related resource. Uses the primary update by default.</p></li><li><p><code class="inline">:copy_inputs</code> (list of <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">atom/0</code></a>) - A list of fields to copy &amp; pass on to the downstream update. The source action cannot be atomic. The default value is <code class="inline">[]</code>.</p></li><li><p><code class="inline">:read_action</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">atom/0</code></a>) - The name of the read action to call on the related resource to find results to be updated</p></li><li><p><code class="inline">:return_notifications?</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">boolean/0</code></a>) - Return notifications for all updated records? The default value is <code class="inline">false</code>.</p></li><li><p><code class="inline">:domain</code> (<a href="Ash.Domain.xhtml"><code class="inline">Ash.Domain</code></a>) - </p></li></ul><h2 id="cascade_update/2-example" class="section-heading"><a href="#cascade_update/2-example" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Example</span></h2><pre><code class="makeup elixir" translate="no"><samp class="n">change</samp><samp class="w"> </samp><samp class="n">cascade_update</samp><samp class="p" data-group-id="4209446412-1">(</samp><samp class="ss">:relationship1</samp><samp class="p" data-group-id="4209446412-1">)</samp><samp class="w">
</samp><samp class="n">change</samp><samp class="w"> </samp><samp class="n">cascade_update</samp><samp class="p" data-group-id="4209446412-2">(</samp><samp class="ss">:relationship2</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">copy_inputs</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="p" data-group-id="4209446412-3">[</samp><samp class="ss">:field1</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:field2</samp><samp class="p" data-group-id="4209446412-3">]</samp><samp class="p" data-group-id="4209446412-2">)</samp></code></pre>
  </section>
</section>
<section class="detail" id="debug_log/1">

    <span id="debug_log/0"></span>

  <div class="detail-header">
    <a href="#debug_log/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">debug_log(label \\ nil)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L40" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> debug_log(label :: <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>() | nil) :: <a href="Ash.Resource.Change.xhtml#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>


  </section>
</section>
<section class="detail" id="ensure_selected/1">

  <div class="detail-header">
    <a href="#ensure_selected/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">ensure_selected(value)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L294" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> ensure_selected(select :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>() | [<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()]) :: <a href="Ash.Resource.Change.xhtml#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Passes the provided value into <a href="Ash.Changeset.xhtml#ensure_selected/2"><code class="inline">Ash.Changeset.ensure_selected/2</code></a></p><p>If the value is not already selected, this makes sure it is. Does not deselect anything else.</p><h2 id="ensure_selected/1-example" class="section-heading"><a href="#ensure_selected/1-example" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Example</span></h2><pre><code class="makeup elixir" translate="no"><samp class="n">change</samp><samp class="w"> </samp><samp class="n">ensure_selected</samp><samp class="p" data-group-id="7278361203-1">(</samp><samp class="p" data-group-id="7278361203-2">[</samp><samp class="ss">:necessary_field</samp><samp class="p" data-group-id="7278361203-2">]</samp><samp class="p" data-group-id="7278361203-1">)</samp></code></pre>
  </section>
</section>
<section class="detail" id="filter/1">

  <div class="detail-header">
    <a href="#filter/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">filter(filter)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L14" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> filter(expr :: <a href="Ash.Expr.xhtml#t:t/0">Ash.Expr.t</a>()) :: <a href="Ash.Resource.Change.xhtml#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Applies a filter to the changeset. Has no effect for create actions.</p><p>This ensures that only things matching the provided filter are updated or destroyed.</p>
  </section>
</section>
<section class="detail" id="get_and_lock/2">

    <span id="get_and_lock/1"></span>

  <div class="detail-header">
    <a href="#get_and_lock/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_and_lock(lock, opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L88" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Re-fetches the record being updated and locks it with the given type.</p><p>This happens in a <code class="inline">before_action</code> hook (so that it is done as part of the transaction).</p><p>If your resource has global validations (in the top level <code class="inline">validations</code> block), you may
want to add <code class="inline">delay_global_validations? true</code> to your action to ensure they happen on the
locked record.</p><h2 id="get_and_lock/2-options" class="section-heading"><a href="#get_and_lock/2-options" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Options</span></h2><ul><li><code class="inline">:skip_atomic?</code> - set to <code class="inline">true</code> to skip in the case that the update is done atomically. Defaults to <code class="inline">false</code>.</li></ul>
  </section>
</section>
<section class="detail" id="get_and_lock_for_update/1">

    <span id="get_and_lock_for_update/0"></span>

  <div class="detail-header">
    <a href="#get_and_lock_for_update/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_and_lock_for_update(opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L70" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> get_and_lock_for_update(opts :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()) :: <a href="Ash.Resource.Change.xhtml#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Re-fetches the record being updated and locks it for update.</p><p>Only usable with data layers that support locking <code class="inline">:for_update</code>.</p><p>This happens in a <code class="inline">before_action</code> hook (so that it is done as part of the transaction).</p><p>If your resource has global validations (in the top level <code class="inline">validations</code> block), you may
want to add <code class="inline">delay_global_validations? true</code> to your action to ensure they happen on the
locked record.</p><h2 id="get_and_lock_for_update/1-options" class="section-heading"><a href="#get_and_lock_for_update/1-options" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Options</span></h2><ul><li><code class="inline">:skip_atomic?</code> - set to <code class="inline">true</code> to skip in the case that the update is done atomically. Defaults to <code class="inline">false</code>.</li></ul>
  </section>
</section>
<section class="detail" id="increment/2">

    <span id="increment/1"></span>

  <div class="detail-header">
    <a href="#increment/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">increment(attribute, opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L118" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> increment(attribute :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(), opts :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()) :: <a href="Ash.Resource.Change.xhtml#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Increments an attribute's value by the amount specified, which defaults to 1.</p><p>Options:</p><ul><li><code class="inline">:amount</code> - Defaults to 1</li><li><code class="inline">:overflow_limit</code> - Defaults to <code class="inline">nil</code>. If the value is over the overflow limit it will roll-over to the amount being incremented by (for common database limit support)</li></ul>
  </section>
</section>
<section class="detail" id="load/1">

  <div class="detail-header">
    <a href="#load/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">load(value)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L261" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> load(load :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()) :: <a href="Ash.Resource.Change.xhtml#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Passes the provided value into <code class="inline">Ash.load</code> after the action has completed.</p><h2 id="load/1-example" class="section-heading"><a href="#load/1-example" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Example</span></h2><pre><code class="makeup elixir" translate="no"><samp class="n">change</samp><samp class="w"> </samp><samp class="n">load</samp><samp class="p" data-group-id="2000014999-1">(</samp><samp class="ss">:comments</samp><samp class="p" data-group-id="2000014999-1">)</samp><samp class="w">
</samp><samp class="n">change</samp><samp class="w"> </samp><samp class="n">load</samp><samp class="p" data-group-id="2000014999-2">(</samp><samp class="p" data-group-id="2000014999-3">[</samp><samp class="ss">:friend_count</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:friends</samp><samp class="p" data-group-id="2000014999-3">]</samp><samp class="p" data-group-id="2000014999-2">)</samp></code></pre>
  </section>
</section>
<section class="detail" id="manage_relationship/3">

    <span id="manage_relationship/2"></span>

  <div class="detail-header">
    <a href="#manage_relationship/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">manage_relationship(argument, relationship_name \\ nil, opts)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L228" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> manage_relationship(
  argument :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(),
  relationship_name :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>() | nil,
  opts :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()
) :: <a href="Ash.Resource.Change.xhtml#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Calls <a href="Ash.Changeset.xhtml#manage_relationship/4"><code class="inline">Ash.Changeset.manage_relationship/4</code></a> with the changeset and relationship provided, using the value provided for the named argument.</p><p>If relationship_name is not specified, it is assumed to be the same as the argument.</p><p>For information on the available options, see <a href="Ash.Changeset.xhtml#manage_relationship/4"><code class="inline">Ash.Changeset.manage_relationship/4</code></a>.</p><h2 id="manage_relationship/3-examples" class="section-heading"><a href="#manage_relationship/3-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="n">change</samp><samp class="w"> </samp><samp class="n">manage_relationship</samp><samp class="p" data-group-id="9090326928-1">(</samp><samp class="ss">:comments</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">type</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:append</samp><samp class="p" data-group-id="9090326928-1">)</samp><samp class="w">
</samp><samp class="n">change</samp><samp class="w"> </samp><samp class="n">manage_relationship</samp><samp class="p" data-group-id="9090326928-2">(</samp><samp class="ss">:remove_comments</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:comments</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">type</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:remove</samp><samp class="p" data-group-id="9090326928-2">)</samp></code></pre>
  </section>
</section>
<section class="detail" id="optimistic_lock/1">

  <div class="detail-header">
    <a href="#optimistic_lock/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">optimistic_lock(attribute)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L49" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Apply an &quot;optimistic lock&quot; on a record being updated or destroyed.</p><p>See <a href="Ash.Resource.Change.OptimisticLock.xhtml"><code class="inline">Ash.Resource.Change.OptimisticLock</code></a> for more.</p>
  </section>
</section>
<section class="detail" id="prevent_change/1">

  <div class="detail-header">
    <a href="#prevent_change/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">prevent_change(attribute)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L206" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> prevent_change(attribute :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) :: <a href="Ash.Resource.Change.xhtml#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Clears a change off of the changeset before the action runs.</p><p>Does not fail if it is being changed, but ensures it is cleared just before the action.</p><p>Can be useful if a change is only used in validations but shouldn't ultimately be written to the data layer.</p><h2 id="prevent_change/1-examples" class="section-heading"><a href="#prevent_change/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="n">change</samp><samp class="w"> </samp><samp class="n">prevent_change</samp><samp class="p" data-group-id="2966878329-1">(</samp><samp class="ss">:email</samp><samp class="p" data-group-id="2966878329-1">)</samp></code></pre>
  </section>
</section>
<section class="detail" id="relate_actor/2">

    <span id="relate_actor/1"></span>

  <div class="detail-header">
    <a href="#relate_actor/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">relate_actor(relationship, opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L30" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> relate_actor(relationship :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(), opts :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()) ::
  <a href="Ash.Resource.Change.xhtml#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Relates the actor to the data being changed, as the provided relationship.</p><h2 id="relate_actor/2-options" class="section-heading"><a href="#relate_actor/2-options" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Options</span></h2><ul><li><p><code class="inline">:allow_nil?</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">boolean/0</code></a>) - Whether or not to allow the actor to be nil, in which case nothing will happen. The default value is <code class="inline">false</code>.</p></li><li><p><code class="inline">:field</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">atom/0</code></a>) - The field of the actor to set the relationship to</p></li></ul><h2 id="relate_actor/2-examples" class="section-heading"><a href="#relate_actor/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="n">change</samp><samp class="w"> </samp><samp class="n">relate_actor</samp><samp class="p" data-group-id="1730896422-1">(</samp><samp class="ss">:owner</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">allow_nil?</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="no">true</samp><samp class="p" data-group-id="1730896422-1">)</samp></code></pre>
  </section>
</section>
<section class="detail" id="select/1">

  <div class="detail-header">
    <a href="#select/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">select(value)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L280" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> select(select :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>() | [<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()]) :: <a href="Ash.Resource.Change.xhtml#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Passes the provided value into <a href="Ash.Changeset.xhtml#select/3"><code class="inline">Ash.Changeset.select/3</code></a></p><p>Keep in mind, this will <em>limit</em> the fields that are selected. You may want <a href="#ensure_selected/1"><code class="inline">ensure_selected/1</code></a> if you
want to make sure that something is selected, without deselecting anything else.</p><p>Selecting in changesets does not actually do a select in the data layer. It nils out any
fields that were not selected after completing the action. This can be useful if you are writing
policies that have to do with specific fields being selected.</p><h2 id="select/1-example" class="section-heading"><a href="#select/1-example" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Example</span></h2><pre><code class="makeup elixir" translate="no"><samp class="n">change</samp><samp class="w"> </samp><samp class="n">select</samp><samp class="p" data-group-id="2853617333-1">(</samp><samp class="p" data-group-id="2853617333-2">[</samp><samp class="ss">:name</samp><samp class="p" data-group-id="2853617333-2">]</samp><samp class="p" data-group-id="2853617333-1">)</samp></code></pre>
  </section>
</section>
<section class="detail" id="set_attribute/3">

    <span id="set_attribute/2"></span>

  <div class="detail-header">
    <a href="#set_attribute/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">set_attribute(attribute, value, opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L152" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> set_attribute(
  attribute :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(),
  (-&gt; <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()) | {:_arg, :status} | <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  opts :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()
) :: <a href="Ash.Resource.Change.xhtml#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Sets the attribute to the value provided.</p><p>If a zero argument function is provided, it is called to determine the value.</p><p>Use <code class="inline">arg(:argument_name)</code> to use the value of the given argument. If the argument is not supplied then nothing happens.</p><h2 id="set_attribute/3-options" class="section-heading"><a href="#set_attribute/3-options" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Options</span></h2><ul><li><p><code class="inline">:set_when_nil?</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">boolean/0</code></a>) - When false, decline setting the attribute if it is nil. The default value is <code class="inline">true</code>.</p></li><li><p><code class="inline">:new?</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">boolean/0</code></a>) - When true, sets the attribute to the value provided if the attribute is not already being changed. The default value is <code class="inline">false</code>.</p></li></ul><h2 id="set_attribute/3-examples" class="section-heading"><a href="#set_attribute/3-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="n">change</samp><samp class="w"> </samp><samp class="n">set_attribute</samp><samp class="p" data-group-id="2219662100-1">(</samp><samp class="ss">:active</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="no">false</samp><samp class="p" data-group-id="2219662100-1">)</samp><samp class="w">
</samp><samp class="n">change</samp><samp class="w"> </samp><samp class="n">set_attribute</samp><samp class="p" data-group-id="2219662100-2">(</samp><samp class="ss">:opened_at</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="o">&amp;</samp><samp class="nc">DateTime</samp><samp class="o">.</samp><samp class="n">utc_now</samp><samp class="o">/</samp><samp class="mi">0</samp><samp class="p" data-group-id="2219662100-2">)</samp><samp class="w">
</samp><samp class="n">change</samp><samp class="w"> </samp><samp class="n">set_attribute</samp><samp class="p" data-group-id="2219662100-3">(</samp><samp class="ss">:status</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">arg</samp><samp class="p" data-group-id="2219662100-4">(</samp><samp class="ss">:status</samp><samp class="p" data-group-id="2219662100-4">)</samp><samp class="p" data-group-id="2219662100-3">)</samp><samp class="w">
</samp><samp class="n">change</samp><samp class="w"> </samp><samp class="n">set_attribute</samp><samp class="p" data-group-id="2219662100-5">(</samp><samp class="ss">:encrypted_data</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">arg</samp><samp class="p" data-group-id="2219662100-6">(</samp><samp class="ss">:data</samp><samp class="p" data-group-id="2219662100-6">)</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">set_when_nil?</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="no">false</samp><samp class="p" data-group-id="2219662100-5">)</samp></code></pre>
  </section>
</section>
<section class="detail" id="set_context/1">

  <div class="detail-header">
    <a href="#set_context/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">set_context(context)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L248" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> set_context(context :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>() | <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">mfa</a>()) :: <a href="Ash.Resource.Change.xhtml#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Merges the given query context.</p><p>If an MFA is provided, it will be called with the changeset.
The MFA should return <code class="inline">{:ok, context_to_be_merged}</code> or <code class="inline">{:error, term}</code></p><h2 id="set_context/1-examples" class="section-heading"><a href="#set_context/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="n">change</samp><samp class="w"> </samp><samp class="n">set_context</samp><samp class="p" data-group-id="7177744618-1">(</samp><samp class="p" data-group-id="7177744618-2">%{</samp><samp class="ss">something_used_internally</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="no">true</samp><samp class="p" data-group-id="7177744618-2">}</samp><samp class="p" data-group-id="7177744618-1">)</samp><samp class="w">
</samp><samp class="n">change</samp><samp class="w"> </samp><samp class="n">set_context</samp><samp class="p" data-group-id="7177744618-3">(</samp><samp class="p" data-group-id="7177744618-4">{</samp><samp class="nc">MyApp.Context</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:set_context</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="7177744618-5">[</samp><samp class="p" data-group-id="7177744618-5">]</samp><samp class="p" data-group-id="7177744618-4">}</samp><samp class="p" data-group-id="7177744618-3">)</samp></code></pre>
  </section>
</section>
<section class="detail" id="set_new_attribute/2">

  <div class="detail-header">
    <a href="#set_new_attribute/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">set_new_attribute(attribute, value)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L190" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> set_new_attribute(
  relationship :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(),
  (-&gt; <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()) | {:_arg, :status} | <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()
) ::
  <a href="Ash.Resource.Change.xhtml#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Sets the attribute to the value provided if the attribute is not already being changed.</p><p>If a zero argument function is provided, it is called to determine the value.</p><p>Use <code class="inline">arg(:argument_name)</code> to use the value of the given argument. If the argument is not supplied then nothing happens.</p><h2 id="set_new_attribute/2-examples" class="section-heading"><a href="#set_new_attribute/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="n">change</samp><samp class="w"> </samp><samp class="n">set_new_attribute</samp><samp class="p" data-group-id="2991939106-1">(</samp><samp class="ss">:active</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="no">false</samp><samp class="p" data-group-id="2991939106-1">)</samp><samp class="w">
</samp><samp class="n">change</samp><samp class="w"> </samp><samp class="n">set_new_attribute</samp><samp class="p" data-group-id="2991939106-2">(</samp><samp class="ss">:opened_at</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="o">&amp;</samp><samp class="nc">DateTime</samp><samp class="o">.</samp><samp class="n">utc_now</samp><samp class="o">/</samp><samp class="mi">0</samp><samp class="p" data-group-id="2991939106-2">)</samp><samp class="w">
</samp><samp class="n">change</samp><samp class="w"> </samp><samp class="n">set_new_attribute</samp><samp class="p" data-group-id="2991939106-3">(</samp><samp class="ss">:status</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">arg</samp><samp class="p" data-group-id="2991939106-4">(</samp><samp class="ss">:status</samp><samp class="p" data-group-id="2991939106-4">)</samp><samp class="p" data-group-id="2991939106-3">)</samp></code></pre>
  </section>
</section>
<section class="detail" id="update_change/2">

  <div class="detail-header">
    <a href="#update_change/2" class="detail-link" data-no-tooltip="" aria-label="Link to this macro">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">update_change(attribute, function)</h1>

        <span class="note">(macro)</span>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/resource/change/builtins.ex#L98" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Updates an existing attribute change by applying a function to it.</p><p>The update function gets called with the value already cast to the correct type, and only gets called
on valid changesets, so the value is guaranteed to have passed validations and constraints.</p>
  </section>
</section>

        </div>
      </section>


  </body>
</html>
