<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
      xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <title>Ash.Changeset - ash v3.5.33</title>
    <meta name="generator" content="ExDoc v0.38.2" />
    <link type="text/css" rel="stylesheet" href="dist/epub-elixir-FNUUKFP7.css" />
    <script src="dist/epub-4WIP524F.js"></script>

  </head>
  <body class="content-inner">

    <h1 id="content">
Ash.Changeset 
    </h1>


      <section id="moduledoc" class="docstring">
<p>Changesets are used to create and update data in Ash.</p><p>Create a changeset with <a href="#new/1"><code class="inline">new/1</code></a> or <code class="inline">new/2</code>, and alter the attributes
and relationships using the functions provided in this module.  Nothing in this module
actually incurs changes in a data layer. To commit a changeset, see <a href="Ash.xhtml#create/2"><code class="inline">Ash.create/2</code></a>
and <a href="Ash.xhtml#update/2"><code class="inline">Ash.update/2</code></a>.</p><h1>Changeset lifecycle</h1><h2 id="module-action-lifecycle">Action Lifecycle</h2><p>The following example illustrates the hook lifecycle of a changeset.</p><pre><code class="makeup elixir" translate="no"><samp class="kd">defmodule</samp><samp class="w"> </samp><samp class="nc">AshChangesetLifeCycleExample</samp><samp class="w"> </samp><samp class="k" data-group-id="5046437562-1">do</samp><samp class="w">
  </samp><samp class="kd">def</samp><samp class="w"> </samp><samp class="nf">change</samp><samp class="p" data-group-id="5046437562-2">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="bp">_</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="bp">_</samp><samp class="p" data-group-id="5046437562-2">)</samp><samp class="w"> </samp><samp class="k" data-group-id="5046437562-3">do</samp><samp class="w">
    </samp><samp class="n">changeset</samp><samp class="w">
    </samp><samp class="c1"># execute code both before and after the transaction</samp><samp class="w">
    </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">around_transaction</samp><samp class="p" data-group-id="5046437562-4">(</samp><samp class="k" data-group-id="5046437562-5">fn</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">callback</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
      </samp><samp class="n">callback</samp><samp class="o">.</samp><samp class="p" data-group-id="5046437562-6">(</samp><samp class="n">changeset</samp><samp class="p" data-group-id="5046437562-6">)</samp><samp class="w">
    </samp><samp class="k" data-group-id="5046437562-5">end</samp><samp class="p" data-group-id="5046437562-4">)</samp><samp class="w">
    </samp><samp class="c1"># execute code before the transaction is started. Use for things like external calls</samp><samp class="w">
    </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">before_transaction</samp><samp class="p" data-group-id="5046437562-7">(</samp><samp class="k" data-group-id="5046437562-8">fn</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="k" data-group-id="5046437562-8">end</samp><samp class="p" data-group-id="5046437562-7">)</samp><samp class="w">
    </samp><samp class="c1"># execute code in the transaction, before and after the data layer is called</samp><samp class="w">
    </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">around_action</samp><samp class="p" data-group-id="5046437562-9">(</samp><samp class="k" data-group-id="5046437562-10">fn</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">callback</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
      </samp><samp class="n">callback</samp><samp class="o">.</samp><samp class="p" data-group-id="5046437562-11">(</samp><samp class="n">changeset</samp><samp class="p" data-group-id="5046437562-11">)</samp><samp class="w">
    </samp><samp class="k" data-group-id="5046437562-10">end</samp><samp class="p" data-group-id="5046437562-9">)</samp><samp class="w">
    </samp><samp class="c1"># execute code in the transaction, before the data layer is called</samp><samp class="w">
    </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">before_action</samp><samp class="p" data-group-id="5046437562-12">(</samp><samp class="k" data-group-id="5046437562-13">fn</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="k" data-group-id="5046437562-13">end</samp><samp class="p" data-group-id="5046437562-12">)</samp><samp class="w">
    </samp><samp class="c1"># execute code in the transaction, after the data layer is called, only if the action is successful</samp><samp class="w">
    </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">after_action</samp><samp class="p" data-group-id="5046437562-14">(</samp><samp class="k" data-group-id="5046437562-15">fn</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">result</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w"> </samp><samp class="p" data-group-id="5046437562-16">{</samp><samp class="ss">:ok</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">result</samp><samp class="p" data-group-id="5046437562-16">}</samp><samp class="w"> </samp><samp class="k" data-group-id="5046437562-15">end</samp><samp class="p" data-group-id="5046437562-14">)</samp><samp class="w">
    </samp><samp class="c1"># execute code after the transaction, both in success and error cases</samp><samp class="w">
    </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">after_transaction</samp><samp class="p" data-group-id="5046437562-17">(</samp><samp class="k" data-group-id="5046437562-18">fn</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">success_or_error_result</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w"> </samp><samp class="n">success_or_error_result</samp><samp class="w"> </samp><samp class="k" data-group-id="5046437562-18">end</samp><samp class="w">
  </samp><samp class="k">end</samp><samp class="w">
</samp><samp class="k">end</samp></code></pre>
      </section>


      <section id="summary" class="details-list">
        <h1 class="section-heading">Summary</h1>
<div class="summary-types summary">
  <h2>
    <a href="#types">Types</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:after_action_fun/0" data-no-tooltip="" translate="no">after_action_fun()</a>

      </div>

        <div class="summary-synopsis"><p>Function type for after action hooks.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:after_transaction_fun/0" data-no-tooltip="" translate="no">after_transaction_fun()</a>

      </div>

        <div class="summary-synopsis"><p>Function type for after transaction hooks.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:around_action_callback/0" data-no-tooltip="" translate="no">around_action_callback()</a>

      </div>

        <div class="summary-synopsis"><p>Callback function type for around action hooks.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:around_action_fun/0" data-no-tooltip="" translate="no">around_action_fun()</a>

      </div>

        <div class="summary-synopsis"><p>Function type for around action hooks.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:around_action_result/0" data-no-tooltip="" translate="no">around_action_result()</a>

      </div>

        <div class="summary-synopsis"><p>Result type for around action callbacks.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:around_transaction_callback/0" data-no-tooltip="" translate="no">around_transaction_callback()</a>

      </div>

        <div class="summary-synopsis"><p>Callback function type for around transaction hooks.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:around_transaction_fun/0" data-no-tooltip="" translate="no">around_transaction_fun()</a>

      </div>

        <div class="summary-synopsis"><p>Function type for around transaction hooks.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:around_transaction_result/0" data-no-tooltip="" translate="no">around_transaction_result()</a>

      </div>

        <div class="summary-synopsis"><p>Result type for around transaction callbacks.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:before_action_fun/0" data-no-tooltip="" translate="no">before_action_fun()</a>

      </div>

        <div class="summary-synopsis"><p>Function type for before action hooks.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:before_transaction_fun/0" data-no-tooltip="" translate="no">before_transaction_fun()</a>

      </div>

        <div class="summary-synopsis"><p>Function type for before transaction hooks.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:error_info/0" data-no-tooltip="" translate="no">error_info()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:manage_relationship_type/0" data-no-tooltip="" translate="no">manage_relationship_type()</a>

      </div>

        <div class="summary-synopsis"><p>The type of relationship management strategy to use.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:phase/0" data-no-tooltip="" translate="no">phase()</a>

      </div>

        <div class="summary-synopsis"><p>The current phase of changeset processing.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:t/0" data-no-tooltip="" translate="no">t()</a>

      </div>

        <div class="summary-synopsis"><p>The changeset struct containing all the information about a pending action.</p></div>

    </div>

</div>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#accessing/3" data-no-tooltip="" translate="no">accessing(changeset, types \\ [:attributes, :relationships, :calculations, :attributes], only_public? \\ true)</a>

      </div>

        <div class="summary-synopsis"><p>Returns a list of attributes, aggregates, relationships, and calculations that are being loaded</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#add_error/3" data-no-tooltip="" translate="no">add_error(changeset, errors, path \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Add an error to the errors list and mark the changeset as invalid.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#after_action/3" data-no-tooltip="" translate="no">after_action(changeset, func, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Adds an after_action hook to the changeset.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#after_transaction/3" data-no-tooltip="" translate="no">after_transaction(changeset, func, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Adds an after_transaction hook to the changeset. Cannot be called within other hooks.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#apply_attributes/2" data-no-tooltip="" translate="no">apply_attributes(changeset, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Returns the original data with attribute changes merged, if the changeset is valid.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#around_action/3" data-no-tooltip="" translate="no">around_action(changeset, func, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Adds an around_action hook to the changeset.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#around_transaction/3" data-no-tooltip="" translate="no">around_transaction(changeset, func, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Adds an around_transaction hook to the changeset.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#atomic_defaults/1" data-no-tooltip="" translate="no">atomic_defaults(changeset)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#atomic_ref/2" data-no-tooltip="" translate="no">atomic_ref(changeset, field)</a>

      </div>

        <div class="summary-synopsis"><p>Gets a reference to a field, or the current atomic update expression of that field.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#atomic_update/2" data-no-tooltip="" translate="no">atomic_update(changeset, atomics)</a>

      </div>

        <div class="summary-synopsis"><p>Adds multiple atomic changes to the changeset</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#atomic_update/3" data-no-tooltip="" translate="no">atomic_update(changeset, key, value)</a>

      </div>

        <div class="summary-synopsis"><p>Adds an atomic change to the changeset.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#attribute_present?/2" data-no-tooltip="" translate="no">attribute_present?(changeset, attribute)</a>

      </div>

        <div class="summary-synopsis"><p>Checks if an attribute is not nil, either in the original data, or that it is not being changed to a <code class="inline">nil</code> value if it is changing.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#before_action/3" data-no-tooltip="" translate="no">before_action(changeset, func, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Adds a before_action hook to the changeset.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#before_transaction/3" data-no-tooltip="" translate="no">before_transaction(changeset, func, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Adds a before_transaction hook to the changeset.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#change_attribute/3" data-no-tooltip="" translate="no">change_attribute(changeset, attribute, value)</a>

      </div>

        <div class="summary-synopsis"><p>Adds a change to the changeset, unless the value matches the existing value.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#change_attributes/2" data-no-tooltip="" translate="no">change_attributes(changeset, changes)</a>

      </div>

        <div class="summary-synopsis"><p>Calls <a><code class="inline">change_attribute/3</code></a> for each key/value pair provided.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#change_default_attribute/3" data-no-tooltip="" translate="no">change_default_attribute(changeset, attribute, value)</a>

      </div>

        <div class="summary-synopsis"><p>The same as <code class="inline">change_attribute</code>, but annotates that the attribute is currently holding a default value.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#change_new_attribute/3" data-no-tooltip="" translate="no">change_new_attribute(changeset, attribute, value)</a>

      </div>

        <div class="summary-synopsis"><p>Change an attribute only if is not currently being changed</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#change_new_attribute_lazy/3" data-no-tooltip="" translate="no">change_new_attribute_lazy(changeset, attribute, func)</a>

      </div>

        <div class="summary-synopsis"><p>Change an attribute if is not currently being changed, by calling the provided function.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#changing_attribute?/2" data-no-tooltip="" translate="no">changing_attribute?(changeset, attribute)</a>

      </div>

        <div class="summary-synopsis"><p>Returns true if an attribute exists in the changes.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#changing_attributes?/1" data-no-tooltip="" translate="no">changing_attributes?(changeset)</a>

      </div>

        <div class="summary-synopsis"><p>Returns true if any attributes on the resource are being changed.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#changing_relationship?/2" data-no-tooltip="" translate="no">changing_relationship?(changeset, relationship)</a>

      </div>

        <div class="summary-synopsis"><p>Returns true if a relationship exists in the changes</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#clear_change/2" data-no-tooltip="" translate="no">clear_change(changeset, field)</a>

      </div>

        <div class="summary-synopsis"><p>Clears an attribute or relationship change off of the changeset.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_argument/2" data-no-tooltip="" translate="no">delete_argument(changeset, argument_or_arguments)</a>

      </div>

        <div class="summary-synopsis"><p>Remove an argument from the changeset</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#deselect/2" data-no-tooltip="" translate="no">deselect(changeset, fields)</a>

      </div>

        <div class="summary-synopsis"><p>Ensure the the specified attributes are <code class="inline">nil</code> in the changeset results.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#ensure_selected/2" data-no-tooltip="" translate="no">ensure_selected(changeset, fields)</a>

      </div>

        <div class="summary-synopsis"><p>Ensures that the given attributes are selected.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#expand_upsert_fields/2" data-no-tooltip="" translate="no">expand_upsert_fields(fields, resource)</a>

      </div>

        <div class="summary-synopsis"><p>Turns the special case {:replace, fields}, :replace_all and {:replace_all_except, fields} upsert_fields
options into a list of fields</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#fetch_argument/2" data-no-tooltip="" translate="no">fetch_argument(changeset, argument)</a>

      </div>

        <div class="summary-synopsis"><p>Fetches the value of an argument provided to the changeset or <code class="inline">:error</code>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#fetch_argument_or_attribute/2" data-no-tooltip="" translate="no">fetch_argument_or_attribute(changeset, argument_or_attribute)</a>

      </div>

        <div class="summary-synopsis"><p>Fetches the value of an argument provided to the changeset, falling back to <a><code class="inline">Ash.Changeset.fetch_attribute/2</code></a> if nothing was provided.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#fetch_argument_or_change/2" data-no-tooltip="" translate="no">fetch_argument_or_change(changeset, attribute)</a>

      </div>

        <div class="summary-synopsis"><p>Gets the value of an argument provided to the changeset, falling back to <a><code class="inline">Ash.Changeset.fetch_change/2</code></a> if nothing was provided.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#fetch_attribute/2" data-no-tooltip="" translate="no">fetch_attribute(changeset, attribute)</a>

      </div>

        <div class="summary-synopsis"><p>Fetches the changing value or the original value of an attribute.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#fetch_change/2" data-no-tooltip="" translate="no">fetch_change(changeset, attribute)</a>

      </div>

        <div class="summary-synopsis"><p>Gets the new value for an attribute, or <code class="inline">:error</code> if it is not being changed.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#fetch_data/2" data-no-tooltip="" translate="no">fetch_data(changeset, attribute)</a>

      </div>

        <div class="summary-synopsis"><p>Gets the original value for an attribute, or <code class="inline">:error</code> if it is not available.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#filter/2" data-no-tooltip="" translate="no">filter(changeset, expr)</a>

      </div>

        <div class="summary-synopsis"><p>Adds a filter for a record being updated or destroyed.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#for_action/4" data-no-tooltip="" translate="no">for_action(initial, action, params \\ %{}, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Constructs a changeset for a given action, and validates it.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#for_create/4" data-no-tooltip="" translate="no">for_create(initial, action, params \\ %{}, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Constructs a changeset for a given create action, and validates it.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#for_destroy/4" data-no-tooltip="" translate="no">for_destroy(initial, action_or_name, params \\ %{}, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Constructs a changeset for a given destroy action, and validates it.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#for_update/4" data-no-tooltip="" translate="no">for_update(initial, action, params \\ %{}, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Constructs a changeset for a given update action, and validates it.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#force_change_attribute/3" data-no-tooltip="" translate="no">force_change_attribute(changeset, attribute, value)</a>

      </div>

        <div class="summary-synopsis"><p>Changes an attribute even if it isn't writable</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#force_change_attributes/2" data-no-tooltip="" translate="no">force_change_attributes(changeset, changes)</a>

      </div>

        <div class="summary-synopsis"><p>Calls <a><code class="inline">force_change_attribute/3</code></a> for each key/value pair provided.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#force_change_new_attribute/3" data-no-tooltip="" translate="no">force_change_new_attribute(changeset, attribute, value)</a>

      </div>

        <div class="summary-synopsis"><p>Force change an attribute if it is not currently being changed.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#force_change_new_attribute_lazy/3" data-no-tooltip="" translate="no">force_change_new_attribute_lazy(changeset, attribute, func)</a>

      </div>

        <div class="summary-synopsis"><p>Force change an attribute if it is not currently being changed, by calling the provided function.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#force_delete_argument/2" data-no-tooltip="" translate="no">force_delete_argument(changeset, argument_or_arguments)</a>

      </div>

        <div class="summary-synopsis"><p>Remove an argument from the changeset, not warning if the changeset has already been validated.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#force_set_argument/3" data-no-tooltip="" translate="no">force_set_argument(changeset, argument, value)</a>

      </div>

        <div class="summary-synopsis"><p>Add an argument to the changeset, which will be provided to the action.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#force_set_arguments/2" data-no-tooltip="" translate="no">force_set_arguments(changeset, map)</a>

      </div>

        <div class="summary-synopsis"><p>Merge a map of arguments to the arguments list.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#fully_atomic_changeset/4" data-no-tooltip="" translate="no">fully_atomic_changeset(resource, action, params, opts \\ [])</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_argument/2" data-no-tooltip="" translate="no">get_argument(changeset, argument)</a>

      </div>

        <div class="summary-synopsis"><p>Gets the value of an argument provided to the changeset.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_argument_or_attribute/2" data-no-tooltip="" translate="no">get_argument_or_attribute(changeset, attribute)</a>

      </div>

        <div class="summary-synopsis"><p>Gets the value of an argument provided to the changeset, falling back to <a><code class="inline">Ash.Changeset.get_attribute/2</code></a> if nothing was provided.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_attribute/2" data-no-tooltip="" translate="no">get_attribute(changeset, attribute)</a>

      </div>

        <div class="summary-synopsis"><p>Gets the changing value or the original value of an attribute.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_data/2" data-no-tooltip="" translate="no">get_data(changeset, attribute)</a>

      </div>

        <div class="summary-synopsis"><p>Gets the original value for an attribute</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#handle_errors/2" data-no-tooltip="" translate="no">handle_errors(changeset, func)</a>

      </div>

        <div class="summary-synopsis"><p>Sets a custom error handler on the changeset.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#is_valid/1" data-no-tooltip="" translate="no">is_valid(changeset)</a>

      </div>

        <div class="summary-synopsis"><p>A guard which checks if the Changeset is valid.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#load/2" data-no-tooltip="" translate="no">load(changeset, load)</a>

      </div>

        <div class="summary-synopsis"><p>Calls the provided load statement on the result of the action at the very end of the action.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#loading?/2" data-no-tooltip="" translate="no">loading?(changeset, path)</a>

      </div>

        <div class="summary-synopsis"><p>Returns true if the field/relationship or path to field/relationship is being loaded.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#manage_relationship/4" data-no-tooltip="" translate="no">manage_relationship(changeset, relationship, input, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Manages the related records by creating, updating, or destroying them as necessary.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#new/1" data-no-tooltip="" translate="no">new(record_or_resource)</a>

      </div>

        <div class="summary-synopsis"><p>Returns a new changeset over a resource.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#prepare_changeset_for_action/3" data-no-tooltip="" translate="no">prepare_changeset_for_action(changeset, action, opts)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#present?/2" data-no-tooltip="" translate="no">present?(changeset, attribute)</a>

      </div>

        <div class="summary-synopsis"><p>Checks if an argument is not nil or an attribute is not nil, either in the original data, or that it is not being changed to a <code class="inline">nil</code> value if it is changing.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#put_context/3" data-no-tooltip="" translate="no">put_context(changeset, key, value)</a>

      </div>

        <div class="summary-synopsis"><p>Puts a key/value in the changeset context that can be used later.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#run_before_transaction_hooks/1" data-no-tooltip="" translate="no">run_before_transaction_hooks(changeset)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#select/3" data-no-tooltip="" translate="no">select(changeset, fields, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Ensure that only the specified attributes are present in the results.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#selecting?/2" data-no-tooltip="" translate="no">selecting?(changeset, field)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#set_argument/3" data-no-tooltip="" translate="no">set_argument(changeset, argument, value)</a>

      </div>

        <div class="summary-synopsis"><p>Add an argument to the changeset, which will be provided to the action.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#set_arguments/2" data-no-tooltip="" translate="no">set_arguments(changeset, map)</a>

      </div>

        <div class="summary-synopsis"><p>Merge a map of arguments to the arguments list.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#set_context/2" data-no-tooltip="" translate="no">set_context(changeset, map)</a>

      </div>

        <div class="summary-synopsis"><p>Deep merges the provided map into the changeset context that can be used later.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#set_private_argument/3" data-no-tooltip="" translate="no">set_private_argument(changeset, argument, value)</a>

      </div>

        <div class="summary-synopsis"><p>Add a private argument to the changeset, which will be provided to the action.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#set_result/2" data-no-tooltip="" translate="no">set_result(changeset, result)</a>

      </div>

        <div class="summary-synopsis"><p>Set the result of the action. This will prevent running the underlying datalayer behavior</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#set_tenant/2" data-no-tooltip="" translate="no">set_tenant(changeset, tenant)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#timeout/3" data-no-tooltip="" translate="no">timeout(changeset, timeout, default \\ nil)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update_change/3" data-no-tooltip="" translate="no">update_change(changeset, attribute, fun)</a>

      </div>

        <div class="summary-synopsis"><p>Updates an existing attribute change by applying a function to it.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#with_hooks/3" data-no-tooltip="" translate="no">with_hooks(changeset, func, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Wraps a function in the before/after action hooks of a changeset.</p></div>

    </div>

</div>

      </section>


      <section id="types" class="details-list">
        <h1 class="section-heading">Types</h1>
        <div class="types-list">
<section class="detail" id="t:after_action_fun/0">

  <div class="detail-header">
    <a href="#t:after_action_fun/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">after_action_fun()</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L229" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> after_action_fun() :: (<a href="#t:t/0">t</a>(), <a href="Ash.Resource.xhtml#t:record/0">Ash.Resource.record</a>() -&gt;
                         {:ok, <a href="Ash.Resource.xhtml#t:record/0">Ash.Resource.record</a>()}
                         | {:ok, <a href="Ash.Resource.xhtml#t:record/0">Ash.Resource.record</a>(),
                            [<a href="Ash.Notifier.Notification.xhtml#t:t/0">Ash.Notifier.Notification.t</a>()]}
                         | {:error, <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()})</pre>

      </div>

<p>Function type for after action hooks.</p><p>Receives the changeset and the successfully created/updated record, and can return
the record optionally with notifications, or an error.</p>
  </section>
</section>
<section class="detail" id="t:after_transaction_fun/0">

  <div class="detail-header">
    <a href="#t:after_transaction_fun/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">after_transaction_fun()</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L241" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> after_transaction_fun() :: (<a href="#t:t/0">t</a>(),
                            {:ok, <a href="Ash.Resource.xhtml#t:record/0">Ash.Resource.record</a>()}
                            | {:error, <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()} -&gt;
                              {:ok, <a href="Ash.Resource.xhtml#t:record/0">Ash.Resource.record</a>()} | {:error, <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()})</pre>

      </div>

<p>Function type for after transaction hooks.</p><p>Receives the changeset and the result (success or failure) of the action,
and returns the result (potentially modified).</p>
  </section>
</section>
<section class="detail" id="t:around_action_callback/0">

  <div class="detail-header">
    <a href="#t:around_action_callback/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">around_action_callback()</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L273" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> around_action_callback() :: (<a href="#t:t/0">t</a>() -&gt; <a href="#t:around_action_result/0">around_action_result</a>())</pre>

      </div>

<p>Callback function type for around action hooks.</p><p>A function that takes a changeset and returns an around action result.</p>
  </section>
</section>
<section class="detail" id="t:around_action_fun/0">

  <div class="detail-header">
    <a href="#t:around_action_fun/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">around_action_fun()</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L280" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> around_action_fun() :: (<a href="#t:t/0">t</a>(), <a href="#t:around_action_callback/0">around_action_callback</a>() -&gt; <a href="#t:around_action_result/0">around_action_result</a>())</pre>

      </div>

<p>Function type for around action hooks.</p><p>Receives a changeset and a callback function that must be called with the changeset.</p>
  </section>
</section>
<section class="detail" id="t:around_action_result/0">

  <div class="detail-header">
    <a href="#t:around_action_result/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">around_action_result()</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L264" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> around_action_result() ::
  {:ok, <a href="Ash.Resource.xhtml#t:record/0">Ash.Resource.record</a>(), <a href="#t:t/0">t</a>(),
   %{notifications: [<a href="Ash.Notifier.Notification.xhtml#t:t/0">Ash.Notifier.Notification.t</a>()]}}
  | {:error, <a href="Ash.Error.xhtml#t:t/0">Ash.Error.t</a>()}</pre>

      </div>

<p>Result type for around action callbacks.</p><p>Contains the successful result with record, changeset, and notifications, or an error.</p>
  </section>
</section>
<section class="detail" id="t:around_transaction_callback/0">

  <div class="detail-header">
    <a href="#t:around_transaction_callback/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">around_transaction_callback()</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L294" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> around_transaction_callback() :: (<a href="#t:t/0">t</a>() -&gt; <a href="#t:around_transaction_result/0">around_transaction_result</a>())</pre>

      </div>

<p>Callback function type for around transaction hooks.</p><p>A function that takes a changeset and returns an around transaction result.</p>
  </section>
</section>
<section class="detail" id="t:around_transaction_fun/0">

  <div class="detail-header">
    <a href="#t:around_transaction_fun/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">around_transaction_fun()</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L301" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> around_transaction_fun() :: (<a href="#t:t/0">t</a>(), <a href="#t:around_transaction_callback/0">around_transaction_callback</a>() -&gt;
                               <a href="#t:around_transaction_result/0">around_transaction_result</a>())</pre>

      </div>

<p>Function type for around transaction hooks.</p><p>Receives a changeset and a callback function that must be called with the changeset.</p>
  </section>
</section>
<section class="detail" id="t:around_transaction_result/0">

  <div class="detail-header">
    <a href="#t:around_transaction_result/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">around_transaction_result()</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L287" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> around_transaction_result() :: {:ok, <a href="Ash.Resource.xhtml#t:record/0">Ash.Resource.record</a>()} | {:error, <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()}</pre>

      </div>

<p>Result type for around transaction callbacks.</p><p>Contains either a successful result with the record or an error.</p>
  </section>
</section>
<section class="detail" id="t:before_action_fun/0">

  <div class="detail-header">
    <a href="#t:before_action_fun/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">before_action_fun()</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L250" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> before_action_fun() :: (<a href="#t:t/0">t</a>() -&gt;
                          <a href="#t:t/0">t</a>()
                          | {<a href="#t:t/0">t</a>(),
                             %{notifications: [<a href="Ash.Notifier.Notification.xhtml#t:t/0">Ash.Notifier.Notification.t</a>()]}})</pre>

      </div>

<p>Function type for before action hooks.</p><p>Receives a changeset and returns a modified changeset, optionally with notifications.</p>
  </section>
</section>
<section class="detail" id="t:before_transaction_fun/0">

  <div class="detail-header">
    <a href="#t:before_transaction_fun/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">before_transaction_fun()</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L257" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> before_transaction_fun() :: (<a href="#t:t/0">t</a>() -&gt; <a href="#t:t/0">t</a>())</pre>

      </div>

<p>Function type for before transaction hooks.</p><p>Receives a changeset and returns a modified changeset.</p>
  </section>
</section>
<section class="detail" id="t:error_info/0">

  <div class="detail-header">
    <a href="#t:error_info/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">error_info()</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L367" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> error_info() :: <a href="Ash.Error.xhtml#t:error_input/0">Ash.Error.error_input</a>()</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:manage_relationship_type/0">

  <div class="detail-header">
    <a href="#t:manage_relationship_type/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">manage_relationship_type()</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L4968" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> manage_relationship_type() ::
  :append_and_remove | :append | :remove | :direct_control | :create</pre>

      </div>

<p>The type of relationship management strategy to use.</p><p>Defines how related records should be handled when managing relationships.</p>
  </section>
</section>
<section class="detail" id="t:phase/0">

  <div class="detail-header">
    <a href="#t:phase/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">phase()</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L320" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> phase() ::
  :around_transaction
  | :around_action
  | :after_transaction
  | :before_transaction
  | :after_action
  | :before_action
  | :validate
  | :pending
  | :atomic</pre>

      </div>

<p>The current phase of changeset processing.</p><p>Represents where the changeset is in its lifecycle, from pending through various hook phases.</p>
  </section>
</section>
<section class="detail" id="t:t/0">

  <div class="detail-header">
    <a href="#t:t/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">t()</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L328" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> t() :: %Ash.Changeset{
  __validated_for_action__: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>() | nil,
  action: <a href="Ash.Resource.Actions.xhtml#t:action/0">Ash.Resource.Actions.action</a>() | nil,
  action_failed?: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">boolean</a>(),
  action_select: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  action_type: <a href="Ash.Resource.Actions.xhtml#t:action_type/0">Ash.Resource.Actions.action_type</a>() | nil,
  added_filter: <a href="Ash.Filter.xhtml#t:t/0">Ash.Filter.t</a>() | nil,
  after_action: [<a href="#t:after_action_fun/0">after_action_fun</a>() | {<a href="#t:after_action_fun/0">after_action_fun</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>()}],
  after_transaction: [
    <a href="#t:after_transaction_fun/0">after_transaction_fun</a>() | {<a href="#t:after_transaction_fun/0">after_transaction_fun</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>()}
  ],
  arguments: %{optional(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) =&gt; <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()},
  around_action: [<a href="#t:around_action_fun/0">around_action_fun</a>() | {<a href="#t:around_action_fun/0">around_action_fun</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>()}],
  around_transaction: [
    <a href="#t:around_transaction_fun/0">around_transaction_fun</a>() | {<a href="#t:around_transaction_fun/0">around_transaction_fun</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>()}
  ],
  atomic_after_action: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  atomic_changes: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  atomic_validations: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  atomics: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>(),
  attribute_changes: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  attributes: %{optional(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) =&gt; <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()},
  before_action: [<a href="#t:before_action_fun/0">before_action_fun</a>() | {<a href="#t:before_action_fun/0">before_action_fun</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>()}],
  before_transaction: [
    <a href="#t:before_transaction_fun/0">before_transaction_fun</a>() | {<a href="#t:before_transaction_fun/0">before_transaction_fun</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>()}
  ],
  casted_arguments: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  casted_attributes: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  context: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>(),
  context_changes: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  data: <a href="Ash.Resource.xhtml#t:record/0">Ash.Resource.record</a>() | nil,
  defaults: [<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()],
  dirty_hooks: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  domain: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">module</a>() | nil,
  errors: [<a href="Ash.Error.xhtml#t:t/0">Ash.Error.t</a>()],
  filter: <a href="Ash.Filter.xhtml#t:t/0">Ash.Filter.t</a>() | nil,
  handle_errors:
    nil
    | (<a href="#t:t/0">t</a>(), error :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>() -&gt;
         :ignore | <a href="#t:t/0">t</a>() | (error :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()) | {error :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>(), <a href="#t:t/0">t</a>()}),
  invalid_keys: <a href="https://hexdocs.pm/elixir/MapSet.html#t:t/0">MapSet.t</a>(),
  load: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">keyword</a>(<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">keyword</a>()),
  no_atomic_constraints: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  params: %{optional(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>() | <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">binary</a>()) =&gt; <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()},
  phase: <a href="#t:phase/0">phase</a>(),
  relationships: %{
    optional(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) =&gt;
      %{optional(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>() | <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">binary</a>()) =&gt; <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()}
      | [%{optional(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>() | <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">binary</a>()) =&gt; <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()}]
  },
  resource: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">module</a>(),
  select: [<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()] | nil,
  tenant: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  timeout: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">pos_integer</a>() | nil,
  to_tenant: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  valid?: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">boolean</a>()
}</pre>

      </div>

<p>The changeset struct containing all the information about a pending action.</p><p>This struct tracks changes to attributes, arguments for the action, validation state,
hooks to run at various points, and other metadata needed to execute an action.</p>
  </section>
</section>

        </div>
      </section>

      <section id="functions" class="details-list">
        <h1 class="section-heading">Functions</h1>
        <div class="functions-list">
<section class="detail" id="accessing/3">

    <span id="accessing/1"></span>

    <span id="accessing/2"></span>

  <div class="detail-header">
    <a href="#accessing/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">accessing(changeset, types \\ [:attributes, :relationships, :calculations, :attributes], only_public? \\ true)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L771" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Returns a list of attributes, aggregates, relationships, and calculations that are being loaded</p><p>Provide a list of field types to narrow down the returned results.</p>
  </section>
</section>
<section class="detail" id="add_error/3">

    <span id="add_error/2"></span>

  <div class="detail-header">
    <a href="#add_error/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">add_error(changeset, errors, path \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L7072" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> add_error(<a href="#t:t/0">t</a>(), <a href="Ash.Error.xhtml#t:error_input/0">Ash.Error.error_input</a>(), path :: <a href="Ash.Error.xhtml#t:path_input/0">Ash.Error.path_input</a>()) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Add an error to the errors list and mark the changeset as invalid.</p><p>See <a href="Ash.Error.xhtml#to_ash_error/3"><code class="inline">Ash.Error.to_ash_error/3</code></a> for more on supported values for <code class="inline">error</code></p>
  </section>
</section>
<section class="detail" id="after_action/3">

    <span id="after_action/2"></span>

  <div class="detail-header">
    <a href="#after_action/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">after_action(changeset, func, opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L6686" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> after_action(
  changeset :: <a href="#t:t/0">t</a>(),
  fun :: <a href="#t:after_action_fun/0">after_action_fun</a>(),
  opts :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()
) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Adds an after_action hook to the changeset.</p><p>After action hooks run within the database transaction after the data layer action succeeds.
They are perfect for:</p><ul><li>Creating related records that depend on the main action's result</li><li>Sending notifications with the final record data</li><li>Updating derived data or maintaining referential integrity</li><li>Triggering business logic that needs the persisted record</li><li>Creating audit trails with the actual saved data</li></ul><p>The hook receives both the changeset and the successfully created/updated record.
Any errors returned will roll back the entire transaction.</p><p>Provide the option <code class="inline">prepend?: true</code> to place the hook before all other hooks instead of after.</p><h2 id="after_action/3-examples" class="section-heading"><a href="#after_action/3-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="c1"># Create related audit record with the final data</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_update</samp><samp class="p" data-group-id="1979502831-1">(</samp><samp class="n">user</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:update_profile</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="1979502831-2">%{</samp><samp class="ss">email</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;new@example.com&quot;</samp><samp class="p" data-group-id="1979502831-2">}</samp><samp class="p" data-group-id="1979502831-1">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">after_action</samp><samp class="p" data-group-id="1979502831-3">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="k" data-group-id="1979502831-4">fn</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">updated_user</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="p" data-group-id="1979502831-5">{</samp><samp class="ss">:ok</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="c">_audit</samp><samp class="p" data-group-id="1979502831-5">}</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">MyApp.AuditLog</samp><samp class="o">.</samp><samp class="n">create</samp><samp class="p" data-group-id="1979502831-6">(</samp><samp class="p" data-group-id="1979502831-7">%{</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="ss">action</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;profile_updated&quot;</samp><samp class="p">,</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="ss">user_id</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="n">updated_user</samp><samp class="o">.</samp><samp class="n">id</samp><samp class="p">,</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="ss">changes</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">attributes</samp><samp class="p">,</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="ss">actor_id</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">context</samp><samp class="o">.</samp><samp class="n">actor</samp><samp class="o">.</samp><samp class="n">id</samp><samp class="p">,</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="ss">timestamp</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="nc">DateTime</samp><samp class="o">.</samp><samp class="n">utc_now</samp><samp class="p" data-group-id="1979502831-8">(</samp><samp class="p" data-group-id="1979502831-8">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="p" data-group-id="1979502831-7">}</samp><samp class="p" data-group-id="1979502831-6">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="p" data-group-id="1979502831-9">{</samp><samp class="ss">:ok</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">updated_user</samp><samp class="p" data-group-id="1979502831-9">}</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="k" data-group-id="1979502831-4">end</samp><samp class="p" data-group-id="1979502831-3">)</samp><samp class="w">

</samp><samp class="c1"># Send notification with the final record</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="1979502831-10">(</samp><samp class="nc">MyApp.Order</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="1979502831-11">%{</samp><samp class="ss">total</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mf">100.00</samp><samp class="p" data-group-id="1979502831-11">}</samp><samp class="p" data-group-id="1979502831-10">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">after_action</samp><samp class="p" data-group-id="1979502831-12">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="k" data-group-id="1979502831-13">fn</samp><samp class="w"> </samp><samp class="c">_changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">order</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="nc">NotificationService</samp><samp class="o">.</samp><samp class="n">send_order_confirmation</samp><samp class="p" data-group-id="1979502831-14">(</samp><samp class="p" data-group-id="1979502831-15">%{</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="ss">order_id</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="n">order</samp><samp class="o">.</samp><samp class="n">id</samp><samp class="p">,</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="ss">customer_email</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="n">order</samp><samp class="o">.</samp><samp class="n">customer_email</samp><samp class="p">,</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="ss">total</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="n">order</samp><samp class="o">.</samp><samp class="n">total</samp><samp class="p">,</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="ss">order_number</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="n">order</samp><samp class="o">.</samp><samp class="n">number</samp><samp class="w">  </samp><samp class="c1"># Generated by the database</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="p" data-group-id="1979502831-15">}</samp><samp class="p" data-group-id="1979502831-14">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="p" data-group-id="1979502831-16">{</samp><samp class="ss">:ok</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">order</samp><samp class="p" data-group-id="1979502831-16">}</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="k" data-group-id="1979502831-13">end</samp><samp class="p" data-group-id="1979502831-12">)</samp><samp class="w">

</samp><samp class="c1"># Update related records that depend on the main record</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="1979502831-17">(</samp><samp class="nc">MyApp.Post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:publish</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="1979502831-18">%{</samp><samp class="ss">title</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;My Post&quot;</samp><samp class="p" data-group-id="1979502831-18">}</samp><samp class="p" data-group-id="1979502831-17">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">after_action</samp><samp class="p" data-group-id="1979502831-19">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="k" data-group-id="1979502831-20">fn</samp><samp class="w"> </samp><samp class="c">_changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">post</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="c1"># Update author&#39;s post count</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="p" data-group-id="1979502831-21">{</samp><samp class="ss">:ok</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="c">_author</samp><samp class="p" data-group-id="1979502831-21">}</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">MyApp.User</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_update</samp><samp class="p" data-group-id="1979502831-22">(</samp><samp class="ss">:increment_post_count</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="1979502831-23">%{</samp><samp class="p" data-group-id="1979502831-23">}</samp><samp class="p" data-group-id="1979502831-22">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash</samp><samp class="o">.</samp><samp class="n">update</samp><samp class="p" data-group-id="1979502831-24">(</samp><samp class="p" data-group-id="1979502831-24">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="p" data-group-id="1979502831-25">{</samp><samp class="ss">:ok</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">post</samp><samp class="p" data-group-id="1979502831-25">}</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="k" data-group-id="1979502831-20">end</samp><samp class="p" data-group-id="1979502831-19">)</samp></code></pre><h2 id="after_action/3-see-also" class="section-heading"><a href="#after_action/3-see-also" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">See also</span></h2><ul><li><a href="#before_action/3"><code class="inline">before_action/3</code></a> for hooks that run before the data layer action</li><li><a href="#after_transaction/3"><code class="inline">after_transaction/3</code></a> for hooks that run after the transaction commits</li><li><a href="#around_action/2"><code class="inline">around_action/2</code></a> for hooks that wrap the data layer action</li></ul>
  </section>
</section>
<section class="detail" id="after_transaction/3">

    <span id="after_transaction/2"></span>

  <div class="detail-header">
    <a href="#after_transaction/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">after_transaction(changeset, func, opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L6788" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> after_transaction(
  changeset :: <a href="#t:t/0">t</a>(),
  fun :: <a href="#t:after_transaction_fun/0">after_transaction_fun</a>(),
  opts :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()
) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Adds an after_transaction hook to the changeset. Cannot be called within other hooks.</p><p>After transaction hooks run outside the database transaction and are called regardless
of whether the action succeeded or failed. They are essential for:</p><ul><li>Cleanup operations that must happen regardless of success/failure</li><li>External service notifications that shouldn't be rolled back</li><li>Logging final outcomes for auditing purposes</li><li>Releasing external resources or locks</li><li>Sending emails or notifications that should persist even if the action failed</li></ul><p>The hook receives the changeset and either <code class="inline">{:ok, result}</code> or <code class="inline">{:error, error}</code>,
allowing you to handle both success and failure cases appropriately.</p><p>Provide the option <code class="inline">prepend?: true</code> to place the hook before all other hooks instead of after.</p><h2 id="after_transaction/3-examples" class="section-heading"><a href="#after_transaction/3-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="c1"># Send notification regardless of order creation success/failure</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="3515476770-1">(</samp><samp class="nc">MyApp.Order</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="3515476770-2">%{</samp><samp class="ss">total</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mf">100.00</samp><samp class="p" data-group-id="3515476770-2">}</samp><samp class="p" data-group-id="3515476770-1">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">after_transaction</samp><samp class="p" data-group-id="3515476770-3">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="k" data-group-id="3515476770-4">fn</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">result</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="k">case</samp><samp class="w"> </samp><samp class="n">result</samp><samp class="w"> </samp><samp class="k" data-group-id="3515476770-5">do</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="p" data-group-id="3515476770-6">{</samp><samp class="ss">:ok</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">order</samp><samp class="p" data-group-id="3515476770-6">}</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">      </samp><samp class="nc">NotificationService</samp><samp class="o">.</samp><samp class="n">order_created_successfully</samp><samp class="p" data-group-id="3515476770-7">(</samp><samp class="n">order</samp><samp class="o">.</samp><samp class="n">id</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">context</samp><samp class="o">.</samp><samp class="n">actor</samp><samp class="p" data-group-id="3515476770-7">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="p" data-group-id="3515476770-8">{</samp><samp class="ss">:error</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="c">_error</samp><samp class="p" data-group-id="3515476770-8">}</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">      </samp><samp class="nc">NotificationService</samp><samp class="o">.</samp><samp class="n">order_creation_failed</samp><samp class="p" data-group-id="3515476770-9">(</samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">attributes</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">context</samp><samp class="o">.</samp><samp class="n">actor</samp><samp class="p" data-group-id="3515476770-9">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="k" data-group-id="3515476770-5">end</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="n">result</samp><samp class="w">  </samp><samp class="c1"># Always return the original result</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="k" data-group-id="3515476770-4">end</samp><samp class="p" data-group-id="3515476770-3">)</samp><samp class="w">

</samp><samp class="c1"># Release external resources or cleanup</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_update</samp><samp class="p" data-group-id="3515476770-10">(</samp><samp class="n">file</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:process</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="3515476770-11">%{</samp><samp class="ss">status</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;processing&quot;</samp><samp class="p" data-group-id="3515476770-11">}</samp><samp class="p" data-group-id="3515476770-10">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">after_transaction</samp><samp class="p" data-group-id="3515476770-12">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="k" data-group-id="3515476770-13">fn</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">result</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="c1"># Always release the file lock, regardless of processing outcome</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="nc">ExternalFileService</samp><samp class="o">.</samp><samp class="n">release_lock</samp><samp class="p" data-group-id="3515476770-14">(</samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">data</samp><samp class="o">.</samp><samp class="n">file_path</samp><samp class="p" data-group-id="3515476770-14">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="k">case</samp><samp class="w"> </samp><samp class="n">result</samp><samp class="w"> </samp><samp class="k" data-group-id="3515476770-15">do</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="p" data-group-id="3515476770-16">{</samp><samp class="ss">:ok</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">processed_file</samp><samp class="p" data-group-id="3515476770-16">}</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">      </samp><samp class="nc">Logger</samp><samp class="o">.</samp><samp class="n">info</samp><samp class="p" data-group-id="3515476770-17">(</samp><samp class="s">&quot;File processing completed successfully: </samp><samp class="si" data-group-id="3515476770-18">#{</samp><samp class="n">processed_file</samp><samp class="o">.</samp><samp class="n">id</samp><samp class="si" data-group-id="3515476770-18">}</samp><samp class="s">&quot;</samp><samp class="p" data-group-id="3515476770-17">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="p" data-group-id="3515476770-19">{</samp><samp class="ss">:error</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">error</samp><samp class="p" data-group-id="3515476770-19">}</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">      </samp><samp class="nc">Logger</samp><samp class="o">.</samp><samp class="n">error</samp><samp class="p" data-group-id="3515476770-20">(</samp><samp class="s">&quot;File processing failed: </samp><samp class="si" data-group-id="3515476770-21">#{</samp><samp class="n">inspect</samp><samp class="p" data-group-id="3515476770-22">(</samp><samp class="n">error</samp><samp class="p" data-group-id="3515476770-22">)</samp><samp class="si" data-group-id="3515476770-21">}</samp><samp class="s">&quot;</samp><samp class="p" data-group-id="3515476770-20">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">      </samp><samp class="c1"># Could trigger retry mechanism here</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="k" data-group-id="3515476770-15">end</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="n">result</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="k" data-group-id="3515476770-13">end</samp><samp class="p" data-group-id="3515476770-12">)</samp><samp class="w">

</samp><samp class="c1"># Audit final outcome for compliance</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_update</samp><samp class="p" data-group-id="3515476770-23">(</samp><samp class="n">sensitive_record</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:update</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="3515476770-24">%{</samp><samp class="ss">classification</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;top_secret&quot;</samp><samp class="p" data-group-id="3515476770-24">}</samp><samp class="p" data-group-id="3515476770-23">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">after_transaction</samp><samp class="p" data-group-id="3515476770-25">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="k" data-group-id="3515476770-26">fn</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">result</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="n">outcome</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="k">case</samp><samp class="w"> </samp><samp class="n">result</samp><samp class="w"> </samp><samp class="k" data-group-id="3515476770-27">do</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="p" data-group-id="3515476770-28">{</samp><samp class="ss">:ok</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="bp">_</samp><samp class="p" data-group-id="3515476770-28">}</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w"> </samp><samp class="s">&quot;success&quot;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="p" data-group-id="3515476770-29">{</samp><samp class="ss">:error</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="bp">_</samp><samp class="p" data-group-id="3515476770-29">}</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w"> </samp><samp class="s">&quot;failure&quot;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="k" data-group-id="3515476770-27">end</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="nc">ComplianceLogger</samp><samp class="o">.</samp><samp class="n">log_security_action</samp><samp class="p" data-group-id="3515476770-30">(</samp><samp class="p" data-group-id="3515476770-31">%{</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="ss">action</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:update_classification</samp><samp class="p">,</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="ss">actor</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">context</samp><samp class="o">.</samp><samp class="n">actor</samp><samp class="p">,</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="ss">resource_id</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">data</samp><samp class="o">.</samp><samp class="n">id</samp><samp class="p">,</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="ss">outcome</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="n">outcome</samp><samp class="p">,</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="ss">timestamp</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="nc">DateTime</samp><samp class="o">.</samp><samp class="n">utc_now</samp><samp class="p" data-group-id="3515476770-32">(</samp><samp class="p" data-group-id="3515476770-32">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="p" data-group-id="3515476770-31">}</samp><samp class="p" data-group-id="3515476770-30">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="n">result</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="k" data-group-id="3515476770-26">end</samp><samp class="p" data-group-id="3515476770-25">)</samp></code></pre><h2 id="after_transaction/3-see-also" class="section-heading"><a href="#after_transaction/3-see-also" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">See also</span></h2><ul><li><a href="#after_action/3"><code class="inline">after_action/3</code></a> for hooks that run within the transaction on success only</li><li><a href="#before_transaction/3"><code class="inline">before_transaction/3</code></a> for hooks that run before the transaction starts</li><li><a href="#around_transaction/2"><code class="inline">around_transaction/2</code></a> for hooks that wrap the entire transaction</li></ul>
  </section>
</section>
<section class="detail" id="apply_attributes/2">

    <span id="apply_attributes/1"></span>

  <div class="detail-header">
    <a href="#apply_attributes/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">apply_attributes(changeset, opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L6929" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> apply_attributes(<a href="#t:t/0">t</a>(), opts :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()) ::
  {:ok, <a href="Ash.Resource.xhtml#t:record/0">Ash.Resource.record</a>()} | {:error, <a href="#t:t/0">t</a>()}</pre>

      </div>

<p>Returns the original data with attribute changes merged, if the changeset is valid.</p><p>Options:</p><ul><li>force? - applies current attributes even if the changeset is not valid</li></ul>
  </section>
</section>
<section class="detail" id="around_action/3">

    <span id="around_action/2"></span>

  <div class="detail-header">
    <a href="#around_action/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">around_action(changeset, func, opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L6849" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> around_action(
  changeset :: <a href="#t:t/0">t</a>(),
  fun :: <a href="#t:around_action_fun/0">around_action_fun</a>(),
  opts :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()
) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Adds an around_action hook to the changeset.</p><p>Around action hooks wrap the data layer action execution within the transaction.
This is a specialized hook primarily useful for:</p><ul><li>Debugging and development tooling that needs to wrap action execution</li><li>Action timing and performance monitoring for profiling</li><li>Testing frameworks that need to intercept action execution</li><li>Advanced error handling that requires wrapping the action itself</li></ul><p>Your function receives the changeset and a callback that must be called with a changeset.
The callback returns <code class="inline">{:ok, result, changeset, instructions}</code> or <code class="inline">{:error, error}</code>.
You can modify these values, but must return the same structure.</p><p><strong>Warning</strong>: This is an advanced hook that runs within the database transaction.
You <em>must</em> call the callback function. For most use cases, <a href="#before_action/3"><code class="inline">before_action/3</code></a> and
<a href="#after_action/3"><code class="inline">after_action/3</code></a> are simpler and more appropriate.</p><h2 id="around_action/3-examples" class="section-heading"><a href="#around_action/3-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="c1"># Monitor action execution time for debugging</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="1360348207-1">(</samp><samp class="nc">MyApp.Order</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="1360348207-2">%{</samp><samp class="ss">total</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mf">100.00</samp><samp class="p" data-group-id="1360348207-2">}</samp><samp class="p" data-group-id="1360348207-1">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">around_action</samp><samp class="p" data-group-id="1360348207-3">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="k" data-group-id="1360348207-4">fn</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">callback</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="n">start_time</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">System</samp><samp class="o">.</samp><samp class="n">monotonic_time</samp><samp class="p" data-group-id="1360348207-5">(</samp><samp class="ss">:microsecond</samp><samp class="p" data-group-id="1360348207-5">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="n">result</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="n">callback</samp><samp class="o">.</samp><samp class="p" data-group-id="1360348207-6">(</samp><samp class="n">changeset</samp><samp class="p" data-group-id="1360348207-6">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="n">duration</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">System</samp><samp class="o">.</samp><samp class="n">monotonic_time</samp><samp class="p" data-group-id="1360348207-7">(</samp><samp class="ss">:microsecond</samp><samp class="p" data-group-id="1360348207-7">)</samp><samp class="w"> </samp><samp class="o">-</samp><samp class="w"> </samp><samp class="n">start_time</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="nc">Logger</samp><samp class="o">.</samp><samp class="n">debug</samp><samp class="p" data-group-id="1360348207-8">(</samp><samp class="s">&quot;Action </samp><samp class="si" data-group-id="1360348207-9">#{</samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">action</samp><samp class="o">.</samp><samp class="n">name</samp><samp class="si" data-group-id="1360348207-9">}</samp><samp class="s"> took </samp><samp class="si" data-group-id="1360348207-10">#{</samp><samp class="n">duration</samp><samp class="si" data-group-id="1360348207-10">}</samp><samp class="s">s&quot;</samp><samp class="p" data-group-id="1360348207-8">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="n">result</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="k" data-group-id="1360348207-4">end</samp><samp class="p" data-group-id="1360348207-3">)</samp></code></pre><h2 id="around_action/3-see-also" class="section-heading"><a href="#around_action/3-see-also" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">See also</span></h2><ul><li><a href="#before_action/3"><code class="inline">before_action/3</code></a> and <a href="#after_action/3"><code class="inline">after_action/3</code></a> for most workflow needs</li><li><a href="#around_transaction/2"><code class="inline">around_transaction/2</code></a> for wrapping the entire transaction</li><li>Multi-step actions guide for complex workflow patterns</li></ul>
  </section>
</section>
<section class="detail" id="around_transaction/3">

    <span id="around_transaction/2"></span>

  <div class="detail-header">
    <a href="#around_transaction/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">around_transaction(changeset, func, opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L6903" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> around_transaction(
  changeset :: <a href="#t:t/0">t</a>(),
  fun :: <a href="#t:around_transaction_fun/0">around_transaction_fun</a>(),
  opts :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()
) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Adds an around_transaction hook to the changeset.</p><p>Around transaction hooks wrap the entire database transaction execution.
This is a specialized hook primarily useful for:</p><ul><li>Debugging and development tooling that needs to wrap transaction execution</li><li>Transaction timing and monitoring for performance analysis</li><li>Testing frameworks that need to intercept transaction behavior</li><li>Advanced transaction management that requires wrapping all hook execution</li></ul><p>Your function receives the changeset and a callback that must be called with a changeset.
The callback returns <code class="inline">{:ok, result}</code> or <code class="inline">{:error, error}</code>. You can modify these values,
but must return the same structure.</p><p><strong>Warning</strong>: This is an advanced hook that controls transaction execution.
You <em>must</em> call the callback function. For most use cases, <a href="#before_transaction/3"><code class="inline">before_transaction/3</code></a>
and <a href="#after_transaction/3"><code class="inline">after_transaction/3</code></a> are simpler and more appropriate.</p><h2 id="around_transaction/3-examples" class="section-heading"><a href="#around_transaction/3-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="c1"># Monitor transaction execution time</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="0835071037-1">(</samp><samp class="nc">MyApp.Order</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="0835071037-2">%{</samp><samp class="ss">total</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mf">100.00</samp><samp class="p" data-group-id="0835071037-2">}</samp><samp class="p" data-group-id="0835071037-1">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">around_transaction</samp><samp class="p" data-group-id="0835071037-3">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="k" data-group-id="0835071037-4">fn</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">callback</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="n">tx_start</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">System</samp><samp class="o">.</samp><samp class="n">monotonic_time</samp><samp class="p" data-group-id="0835071037-5">(</samp><samp class="ss">:microsecond</samp><samp class="p" data-group-id="0835071037-5">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="n">result</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="n">callback</samp><samp class="o">.</samp><samp class="p" data-group-id="0835071037-6">(</samp><samp class="n">changeset</samp><samp class="p" data-group-id="0835071037-6">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="n">tx_duration</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">System</samp><samp class="o">.</samp><samp class="n">monotonic_time</samp><samp class="p" data-group-id="0835071037-7">(</samp><samp class="ss">:microsecond</samp><samp class="p" data-group-id="0835071037-7">)</samp><samp class="w"> </samp><samp class="o">-</samp><samp class="w"> </samp><samp class="n">tx_start</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="nc">Logger</samp><samp class="o">.</samp><samp class="n">debug</samp><samp class="p" data-group-id="0835071037-8">(</samp><samp class="s">&quot;Transaction for </samp><samp class="si" data-group-id="0835071037-9">#{</samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">action</samp><samp class="o">.</samp><samp class="n">name</samp><samp class="si" data-group-id="0835071037-9">}</samp><samp class="s"> took </samp><samp class="si" data-group-id="0835071037-10">#{</samp><samp class="n">tx_duration</samp><samp class="si" data-group-id="0835071037-10">}</samp><samp class="s">s&quot;</samp><samp class="p" data-group-id="0835071037-8">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="n">result</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="k" data-group-id="0835071037-4">end</samp><samp class="p" data-group-id="0835071037-3">)</samp></code></pre><h2 id="around_transaction/3-see-also" class="section-heading"><a href="#around_transaction/3-see-also" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">See also</span></h2><ul><li><a href="#before_transaction/3"><code class="inline">before_transaction/3</code></a> and <a href="#after_transaction/3"><code class="inline">after_transaction/3</code></a> for most workflow needs</li><li><a href="#around_action/2"><code class="inline">around_action/2</code></a> for wrapping the data layer action</li><li>Multi-step actions guide for complex workflow patterns</li></ul>
  </section>
</section>
<section class="detail" id="atomic_defaults/1">

  <div class="detail-header">
    <a href="#atomic_defaults/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">atomic_defaults(changeset)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L866" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="atomic_ref/2">

  <div class="detail-header">
    <a href="#atomic_ref/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">atomic_ref(changeset, field)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L1469" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Gets a reference to a field, or the current atomic update expression of that field.</p>
  </section>
</section>
<section class="detail" id="atomic_update/2">

  <div class="detail-header">
    <a href="#atomic_update/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">atomic_update(changeset, atomics)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L2157" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> atomic_update(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>() | <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Adds multiple atomic changes to the changeset</p><p>See <a href="#atomic_update/3"><code class="inline">atomic_update/3</code></a> for more information.</p>
  </section>
</section>
<section class="detail" id="atomic_update/3">

  <div class="detail-header">
    <a href="#atomic_update/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">atomic_update(changeset, key, value)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L2238" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> atomic_update(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(), {:atomic, <a href="Ash.Expr.xhtml#t:t/0">Ash.Expr.t</a>()} | <a href="Ash.Expr.xhtml#t:t/0">Ash.Expr.t</a>()) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Adds an atomic change to the changeset.</p><p>Atomic changes are applied by the data layer, and as such have guarantees that are not
given by changes that are based on looking at the previous value and updating it. Here
is an example of a change that is not safe to do concurrently:</p><pre><code class="makeup elixir" translate="no"><samp class="n">change</samp><samp class="w"> </samp><samp class="k" data-group-id="7922597909-1">fn</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="bp">_</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
  </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">change_attribute</samp><samp class="p" data-group-id="7922597909-2">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:score</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">data</samp><samp class="o">.</samp><samp class="n">score</samp><samp class="w"> </samp><samp class="o">+</samp><samp class="w"> </samp><samp class="mi">1</samp><samp class="p" data-group-id="7922597909-2">)</samp><samp class="w">
</samp><samp class="k" data-group-id="7922597909-1">end</samp></code></pre><p>If two processes run this concurrently, they will both read the same value of <code class="inline">score</code>, and
set the new score to the same value. This means that one of the increments will be lost.
If you were to instead do this using <code class="inline">atomic_update</code>, you would get the correct result:</p><pre><code class="makeup elixir" translate="no"><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">atomic_update</samp><samp class="p" data-group-id="7992591913-1">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:score</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">expr</samp><samp class="p" data-group-id="7992591913-2">(</samp><samp class="n">score</samp><samp class="w"> </samp><samp class="o">+</samp><samp class="w"> </samp><samp class="mi">1</samp><samp class="p" data-group-id="7992591913-2">)</samp><samp class="p" data-group-id="7992591913-1">)</samp></code></pre><p>There are drawbacks/things to consider, however. The first is that atomic update results
are not known until after the action is run. The following functional validation would not
be able to enforce the score being less than 10, because the atomic happens after the validation.</p><pre><code class="makeup elixir" translate="no"><samp class="n">validate</samp><samp class="w"> </samp><samp class="k" data-group-id="2203329656-1">fn</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="bp">_</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
  </samp><samp class="k">if</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">get_attribute</samp><samp class="p" data-group-id="2203329656-2">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:score</samp><samp class="p" data-group-id="2203329656-2">)</samp><samp class="w"> </samp><samp class="o">&lt;</samp><samp class="w"> </samp><samp class="mi">10</samp><samp class="w"> </samp><samp class="k" data-group-id="2203329656-3">do</samp><samp class="w">
    </samp><samp class="ss">:ok</samp><samp class="w">
  </samp><samp class="k" data-group-id="2203329656-3">else</samp><samp class="w">
    </samp><samp class="p" data-group-id="2203329656-4">{</samp><samp class="ss">:error</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">field</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:score</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">message</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;must be less than 10&quot;</samp><samp class="p" data-group-id="2203329656-4">}</samp><samp class="w">
  </samp><samp class="k" data-group-id="2203329656-3">end</samp><samp class="w">
</samp><samp class="k" data-group-id="2203329656-1">end</samp></code></pre><p>If you want to use atomic updates, it is suggested to write module-based validations &amp; changes,
and implement the appropriate atomic callbacks on those modules. All builtin validations and changes
implement these callbacks in addition to the standard callbacks. Validations will only be run atomically
when the entire action is being run atomically or if one of the relevant fields is being updated atomically.</p><h2 id="atomic_update/3-examples" class="section-heading"><a href="#atomic_update/3-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="c1"># Basic atomic increment</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_update</samp><samp class="p" data-group-id="4724005519-1">(</samp><samp class="n">post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:update</samp><samp class="p" data-group-id="4724005519-1">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">atomic_update</samp><samp class="p" data-group-id="4724005519-2">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:view_count</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">expr</samp><samp class="p" data-group-id="4724005519-3">(</samp><samp class="n">view_count</samp><samp class="w"> </samp><samp class="o">+</samp><samp class="w"> </samp><samp class="mi">1</samp><samp class="p" data-group-id="4724005519-3">)</samp><samp class="p" data-group-id="4724005519-2">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">atomics</samp><samp class="w">
</samp><samp class="p" data-group-id="4724005519-4">[</samp><samp class="ss">view_count</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="p" data-group-id="4724005519-5">%</samp><samp class="nc" data-group-id="4724005519-5">Ash.Expr</samp><samp class="p" data-group-id="4724005519-5">{</samp><samp class="n">...</samp><samp class="p" data-group-id="4724005519-5">}</samp><samp class="p" data-group-id="4724005519-4">]</samp><samp class="w">

</samp><samp class="c1"># Multiple atomic updates</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_update</samp><samp class="p" data-group-id="4724005519-6">(</samp><samp class="n">user</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:update</samp><samp class="p" data-group-id="4724005519-6">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">atomic_update</samp><samp class="p" data-group-id="4724005519-7">(</samp><samp class="ss">:login_count</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">expr</samp><samp class="p" data-group-id="4724005519-8">(</samp><samp class="n">login_count</samp><samp class="w"> </samp><samp class="o">+</samp><samp class="w"> </samp><samp class="mi">1</samp><samp class="p" data-group-id="4724005519-8">)</samp><samp class="p" data-group-id="4724005519-7">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">atomic_update</samp><samp class="p" data-group-id="4724005519-9">(</samp><samp class="ss">:last_login</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">expr</samp><samp class="p" data-group-id="4724005519-10">(</samp><samp class="n">now</samp><samp class="p" data-group-id="4724005519-11">(</samp><samp class="p" data-group-id="4724005519-11">)</samp><samp class="p" data-group-id="4724005519-10">)</samp><samp class="p" data-group-id="4724005519-9">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">length</samp><samp class="p" data-group-id="4724005519-12">(</samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">atomics</samp><samp class="p" data-group-id="4724005519-12">)</samp><samp class="w">
</samp><samp class="mi">2</samp><samp class="w">

</samp><samp class="c1"># Atomic update with conditional logic</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_update</samp><samp class="p" data-group-id="4724005519-13">(</samp><samp class="n">post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:update</samp><samp class="p" data-group-id="4724005519-13">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">atomic_update</samp><samp class="p" data-group-id="4724005519-14">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:status</samp><samp class="p">,</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="n">expr</samp><samp class="p" data-group-id="4724005519-15">(</samp><samp class="k">if</samp><samp class="w"> </samp><samp class="n">view_count</samp><samp class="w"> </samp><samp class="o">&gt;</samp><samp class="w"> </samp><samp class="mi">1000</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">do</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;popular&quot;</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">else</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;normal&quot;</samp><samp class="p" data-group-id="4724005519-15">)</samp><samp class="p" data-group-id="4724005519-14">)</samp><samp class="w">

</samp><samp class="c1"># Using the map/keyword syntax for multiple atomics</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_update</samp><samp class="p" data-group-id="4724005519-16">(</samp><samp class="n">user</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:update</samp><samp class="p" data-group-id="4724005519-16">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">atomic_update</samp><samp class="p" data-group-id="4724005519-17">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="4724005519-18">%{</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="ss">login_count</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="n">expr</samp><samp class="p" data-group-id="4724005519-19">(</samp><samp class="n">login_count</samp><samp class="w"> </samp><samp class="o">+</samp><samp class="w"> </samp><samp class="mi">1</samp><samp class="p" data-group-id="4724005519-19">)</samp><samp class="p">,</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="ss">last_seen</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="n">expr</samp><samp class="p" data-group-id="4724005519-20">(</samp><samp class="n">now</samp><samp class="p" data-group-id="4724005519-21">(</samp><samp class="p" data-group-id="4724005519-21">)</samp><samp class="p" data-group-id="4724005519-20">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="p" data-group-id="4724005519-18">}</samp><samp class="p" data-group-id="4724005519-17">)</samp></code></pre><h2 id="atomic_update/3-see-also" class="section-heading"><a href="#atomic_update/3-see-also" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">See also</span></h2><ul><li><a href="#atomic_ref/2"><code class="inline">atomic_ref/2</code></a> for referencing atomic values in expressions</li><li><a href="#fully_atomic_changeset/4"><code class="inline">fully_atomic_changeset/4</code></a> for creating fully atomic changesets</li><li><a href="#change_attribute/3"><code class="inline">change_attribute/3</code></a> for regular (non-atomic) attribute changes</li></ul>
  </section>
</section>
<section class="detail" id="attribute_present?/2">

  <div class="detail-header">
    <a href="#attribute_present?/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">attribute_present?(changeset, attribute)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L2655" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Checks if an attribute is not nil, either in the original data, or that it is not being changed to a <code class="inline">nil</code> value if it is changing.</p><p>This also accounts for the <code class="inline">accessing_from</code> context that is set when using <code class="inline">manage_relationship</code>, so it is aware that a particular value
<em>will</em> be set by <code class="inline">manage_relationship</code> even if it isn't currently being set.</p>
  </section>
</section>
<section class="detail" id="before_action/3">

    <span id="before_action/2"></span>

  <div class="detail-header">
    <a href="#before_action/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">before_action(changeset, func, opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L6547" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> before_action(
  changeset :: <a href="#t:t/0">t</a>(),
  fun :: <a href="#t:before_action_fun/0">before_action_fun</a>(),
  opts :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()
) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Adds a before_action hook to the changeset.</p><p>Before action hooks are essential for multi-step workflows where you need to:</p><ul><li>Validate complex business logic that requires database queries</li><li>Set computed attributes based on other changes</li><li>Prepare data for external service calls</li><li>Implement conditional logic that depends on the current state</li></ul><p>The hook runs after validations and changes but before the data layer action is executed.
This gives you access to the final validated changeset while still being able to modify it.</p><p>Provide the option <code class="inline">prepend?: true</code> to place the hook before all other hooks instead of after.</p><h2 id="before_action/3-examples" class="section-heading"><a href="#before_action/3-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="c1"># Set computed fields based on other attributes</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="6521959594-1">(</samp><samp class="nc">MyApp.Order</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="6521959594-2">%{</samp><samp class="ss">items</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="p" data-group-id="6521959594-3">[</samp><samp class="p" data-group-id="6521959594-4">%{</samp><samp class="ss">price</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mi">10</samp><samp class="p" data-group-id="6521959594-4">}</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="6521959594-5">%{</samp><samp class="ss">price</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mi">15</samp><samp class="p" data-group-id="6521959594-5">}</samp><samp class="p" data-group-id="6521959594-3">]</samp><samp class="p" data-group-id="6521959594-2">}</samp><samp class="p" data-group-id="6521959594-1">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">before_action</samp><samp class="p" data-group-id="6521959594-6">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="k" data-group-id="6521959594-7">fn</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="n">total</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">attributes</samp><samp class="o">.</samp><samp class="n">items</samp><samp class="w"> </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Enum</samp><samp class="o">.</samp><samp class="n">map</samp><samp class="p" data-group-id="6521959594-8">(</samp><samp class="o">&amp;</samp><samp class="w"> </samp><samp class="ni">&amp;1</samp><samp class="o">.</samp><samp class="n">price</samp><samp class="p" data-group-id="6521959594-8">)</samp><samp class="w"> </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Enum</samp><samp class="o">.</samp><samp class="n">sum</samp><samp class="p" data-group-id="6521959594-9">(</samp><samp class="p" data-group-id="6521959594-9">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="n">tax</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="n">total</samp><samp class="w"> </samp><samp class="o">*</samp><samp class="w"> </samp><samp class="mf">0.08</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="n">changeset</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">change_attribute</samp><samp class="p" data-group-id="6521959594-10">(</samp><samp class="ss">:subtotal</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">total</samp><samp class="p" data-group-id="6521959594-10">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">change_attribute</samp><samp class="p" data-group-id="6521959594-11">(</samp><samp class="ss">:tax</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">tax</samp><samp class="p" data-group-id="6521959594-11">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">change_attribute</samp><samp class="p" data-group-id="6521959594-12">(</samp><samp class="ss">:total</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">total</samp><samp class="w"> </samp><samp class="o">+</samp><samp class="w"> </samp><samp class="n">tax</samp><samp class="p" data-group-id="6521959594-12">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="k" data-group-id="6521959594-7">end</samp><samp class="p" data-group-id="6521959594-6">)</samp><samp class="w">

</samp><samp class="c1"># Assign resources based on complex business logic</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="6521959594-13">(</samp><samp class="nc">MyApp.Ticket</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="6521959594-14">%{</samp><samp class="ss">title</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;Help needed&quot;</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">priority</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:urgent</samp><samp class="p" data-group-id="6521959594-14">}</samp><samp class="p" data-group-id="6521959594-13">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">before_action</samp><samp class="p" data-group-id="6521959594-15">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="k" data-group-id="6521959594-16">fn</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="k">case</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">attributes</samp><samp class="o">.</samp><samp class="n">priority</samp><samp class="w"> </samp><samp class="k" data-group-id="6521959594-17">do</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="ss">:urgent</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">      </samp><samp class="c1"># Query for available senior agents</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">      </samp><samp class="n">agent</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">MyApp.Agent</samp><samp class="w"> </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">MyApp.Query</samp><samp class="o">.</samp><samp class="n">for_read</samp><samp class="p" data-group-id="6521959594-18">(</samp><samp class="ss">:available_senior</samp><samp class="p" data-group-id="6521959594-18">)</samp><samp class="w"> </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">MyApp</samp><samp class="o">.</samp><samp class="n">read_one!</samp><samp class="p" data-group-id="6521959594-19">(</samp><samp class="p" data-group-id="6521959594-19">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">      </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">change_attribute</samp><samp class="p" data-group-id="6521959594-20">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:assigned_agent_id</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">agent</samp><samp class="o">.</samp><samp class="n">id</samp><samp class="p" data-group-id="6521959594-20">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="bp">_</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">      </samp><samp class="n">changeset</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="k" data-group-id="6521959594-17">end</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="k" data-group-id="6521959594-16">end</samp><samp class="p" data-group-id="6521959594-15">)</samp><samp class="w">

</samp><samp class="c1"># Validate complex business rules that require database access</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_update</samp><samp class="p" data-group-id="6521959594-21">(</samp><samp class="n">user</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:upgrade_plan</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="6521959594-22">%{</samp><samp class="ss">plan</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:premium</samp><samp class="p" data-group-id="6521959594-22">}</samp><samp class="p" data-group-id="6521959594-21">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">before_action</samp><samp class="p" data-group-id="6521959594-23">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="k" data-group-id="6521959594-24">fn</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="n">existing_subscription</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">MyApp.Subscription</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">MyApp.Query</samp><samp class="o">.</samp><samp class="n">filter</samp><samp class="p" data-group-id="6521959594-25">(</samp><samp class="n">user_id</samp><samp class="w"> </samp><samp class="o">==</samp><samp class="w"> </samp><samp class="o">^</samp><samp class="n">user</samp><samp class="o">.</samp><samp class="n">id</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">status</samp><samp class="w"> </samp><samp class="o">==</samp><samp class="w"> </samp><samp class="ss">:active</samp><samp class="p" data-group-id="6521959594-25">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">MyApp</samp><samp class="o">.</samp><samp class="n">read_one</samp><samp class="p" data-group-id="6521959594-26">(</samp><samp class="p" data-group-id="6521959594-26">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="k">case</samp><samp class="w"> </samp><samp class="n">existing_subscription</samp><samp class="w"> </samp><samp class="k" data-group-id="6521959594-27">do</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="p" data-group-id="6521959594-28">{</samp><samp class="ss">:ok</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="6521959594-29">%{</samp><samp class="ss">plan</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:premium</samp><samp class="p" data-group-id="6521959594-29">}</samp><samp class="p" data-group-id="6521959594-28">}</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">      </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">add_error</samp><samp class="p" data-group-id="6521959594-30">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">field</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:plan</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">message</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;already on premium plan&quot;</samp><samp class="p" data-group-id="6521959594-30">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="bp">_</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">      </samp><samp class="n">changeset</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="k" data-group-id="6521959594-27">end</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="k" data-group-id="6521959594-24">end</samp><samp class="p" data-group-id="6521959594-23">)</samp></code></pre><h2 id="before_action/3-see-also" class="section-heading"><a href="#before_action/3-see-also" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">See also</span></h2><ul><li><a href="#after_action/3"><code class="inline">after_action/3</code></a> for hooks that run after the action succeeds</li><li><a href="#around_action/2"><code class="inline">around_action/2</code></a> for hooks that wrap the entire action</li><li><a href="#before_transaction/3"><code class="inline">before_transaction/3</code></a> for hooks that run before the database transaction</li><li>Multi-step actions guide for complex workflow patterns</li></ul>
  </section>
</section>
<section class="detail" id="before_transaction/3">

    <span id="before_transaction/2"></span>

  <div class="detail-header">
    <a href="#before_transaction/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">before_transaction(changeset, func, opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L6610" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> before_transaction(
  changeset :: <a href="#t:t/0">t</a>(),
  fun :: <a href="#t:before_transaction_fun/0">before_transaction_fun</a>(),
  opts :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()
) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Adds a before_transaction hook to the changeset.</p><p>Before transaction hooks run outside the database transaction and are ideal for:</p><ul><li>Making external API calls that shouldn't be rolled back</li><li>Validating external resources or permissions</li><li>Setting up external state that the action depends on</li><li>Logging or auditing that should happen regardless of transaction success</li><li>Preparing data from external services</li></ul><p>These hooks run before any database transaction is started, so they can't access
the final result but can prepare the changeset with external data.</p><p>Provide the option <code class="inline">prepend?: true</code> to place the hook before all other hooks instead of after.</p><h2 id="before_transaction/3-examples" class="section-heading"><a href="#before_transaction/3-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="c1"># Validate external service availability before processing</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="7380767661-1">(</samp><samp class="nc">MyApp.Order</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="7380767661-2">%{</samp><samp class="ss">items</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="p" data-group-id="7380767661-3">[</samp><samp class="p" data-group-id="7380767661-4">%{</samp><samp class="ss">sku</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;ABC123&quot;</samp><samp class="p" data-group-id="7380767661-4">}</samp><samp class="p" data-group-id="7380767661-3">]</samp><samp class="p" data-group-id="7380767661-2">}</samp><samp class="p" data-group-id="7380767661-1">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">before_transaction</samp><samp class="p" data-group-id="7380767661-5">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="k" data-group-id="7380767661-6">fn</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="k">case</samp><samp class="w"> </samp><samp class="nc">ExternalInventoryService</samp><samp class="o">.</samp><samp class="n">check_availability</samp><samp class="p" data-group-id="7380767661-7">(</samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">attributes</samp><samp class="o">.</samp><samp class="n">items</samp><samp class="p" data-group-id="7380767661-7">)</samp><samp class="w"> </samp><samp class="k" data-group-id="7380767661-8">do</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="p" data-group-id="7380767661-9">{</samp><samp class="ss">:ok</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="bp">_</samp><samp class="p" data-group-id="7380767661-9">}</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">      </samp><samp class="n">changeset</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="p" data-group-id="7380767661-10">{</samp><samp class="ss">:error</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:out_of_stock</samp><samp class="p" data-group-id="7380767661-10">}</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">      </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">add_error</samp><samp class="p" data-group-id="7380767661-11">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">field</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:items</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">message</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;items out of stock&quot;</samp><samp class="p" data-group-id="7380767661-11">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="k" data-group-id="7380767661-8">end</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="k" data-group-id="7380767661-6">end</samp><samp class="p" data-group-id="7380767661-5">)</samp><samp class="w">

</samp><samp class="c1"># Fetch and set data from external service</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="7380767661-12">(</samp><samp class="nc">MyApp.User</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="7380767661-13">%{</samp><samp class="ss">email</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;user@example.com&quot;</samp><samp class="p" data-group-id="7380767661-13">}</samp><samp class="p" data-group-id="7380767661-12">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">before_transaction</samp><samp class="p" data-group-id="7380767661-14">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="k" data-group-id="7380767661-15">fn</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="k">case</samp><samp class="w"> </samp><samp class="nc">UserService</samp><samp class="o">.</samp><samp class="n">get_profile_data</samp><samp class="p" data-group-id="7380767661-16">(</samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">attributes</samp><samp class="o">.</samp><samp class="n">email</samp><samp class="p" data-group-id="7380767661-16">)</samp><samp class="w"> </samp><samp class="k" data-group-id="7380767661-17">do</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="p" data-group-id="7380767661-18">{</samp><samp class="ss">:ok</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">profile</samp><samp class="p" data-group-id="7380767661-18">}</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">      </samp><samp class="n">changeset</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">      </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">change_attribute</samp><samp class="p" data-group-id="7380767661-19">(</samp><samp class="ss">:display_name</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">profile</samp><samp class="o">.</samp><samp class="n">name</samp><samp class="p" data-group-id="7380767661-19">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">      </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">change_attribute</samp><samp class="p" data-group-id="7380767661-20">(</samp><samp class="ss">:avatar_url</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">profile</samp><samp class="o">.</samp><samp class="n">avatar</samp><samp class="p" data-group-id="7380767661-20">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">    </samp><samp class="p" data-group-id="7380767661-21">{</samp><samp class="ss">:error</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="bp">_</samp><samp class="p" data-group-id="7380767661-21">}</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">      </samp><samp class="n">changeset</samp><samp class="w">  </samp><samp class="c1"># Continue without external data</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="k" data-group-id="7380767661-17">end</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="k" data-group-id="7380767661-15">end</samp><samp class="p" data-group-id="7380767661-14">)</samp></code></pre><h2 id="before_transaction/3-see-also" class="section-heading"><a href="#before_transaction/3-see-also" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">See also</span></h2><ul><li><a href="#before_action/3"><code class="inline">before_action/3</code></a> for hooks that run within the transaction</li><li><a href="#after_transaction/3"><code class="inline">after_transaction/3</code></a> for hooks that run after the transaction completes</li><li><a href="#around_transaction/2"><code class="inline">around_transaction/2</code></a> for hooks that wrap the entire transaction</li></ul>
  </section>
</section>
<section class="detail" id="change_attribute/3">

  <div class="detail-header">
    <a href="#change_attribute/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">change_attribute(changeset, attribute, value)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L6213" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> change_attribute(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Adds a change to the changeset, unless the value matches the existing value.</p><h2 id="change_attribute/3-examples" class="section-heading"><a href="#change_attribute/3-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="c1"># Basic attribute change</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="2157198842-1">(</samp><samp class="nc">MyApp.Post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p" data-group-id="2157198842-1">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">change_attribute</samp><samp class="p" data-group-id="2157198842-2">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:title</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="s">&quot;New Title&quot;</samp><samp class="p" data-group-id="2157198842-2">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">attributes</samp><samp class="w">
</samp><samp class="p" data-group-id="2157198842-3">%{</samp><samp class="ss">title</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;New Title&quot;</samp><samp class="p" data-group-id="2157198842-3">}</samp><samp class="w">

</samp><samp class="c1"># Change multiple attributes in sequence</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="2157198842-4">(</samp><samp class="nc">MyApp.User</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p" data-group-id="2157198842-4">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">change_attribute</samp><samp class="p" data-group-id="2157198842-5">(</samp><samp class="ss">:name</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="s">&quot;John Doe&quot;</samp><samp class="p" data-group-id="2157198842-5">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">change_attribute</samp><samp class="p" data-group-id="2157198842-6">(</samp><samp class="ss">:email</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="s">&quot;john@example.com&quot;</samp><samp class="p" data-group-id="2157198842-6">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">attributes</samp><samp class="w">
</samp><samp class="p" data-group-id="2157198842-7">%{</samp><samp class="ss">name</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;John Doe&quot;</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">email</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;john@example.com&quot;</samp><samp class="p" data-group-id="2157198842-7">}</samp><samp class="w">

</samp><samp class="c1"># Value is cast according to the attribute type</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="2157198842-8">(</samp><samp class="nc">MyApp.Post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p" data-group-id="2157198842-8">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">change_attribute</samp><samp class="p" data-group-id="2157198842-9">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:view_count</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="s">&quot;42&quot;</samp><samp class="p" data-group-id="2157198842-9">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">attributes</samp><samp class="w">
</samp><samp class="p" data-group-id="2157198842-10">%{</samp><samp class="ss">view_count</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mi">42</samp><samp class="p" data-group-id="2157198842-10">}</samp></code></pre><h2 id="change_attribute/3-see-also" class="section-heading"><a href="#change_attribute/3-see-also" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">See also</span></h2><ul><li><a href="#change_attributes/2"><code class="inline">change_attributes/2</code></a> for changing multiple attributes at once</li><li><a href="#force_change_attribute/3"><code class="inline">force_change_attribute/3</code></a> for writing attributes not accepted by the action, or changing attributes in hooks</li><li><a href="#change_new_attribute/3"><code class="inline">change_new_attribute/3</code></a> for changing an attribute unless its already being changed</li><li><a href="#update_change/3"><code class="inline">update_change/3</code></a> for updating existing changes</li></ul>
  </section>
</section>
<section class="detail" id="change_attributes/2">

  <div class="detail-header">
    <a href="#change_attributes/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">change_attributes(changeset, changes)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L6172" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> change_attributes(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>() | <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Calls <a href="#change_attribute/3"><code class="inline">change_attribute/3</code></a> for each key/value pair provided.</p><h2 id="change_attributes/2-examples" class="section-heading"><a href="#change_attributes/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="c1"># Change multiple attributes with a map</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="3465098794-1">(</samp><samp class="nc">MyApp.Post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p" data-group-id="3465098794-1">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">change_attributes</samp><samp class="p" data-group-id="3465098794-2">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="3465098794-3">%{</samp><samp class="ss">title</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;Hello World&quot;</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">content</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;Post content&quot;</samp><samp class="p" data-group-id="3465098794-3">}</samp><samp class="p" data-group-id="3465098794-2">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">attributes</samp><samp class="w">
</samp><samp class="p" data-group-id="3465098794-4">%{</samp><samp class="ss">title</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;Hello World&quot;</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">content</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;Post content&quot;</samp><samp class="p" data-group-id="3465098794-4">}</samp><samp class="w">

</samp><samp class="c1"># Change multiple attributes with a keyword list</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="3465098794-5">(</samp><samp class="nc">MyApp.User</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p" data-group-id="3465098794-5">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">change_attributes</samp><samp class="p" data-group-id="3465098794-6">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="3465098794-7">[</samp><samp class="ss">name</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;John Doe&quot;</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">email</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;john@example.com&quot;</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">age</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mi">30</samp><samp class="p" data-group-id="3465098794-7">]</samp><samp class="p" data-group-id="3465098794-6">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">attributes</samp><samp class="w">
</samp><samp class="p" data-group-id="3465098794-8">%{</samp><samp class="ss">name</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;John Doe&quot;</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">email</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;john@example.com&quot;</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">age</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mi">30</samp><samp class="p" data-group-id="3465098794-8">}</samp><samp class="w">

</samp><samp class="c1"># Values are cast according to their attribute types</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="3465098794-9">(</samp><samp class="nc">MyApp.Post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p" data-group-id="3465098794-9">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">change_attributes</samp><samp class="p" data-group-id="3465098794-10">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="3465098794-11">%{</samp><samp class="ss">view_count</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;42&quot;</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">published</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;true&quot;</samp><samp class="p" data-group-id="3465098794-11">}</samp><samp class="p" data-group-id="3465098794-10">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">attributes</samp><samp class="w">
</samp><samp class="p" data-group-id="3465098794-12">%{</samp><samp class="ss">view_count</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mi">42</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">published</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="no">true</samp><samp class="p" data-group-id="3465098794-12">}</samp></code></pre><h2 id="change_attributes/2-see-also" class="section-heading"><a href="#change_attributes/2-see-also" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">See also</span></h2><ul><li><a href="#change_attribute/3"><code class="inline">change_attribute/3</code></a> for changing individual attributes</li><li><a href="#force_change_attribute/3"><code class="inline">force_change_attribute/3</code></a> for writing attributes not accepted by the action, or changing attributes in hooks</li><li><a href="#set_arguments/2"><code class="inline">set_arguments/2</code></a> for setting action arguments</li></ul>
  </section>
</section>
<section class="detail" id="change_default_attribute/3">

  <div class="detail-header">
    <a href="#change_default_attribute/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">change_default_attribute(changeset, attribute, value)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L6338" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> change_default_attribute(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>The same as <code class="inline">change_attribute</code>, but annotates that the attribute is currently holding a default value.</p><p>This information can be used in changes to see if a value was explicitly set or if it was set by being the default.
Additionally, this is used in <code class="inline">upsert</code> actions to not overwrite existing values with the default.</p>
  </section>
</section>
<section class="detail" id="change_new_attribute/3">

  <div class="detail-header">
    <a href="#change_new_attribute/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">change_new_attribute(changeset, attribute, value)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L5849" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> change_new_attribute(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Change an attribute only if is not currently being changed</p>
  </section>
</section>
<section class="detail" id="change_new_attribute_lazy/3">

  <div class="detail-header">
    <a href="#change_new_attribute_lazy/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">change_new_attribute_lazy(changeset, attribute, func)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L5866" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> change_new_attribute_lazy(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(), (-&gt; <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>())) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Change an attribute if is not currently being changed, by calling the provided function.</p><p>Use this if you want to only perform some expensive calculation for an attribute value
only if there isn't already a change for that attribute.</p>
  </section>
</section>
<section class="detail" id="changing_attribute?/2">

  <div class="detail-header">
    <a href="#changing_attribute?/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">changing_attribute?(changeset, attribute)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L5836" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> changing_attribute?(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">boolean</a>()</pre>

      </div>

<p>Returns true if an attribute exists in the changes.</p><h2 id="changing_attribute?/2-examples" class="section-heading"><a href="#changing_attribute?/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="c1"># Check if an attribute is being changed</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="2186509406-1">(</samp><samp class="nc">MyApp.Post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p" data-group-id="2186509406-1">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">change_attribute</samp><samp class="p" data-group-id="2186509406-2">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:title</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="s">&quot;New Title&quot;</samp><samp class="p" data-group-id="2186509406-2">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">changing_attribute?</samp><samp class="p" data-group-id="2186509406-3">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:title</samp><samp class="p" data-group-id="2186509406-3">)</samp><samp class="w">
</samp><samp class="no">true</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">changing_attribute?</samp><samp class="p" data-group-id="2186509406-4">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:content</samp><samp class="p" data-group-id="2186509406-4">)</samp><samp class="w">
</samp><samp class="no">false</samp><samp class="w">

</samp><samp class="c1"># Works with atomic updates too</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_update</samp><samp class="p" data-group-id="2186509406-5">(</samp><samp class="n">post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:update</samp><samp class="p" data-group-id="2186509406-5">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">atomic_update</samp><samp class="p" data-group-id="2186509406-6">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:view_count</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="2186509406-7">{</samp><samp class="ss">:atomic</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">expr</samp><samp class="p" data-group-id="2186509406-8">(</samp><samp class="n">view_count</samp><samp class="w"> </samp><samp class="o">+</samp><samp class="w"> </samp><samp class="mi">1</samp><samp class="p" data-group-id="2186509406-8">)</samp><samp class="p" data-group-id="2186509406-7">}</samp><samp class="p" data-group-id="2186509406-6">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">changing_attribute?</samp><samp class="p" data-group-id="2186509406-9">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:view_count</samp><samp class="p" data-group-id="2186509406-9">)</samp><samp class="w">
</samp><samp class="no">true</samp><samp class="w">

</samp><samp class="c1"># Check multiple attributes</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="2186509406-10">(</samp><samp class="nc">MyApp.User</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p" data-group-id="2186509406-10">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">change_attributes</samp><samp class="p" data-group-id="2186509406-11">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="2186509406-12">%{</samp><samp class="ss">name</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;John&quot;</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">email</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;john@example.com&quot;</samp><samp class="p" data-group-id="2186509406-12">}</samp><samp class="p" data-group-id="2186509406-11">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">changing_attribute?</samp><samp class="p" data-group-id="2186509406-13">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:name</samp><samp class="p" data-group-id="2186509406-13">)</samp><samp class="w">
</samp><samp class="no">true</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">changing_attribute?</samp><samp class="p" data-group-id="2186509406-14">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:age</samp><samp class="p" data-group-id="2186509406-14">)</samp><samp class="w">
</samp><samp class="no">false</samp></code></pre><h2 id="changing_attribute?/2-see-also" class="section-heading"><a href="#changing_attribute?/2-see-also" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">See also</span></h2><ul><li><a href="#changing_attributes?/1"><code class="inline">changing_attributes?/1</code></a> for checking if any attributes are changing</li><li><a href="#changing_relationship?/2"><code class="inline">changing_relationship?/2</code></a> for checking relationship changes</li><li><a href="#present?/2"><code class="inline">present?/2</code></a> for checking if a value is present</li><li><a href="#fetch_change/2"><code class="inline">fetch_change/2</code></a> for getting the changed value</li></ul>
  </section>
</section>
<section class="detail" id="changing_attributes?/1">

  <div class="detail-header">
    <a href="#changing_attributes?/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">changing_attributes?(changeset)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L5795" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> changing_attributes?(<a href="#t:t/0">t</a>()) :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">boolean</a>()</pre>

      </div>

<p>Returns true if any attributes on the resource are being changed.</p>
  </section>
</section>
<section class="detail" id="changing_relationship?/2">

  <div class="detail-header">
    <a href="#changing_relationship?/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">changing_relationship?(changeset, relationship)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L5843" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> changing_relationship?(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">boolean</a>()</pre>

      </div>

<p>Returns true if a relationship exists in the changes</p>
  </section>
</section>
<section class="detail" id="clear_change/2">

  <div class="detail-header">
    <a href="#clear_change/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">clear_change(changeset, field)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L6953" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Clears an attribute or relationship change off of the changeset.</p>
  </section>
</section>
<section class="detail" id="delete_argument/2">

  <div class="detail-header">
    <a href="#delete_argument/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">delete_argument(changeset, argument_or_arguments)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L6073" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Remove an argument from the changeset</p>
  </section>
</section>
<section class="detail" id="deselect/2">

  <div class="detail-header">
    <a href="#deselect/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">deselect(changeset, fields)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L715" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> deselect(<a href="#t:t/0">t</a>(), [<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()] | <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Ensure the the specified attributes are <code class="inline">nil</code> in the changeset results.</p>
  </section>
</section>
<section class="detail" id="ensure_selected/2">

  <div class="detail-header">
    <a href="#ensure_selected/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">ensure_selected(changeset, fields)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L699" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> ensure_selected(<a href="#t:t/0">t</a>(), [<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()] | <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Ensures that the given attributes are selected.</p><p>The first call to <a href="#select/2"><code class="inline">select/2</code></a> will <em>limit</em> the fields to only the provided fields.
Use <a href="#ensure_selected/2"><code class="inline">ensure_selected/2</code></a> to say &quot;select this field (or these fields) without deselecting anything else&quot;.</p><p>See <a href="#select/2"><code class="inline">select/2</code></a> for more.</p>
  </section>
</section>
<section class="detail" id="expand_upsert_fields/2">

  <div class="detail-header">
    <a href="#expand_upsert_fields/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">expand_upsert_fields(fields, resource)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L2388" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Turns the special case {:replace, fields}, :replace_all and {:replace_all_except, fields} upsert_fields
options into a list of fields</p>
  </section>
</section>
<section class="detail" id="fetch_argument/2">

  <div class="detail-header">
    <a href="#fetch_argument/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">fetch_argument(changeset, argument)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L4792" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> fetch_argument(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) :: {:ok, <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()} | :error</pre>

      </div>

<p>Fetches the value of an argument provided to the changeset or <code class="inline">:error</code>.</p>
  </section>
</section>
<section class="detail" id="fetch_argument_or_attribute/2">

  <div class="detail-header">
    <a href="#fetch_argument_or_attribute/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">fetch_argument_or_attribute(changeset, argument_or_attribute)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L4874" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> fetch_argument_or_attribute(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) :: {:ok, <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()} | :error</pre>

      </div>

<p>Fetches the value of an argument provided to the changeset, falling back to <a href="#fetch_attribute/2"><code class="inline">Ash.Changeset.fetch_attribute/2</code></a> if nothing was provided.</p><h2 id="fetch_argument_or_attribute/2-example" class="section-heading"><a href="#fetch_argument_or_attribute/2-example" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Example</span></h2><pre><code class="makeup elixir" translate="no"><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_update</samp><samp class="p" data-group-id="7364266544-1">(</samp><samp class="n">post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:update</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="7364266544-2">%{</samp><samp class="ss">title</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;New Title&quot;</samp><samp class="p" data-group-id="7364266544-2">}</samp><samp class="p" data-group-id="7364266544-1">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">fetch_argument_or_attribute</samp><samp class="p" data-group-id="7364266544-3">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:title</samp><samp class="p" data-group-id="7364266544-3">)</samp><samp class="w">
</samp><samp class="p" data-group-id="7364266544-4">{</samp><samp class="ss">:ok</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="s">&quot;New Title&quot;</samp><samp class="p" data-group-id="7364266544-4">}</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">fetch_argument_or_attribute</samp><samp class="p" data-group-id="7364266544-5">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:content</samp><samp class="p" data-group-id="7364266544-5">)</samp><samp class="w">
</samp><samp class="ss">:error</samp></code></pre>
  </section>
</section>
<section class="detail" id="fetch_argument_or_change/2">

  <div class="detail-header">
    <a href="#fetch_argument_or_change/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">fetch_argument_or_change(changeset, attribute)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L4889" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> fetch_argument_or_change(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) :: {:ok, <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()} | :error</pre>

      </div>

<p>Gets the value of an argument provided to the changeset, falling back to <a href="#fetch_change/2"><code class="inline">Ash.Changeset.fetch_change/2</code></a> if nothing was provided.</p>
  </section>
</section>
<section class="detail" id="fetch_attribute/2">

  <div class="detail-header">
    <a href="#fetch_attribute/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">fetch_attribute(changeset, attribute)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L4843" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> fetch_attribute(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) :: {:ok, <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()} | :error</pre>

      </div>

<p>Fetches the changing value or the original value of an attribute.</p><h2 id="fetch_attribute/2-example" class="section-heading"><a href="#fetch_attribute/2-example" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Example</span></h2><pre><code class="makeup elixir" translate="no"><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_update</samp><samp class="p" data-group-id="4867525301-1">(</samp><samp class="n">post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:update</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="4867525301-2">%{</samp><samp class="ss">title</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;New Title&quot;</samp><samp class="p" data-group-id="4867525301-2">}</samp><samp class="p" data-group-id="4867525301-1">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">fetch_attribute</samp><samp class="p" data-group-id="4867525301-3">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:title</samp><samp class="p" data-group-id="4867525301-3">)</samp><samp class="w">
</samp><samp class="p" data-group-id="4867525301-4">{</samp><samp class="ss">:ok</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="s">&quot;New Title&quot;</samp><samp class="p" data-group-id="4867525301-4">}</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">fetch_attribute</samp><samp class="p" data-group-id="4867525301-5">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:content</samp><samp class="p" data-group-id="4867525301-5">)</samp><samp class="w">
</samp><samp class="ss">:error</samp></code></pre>
  </section>
</section>
<section class="detail" id="fetch_change/2">

  <div class="detail-header">
    <a href="#fetch_change/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">fetch_change(changeset, attribute)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L4883" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> fetch_change(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) :: {:ok, <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()} | :error</pre>

      </div>

<p>Gets the new value for an attribute, or <code class="inline">:error</code> if it is not being changed.</p>
  </section>
</section>
<section class="detail" id="fetch_data/2">

  <div class="detail-header">
    <a href="#fetch_data/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">fetch_data(changeset, attribute)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L4914" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> fetch_data(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) :: {:ok, <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()} | :error</pre>

      </div>

<p>Gets the original value for an attribute, or <code class="inline">:error</code> if it is not available.</p><h2 id="fetch_data/2-example" class="section-heading"><a href="#fetch_data/2-example" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Example</span></h2><pre><code class="makeup elixir" translate="no"><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_update</samp><samp class="p" data-group-id="0532873599-1">(</samp><samp class="n">post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:update</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="0532873599-2">%{</samp><samp class="ss">title</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;New Title&quot;</samp><samp class="p" data-group-id="0532873599-2">}</samp><samp class="p" data-group-id="0532873599-1">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">fetch_data</samp><samp class="p" data-group-id="0532873599-3">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:title</samp><samp class="p" data-group-id="0532873599-3">)</samp><samp class="w">
</samp><samp class="p" data-group-id="0532873599-4">{</samp><samp class="ss">:ok</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="s">&quot;Original Title&quot;</samp><samp class="p" data-group-id="0532873599-4">}</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">fetch_data</samp><samp class="p" data-group-id="0532873599-5">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:content</samp><samp class="p" data-group-id="0532873599-5">)</samp><samp class="w">
</samp><samp class="ss">:error</samp></code></pre>
  </section>
</section>
<section class="detail" id="filter/2">

  <div class="detail-header">
    <a href="#filter/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">filter(changeset, expr)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L7003" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> filter(<a href="#t:t/0">t</a>(), <a href="Ash.Expr.xhtml#t:t/0">Ash.Expr.t</a>()) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Adds a filter for a record being updated or destroyed.</p><p>Used by optimistic locking. See <a href="Ash.Resource.Change.Builtins.xhtml#optimistic_lock/1"><code class="inline">Ash.Resource.Change.Builtins.optimistic_lock/1</code></a> for more.</p>
  </section>
</section>
<section class="detail" id="for_action/4">

    <span id="for_action/2"></span>

    <span id="for_action/3"></span>

  <div class="detail-header">
    <a href="#for_action/4" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">for_action(initial, action, params \\ %{}, opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L1674" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Constructs a changeset for a given action, and validates it.</p><p>Calls <a href="#for_create/4"><code class="inline">for_create/4</code></a>, <a href="#for_update/4"><code class="inline">for_update/4</code></a> or <a href="#for_destroy/4"><code class="inline">for_destroy/4</code></a> based on the type of action passed in.</p><p>See those functions for more explanation.</p>
  </section>
</section>
<section class="detail" id="for_create/4">

    <span id="for_create/2"></span>

    <span id="for_create/3"></span>

  <div class="detail-header">
    <a href="#for_create/4" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">for_create(initial, action, params \\ %{}, opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L1835" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Constructs a changeset for a given create action, and validates it.</p><p>Anything that is modified prior to <a href="#for_create/4"><code class="inline">for_create/4</code></a> is validated against the rules of the action, while <em>anything after it is not</em>.
This runs any <code class="inline">change</code>s contained on your action. To have your logic execute <em>only</em> during the action, you can use <a href="#after_action/2"><code class="inline">after_action/2</code></a>
or <a href="#before_action/2"><code class="inline">before_action/2</code></a>.</p><p>Multitenancy is <em>not</em> validated until an action is called. This allows you to avoid specifying a tenant until just before calling
the domain action.</p><h3 id="for_create/4-params" class="section-heading"><a href="#for_create/4-params" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Params</span></h3><p><code class="inline">params</code> may be attributes, relationships, or arguments. You can safely pass user/form input directly into this function.
Only public attributes and relationships are supported. If you want to change private attributes as well, see the
Customization section below. <code class="inline">params</code> are stored directly as given in the <code class="inline">params</code> field of the changeset, which can be
used to retrieve the originally input value.</p><h2 id="for_create/4-options" class="section-heading"><a href="#for_create/4-options" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Options</span></h2><ul><li><p><code class="inline">:require?</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">boolean/0</code></a>) - If set to <code class="inline">false</code>, values are only required when the action is run (instead of immediately). The default value is <code class="inline">false</code>.</p></li><li><p><code class="inline">:actor</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">term/0</code></a>) - set the actor, which can be used in any <a href="Ash.Resource.Change.xhtml"><code class="inline">Ash.Resource.Change</code></a>s configured on the action. (in the <code class="inline">context</code> argument)</p></li><li><p><code class="inline">:authorize?</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">term/0</code></a>) - set authorize?, which can be used in any <a href="Ash.Resource.Change.xhtml"><code class="inline">Ash.Resource.Change</code></a>s configured on the action. (in the <code class="inline">context</code> argument)</p></li><li><p><code class="inline">:tracer</code> (one or a list of module that adopts <a href="Ash.Tracer.xhtml"><code class="inline">Ash.Tracer</code></a>) - A tracer to use. Will be carried over to the action. For more information see <a href="Ash.Tracer.xhtml"><code class="inline">Ash.Tracer</code></a>.</p></li><li><p><code class="inline">:tenant</code> (value that implements the <a href="Ash.ToTenant.xhtml"><code class="inline">Ash.ToTenant</code></a> protocol) - set the tenant on the changeset</p></li><li><p><code class="inline">:skip_unknown_inputs</code> - A list of inputs that, if provided, will be ignored if they are not recognized by the action. Use <code class="inline">:*</code> to indicate all unknown keys.</p></li><li><p><code class="inline">:load</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">term/0</code></a>) - Data to load on the result after running the action.</p></li><li><p><code class="inline">:context</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">map/0</code></a>) - Context to set on the query, changeset, or input</p></li><li><p><code class="inline">:scope</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">term/0</code></a>) - A value that implements the <a href="Ash.Scope.ToOpts.xhtml"><code class="inline">Ash.Scope.ToOpts</code></a> protocol, for passing around actor/tenant/context in a single value. See <a href="Ash.Scope.ToOpts.xhtml"><code class="inline">Ash.Scope.ToOpts</code></a> for more.</p></li><li><p><code class="inline">:private_arguments</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">map/0</code></a>) - Private argument values to set before validations and changes. The default value is <code class="inline">%{}</code>.</p></li><li><p><code class="inline">:return_skipped_upsert?</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">boolean/0</code></a>) - If <code class="inline">true</code>, and a record was <em>not</em> upserted because its filter prevented the upsert, the original record (which was <em>not</em> upserted) will be returned. The default value is <code class="inline">false</code>.</p></li></ul><h3 id="for_create/4-customization" class="section-heading"><a href="#for_create/4-customization" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Customization</span></h3><p>A changeset can be provided as the first argument, instead of a resource, to allow
setting specific attributes ahead of time.</p><p>For example:</p><pre><code class="makeup elixir" translate="no"><samp class="nc">MyResource</samp><samp class="w">
</samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">new</samp><samp class="p" data-group-id="9885087606-1">(</samp><samp class="p" data-group-id="9885087606-1">)</samp><samp class="w">
</samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">change_attribute</samp><samp class="p" data-group-id="9885087606-2">(</samp><samp class="ss">:foo</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="mi">1</samp><samp class="p" data-group-id="9885087606-2">)</samp><samp class="w">
</samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="9885087606-3">(</samp><samp class="ss">:create</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">...</samp><samp class="n">opts</samp><samp class="p" data-group-id="9885087606-3">)</samp></code></pre><p>Once a changeset has been validated by <a href="#for_create/4"><code class="inline">for_create/4</code></a> (or <a href="#for_update/4"><code class="inline">for_update/4</code></a>), it isn't validated again in the action.
New changes added are validated individually, though. This allows you to create a changeset according
to a given action, and then add custom changes if necessary.</p><h3 id="for_create/4-what-does-this-function-do" class="section-heading"><a href="#for_create/4-what-does-this-function-do" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">What does this function do?</span></h3><p>The following steps are run when calling <a href="#for_create/4"><code class="inline">Ash.Changeset.for_create/4</code></a>.</p><ul><li><p>Cast input params | This is any arguments in addition to any accepted attributes</p></li><li>Set argument defaults</li><li>Require any missing arguments</li><li>Validate all provided attributes are accepted</li><li>Require any accepted attributes that are <code class="inline">allow_nil?</code> false</li><li>Set any default values for attributes</li><li>Run action changes &amp; validations</li><li>Run validations, or add them in <code class="inline">before_action</code> hooks if using <code class="inline">d:Ash.Resource.Dsl.actions.create.validate|before_action?</code>. Any global validations are skipped if the action has <code class="inline">skip_global_validations?</code> set to <code class="inline">true</code>.</li></ul><h2 id="for_create/4-examples" class="section-heading"><a href="#for_create/4-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="c1"># Basic create changeset with attributes</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="1388881396-1">(</samp><samp class="nc">MyApp.Post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="1388881396-2">%{</samp><samp class="ss">title</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;Hello World&quot;</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">content</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;This is my first post&quot;</samp><samp class="p" data-group-id="1388881396-2">}</samp><samp class="p" data-group-id="1388881396-1">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">valid?</samp><samp class="w">
</samp><samp class="no">true</samp><samp class="w">

</samp><samp class="c1"># Create changeset with custom actor and tenant</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="1388881396-3">(</samp><samp class="nc">MyApp.Comment</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p">,</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="p" data-group-id="1388881396-4">%{</samp><samp class="ss">body</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;Great post!&quot;</samp><samp class="p" data-group-id="1388881396-4">}</samp><samp class="p">,</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="ss">actor</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="n">current_user</samp><samp class="p">,</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="ss">tenant</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;org_123&quot;</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="p" data-group-id="1388881396-3">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">tenant</samp><samp class="w">
</samp><samp class="s">&quot;org_123&quot;</samp></code></pre><h2 id="for_create/4-see-also" class="section-heading"><a href="#for_create/4-see-also" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">See also</span></h2><ul><li><a href="#for_action/4"><code class="inline">for_action/4</code></a> for a generic action constructor</li><li><a href="#for_update/4"><code class="inline">for_update/4</code></a> for updating existing records</li><li><a href="#for_destroy/4"><code class="inline">for_destroy/4</code></a> for destroying records</li><li><a href="Ash.xhtml#create/2"><code class="inline">Ash.create/2</code></a> to execute the changeset</li><li><code class="inline">d:Ash.Resource.Dsl.actions.create</code> for defining create actions</li><li><a href="create-actions.xhtml">Create Actions Guide</a> for understanding create operations</li><li><a href="actions.xhtml">Actions Guide</a> for general action concepts</li></ul>
  </section>
</section>
<section class="detail" id="for_destroy/4">

    <span id="for_destroy/2"></span>

    <span id="for_destroy/3"></span>

  <div class="detail-header">
    <a href="#for_destroy/4" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">for_destroy(initial, action_or_name, params \\ %{}, opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L2030" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Constructs a changeset for a given destroy action, and validates it.</p><h3 id="for_destroy/4-opts" class="section-heading"><a href="#for_destroy/4-opts" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Opts</span></h3><ul><li><code class="inline">:actor</code> - set the actor, which can be used in any <a href="Ash.Resource.Change.xhtml"><code class="inline">Ash.Resource.Change</code></a>s configured on the action. (in the <code class="inline">context</code> argument)</li><li><code class="inline">:tenant</code> - set the tenant on the changeset</li><li><code class="inline">:private_arguments</code> - set private arguments on the changeset before validations and changes are run</li></ul><p>Anything that is modified prior to <a href="#for_destroy/4"><code class="inline">for_destroy/4</code></a> is validated against the rules of the action, while <em>anything after it is not</em>.</p><p>Once a changeset has been validated by <a href="#for_destroy/4"><code class="inline">for_destroy/4</code></a>, it isn't validated again in the action.
New changes added are validated individually, though. This allows you to create a changeset according
to a given action, and then add custom changes if necessary.</p><h3 id="for_destroy/4-what-does-this-function-do" class="section-heading"><a href="#for_destroy/4-what-does-this-function-do" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">What does this function do?</span></h3><p>The following steps are run when calling <a href="#for_destroy/4"><code class="inline">Ash.Changeset.for_destroy/4</code></a>.</p><ul><li><p>Cast input params | This is any arguments in addition to any accepted attributes</p></li><li>Set argument defaults</li><li>Require any missing arguments</li><li>Validate all provided attributes are accepted</li><li>Require any accepted attributes that are <code class="inline">allow_nil?</code> false</li><li>Set any default values for attributes</li><li>Run action changes &amp; validations</li><li>Run validations, or add them in <code class="inline">before_action</code> hooks if using <code class="inline">d:Ash.Resource.Dsl.actions.destroy.validate|before_action?</code>. Any global validations are skipped if the action has <code class="inline">skip_global_validations?</code> set to <code class="inline">true</code>.</li></ul><h2 id="for_destroy/4-examples" class="section-heading"><a href="#for_destroy/4-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="c1"># Basic destroy changeset</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">post</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="p" data-group-id="4767190501-1">%</samp><samp class="nc" data-group-id="4767190501-1">MyApp.Post</samp><samp class="p" data-group-id="4767190501-1">{</samp><samp class="ss">id</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mi">1</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">title</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;My Post&quot;</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">content</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;Content&quot;</samp><samp class="p" data-group-id="4767190501-1">}</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_destroy</samp><samp class="p" data-group-id="4767190501-2">(</samp><samp class="n">post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:destroy</samp><samp class="p" data-group-id="4767190501-2">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">valid?</samp><samp class="w">
</samp><samp class="no">true</samp><samp class="w">

</samp><samp class="c1"># Destroy changeset with inputs for the action</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">user</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="p" data-group-id="4767190501-3">%</samp><samp class="nc" data-group-id="4767190501-3">MyApp.User</samp><samp class="p" data-group-id="4767190501-3">{</samp><samp class="ss">id</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mi">1</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">name</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;John&quot;</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">email</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;john@example.com&quot;</samp><samp class="p" data-group-id="4767190501-3">}</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_destroy</samp><samp class="p" data-group-id="4767190501-4">(</samp><samp class="n">user</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:archive</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="4767190501-5">%{</samp><samp class="ss">reason</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;User requested deletion&quot;</samp><samp class="p" data-group-id="4767190501-5">}</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">actor</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="n">current_user</samp><samp class="p" data-group-id="4767190501-4">)</samp><samp class="w">

</samp><samp class="c1"># Soft delete changeset (if action is configured as soft)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">comment</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="p" data-group-id="4767190501-6">%</samp><samp class="nc" data-group-id="4767190501-6">MyApp.Comment</samp><samp class="p" data-group-id="4767190501-6">{</samp><samp class="ss">id</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mi">1</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">body</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;My comment&quot;</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">post_id</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mi">1</samp><samp class="p" data-group-id="4767190501-6">}</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_destroy</samp><samp class="p" data-group-id="4767190501-7">(</samp><samp class="n">comment</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:soft_delete</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="4767190501-8">%{</samp><samp class="p" data-group-id="4767190501-8">}</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">actor</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="n">current_user</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">tenant</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;org_123&quot;</samp><samp class="p" data-group-id="4767190501-7">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">tenant</samp><samp class="w">
</samp><samp class="s">&quot;org_123&quot;</samp></code></pre><h2 id="for_destroy/4-see-also" class="section-heading"><a href="#for_destroy/4-see-also" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">See also</span></h2><ul><li><a href="#for_action/4"><code class="inline">for_action/4</code></a> for a generic action constructor</li><li><a href="#for_create/4"><code class="inline">for_create/4</code></a> for creating new records</li><li><a href="#for_update/4"><code class="inline">for_update/4</code></a> for updating records</li><li><a href="Ash.xhtml#destroy/2"><code class="inline">Ash.destroy/2</code></a> to execute the changeset</li><li><code class="inline">d:Ash.Resource.Dsl.actions.destroy</code> for defining destroy actions</li><li><a href="destroy-actions.xhtml">Destroy Actions Guide</a> for understanding destroy operations</li><li><a href="actions.xhtml">Actions Guide</a> for general action concepts</li></ul>
  </section>
</section>
<section class="detail" id="for_update/4">

    <span id="for_update/2"></span>

    <span id="for_update/3"></span>

  <div class="detail-header">
    <a href="#for_update/4" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">for_update(initial, action, params \\ %{}, opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L1949" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Constructs a changeset for a given update action, and validates it.</p><p>Anything that is modified prior to <a href="#for_update/4"><code class="inline">for_update/4</code></a> is validated against the rules of the action, while <em>anything after it is not</em>.</p><h3 id="for_update/4-what-does-this-function-do" class="section-heading"><a href="#for_update/4-what-does-this-function-do" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">What does this function do?</span></h3><p>The following steps are run when calling <a href="#for_update/4"><code class="inline">Ash.Changeset.for_update/4</code></a>.</p><ul><li><p>Cast input params | This is any arguments in addition to any accepted attributes</p></li><li>Set argument defaults</li><li>Require any missing arguments</li><li>Validate all provided attributes are accepted</li><li>Require any accepted attributes that are <code class="inline">allow_nil?</code> false</li><li>Set any default values for attributes</li><li>Run action changes &amp; validations</li><li>Run validations, or add them in <code class="inline">before_action</code> hooks if using <code class="inline">d:Ash.Resource.Dsl.actions.update.validate|before_action?</code>. Any global validations are skipped if the action has <code class="inline">skip_global_validations?</code> set to <code class="inline">true</code>.</li></ul><h2 id="for_update/4-examples" class="section-heading"><a href="#for_update/4-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="c1"># Basic update changeset with attributes</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">post</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="p" data-group-id="4662490985-1">%</samp><samp class="nc" data-group-id="4662490985-1">MyApp.Post</samp><samp class="p" data-group-id="4662490985-1">{</samp><samp class="ss">id</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mi">1</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">title</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;Original Title&quot;</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">content</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;Original content&quot;</samp><samp class="p" data-group-id="4662490985-1">}</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_update</samp><samp class="p" data-group-id="4662490985-2">(</samp><samp class="n">post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:update</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="4662490985-3">%{</samp><samp class="ss">title</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;Updated Title&quot;</samp><samp class="p" data-group-id="4662490985-3">}</samp><samp class="p" data-group-id="4662490985-2">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">valid?</samp><samp class="w">
</samp><samp class="no">true</samp><samp class="w">

</samp><samp class="c1"># Update changeset with custom actor and load related data</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">comment</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="p" data-group-id="4662490985-4">%</samp><samp class="nc" data-group-id="4662490985-4">MyApp.Comment</samp><samp class="p" data-group-id="4662490985-4">{</samp><samp class="ss">id</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mi">1</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">body</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;Original comment&quot;</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">post_id</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mi">1</samp><samp class="p" data-group-id="4662490985-4">}</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_update</samp><samp class="p" data-group-id="4662490985-5">(</samp><samp class="n">comment</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:update</samp><samp class="p">,</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="p" data-group-id="4662490985-6">%{</samp><samp class="ss">body</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;Updated comment&quot;</samp><samp class="p" data-group-id="4662490985-6">}</samp><samp class="p">,</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="ss">actor</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="n">current_user</samp><samp class="p">,</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="w">  </samp><samp class="ss">load</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="p" data-group-id="4662490985-7">[</samp><samp class="ss">:post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:author</samp><samp class="p" data-group-id="4662490985-7">]</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="p" data-group-id="4662490985-5">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">load</samp><samp class="w">
</samp><samp class="p" data-group-id="4662490985-8">[</samp><samp class="ss">:post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:author</samp><samp class="p" data-group-id="4662490985-8">]</samp></code></pre><h2 id="for_update/4-see-also" class="section-heading"><a href="#for_update/4-see-also" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">See also</span></h2><ul><li><a href="#for_action/4"><code class="inline">for_action/4</code></a> for a generic action constructor</li><li><a href="#for_create/4"><code class="inline">for_create/4</code></a> for creating new records</li><li><a href="#for_destroy/4"><code class="inline">for_destroy/4</code></a> for destroying records</li><li><a href="Ash.xhtml#update/2"><code class="inline">Ash.update/2</code></a> to execute the changeset</li><li><code class="inline">d:Ash.Resource.Dsl.actions.update</code> for defining update actions</li><li><a href="update-actions.xhtml">Update Actions Guide</a> for understanding update operations</li><li><a href="actions.xhtml">Actions Guide</a> for general action concepts</li></ul>
  </section>
</section>
<section class="detail" id="force_change_attribute/3">

  <div class="detail-header">
    <a href="#force_change_attribute/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">force_change_attribute(changeset, attribute, value)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L6370" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> force_change_attribute(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Changes an attribute even if it isn't writable</p>
  </section>
</section>
<section class="detail" id="force_change_attributes/2">

  <div class="detail-header">
    <a href="#force_change_attributes/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">force_change_attributes(changeset, changes)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L6362" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> force_change_attributes(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>() | <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Calls <a href="#force_change_attribute/3"><code class="inline">force_change_attribute/3</code></a> for each key/value pair provided.</p>
  </section>
</section>
<section class="detail" id="force_change_new_attribute/3">

  <div class="detail-header">
    <a href="#force_change_new_attribute/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">force_change_new_attribute(changeset, attribute, value)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L6120" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> force_change_new_attribute(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Force change an attribute if it is not currently being changed.</p><p>See <a href="#change_new_attribute/3"><code class="inline">change_new_attribute/3</code></a> for more.</p>
  </section>
</section>
<section class="detail" id="force_change_new_attribute_lazy/3">

  <div class="detail-header">
    <a href="#force_change_new_attribute_lazy/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">force_change_new_attribute_lazy(changeset, attribute, func)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L6134" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> force_change_new_attribute_lazy(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(), (-&gt; <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>())) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Force change an attribute if it is not currently being changed, by calling the provided function.</p><p>See <a href="#change_new_attribute_lazy/3"><code class="inline">change_new_attribute_lazy/3</code></a> for more.</p>
  </section>
</section>
<section class="detail" id="force_delete_argument/2">

  <div class="detail-header">
    <a href="#force_delete_argument/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">force_delete_argument(changeset, argument_or_arguments)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L6086" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Remove an argument from the changeset, not warning if the changeset has already been validated.</p>
  </section>
</section>
<section class="detail" id="force_set_argument/3">

  <div class="detail-header">
    <a href="#force_set_argument/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">force_set_argument(changeset, argument, value)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L6014" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Add an argument to the changeset, which will be provided to the action.</p><p>Does not show a warning when used in before/after action hooks.</p>
  </section>
</section>
<section class="detail" id="force_set_arguments/2">

  <div class="detail-header">
    <a href="#force_set_arguments/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">force_set_arguments(changeset, map)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L6108" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Merge a map of arguments to the arguments list.</p><p>Does not show a warning when used in before/after action hooks.</p>
  </section>
</section>
<section class="detail" id="fully_atomic_changeset/4">

    <span id="fully_atomic_changeset/3"></span>

  <div class="detail-header">
    <a href="#fully_atomic_changeset/4" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">fully_atomic_changeset(resource, action, params, opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L789" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> fully_atomic_changeset(
  resource :: <a href="Ash.Resource.xhtml#t:t/0">Ash.Resource.t</a>(),
  action :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>() | <a href="Ash.Resource.Actions.xhtml#t:action/0">Ash.Resource.Actions.action</a>(),
  params :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>(),
  opts :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()
) :: <a href="#t:t/0">t</a>() | {:not_atomic, <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>()}</pre>

      </div>


  </section>
</section>
<section class="detail" id="get_argument/2">

  <div class="detail-header">
    <a href="#get_argument/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_argument(changeset, argument)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L4768" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> get_argument(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()</pre>

      </div>

<p>Gets the value of an argument provided to the changeset.</p><h2 id="get_argument/2-examples" class="section-heading"><a href="#get_argument/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="c1"># Get an argument that was set</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">MyApp.Post</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">new</samp><samp class="p" data-group-id="0494021325-1">(</samp><samp class="p" data-group-id="0494021325-1">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">set_argument</samp><samp class="p" data-group-id="0494021325-2">(</samp><samp class="ss">:auto_publish</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="no">true</samp><samp class="p" data-group-id="0494021325-2">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">get_argument</samp><samp class="p" data-group-id="0494021325-3">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:auto_publish</samp><samp class="p" data-group-id="0494021325-3">)</samp><samp class="w">
</samp><samp class="no">true</samp><samp class="w">

</samp><samp class="c1"># Get an argument that doesn&#39;t exist (returns nil)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">new</samp><samp class="p" data-group-id="0494021325-4">(</samp><samp class="nc">MyApp.Post</samp><samp class="p" data-group-id="0494021325-4">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">get_argument</samp><samp class="p" data-group-id="0494021325-5">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:nonexistent</samp><samp class="p" data-group-id="0494021325-5">)</samp><samp class="w">
</samp><samp class="no">nil</samp><samp class="w">

</samp><samp class="c1"># Get argument with string key</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">MyApp.User</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">new</samp><samp class="p" data-group-id="0494021325-6">(</samp><samp class="p" data-group-id="0494021325-6">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">set_argument</samp><samp class="p" data-group-id="0494021325-7">(</samp><samp class="ss">:send_email</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="no">false</samp><samp class="p" data-group-id="0494021325-7">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">get_argument</samp><samp class="p" data-group-id="0494021325-8">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="s">&quot;send_email&quot;</samp><samp class="p" data-group-id="0494021325-8">)</samp><samp class="w">
</samp><samp class="no">false</samp></code></pre><h2 id="get_argument/2-see-also" class="section-heading"><a href="#get_argument/2-see-also" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">See also</span></h2><ul><li><a href="#set_argument/3"><code class="inline">set_argument/3</code></a> for setting argument values</li><li><a href="#fetch_argument/2"><code class="inline">fetch_argument/2</code></a> for getting arguments with error handling</li><li><a href="#get_argument_or_attribute/2"><code class="inline">get_argument_or_attribute/2</code></a> for fallback to attributes</li></ul>
  </section>
</section>
<section class="detail" id="get_argument_or_attribute/2">

  <div class="detail-header">
    <a href="#get_argument_or_attribute/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_argument_or_attribute(changeset, attribute)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L4855" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> get_argument_or_attribute(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()</pre>

      </div>

<p>Gets the value of an argument provided to the changeset, falling back to <a href="#get_attribute/2"><code class="inline">Ash.Changeset.get_attribute/2</code></a> if nothing was provided.</p>
  </section>
</section>
<section class="detail" id="get_attribute/2">

  <div class="detail-header">
    <a href="#get_attribute/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_attribute(changeset, attribute)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L4821" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> get_attribute(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()</pre>

      </div>

<p>Gets the changing value or the original value of an attribute.</p>
  </section>
</section>
<section class="detail" id="get_data/2">

  <div class="detail-header">
    <a href="#get_data/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_data(changeset, attribute)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L4898" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> get_data(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()</pre>

      </div>

<p>Gets the original value for an attribute</p>
  </section>
</section>
<section class="detail" id="handle_errors/2">

  <div class="detail-header">
    <a href="#handle_errors/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">handle_errors(changeset, func)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L6989" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> handle_errors(
  <a href="#t:t/0">t</a>(),
  (<a href="#t:t/0">t</a>(), error :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>() -&gt;
     :ignore | <a href="#t:t/0">t</a>() | (error :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()) | {error :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(), <a href="#t:t/0">t</a>()})
  | {<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">module</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(), [<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()]}
) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Sets a custom error handler on the changeset.</p><p>The error handler should be a two argument function or an mfa, in which case the first two arguments will be set
to the changeset and the error, w/ the supplied arguments following those. The changeset will be marked
as invalid regardless of the outcome of this callback.</p><p>Any errors generated are passed to <code class="inline">handle_errors</code>, which can return any of the following:</p><ul><li><code class="inline">:ignore</code> - the error is discarded.</li><li><code class="inline">changeset</code> - a new (or the same) changeset. The error is not added.</li><li><code class="inline">{changeset, error}</code> - a new (or the same) error and changeset. The error is added to the changeset.</li><li><code class="inline">anything_else</code> - is treated as a new, transformed version of the error. The result is added as an error to the changeset.</li></ul>
  </section>
</section>
<section class="detail" id="is_valid/1">

  <div class="detail-header">
    <a href="#is_valid/1" class="detail-link" data-no-tooltip="" aria-label="Link to this macro">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">is_valid(changeset)</h1>

        <span class="note">(macro)</span>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L458" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> is_valid(<a href="#t:t/0">t</a>()) :: <a href="https://hexdocs.pm/elixir/Macro.html#t:output/0">Macro.output</a>()</pre>

      </div>

<p>A guard which checks if the Changeset is valid.</p>
  </section>
</section>
<section class="detail" id="load/2">

  <div class="detail-header">
    <a href="#load/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">load(changeset, load)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L674" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> load(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Calls the provided load statement on the result of the action at the very end of the action.</p><h2 id="load/2-examples" class="section-heading"><a href="#load/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="c1"># Load a single relationship</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="0059914825-1">(</samp><samp class="nc">MyApp.Post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="0059914825-2">%{</samp><samp class="ss">title</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;My Post&quot;</samp><samp class="p" data-group-id="0059914825-2">}</samp><samp class="p" data-group-id="0059914825-1">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">load</samp><samp class="p" data-group-id="0059914825-3">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:comments</samp><samp class="p" data-group-id="0059914825-3">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">load</samp><samp class="w">
</samp><samp class="p" data-group-id="0059914825-4">[</samp><samp class="ss">:comments</samp><samp class="p" data-group-id="0059914825-4">]</samp><samp class="w">

</samp><samp class="c1"># Load multiple relationships</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_update</samp><samp class="p" data-group-id="0059914825-5">(</samp><samp class="n">user</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:update</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="0059914825-6">%{</samp><samp class="ss">name</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;John Doe&quot;</samp><samp class="p" data-group-id="0059914825-6">}</samp><samp class="p" data-group-id="0059914825-5">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">load</samp><samp class="p" data-group-id="0059914825-7">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="0059914825-8">[</samp><samp class="ss">:posts</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:profile</samp><samp class="p" data-group-id="0059914825-8">]</samp><samp class="p" data-group-id="0059914825-7">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">load</samp><samp class="w">
</samp><samp class="p" data-group-id="0059914825-9">[</samp><samp class="ss">:posts</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:profile</samp><samp class="p" data-group-id="0059914825-9">]</samp><samp class="w">

</samp><samp class="c1"># Load nested relationships</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="0059914825-10">(</samp><samp class="nc">MyApp.Comment</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="0059914825-11">%{</samp><samp class="ss">body</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;Great post!&quot;</samp><samp class="p" data-group-id="0059914825-11">}</samp><samp class="p" data-group-id="0059914825-10">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">load</samp><samp class="p" data-group-id="0059914825-12">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="0059914825-13">[</samp><samp class="ss">post</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="p" data-group-id="0059914825-14">[</samp><samp class="ss">:author</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:comments</samp><samp class="p" data-group-id="0059914825-14">]</samp><samp class="p" data-group-id="0059914825-13">]</samp><samp class="p" data-group-id="0059914825-12">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">load</samp><samp class="w">
</samp><samp class="p" data-group-id="0059914825-15">[</samp><samp class="p" data-group-id="0059914825-16">[</samp><samp class="ss">post</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="p" data-group-id="0059914825-17">[</samp><samp class="ss">:author</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:comments</samp><samp class="p" data-group-id="0059914825-17">]</samp><samp class="p" data-group-id="0059914825-16">]</samp><samp class="p" data-group-id="0059914825-15">]</samp><samp class="w">

</samp><samp class="c1"># Chain multiple load calls (they accumulate)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_update</samp><samp class="p" data-group-id="0059914825-18">(</samp><samp class="n">post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:update</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="0059914825-19">%{</samp><samp class="ss">title</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;Updated Title&quot;</samp><samp class="p" data-group-id="0059914825-19">}</samp><samp class="p" data-group-id="0059914825-18">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">load</samp><samp class="p" data-group-id="0059914825-20">(</samp><samp class="ss">:author</samp><samp class="p" data-group-id="0059914825-20">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">load</samp><samp class="p" data-group-id="0059914825-21">(</samp><samp class="ss">:comments</samp><samp class="p" data-group-id="0059914825-21">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">load</samp><samp class="w">
</samp><samp class="p" data-group-id="0059914825-22">[</samp><samp class="ss">:author</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:comments</samp><samp class="p" data-group-id="0059914825-22">]</samp></code></pre><h2 id="load/2-see-also" class="section-heading"><a href="#load/2-see-also" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">See also</span></h2><ul><li><a href="#select/3"><code class="inline">select/3</code></a> for controlling which attributes are returned</li><li><a href="#loading?/2"><code class="inline">loading?/2</code></a> for checking if something is being loaded</li><li><a href="Ash.Query.xhtml#load/2"><code class="inline">Ash.Query.load/2</code></a> for loading in queries</li></ul>
  </section>
</section>
<section class="detail" id="loading?/2">

  <div class="detail-header">
    <a href="#loading?/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">loading?(changeset, path)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L759" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Returns true if the field/relationship or path to field/relationship is being loaded.</p><p>It accepts an atom or a list of atoms, which is treated for as a &quot;path&quot;, i.e:</p><pre><code class="makeup elixir" translate="no"><samp class="nc">Resource</samp><samp class="w"> </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">load</samp><samp class="p" data-group-id="4028108075-1">(</samp><samp class="ss">friends</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="p" data-group-id="4028108075-2">[</samp><samp class="ss">enemies</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="p" data-group-id="4028108075-3">[</samp><samp class="ss">:score</samp><samp class="p" data-group-id="4028108075-3">]</samp><samp class="p" data-group-id="4028108075-2">]</samp><samp class="p" data-group-id="4028108075-1">)</samp><samp class="w"> </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">loading?</samp><samp class="p" data-group-id="4028108075-4">(</samp><samp class="p" data-group-id="4028108075-5">[</samp><samp class="ss">:friends</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:enemies</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:score</samp><samp class="p" data-group-id="4028108075-5">]</samp><samp class="p" data-group-id="4028108075-4">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="no">true</samp><samp class="w">

</samp><samp class="nc">Resource</samp><samp class="w"> </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">load</samp><samp class="p" data-group-id="4028108075-6">(</samp><samp class="ss">friends</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="p" data-group-id="4028108075-7">[</samp><samp class="ss">enemies</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="p" data-group-id="4028108075-8">[</samp><samp class="ss">:score</samp><samp class="p" data-group-id="4028108075-8">]</samp><samp class="p" data-group-id="4028108075-7">]</samp><samp class="p" data-group-id="4028108075-6">)</samp><samp class="w"> </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">loading?</samp><samp class="p" data-group-id="4028108075-9">(</samp><samp class="p" data-group-id="4028108075-10">[</samp><samp class="ss">:friends</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:score</samp><samp class="p" data-group-id="4028108075-10">]</samp><samp class="p" data-group-id="4028108075-9">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="no">false</samp><samp class="w">

</samp><samp class="nc">Resource</samp><samp class="w"> </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">load</samp><samp class="p" data-group-id="4028108075-11">(</samp><samp class="ss">friends</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="p" data-group-id="4028108075-12">[</samp><samp class="ss">enemies</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="p" data-group-id="4028108075-13">[</samp><samp class="ss">:score</samp><samp class="p" data-group-id="4028108075-13">]</samp><samp class="p" data-group-id="4028108075-12">]</samp><samp class="p" data-group-id="4028108075-11">)</samp><samp class="w"> </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">loading?</samp><samp class="p" data-group-id="4028108075-14">(</samp><samp class="ss">:friends</samp><samp class="p" data-group-id="4028108075-14">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="no">true</samp></code></pre>
  </section>
</section>
<section class="detail" id="manage_relationship/4">

    <span id="manage_relationship/3"></span>

  <div class="detail-header">
    <a href="#manage_relationship/4" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">manage_relationship(changeset, relationship, input, opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L5392" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Manages the related records by creating, updating, or destroying them as necessary.</p><p>Keep in mind that the default values for all <code class="inline">on_*</code> are <code class="inline">:ignore</code>, meaning nothing will happen
unless you provide instructions.</p><p>The input provided to <code class="inline">manage_relationship</code> should be a map, in the case of to_one relationships, or a list of maps
in the case of to_many relationships. The following steps are followed for each input provided:</p><ul><li>The input is checked against the currently related records to find any matches. The primary key and unique identities are used to find matches.</li><li>For any input that had a match in the current relationship, the <code class="inline">:on_match</code> behavior is triggered</li><li>For any input that does not have a match:<ul><li>if there is <code class="inline">on_lookup</code> behavior:<ul><li>we try to find the record in the data layer.</li><li>if the record is found, the on_lookup behavior is triggered</li><li>if the record is not found, the <code class="inline">on_no_match</code> behavior is triggered</li></ul></li><li>if there is no <code class="inline">on_lookup</code> behavior:<ul><li>the <code class="inline">on_no_match</code> behavior is triggered</li></ul></li></ul></li><li>finally, for any records present in the <em>current relationship</em> that had no match <em>in the input</em>, the <code class="inline">on_missing</code> behavior is triggered</li></ul><h2 id="manage_relationship/4-options" class="section-heading"><a href="#manage_relationship/4-options" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Options</span></h2><ul><li><p><code class="inline">:type</code> - If the <code class="inline">type</code> is specified, the default values of each option is modified to match that <code class="inline">type</code> of operation.<br/>This allows for specifying certain operations much more succinctly. The defaults that are modified are listed below:  </p><ul><li><code class="inline">:append_and_remove</code>  <pre><code class="makeup elixir" translate="no"><samp class="p" data-group-id="2698963963-1">[</samp><samp class="w">
  </samp><samp class="ss">on_lookup</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:relate</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="ss">on_no_match</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:error</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="ss">on_match</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:ignore</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="ss">on_missing</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:unrelate</samp><samp class="w">
</samp><samp class="p" data-group-id="2698963963-1">]</samp><samp class="w">  </samp></code></pre></li><li><code class="inline">:append</code>  <pre><code class="makeup elixir" translate="no"><samp class="p" data-group-id="9574126612-1">[</samp><samp class="w">
  </samp><samp class="ss">on_lookup</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:relate</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="ss">on_no_match</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:error</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="ss">on_match</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:ignore</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="ss">on_missing</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:ignore</samp><samp class="w">
</samp><samp class="p" data-group-id="9574126612-1">]</samp><samp class="w">  </samp></code></pre></li><li><code class="inline">:remove</code>  <pre><code class="makeup elixir" translate="no"><samp class="p" data-group-id="5496517496-1">[</samp><samp class="w">
  </samp><samp class="ss">on_no_match</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:error</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="ss">on_match</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:unrelate</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="ss">on_missing</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:ignore</samp><samp class="w">
</samp><samp class="p" data-group-id="5496517496-1">]</samp><samp class="w">  </samp></code></pre></li><li><code class="inline">:direct_control</code>  <pre><code class="makeup elixir" translate="no"><samp class="p" data-group-id="9957684996-1">[</samp><samp class="w">
  </samp><samp class="ss">on_lookup</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:ignore</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="ss">on_no_match</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="ss">on_match</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:update</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="ss">on_missing</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:destroy</samp><samp class="w">
</samp><samp class="p" data-group-id="9957684996-1">]</samp><samp class="w">  </samp></code></pre></li><li><code class="inline">:create</code>  <pre><code class="makeup elixir" translate="no"><samp class="p" data-group-id="8550312730-1">[</samp><samp class="w">
  </samp><samp class="ss">on_no_match</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="ss">on_match</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:ignore</samp><samp class="w">
</samp><samp class="p" data-group-id="8550312730-1">]</samp></code></pre>Valid values are :append_and_remove, :append, :remove, :direct_control, :create</li></ul></li><li><p><code class="inline">:authorize?</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">boolean/0</code></a>) - Authorize reads and changes to the destination records, if the primary change is being authorized as well. The default value is <code class="inline">true</code>.</p></li><li><p><code class="inline">:eager_validate_with</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">atom/0</code></a>) - Validates that any referenced entities exist <em>before</em> the action is being performed, using the provided domain for the read. The default value is <code class="inline">false</code>.</p></li><li><p><code class="inline">:on_no_match</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">term/0</code></a>) - Instructions for handling records where no matching record existed in the relationship.  </p><ul><li><code class="inline">:ignore</code> (default) - those inputs are ignored</li><li><code class="inline">:match</code> - For <code class="inline">has_one</code> and <code class="inline">belongs_to</code> only, any input is treated as a match for an existing value. For <code class="inline">has_many</code> and <code class="inline">many_to_many</code>, this is the same as <code class="inline">:ignore</code>.</li><li><code class="inline">:create</code> - the records are created using the destination's primary create action</li><li><code class="inline">{:create, :action_name}</code> - the records are created using the specified action on the destination resource</li><li><code class="inline">{:create, :action_name, :join_table_action_name, [:list, :of, :join_table, :params]}</code> - Same as <code class="inline">{:create, :action_name}</code> but takes
  the list of params specified out and applies them when creating the join record, with the provided join_table_action_name.</li><li><code class="inline">:error</code>  - an error is returned indicating that a record would have been created<ul><li> If <code class="inline">on_lookup</code> is set, and the data contained a primary key or identity, then the error is a <code class="inline">NotFound</code> error</li><li>Otherwise, an <code class="inline">InvalidRelationship</code> error is returned The default value is <code class="inline">:ignore</code>.</li></ul></li></ul></li><li><p><code class="inline">:value_is_key</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">atom/0</code></a>) - Configures what key to use when a single value is provided.<br/>This is useful when you use things like a list of strings i.e <code class="inline">friend_emails</code> to manage the relationship, instead of a list of maps.<br/>By default, we assume it is the primary key of the destination resource, unless it is a composite primary key.</p></li><li><p><code class="inline">:order_is_key</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">atom/0</code></a>) - If set, the order that each input appears in the list will be added to the input as this key.<br/>This is useful when you want to accept an ordered list of related records and write that order to the entity.
This should only currently be used with <code class="inline">type: :direct_control</code> or <code class="inline">type: :create</code> when there are no currently
existing related records (like when creating the source record).<br/>If you have an identity on the field and relationship id on the destination, and you are using
AshPostgres, you will want to use the <code class="inline">deferrable</code> option to ensure that conflicting orders are temporarily
allowed within a single transaction.</p></li><li><p><code class="inline">:identity_priority</code> (list of <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">atom/0</code></a>) - The list, in priority order, of identities to use when looking up records for <code class="inline">on_lookup</code>, and matching records with <code class="inline">on_match</code>.<br/>Use <code class="inline">:_primary_key</code> to prioritize checking a match with the primary key.
All identities, along with <code class="inline">:_primary_key</code> are checked regardless, this only allows ensuring that some are checked first.
Defaults to the list provided by <code class="inline">use_identities</code>, so you typically won't need this option.</p></li><li><p><code class="inline">:use_identities</code> (list of <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">atom/0</code></a>) - A list of identities that may be used to look up and compare records. Use <code class="inline">:_primary_key</code> to include the primary key. By default, only <code class="inline">[:_primary_key]</code> is used.</p></li><li><p><code class="inline">:on_lookup</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">term/0</code></a>) - Before creating a record (because no match was found in the relationship), the record can be looked up and related.  </p><ul><li><code class="inline">:ignore</code> (default) - Does not look for existing entries (matches in the current relationship are still considered updates)</li><li><code class="inline">:relate</code> - Same as calling <code class="inline">{:relate, primary_action_name}</code></li><li><code class="inline">{:relate, :action_name}</code> - the records are looked up by primary key/the first identity that is found (using the primary read action), and related. The action should be:<ul><li><code class="inline">many_to_many</code> - a create action on the join resource</li><li><code class="inline">has_many</code> - an update action on the destination resource</li><li><code class="inline">has_one</code> - an update action on the destination resource</li><li><code class="inline">belongs_to</code> - an update action on the source resource</li></ul></li><li><code class="inline">{:relate, :action_name, :read_action_name}</code> - Same as the above, but customizes the read action called to search for matches.</li><li><code class="inline">:relate_and_update</code> - Same as <code class="inline">:relate</code>, but the remaining parameters from the lookup are passed into the action that is used to change the relationship key</li><li><code class="inline">{:relate_and_update, :action_name}</code> - Same as the above, but customizes the action used. The action should be:<ul><li><code class="inline">many_to_many</code> - a create action on the join resource</li><li><code class="inline">has_many</code> - an update action on the destination resource</li><li><code class="inline">has_one</code> - an update action on the destination resource</li><li><code class="inline">belongs_to</code> - an update action on the source resource</li></ul></li><li><code class="inline">{:relate_and_update, :action_name, :read_action_name}</code> - Same as the above, but customizes the read action called to search for matches.</li><li><code class="inline">{:relate_and_update, :action_name, :read_action_name, [:list, :of, :join_table, :params]}</code> - Same as the above, but uses the provided list of parameters when creating
  the join row (only relevant for many to many relationships). Use <code class="inline">:*</code> to <em>only</em> update the join record, and pass all parameters to its action The default value is <code class="inline">:ignore</code>.</li></ul></li><li><p><code class="inline">:on_match</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">term/0</code></a>) - Instructions for handling records where a matching record existed in the relationship already.  </p><ul><li><code class="inline">:ignore</code> (default) - those inputs are ignored</li><li><code class="inline">:update</code> - the record is updated using the destination's primary update action</li><li><code class="inline">{:update, :action_name}</code> - the record is updated using the specified action on the destination resource</li><li><code class="inline">{:update, :action_name, :join_table_action_name, [:list, :of, :params]}</code> - Same as <code class="inline">{:update, :action_name}</code> but takes
  the list of params specified out and applies them as an update to the join record (only valid for many to many)</li><li><code class="inline">:update_join</code> - update only the join record (only valid for many to many)</li><li><code class="inline">{:update_join, :join_table_action_name}</code> - use the specified update action on a join resource</li><li><code class="inline">{:update_join, :join_table_action_name, [:list, :of, :params]}</code> - pass specified params from input into a join resource update action</li><li><code class="inline">{:destroy, :action_name}</code> - the record is destroyed using the specified action on the destination resource. The action should be:<ul><li><code class="inline">many_to_many</code> - a destroy action on the join record</li><li><code class="inline">has_many</code> - a destroy action on the destination resource</li><li><code class="inline">has_one</code> - a destroy action on the destination resource</li><li><code class="inline">belongs_to</code> - a destroy action on the destination resource</li></ul></li><li><code class="inline">:error</code>  - an error is returned indicating that a record would have been updated</li><li><code class="inline">:no_match</code> - follows the <code class="inline">on_no_match</code> instructions with these records</li><li><code class="inline">:missing</code> - follows the <code class="inline">on_missing</code> instructions with these records</li><li><code class="inline">:unrelate</code> - the related item is not destroyed, but the data is &quot;unrelated&quot;. The action should be:<ul><li><code class="inline">many_to_many</code> - the join resource row is destroyed</li><li><code class="inline">has_many</code> - the <code class="inline">destination_attribute</code> (on the related record) is set to <code class="inline">nil</code></li><li><code class="inline">has_one</code> - the <code class="inline">destination_attribute</code> (on the related record) is set to <code class="inline">nil</code></li><li><code class="inline">belongs_to</code> - the <code class="inline">source_attribute</code> (on this record) is set to <code class="inline">nil</code></li></ul></li><li><code class="inline">{:unrelate, :action_name}</code> - the record is unrelated using the provided update action. The action should be:<ul><li><code class="inline">many_to_many</code> - a destroy action on the join resource</li><li><code class="inline">has_many</code> - an update action on the destination resource</li><li><code class="inline">has_one</code> - an update action on the destination resource</li><li><code class="inline">belongs_to</code> - an update action on the source resource The default value is <code class="inline">:ignore</code>.</li></ul></li></ul></li><li><p><code class="inline">:on_missing</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">term/0</code></a>) - Instructions for handling records that existed in the current relationship but not in the input.  </p><ul><li><code class="inline">:ignore</code> (default) - those inputs are ignored</li><li><code class="inline">:destroy</code> - the record is destroyed using the destination's primary destroy action</li><li><code class="inline">{:destroy, :action_name}</code> - the record is destroyed using the specified action on the destination resource</li><li><code class="inline">{:destroy, :action_name, :join_resource_action_name}</code> - the record is destroyed using the specified action on the destination resource,
but first the join resource is destroyed with its specified action</li><li><code class="inline">:error</code>  - an error is returned indicating that a record would have been updated</li><li><code class="inline">:unrelate</code> - the related item is not destroyed, but the data is &quot;unrelated&quot;. The action should be:<ul><li><code class="inline">many_to_many</code> - the join resource row is destroyed</li><li><code class="inline">has_many</code> - the <code class="inline">destination_attribute</code> (on the related record) is set to <code class="inline">nil</code></li><li><code class="inline">has_one</code> - the <code class="inline">destination_attribute</code> (on the related record) is set to <code class="inline">nil</code></li><li><code class="inline">belongs_to</code> - the <code class="inline">source_attribute</code> (on this record) is set to <code class="inline">nil</code></li></ul></li><li><code class="inline">{:unrelate, :action_name}</code> - the record is unrelated using the provided update action. The action should be:<ul><li><code class="inline">many_to_many</code> - a destroy action on the join resource</li><li><code class="inline">has_many</code> - an update action on the destination resource</li><li><code class="inline">has_one</code> - an update action on the destination resource</li><li><code class="inline">belongs_to</code> - an update action on the source resource The default value is <code class="inline">:ignore</code>.</li></ul></li></ul></li><li><p><code class="inline">:error_path</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">term/0</code></a>) - By default, errors added to the changeset will use the path <code class="inline">[:relationship_name]</code>, or <code class="inline">[:relationship_name, &lt;index&gt;]</code>.
If you want to modify this path, you can specify <code class="inline">error_path</code>, e.g if had a <code class="inline">change</code> on an action that takes an argument
and uses that argument data to call <code class="inline">manage_relationship</code>, you may want any generated errors to appear under the name of that
argument, so you could specify <code class="inline">error_path: :argument_name</code> when calling <code class="inline">manage_relationship</code>.</p></li><li><p><code class="inline">:join_keys</code> (list of <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">atom/0</code></a>) - For many to many relationships specifies the parameters to pick from the input and pass into a join resource action.
Applicable in cases like <code class="inline">on_no_match: :create</code>, <code class="inline">on_match: :update</code> and <code class="inline">on_lookup: :relate</code>.
Can be overwritten by a full form instruction tuple which contains join parameters at the end.</p></li><li><p><code class="inline">:meta</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">term/0</code></a>) - Freeform data that will be retained along with the options, which can be used to track/manage the changes
that are added to the <code class="inline">relationships</code> key. Use the <code class="inline">meta[:order]</code> option to specify the order in which multiple
calls to <code class="inline">manage_relationship</code> should be executed.</p></li><li><p><code class="inline">:ignore?</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">term/0</code></a>) - This tells Ash to ignore the provided inputs when actually running the action. This can be useful for
building up a set of instructions that you intend to handle manually. The default value is <code class="inline">false</code>.</p></li><li><p><code class="inline">:debug?</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">boolean/0</code></a>) - Logs queries executed by relationship. The default value is <code class="inline">false</code>.</p></li></ul><p>Each call to this function adds new records that will be handled according to their options. For example,
if you tracked &quot;tags to add&quot; and &quot;tags to remove&quot; in separate fields, you could input them like so:</p><pre><code class="makeup elixir" translate="no"><samp class="n">changeset</samp><samp class="w">
</samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">manage_relationship</samp><samp class="p" data-group-id="7710104832-1">(</samp><samp class="w">
  </samp><samp class="ss">:tags</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="p" data-group-id="7710104832-2">[</samp><samp class="p" data-group-id="7710104832-3">%{</samp><samp class="ss">name</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;backend&quot;</samp><samp class="p" data-group-id="7710104832-3">}</samp><samp class="p" data-group-id="7710104832-2">]</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="ss">on_lookup</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:relate</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="c1">#relate that tag if it exists in the database</samp><samp class="w">
  </samp><samp class="ss">on_no_match</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:error</samp><samp class="w"> </samp><samp class="c1"># error if a tag with that name doesn&#39;t exist</samp><samp class="w">
</samp><samp class="p" data-group-id="7710104832-1">)</samp><samp class="w">
</samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">manage_relationship</samp><samp class="p" data-group-id="7710104832-4">(</samp><samp class="w">
  </samp><samp class="ss">:tags</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="p" data-group-id="7710104832-5">[</samp><samp class="p" data-group-id="7710104832-6">%{</samp><samp class="ss">name</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;frontend&quot;</samp><samp class="p" data-group-id="7710104832-6">}</samp><samp class="p" data-group-id="7710104832-5">]</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="ss">on_no_match</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:error</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="c1"># error if a tag with that name doesn&#39;t exist in the relationship</samp><samp class="w">
  </samp><samp class="ss">on_match</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:unrelate</samp><samp class="w"> </samp><samp class="c1"># if a tag with that name is related, unrelate it</samp><samp class="w">
</samp><samp class="p" data-group-id="7710104832-4">)</samp></code></pre><p>When calling this multiple times with the <code class="inline">on_missing</code> option set, the list of records that are considered missing are checked
after each set of inputs is processed. For example, if you manage the relationship once with <code class="inline">on_missing: :unrelate</code>, the records
missing from your input will be removed, and <em>then</em> your next call to <code class="inline">manage_relationship</code> will be resolved (with those records unrelated).
For this reason, it is suggested that you don't call this function multiple times with an <code class="inline">on_missing</code> instruction, as you may be
surprised by the result.</p><p>If you want the input to update existing entities, you need to ensure that the primary key (or unique identity) is provided as
part of the input. See the example below:</p><pre><code class="makeup elixir" translate="no"><samp class="n">changeset</samp><samp class="w">
</samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">manage_relationship</samp><samp class="p" data-group-id="0647021078-1">(</samp><samp class="w">
  </samp><samp class="ss">:comments</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="p" data-group-id="0647021078-2">[</samp><samp class="p" data-group-id="0647021078-3">%{</samp><samp class="ss">rating</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mi">10</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">contents</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;foo&quot;</samp><samp class="p" data-group-id="0647021078-3">}</samp><samp class="p" data-group-id="0647021078-2">]</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="ss">on_no_match</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="p" data-group-id="0647021078-4">{</samp><samp class="ss">:create</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create_action</samp><samp class="p" data-group-id="0647021078-4">}</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="ss">on_missing</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:ignore</samp><samp class="w">
</samp><samp class="p" data-group-id="0647021078-1">)</samp><samp class="w">
</samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">manage_relationship</samp><samp class="p" data-group-id="0647021078-5">(</samp><samp class="w">
  </samp><samp class="ss">:comments</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="p" data-group-id="0647021078-6">[</samp><samp class="p" data-group-id="0647021078-7">%{</samp><samp class="ss">id</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mi">10</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">rating</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mi">10</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">contents</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;foo&quot;</samp><samp class="p" data-group-id="0647021078-7">}</samp><samp class="p" data-group-id="0647021078-6">]</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="ss">on_match</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="p" data-group-id="0647021078-8">{</samp><samp class="ss">:update</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:update_action</samp><samp class="p" data-group-id="0647021078-8">}</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="ss">on_no_match</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="p" data-group-id="0647021078-9">{</samp><samp class="ss">:create</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create_action</samp><samp class="p" data-group-id="0647021078-9">}</samp><samp class="p" data-group-id="0647021078-5">)</samp></code></pre><p>This is a simple way to manage a relationship. If you need custom behavior, you can customize the action that is
called, which allows you to add arguments/changes. However, at some point you may want to forego this function
and make the changes yourself. For example:</p><pre><code class="makeup elixir" translate="no"><samp class="n">input</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="p" data-group-id="1205155497-1">[</samp><samp class="p" data-group-id="1205155497-2">%{</samp><samp class="ss">id</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mi">10</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">rating</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mi">10</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">contents</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;foo&quot;</samp><samp class="p" data-group-id="1205155497-2">}</samp><samp class="p" data-group-id="1205155497-1">]</samp><samp class="w">

</samp><samp class="n">changeset</samp><samp class="w">
</samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">after_action</samp><samp class="p" data-group-id="1205155497-3">(</samp><samp class="k" data-group-id="1205155497-4">fn</samp><samp class="w"> </samp><samp class="c">_changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">result</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w">
  </samp><samp class="c1"># An example of updating comments based on a result of other changes</samp><samp class="w">
  </samp><samp class="k">for</samp><samp class="w"> </samp><samp class="n">comment</samp><samp class="w"> </samp><samp class="o">&lt;-</samp><samp class="w"> </samp><samp class="n">input</samp><samp class="w"> </samp><samp class="k" data-group-id="1205155497-5">do</samp><samp class="w">
    </samp><samp class="n">comment</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash</samp><samp class="o">.</samp><samp class="n">get</samp><samp class="p" data-group-id="1205155497-6">(</samp><samp class="nc">Comment</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">comment</samp><samp class="o">.</samp><samp class="n">id</samp><samp class="p" data-group-id="1205155497-6">)</samp><samp class="w">

    </samp><samp class="n">comment</samp><samp class="w">
    </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Map</samp><samp class="o">.</samp><samp class="n">update</samp><samp class="p" data-group-id="1205155497-7">(</samp><samp class="ss">:rating</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="mi">0</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="o">&amp;</samp><samp class="p" data-group-id="1205155497-8">(</samp><samp class="ni">&amp;1</samp><samp class="w"> </samp><samp class="o">*</samp><samp class="w"> </samp><samp class="n">result</samp><samp class="o">.</samp><samp class="n">rating_weight</samp><samp class="p" data-group-id="1205155497-8">)</samp><samp class="p" data-group-id="1205155497-7">)</samp><samp class="w">
    </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash</samp><samp class="o">.</samp><samp class="n">update!</samp><samp class="p" data-group-id="1205155497-9">(</samp><samp class="p" data-group-id="1205155497-9">)</samp><samp class="w">
  </samp><samp class="k" data-group-id="1205155497-5">end</samp><samp class="w">

  </samp><samp class="p" data-group-id="1205155497-10">{</samp><samp class="ss">:ok</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">result</samp><samp class="p" data-group-id="1205155497-10">}</samp><samp class="w">
</samp><samp class="k" data-group-id="1205155497-4">end</samp><samp class="p" data-group-id="1205155497-3">)</samp></code></pre><h2 id="manage_relationship/4-using-records-as-input" class="section-heading"><a href="#manage_relationship/4-using-records-as-input" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Using records as input</span></h2><p>Records can be supplied as the input values. If you do:</p><ul><li>if it would be looked up due to <code class="inline">on_lookup</code>, the record is used as-is</li><li>if it would be created due to <code class="inline">on_no_match</code>, the record is used as-is</li><li>Instead of specifying <code class="inline">join_keys</code>, those keys must go in <code class="inline">__metadata__.join_keys</code>. If <code class="inline">join_keys</code> is specified in the options, it is ignored.</li></ul><p>For example:</p><pre><code class="makeup elixir" translate="no"><samp class="n">post1</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w">
  </samp><samp class="n">changeset</samp><samp class="w">
  </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash</samp><samp class="o">.</samp><samp class="n">create!</samp><samp class="p" data-group-id="2326801148-1">(</samp><samp class="p" data-group-id="2326801148-1">)</samp><samp class="w">
  </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Resource</samp><samp class="o">.</samp><samp class="n">put_metadata</samp><samp class="p" data-group-id="2326801148-2">(</samp><samp class="ss">:join_keys</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="2326801148-3">%{</samp><samp class="ss">type</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;a&quot;</samp><samp class="p" data-group-id="2326801148-3">}</samp><samp class="p" data-group-id="2326801148-2">)</samp><samp class="w">

</samp><samp class="n">post2</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w">
  </samp><samp class="n">changeset2</samp><samp class="w">
  </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash</samp><samp class="o">.</samp><samp class="n">create!</samp><samp class="p" data-group-id="2326801148-4">(</samp><samp class="p" data-group-id="2326801148-4">)</samp><samp class="w">
  </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Resource</samp><samp class="o">.</samp><samp class="n">put_metadata</samp><samp class="p" data-group-id="2326801148-5">(</samp><samp class="ss">:join_keys</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="2326801148-6">%{</samp><samp class="ss">type</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;b&quot;</samp><samp class="p" data-group-id="2326801148-6">}</samp><samp class="p" data-group-id="2326801148-5">)</samp><samp class="w">

</samp><samp class="n">author</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash</samp><samp class="o">.</samp><samp class="n">create!</samp><samp class="p" data-group-id="2326801148-7">(</samp><samp class="n">author_changeset</samp><samp class="p" data-group-id="2326801148-7">)</samp><samp class="w">

</samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">manage_relationship</samp><samp class="p" data-group-id="2326801148-8">(</samp><samp class="w">
  </samp><samp class="n">author</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="ss">:posts</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="p" data-group-id="2326801148-9">[</samp><samp class="n">post1</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="n">post2</samp><samp class="p" data-group-id="2326801148-9">]</samp><samp class="p">,</samp><samp class="w">
  </samp><samp class="ss">on_lookup</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="ss">:relate</samp><samp class="w">
</samp><samp class="p" data-group-id="2326801148-8">)</samp></code></pre>
  </section>
</section>
<section class="detail" id="new/1">

  <div class="detail-header">
    <a href="#new/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">new(record_or_resource)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L496" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> new(<a href="Ash.Resource.xhtml#t:t/0">Ash.Resource.t</a>() | <a href="Ash.Resource.xhtml#t:record/0">Ash.Resource.record</a>()) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Returns a new changeset over a resource.</p><p><em>Warning</em>: You almost always want to use <code class="inline">for_action</code> or <code class="inline">for_create</code>, etc. over this function if possible.</p><p>You can use this to start a changeset and make changes prior to calling <code class="inline">for_action</code>. This is not typically
necessary, but can be useful as an escape hatch.</p><h2 id="new/1-examples" class="section-heading"><a href="#new/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="c1"># Create a changeset for a new record</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">new</samp><samp class="p" data-group-id="8512333044-1">(</samp><samp class="nc">MyApp.Post</samp><samp class="p" data-group-id="8512333044-1">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">action_type</samp><samp class="w">
</samp><samp class="ss">:create</samp><samp class="w">

</samp><samp class="c1"># Create a changeset for updating an existing record</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">post</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="p" data-group-id="8512333044-2">%</samp><samp class="nc" data-group-id="8512333044-2">MyApp.Post</samp><samp class="p" data-group-id="8512333044-2">{</samp><samp class="ss">id</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mi">1</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">title</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;Original Title&quot;</samp><samp class="p" data-group-id="8512333044-2">}</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">new</samp><samp class="p" data-group-id="8512333044-3">(</samp><samp class="n">post</samp><samp class="p" data-group-id="8512333044-3">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">action_type</samp><samp class="w">
</samp><samp class="ss">:update</samp><samp class="w">

</samp><samp class="c1"># Use as an escape hatch before calling for_action</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="nc">MyApp.Post</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">new</samp><samp class="p" data-group-id="8512333044-4">(</samp><samp class="p" data-group-id="8512333044-4">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">change_attribute</samp><samp class="p" data-group-id="8512333044-5">(</samp><samp class="ss">:title</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="s">&quot;Draft Title&quot;</samp><samp class="p" data-group-id="8512333044-5">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_action</samp><samp class="p" data-group-id="8512333044-6">(</samp><samp class="ss">:create</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="8512333044-7">%{</samp><samp class="ss">content</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;Post content&quot;</samp><samp class="p" data-group-id="8512333044-7">}</samp><samp class="p" data-group-id="8512333044-6">)</samp></code></pre><h2 id="new/1-see-also" class="section-heading"><a href="#new/1-see-also" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">See also</span></h2><ul><li><a href="#for_action/4"><code class="inline">for_action/4</code></a> for the recommended way to create changesets</li><li><a href="#for_create/4"><code class="inline">for_create/4</code></a> for creating new records</li><li><a href="#for_update/4"><code class="inline">for_update/4</code></a> for updating existing records</li><li><a href="#for_destroy/4"><code class="inline">for_destroy/4</code></a> for destroying records</li></ul>
  </section>
</section>
<section class="detail" id="prepare_changeset_for_action/3">

  <div class="detail-header">
    <a href="#prepare_changeset_for_action/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">prepare_changeset_for_action(changeset, action, opts)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L2675" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="present?/2">

  <div class="detail-header">
    <a href="#present?/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">present?(changeset, attribute)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L2619" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Checks if an argument is not nil or an attribute is not nil, either in the original data, or that it is not being changed to a <code class="inline">nil</code> value if it is changing.</p><p>This also accounts for the <code class="inline">accessing_from</code> context that is set when using <code class="inline">manage_relationship</code>, so it is aware that a particular value
<em>will</em> be set by <code class="inline">manage_relationship</code> even if it isn't currently being set.</p><h2 id="present?/2-examples" class="section-heading"><a href="#present?/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="c1"># Check if attribute is present in original data</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">post</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="p" data-group-id="5284642887-1">%</samp><samp class="nc" data-group-id="5284642887-1">MyApp.Post</samp><samp class="p" data-group-id="5284642887-1">{</samp><samp class="ss">id</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mi">1</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">title</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;My Post&quot;</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">content</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="no">nil</samp><samp class="p" data-group-id="5284642887-1">}</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_update</samp><samp class="p" data-group-id="5284642887-2">(</samp><samp class="n">post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:update</samp><samp class="p" data-group-id="5284642887-2">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">present?</samp><samp class="p" data-group-id="5284642887-3">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:title</samp><samp class="p" data-group-id="5284642887-3">)</samp><samp class="w">
</samp><samp class="no">true</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">present?</samp><samp class="p" data-group-id="5284642887-4">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:content</samp><samp class="p" data-group-id="5284642887-4">)</samp><samp class="w">
</samp><samp class="no">false</samp><samp class="w">

</samp><samp class="c1"># Check if attribute is being changed to a non-nil value</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">post</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="p" data-group-id="5284642887-5">%</samp><samp class="nc" data-group-id="5284642887-5">MyApp.Post</samp><samp class="p" data-group-id="5284642887-5">{</samp><samp class="ss">id</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mi">1</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">title</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="no">nil</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">content</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;Content&quot;</samp><samp class="p" data-group-id="5284642887-5">}</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_update</samp><samp class="p" data-group-id="5284642887-6">(</samp><samp class="n">post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:update</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="5284642887-7">%{</samp><samp class="ss">title</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;New Title&quot;</samp><samp class="p" data-group-id="5284642887-7">}</samp><samp class="p" data-group-id="5284642887-6">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">present?</samp><samp class="p" data-group-id="5284642887-8">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:title</samp><samp class="p" data-group-id="5284642887-8">)</samp><samp class="w">
</samp><samp class="no">true</samp><samp class="w">

</samp><samp class="c1"># Check if argument is present</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">MyApp.User</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">new</samp><samp class="p" data-group-id="5284642887-9">(</samp><samp class="p" data-group-id="5284642887-9">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">set_argument</samp><samp class="p" data-group-id="5284642887-10">(</samp><samp class="ss">:send_email</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="no">true</samp><samp class="p" data-group-id="5284642887-10">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">present?</samp><samp class="p" data-group-id="5284642887-11">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:send_email</samp><samp class="p" data-group-id="5284642887-11">)</samp><samp class="w">
</samp><samp class="no">true</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">present?</samp><samp class="p" data-group-id="5284642887-12">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:other_arg</samp><samp class="p" data-group-id="5284642887-12">)</samp><samp class="w">
</samp><samp class="no">false</samp></code></pre><h2 id="present?/2-see-also" class="section-heading"><a href="#present?/2-see-also" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">See also</span></h2><ul><li><a href="#attribute_present?/2"><code class="inline">attribute_present?/2</code></a> for checking only attributes (not arguments)</li><li><a href="#changing_attribute?/2"><code class="inline">changing_attribute?/2</code></a> for checking if an attribute is being changed</li><li><a href="#get_argument/2"><code class="inline">get_argument/2</code></a> and <a href="#get_attribute/2"><code class="inline">get_attribute/2</code></a> for retrieving values</li></ul>
  </section>
</section>
<section class="detail" id="put_context/3">

  <div class="detail-header">
    <a href="#put_context/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">put_context(changeset, key, value)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L4924" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> put_context(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Puts a key/value in the changeset context that can be used later.</p><p>Do not use the <code class="inline">private</code> key in your custom context, as that is reserved for internal use.</p>
  </section>
</section>
<section class="detail" id="run_before_transaction_hooks/1">

  <div class="detail-header">
    <a href="#run_before_transaction_hooks/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">run_before_transaction_hooks(changeset)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L4409" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="select/3">

    <span id="select/2"></span>

  <div class="detail-header">
    <a href="#select/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">select(changeset, fields, opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L579" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> select(<a href="#t:t/0">t</a>(), [<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()] | <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(), <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Ensure that only the specified attributes are present in the results.</p><p>The first call to <a href="#select/2"><code class="inline">select/2</code></a> will replace the default behavior of selecting
all attributes. Subsequent calls to <a href="#select/2"><code class="inline">select/2</code></a> will combine the provided
fields unless the <code class="inline">replace?</code> option is provided with a value of <code class="inline">true</code>.</p><p>If a field has been deselected, selecting it again will override that (because a single list of fields is tracked for selection)</p><p>Primary key attributes always selected and cannot be deselected.</p><p>When attempting to load a relationship (or manage it with <a href="#manage_relationship/3"><code class="inline">Ash.Changeset.manage_relationship/3</code></a>),
if the source field is not selected on the query/provided data an error will be produced. If loading
a relationship with a query, an error is produced if the query does not select the destination field
of the relationship.</p><p>Datalayers currently are not notified of the <code class="inline">select</code> for a changeset(unlike queries), and creates/updates select all fields when they are performed.
A select provided on a changeset sets the unselected fields to <code class="inline">nil</code> before returning the result.</p><p>Use <a href="#ensure_selected/2"><code class="inline">ensure_selected/2</code></a> if you wish to make sure a field has been selected, without deselecting any other fields.</p><h2 id="select/3-examples" class="section-heading"><a href="#select/3-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="c1"># Select specific fields</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="9207737174-1">(</samp><samp class="nc">MyApp.Post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p" data-group-id="9207737174-1">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">select</samp><samp class="p" data-group-id="9207737174-2">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="9207737174-3">[</samp><samp class="ss">:title</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:content</samp><samp class="p" data-group-id="9207737174-3">]</samp><samp class="p" data-group-id="9207737174-2">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">select</samp><samp class="w">
</samp><samp class="p" data-group-id="9207737174-4">[</samp><samp class="ss">:title</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:content</samp><samp class="p" data-group-id="9207737174-4">]</samp><samp class="w">

</samp><samp class="c1"># Combine multiple select calls (default behavior)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="9207737174-5">(</samp><samp class="nc">MyApp.User</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p" data-group-id="9207737174-5">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">select</samp><samp class="p" data-group-id="9207737174-6">(</samp><samp class="p" data-group-id="9207737174-7">[</samp><samp class="ss">:name</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:email</samp><samp class="p" data-group-id="9207737174-7">]</samp><samp class="p" data-group-id="9207737174-6">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">select</samp><samp class="p" data-group-id="9207737174-8">(</samp><samp class="p" data-group-id="9207737174-9">[</samp><samp class="ss">:created_at</samp><samp class="p" data-group-id="9207737174-9">]</samp><samp class="p" data-group-id="9207737174-8">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">select</samp><samp class="w">
</samp><samp class="p" data-group-id="9207737174-10">[</samp><samp class="ss">:name</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:email</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:created_at</samp><samp class="p" data-group-id="9207737174-10">]</samp><samp class="w">

</samp><samp class="c1"># Replace previous selection</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_create</samp><samp class="p" data-group-id="9207737174-11">(</samp><samp class="nc">MyApp.Post</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:create</samp><samp class="p" data-group-id="9207737174-11">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="n">changeset</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">select</samp><samp class="p" data-group-id="9207737174-12">(</samp><samp class="p" data-group-id="9207737174-13">[</samp><samp class="ss">:title</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:content</samp><samp class="p" data-group-id="9207737174-13">]</samp><samp class="p" data-group-id="9207737174-12">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">select</samp><samp class="p" data-group-id="9207737174-14">(</samp><samp class="p" data-group-id="9207737174-15">[</samp><samp class="ss">:title</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:published_at</samp><samp class="p" data-group-id="9207737174-15">]</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">replace?</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="no">true</samp><samp class="p" data-group-id="9207737174-14">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">select</samp><samp class="w">
</samp><samp class="p" data-group-id="9207737174-16">[</samp><samp class="ss">:title</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:published_at</samp><samp class="p" data-group-id="9207737174-16">]</samp></code></pre><h2 id="select/3-see-also" class="section-heading"><a href="#select/3-see-also" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">See also</span></h2><ul><li><a href="#ensure_selected/2"><code class="inline">ensure_selected/2</code></a> for adding fields without replacing existing selection</li><li><a href="#deselect/2"><code class="inline">deselect/2</code></a> for removing fields from selection</li><li><a href="#selecting?/2"><code class="inline">selecting?/2</code></a> for checking if a field is selected</li><li><a href="#load/2"><code class="inline">load/2</code></a> for loading relationships and calculations</li></ul>
  </section>
</section>
<section class="detail" id="selecting?/2">

  <div class="detail-header">
    <a href="#selecting?/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">selecting?(changeset, field)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L729" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="set_argument/3">

  <div class="detail-header">
    <a href="#set_argument/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">set_argument(changeset, argument, value)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L5950" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Add an argument to the changeset, which will be provided to the action.</p><p>Arguments can be set on a changeset before calling <a href="#for_action/4"><code class="inline">for_action/4</code></a> (or the specific <code class="inline">for_*</code> functions).
When <a href="#for_action/4"><code class="inline">for_action/4</code></a> is called, arguments are validated and cast according to the action's argument
definitions. Use this function to set arguments that will be available during the action's execution.</p><h2 id="set_argument/3-examples" class="section-heading"><a href="#set_argument/3-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><samp class="c1"># Set arguments before calling for_action</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">MyApp.Post</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">new</samp><samp class="p" data-group-id="8625680942-1">(</samp><samp class="p" data-group-id="8625680942-1">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">set_argument</samp><samp class="p" data-group-id="8625680942-2">(</samp><samp class="ss">:auto_publish</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="no">true</samp><samp class="p" data-group-id="8625680942-2">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">set_argument</samp><samp class="p" data-group-id="8625680942-3">(</samp><samp class="ss">:slug_prefix</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="s">&quot;blog&quot;</samp><samp class="p" data-group-id="8625680942-3">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">arguments</samp><samp class="w">
</samp><samp class="p" data-group-id="8625680942-4">%{</samp><samp class="ss">auto_publish</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="no">true</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">slug_prefix</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;blog&quot;</samp><samp class="p" data-group-id="8625680942-4">}</samp><samp class="w">

</samp><samp class="c1"># Arguments are validated and cast when for_action is called</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">MyApp.User</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">new</samp><samp class="p" data-group-id="8625680942-5">(</samp><samp class="p" data-group-id="8625680942-5">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">set_argument</samp><samp class="p" data-group-id="8625680942-6">(</samp><samp class="ss">:age</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="s">&quot;25&quot;</samp><samp class="p" data-group-id="8625680942-6">)</samp><samp class="w">  </samp><samp class="c1"># String will be cast to integer</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_action</samp><samp class="p" data-group-id="8625680942-7">(</samp><samp class="ss">:create</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="8625680942-8">%{</samp><samp class="ss">name</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;John&quot;</samp><samp class="p" data-group-id="8625680942-8">}</samp><samp class="p" data-group-id="8625680942-7">)</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="o">.</samp><samp class="n">arguments</samp><samp class="w">
</samp><samp class="p" data-group-id="8625680942-9">%{</samp><samp class="ss">age</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="mi">25</samp><samp class="p" data-group-id="8625680942-9">}</samp><samp class="w">

</samp><samp class="c1"># Chain argument setting with attribute changes</samp><samp class="w">
</samp><samp class="gp unselectable">iex&gt; </samp><samp class="n">changeset</samp><samp class="w"> </samp><samp class="o">=</samp><samp class="w"> </samp><samp class="nc">MyApp.Post</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">new</samp><samp class="p" data-group-id="8625680942-10">(</samp><samp class="p" data-group-id="8625680942-10">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">set_argument</samp><samp class="p" data-group-id="8625680942-11">(</samp><samp class="ss">:generate_excerpt</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="no">true</samp><samp class="p" data-group-id="8625680942-11">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">change_attribute</samp><samp class="p" data-group-id="8625680942-12">(</samp><samp class="ss">:title</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="s">&quot;My Post&quot;</samp><samp class="p" data-group-id="8625680942-12">)</samp><samp class="w">
</samp><samp class="gp unselectable">...&gt; </samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">for_action</samp><samp class="p" data-group-id="8625680942-13">(</samp><samp class="ss">:create</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="p" data-group-id="8625680942-14">%{</samp><samp class="ss">content</samp><samp class="p">:</samp><samp class="w"> </samp><samp class="s">&quot;Post content&quot;</samp><samp class="p" data-group-id="8625680942-14">}</samp><samp class="p" data-group-id="8625680942-13">)</samp></code></pre><h2 id="set_argument/3-see-also" class="section-heading"><a href="#set_argument/3-see-also" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">See also</span></h2><ul><li><a href="#set_arguments/2"><code class="inline">set_arguments/2</code></a> for setting multiple arguments at once</li><li><a href="#get_argument/2"><code class="inline">get_argument/2</code></a> for retrieving argument values</li><li><a href="#force_set_argument/3"><code class="inline">force_set_argument/3</code></a> for setting arguments in hooks without warnings</li><li><a href="#delete_argument/2"><code class="inline">delete_argument/2</code></a> for removing arguments</li></ul>
  </section>
</section>
<section class="detail" id="set_arguments/2">

  <div class="detail-header">
    <a href="#set_arguments/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">set_arguments(changeset, map)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L6097" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Merge a map of arguments to the arguments list.</p>
  </section>
</section>
<section class="detail" id="set_context/2">

  <div class="detail-header">
    <a href="#set_context/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">set_context(changeset, map)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L4944" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> set_context(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>() | nil) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Deep merges the provided map into the changeset context that can be used later.</p><p>Do not use the <code class="inline">private</code> key in your custom context, as that is reserved for internal use.</p>
  </section>
</section>
<section class="detail" id="set_private_argument/3">

  <div class="detail-header">
    <a href="#set_private_argument/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">set_private_argument(changeset, argument, value)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L5959" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> set_private_argument(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Add a private argument to the changeset, which will be provided to the action.</p>
  </section>
</section>
<section class="detail" id="set_result/2">

  <div class="detail-header">
    <a href="#set_result/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">set_result(changeset, result)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L2380" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> set_result(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Set the result of the action. This will prevent running the underlying datalayer behavior</p>
  </section>
</section>
<section class="detail" id="set_tenant/2">

  <div class="detail-header">
    <a href="#set_tenant/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">set_tenant(changeset, tenant)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L4929" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> set_tenant(<a href="#t:t/0">t</a>(), <a href="Ash.ToTenant.xhtml#t:t/0">Ash.ToTenant.t</a>()) :: <a href="#t:t/0">t</a>()</pre>

      </div>


  </section>
</section>
<section class="detail" id="timeout/3">

    <span id="timeout/2"></span>

  <div class="detail-header">
    <a href="#timeout/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">timeout(changeset, timeout, default \\ nil)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L4934" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> timeout(<a href="#t:t/0">t</a>(), nil | <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">pos_integer</a>(), nil | <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">pos_integer</a>()) :: <a href="#t:t/0">t</a>()</pre>

      </div>


  </section>
</section>
<section class="detail" id="update_change/3">

  <div class="detail-header">
    <a href="#update_change/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">update_change(changeset, attribute, fun)</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L5901" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> update_change(<a href="#t:t/0">t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(), (<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>() -&gt; <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>())) :: <a href="#t:t/0">t</a>()</pre>

      </div>

<p>Updates an existing attribute change by applying a function to it.</p><p>This is useful for applying some kind of normalization to the attribute.</p><pre><code class="makeup elixir" translate="no"><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">update_change</samp><samp class="p" data-group-id="1723718173-1">(</samp><samp class="n">changeset</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="ss">:serial</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="o">&amp;</samp><samp class="nc">String</samp><samp class="o">.</samp><samp class="n">downcase</samp><samp class="o">/</samp><samp class="mi">1</samp><samp class="p" data-group-id="1723718173-1">)</samp></code></pre><p>The update function gets called with the value already cast to the correct type.</p><pre><code class="makeup elixir" translate="no"><samp class="n">changeset</samp><samp class="w">
</samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">change_attribute</samp><samp class="p" data-group-id="7066810716-1">(</samp><samp class="ss">:integer_attribute</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="s">&quot;3&quot;</samp><samp class="p" data-group-id="7066810716-1">)</samp><samp class="w">
</samp><samp class="o">|&gt;</samp><samp class="w"> </samp><samp class="nc">Ash.Changeset</samp><samp class="o">.</samp><samp class="n">update_change</samp><samp class="p" data-group-id="7066810716-2">(</samp><samp class="ss">:integer_attribute</samp><samp class="p">,</samp><samp class="w"> </samp><samp class="k" data-group-id="7066810716-3">fn</samp><samp class="w"> </samp><samp class="n">x</samp><samp class="w"> </samp><samp class="o">-&gt;</samp><samp class="w"> </samp><samp class="n">x</samp><samp class="w"> </samp><samp class="o">+</samp><samp class="w"> </samp><samp class="mi">1</samp><samp class="w"> </samp><samp class="k" data-group-id="7066810716-3">end</samp><samp class="p" data-group-id="7066810716-2">)</samp></code></pre><h2 id="update_change/3-invalid-value-handling" class="section-heading"><a href="#update_change/3-invalid-value-handling" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Invalid value handling</span></h2><p>If <code class="inline">update_change</code> is called with a changeset that has not been validated yet, the update
function must handle potentially invalid and <code class="inline">nil</code> values.</p><p>To only deal with valid values, you can call <code class="inline">update_change</code> in a <code class="inline">before_action</code> hook.</p>
  </section>
</section>
<section class="detail" id="with_hooks/3">

    <span id="with_hooks/2"></span>

  <div class="detail-header">
    <a href="#with_hooks/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">with_hooks(changeset, func, opts \\ [])</h1>


        <a href="https://github.com/ash-project/ash/blob/v3.5.33/lib/ash/changeset/changeset.ex#L4119" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> with_hooks(
  <a href="#t:t/0">t</a>(),
  (<a href="#t:t/0">t</a>() -&gt;
     {:ok, <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(), %{notifications: [<a href="Ash.Notifier.Notification.xhtml#t:t/0">Ash.Notifier.Notification.t</a>()]}}
     | {:error, <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()}),
  <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()
) ::
  {:ok, <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(), <a href="#t:t/0">t</a>(), %{notifications: [<a href="Ash.Notifier.Notification.xhtml#t:t/0">Ash.Notifier.Notification.t</a>()]}}
  | {:error, <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()}</pre>

      </div>

<p>Wraps a function in the before/after action hooks of a changeset.</p><p>The function takes a changeset and if it returns
<code class="inline">{:ok, result}</code>, the result will be passed through the after
action hooks.</p>
  </section>
</section>

        </div>
      </section>


  </body>
</html>
