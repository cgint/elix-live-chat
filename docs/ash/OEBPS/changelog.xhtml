<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
      xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <title>Changelog - ash v3.5.33</title>
    <meta name="generator" content="ExDoc v0.38.2" />
    <link type="text/css" rel="stylesheet" href="dist/epub-elixir-FNUUKFP7.css" />
    <script src="dist/epub-4WIP524F.js"></script>

  </head>
  <body class="content-inner">

    <h1 id="content">Changelog</h1>
<!-- changelog --><h2 id="v3-5-33-2025-07-29"><a href="https://github.com/ash-project/ash/compare/v3.5.32...v3.5.33">v3.5.33</a> (2025-07-29)</h2><h3 id="bug-fixes">Bug Fixes:</h3><ul><li><p>handle <code class="inline">nil</code> values properly in atomic changing validations by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>Application ER Mermaid Diagram (#2231) by <a href="https://github.com/maennchen">@maennchen</a></p></li><li><p>clear <code class="inline">nil</code> options in typed struct to constraints process by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>allow Ash @global_opts authorize? to accept boolean or nil (#2225) by <a href="https://github.com/chazwatkins">@chazwatkins</a></p></li><li><p>Don't require permissions to read actor on non-atomic <code class="inline">relate_actor</code> (#2223) by <a href="https://github.com/chazwatkins">@chazwatkins</a></p></li><li><p>call underlying stream run instead of public interface by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li></ul><h3 id="improvements">Improvements:</h3><ul><li><p><code class="inline">get_by_id</code> typo fix in usage rules (#2230) by albinkc</p></li><li><p>Add array modifier to <code class="inline">ash.gen.resource</code> (#2228) by Kenneth Kostrešević</p></li><li><p>Add prepend? opt to hooks and Ash.Subject transaction hooks (#2221) by <a href="https://github.com/chazwatkins">@chazwatkins</a></p></li><li><p>hooks: Add transaction hooks to Ash.Subject by <a href="https://github.com/chazwatkins">@chazwatkins</a></p></li><li><p>Ash.Subject delegation and improvements by <a href="https://github.com/chazwatkins">@chazwatkins</a></p></li><li><p>add <code class="inline">log?</code> option to <code class="inline">can</code> functions by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>add transaction hooks for read actions (#2219) by ChristianAlexander</p></li></ul><h2 id="v3-5-32-2025-07-23"><a href="https://github.com/ash-project/ash/compare/v3.5.31...v3.5.32">v3.5.32</a> (2025-07-23)</h2><h3 id="bug-fixes-1">Bug Fixes:</h3><ul><li>ensure that exists &quot;at_path&quot; is returned as a relationship path by <a href="https://github.com/zachdaniel">@zachdaniel</a></li></ul><h3 id="improvements-1">Improvements:</h3><ul><li>add before/after/around transaction hooks to generic actions (#2218) by ChristianAlexander</li></ul><h2 id="v3-5-31-2025-07-22"><a href="https://github.com/ash-project/ash/compare/v3.5.30...v3.5.31">v3.5.31</a> (2025-07-22)</h2><h3 id="bug-fixes-2">Bug Fixes:</h3><ul><li>Catch invalid load (#2213) by Kenneth Kostrešević</li></ul><h3 id="improvements-2">Improvements:</h3><ul><li><p>Add Ash.Subject to abstract Changeset, Query, ActionInput common functions (#2212) by <a href="https://github.com/chazwatkins">@chazwatkins</a></p></li><li><p>support validations, preparations on generic actions by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>add before/after action hooks to generic actions by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li></ul><h2 id="v3-5-30-2025-07-18"><a href="https://github.com/ash-project/ash/compare/v3.5.29...v3.5.30">v3.5.30</a> (2025-07-18)</h2><h3 id="bug-fixes-3">Bug Fixes:</h3><ul><li>handle new return value from <code class="inline">kind_of_thing</code> in gen.resource by <a href="https://github.com/zachdaniel">@zachdaniel</a></li></ul><h3 id="improvements-3">Improvements:</h3><ul><li>support global validations being applied to reads by <a href="https://github.com/zachdaniel">@zachdaniel</a></li></ul><h2 id="v3-5-29-2025-07-18"><a href="https://github.com/ash-project/ash/compare/v3.5.28...v3.5.29">v3.5.29</a> (2025-07-18)</h2><h3 id="bug-fixes-4">Bug Fixes:</h3><ul><li>properly return <code class="inline">:error</code> when unable to determine type of module by <a href="https://github.com/zachdaniel">@zachdaniel</a></li></ul><h2 id="v3-5-28-2025-07-17"><a href="https://github.com/ash-project/ash/compare/v3.5.27...v3.5.28">v3.5.28</a> (2025-07-17)</h2><h3 id="bug-fixes-5">Bug Fixes:</h3><ul><li><p>accept composite types in typed struct types by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>keep descriptions from typed struct DSL by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li></ul><h2 id="v3-5-27-2025-07-17"><a href="https://github.com/ash-project/ash/compare/v3.5.26...v3.5.27">v3.5.27</a> (2025-07-17)</h2><h3 id="bug-fixes-6">Bug Fixes:</h3><ul><li><p>properly merge contexts from scope and opts by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>ensure that <code class="inline">modify_query</code> is honored on aggregates by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>read action: Tenant from before_action will survive in metadata (#2189) by <a href="https://github.com/serpent213">@serpent213</a></p></li><li><p>set action on aggregate queries by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>cascade change action selection (#2193) by <a href="https://github.com/barnabasJ">@barnabasJ</a></p></li><li><p>try atomic_upgrade_with before falling back to primary action in cascade changes (#2191) by <a href="https://github.com/barnabasJ">@barnabasJ</a></p></li><li><p>ensure <code class="inline">cast_input</code> uses <code class="inline">new</code> callback on typed structs by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>use correct options in code interfaces in usage-rules.md by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>support single atoms in <code class="inline">sort_input</code> by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li></ul><h3 id="improvements-4">Improvements:</h3><ul><li><p>support where clauses on preparations by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>support <a href="Ash.Query.xhtml"><code class="inline">Ash.Query</code></a> for most builtin validations by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>support validations on read actions by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>introduce <a href="Ash.TypedStruct.xhtml"><code class="inline">Ash.TypedStruct</code></a> as a simpler struct type by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li></ul><h2 id="v3-5-26-2025-07-09"><a href="https://github.com/ash-project/ash/compare/v3.5.25...v3.5.26">v3.5.26</a> (2025-07-09)</h2><h3 id="bug-fixes-7">Bug Fixes:</h3><ul><li><p>don't dump values to native when building changesets by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>ensure that async limiter is properly cleared by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>when comparing embedded attributes, ignore metadata keys by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>clear async limiter on pagination query by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li></ul><h3 id="improvements-5">Improvements:</h3><ul><li><p>set <code class="inline">show_policy_breakdowns?</code> to <code class="inline">true</code> in dev/test by default by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>make <a href="Mix.Tasks.Ash.Gen.Resource.xhtml"><code class="inline">mix ash.gen.resource</code></a> merge existing resources by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>allow code_interface default_options to accept a function (#2183) by scottwoodall</p></li><li><p>show optional code interface inputs in usage rules by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li></ul><h2 id="v3-5-25-2025-07-02"><a href="https://github.com/ash-project/ash/compare/v3.5.24...v3.5.25">v3.5.25</a> (2025-07-02)</h2><h3 id="bug-fixes-8">Bug Fixes:</h3><ul><li><p>handle additional cases in <code class="inline">Ash.Filter.flat_map</code> by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>handle overlapping type short-codes in app/dependencies by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>ensure that constraints are set on calculations by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>Upgrade strip_metadata/1 to recurse on maps and handle additional metadata fields (#2169) by Samuel Wrenn</p></li><li><p>ensure that atomic upgrades assume casted inputs by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>move length constraint checking to the end (#2155) by kernel-io</p></li></ul><h3 id="improvements-6">Improvements:</h3><ul><li><p>validate reserved constraint key names by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>Read Action multitenancy :bypass_all (#2154) by xantrac</p></li><li><p>add missing types to Ash.load typespec (#2167) by <a href="https://github.com/barnabasJ">@barnabasJ</a></p></li><li><p>allow pure-binary sigils in expr fragments (#2165) by Frank Dugan III</p></li><li><p>add notifier trace/telemetry span type by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li></ul><h2 id="v3-5-24-2025-06-25"><a href="https://github.com/ash-project/ash/compare/v3.5.23...v3.5.24">v3.5.24</a> (2025-06-25)</h2><h3 id="bug-fixes-9">Bug Fixes:</h3><ul><li><p>restrict subset of context -&gt; opts in embedded changesets by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>properly handle nested context for embeddable type by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>Use the same parent query timeout for the count query, for <code class="inline">read</code> actions (#2161) by sevenseacat</p></li><li><p>ensure join query has shared context passed to it by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>ensure shared context is set on through queries when loading by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li></ul><h3 id="improvements-7">Improvements:</h3><ul><li><p>make usage-rules more clear about require Ash.Query by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p><code class="inline">require Ash.Query</code> in <a href="Ash.Resource.xhtml"><code class="inline">Ash.Resource</code></a> by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li></ul><h2 id="v3-5-23-2025-06-19"><a href="https://github.com/ash-project/ash/compare/v3.5.22...v3.5.23">v3.5.23</a> (2025-06-19)</h2><h3 id="bug-fixes-10">Bug Fixes:</h3><ul><li><p>set proper metadata key for bulk destroy changes by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>don't override tenant if manually set by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li></ul><h2 id="v3-5-22-2025-06-18"><a href="https://github.com/ash-project/ash/compare/v3.5.21...v3.5.22">v3.5.22</a> (2025-06-18)</h2><h3 id="bug-fixes-11">Bug Fixes:</h3><ul><li><p>template opts in conditions in atomic changes by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>properly detect existing timestamp attributes in igniter tasks by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li></ul><h3 id="improvements-8">Improvements:</h3><ul><li><p>improve message for --dev migrations message by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>add <a href="Mix.Tasks.Ash.xhtml"><code class="inline">mix ash</code></a> command by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>handle changes to <code class="inline">nil</code> for unknown attribute values by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li></ul><h2 id="v3-5-21-2025-06-16"><a href="https://github.com/ash-project/ash/compare/v3.5.20...v3.5.21">v3.5.21</a> (2025-06-16)</h2><h3 id="bug-fixes-12">Bug Fixes:</h3><ul><li><p>support read actions and arguments in Ash.Generator.action_input/3 (#2137) by <a href="https://github.com/barnabasJ">@barnabasJ</a></p></li><li><p>combination_of typespec (#2135) by <a href="https://github.com/barnabasJ">@barnabasJ</a></p></li></ul><h3 id="improvements-9">Improvements:</h3><ul><li><p>allow update_query when <code class="inline">expr_error</code> is nto supported by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>only require atomicity when update_query <em>and</em> expr_error supported by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>make installer avoid protocol consolidation by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li></ul><h2 id="v3-5-20-2025-06-13"><a href="https://github.com/ash-project/ash/compare/v3.5.19...v3.5.20">v3.5.20</a> (2025-06-13)</h2><h3 id="bug-fixes-13">Bug Fixes:</h3><ul><li>support private_arguments in code interface and bulk actions (#2133) by <a href="https://github.com/barnabasJ">@barnabasJ</a></li><li>combination_of typespec (#2135) by <a href="https://github.com/barnabasJ">@barnabasJ</a></li></ul><h2 id="v3-5-19-2025-06-12"><a href="https://github.com/ash-project/ash/compare/v3.5.18...v3.5.19">v3.5.19</a> (2025-06-12)</h2><h3 id="bug-fixes-14">Bug Fixes:</h3><ul><li>bad pattern match in query inspect logic by <a href="https://github.com/zachdaniel">@zachdaniel</a></li></ul><h2 id="v3-5-18-2025-06-11"><a href="https://github.com/ash-project/ash/compare/v3.5.17...v3.5.18">v3.5.18</a> (2025-06-11)</h2><h3 id="improvements-10">Improvements:</h3><ul><li>support regexes in match constraint/validation again by <a href="https://github.com/zachdaniel">@zachdaniel</a></li></ul><h2 id="v3-5-17-2025-06-10"><a href="https://github.com/ash-project/ash/compare/v3.5.16...v3.5.17">v3.5.17</a> (2025-06-10)</h2><h3 id="bug-fixes-15">Bug Fixes:</h3><ul><li>set_tenant on combination query (#2123) by <a href="https://github.com/barnabasJ">@barnabasJ</a></li></ul><h2 id="v3-5-16-2025-06-10"><a href="https://github.com/ash-project/ash/compare/v3.5.15...v3.5.16">v3.5.16</a> (2025-06-10)</h2><h3 id="bug-fixes-16">Bug Fixes:</h3><ul><li><p>ensure context is properly threaded through bulk update/atomic upgrades by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>ensure <code class="inline">actor: nil</code> key is retained on scope to opts by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>ensure stream_batch_size is properly set to batch_size on stream by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>set batch size option when streaming by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>keep union types in order by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>resolve accidentally backwards incompatible inspect implementation by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>better error message on mismatch action types in changesets by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>add clause in Ash.Type.String.match/1 to handle the OTP 28 regex tuples (#2119) by Simon Bergström</p></li><li><p>underlying ecto type casting should use coercion, not cast_input by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>make decimal type less strict by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>Fix typespecs for Ash.get! and Ash.load! (#2117) by Moxley Stratton</p></li><li><p>implement Scope.to_opts for policy authorizer by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>simplify relationship loading, to prevent losing set query info by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>typo in Ash.Error.Framework module (#2108) by Samuel Wrenn</p></li><li><p>ash.gen.validation generates invalid callback (#2103) by KasparKipp</p></li></ul><h3 id="improvements-11">Improvements:</h3><ul><li><p>show action when inspecting query by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>add assert_stripped test helper (#2107) by Samuel Wrenn</p></li><li><p>fix misleading value in invalid attribute error by <a href="https://github.com/zachdaniel">@zachdaniel</a></p></li><li><p>better error message on unexpected argument inputs to code interfaces (#2102) by Abhishek Tripathi</p></li></ul><h2 id="v3-5-15-2025-06-04"><a href="https://github.com/ash-project/ash/compare/v3.5.14...v3.5.15">v3.5.15</a> (2025-06-04)</h2><h3 id="bug-fixes-17">Bug Fixes:</h3><ul><li><p>only override bulk options if method is <code class="inline">:id</code> in code interfaces</p></li><li><p>handle missing primary keys more explicitly, and gracefully</p></li><li><p>Omit nil values in Ash.Scope.to_opts/2 (#2088)</p></li><li><p>Correct error message, example and doc for match constraint. (#2086)</p></li><li><p>handle context opt in Ash.calculate/2 (#2083)</p></li></ul><h3 id="improvements-12">Improvements:</h3><ul><li><p>put <strong>meta</strong> and relationships at the end when inspecting (#2096)</p></li><li><p>usage-rules: Add more guidance around codegen. (#2100)</p></li><li><p>update usage rules (#2095)</p></li></ul><h2 id="v3-5-14-2025-06-01"><a href="https://github.com/ash-project/ash/compare/v3.5.13...v3.5.14">v3.5.14</a> (2025-06-01)</h2><h3 id="bug-fixes-18">Bug Fixes:</h3><ul><li><p>ensure the proper dependency on igniter</p></li><li><p>ensure map module loaded when calling it</p></li><li><p>raise if integer primary key is not supplied in ETS (#2079)</p></li></ul><h2 id="v3-5-13-2025-05-30"><a href="https://github.com/ash-project/ash/compare/v3.5.12...v3.5.13">v3.5.13</a> (2025-05-30)</h2><h3 id="otp-28-compatibility">OTP 28 Compatibility</h3><p><a href="Ash.Type.String.xhtml"><code class="inline">Ash.Type.String</code></a>, <a href="Ash.Type.CiString.xhtml"><code class="inline">Ash.Type.CiString</code></a> and the built in <code class="inline">match</code> validation all now warn on the use
of regexes. OTP 28 no longer supports building regexes at compile time. The warning will explain.</p><h2 id="notable-features">Notable Features</h2><ul><li><p><code class="inline">:shared</code> context key is now automatically passed down to child actions. See <a href="actions.xhtml#context">the actions guide</a> for more information.</p></li><li><p>add <a href="Ash.Scope.xhtml"><code class="inline">Ash.Scope</code></a>, mirroring the Phoenix pattern, and extend that to all Ash callback contexts. See <a href="Ash.Scope.xhtml"><code class="inline">Ash.Scope</code></a> for more. (#2050)</p></li></ul><h3 id="bug-fixes-19">Bug Fixes:</h3><ul><li><p>[<a href="Ash.Query.xhtml"><code class="inline">Ash.Query</code></a>] Allow non-list input to skip_unknown_inputs opt of query (#2074)</p></li><li><p>[<a href="Ash.Query.xhtml"><code class="inline">Ash.Query</code></a>] handle single tuple &amp; string values in sort</p></li><li><p>[<a href="Ash.Query.xhtml"><code class="inline">Ash.Query</code></a>] use proper read action calls when building aggregates</p></li><li><p>[<a href="Ash.Generator.xhtml"><code class="inline">Ash.Generator</code></a>] don't generate values for attributes that are <code class="inline">writable?: false</code> and <code class="inline">generated?: true</code></p></li><li><p>[<code class="inline">:embedded</code> resources] ensure we detect all cases where embedded attributes can't be atomically updated</p></li><li><p>[<a href="Ash.Type.NewType.xhtml"><code class="inline">Ash.Type.NewType</code></a>] fix issue with expanding constraints for lazy initialized new types</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] properly pass tenant in bulk_update to managed_relationships (#2061)</p></li></ul><h3 id="improvements-13">Improvements:</h3><ul><li><p>[<a href="Mix.Tasks.Ash.Codegen.xhtml"><code class="inline">mix ash.codegen</code></a>] add <a href="Ash.Error.Framework.PendingCodegen.xhtml"><code class="inline">Ash.Error.Framework.PendingCodegen</code></a> error, used for the new <code class="inline">AshPhoenix.Plug.CheckCodegenStatus</code> plug</p></li><li><p>[<a href="Ash.Generator.xhtml"><code class="inline">Ash.Generator</code></a>] support upsert/upsert_identity in changeset generator</p></li><li><p>[<code class="inline">usage-rules.md</code>] Improve LLM rules in <code class="inline">usage-rules.md</code>. See <a href="https://hexdocs.pm/usage-rules">usage_rules</a> for more.</p></li><li><p>[<a href="Ash.Type.Decimal.xhtml"><code class="inline">Ash.Type.Decimal</code></a>] - Add <code class="inline">precision</code> and <code class="inline">scale</code> constraints.</p></li></ul><h2 id="v3-5-12-2025-05-22"><a href="https://github.com/ash-project/ash/compare/v3.5.11...v3.5.12">v3.5.12</a> (2025-05-22)</h2><h3 id="features">Features:</h3><ul><li>add duration type, functions and operator support (#2036)</li></ul><h3 id="bug-fixes-20">Bug Fixes:</h3><ul><li><p>properly split lazy &amp; non-lazy new type initialization</p></li><li><p>Ash.Reactor: Don't import <a href="Ash.Expr.xhtml"><code class="inline">Ash.Expr</code></a> in the bulk update DSL. (#2055)</p></li><li><p>don't lift query info to aggregate info on aggregation</p></li><li><p>ensure managed relationship context is kept for belongs_to relationships</p></li></ul><h3 id="improvements-14">Improvements:</h3><ul><li><p>Support manage relationship debug (#2021)</p></li><li><p>add <code class="inline">strict_load</code> key to <code class="inline">Ash.Query.build</code></p></li><li><p>Add an Ash.OptionsHelpers.calculation_type/0 (#2051)</p></li></ul><h2 id="v3-5-11-2025-05-20"><a href="https://github.com/ash-project/ash/compare/v3.5.10...v3.5.11">v3.5.11</a> (2025-05-20)</h2><h3 id="bug-fixes-21">Bug Fixes:</h3><ul><li><p>ensure we fully initialize new types</p></li><li><p>Tuple loader and serializer (#2049)</p></li><li><p>make sure after_action is called in generate_many (#2047)</p></li><li><p>properly pass <code class="inline">select</code> into combinations</p></li><li><p>add_new_code_interface/5 when do block occurs after resource (#2020)</p></li></ul><h3 id="improvements-15">Improvements:</h3><ul><li>add experimental new tool <code class="inline">Ash.data_layer_query</code></li></ul><h2 id="v3-5-10-2025-05-15"><a href="https://github.com/ash-project/ash/compare/v3.5.9...v3.5.10">v3.5.10</a> (2025-05-15)</h2><h3 id="bug-fixes-22">Bug Fixes:</h3><ul><li><p>ensure field policies are logged on success</p></li><li><p>various additional fixes for bulk action input ordering</p></li><li><p>Fix batch order of bulk_create (#2027)</p></li><li><p>make <code class="inline">lazy_init?</code> a callback so it can be checked on new types</p></li><li><p>don't raise error when no policies apply to request</p></li><li><p>ensure tenant is set on bulk created records.</p></li><li><p>don't try to cast input before cast atomic</p></li><li><p>properly prevent embedded attribute updates in atomics</p></li><li><p>preserve validation messages in non-atomic-bulk-update validations</p></li><li><p>add types for times operator</p></li><li><p>properly handle pre-expanded newtype constraints</p></li><li><p>shortcircuit queries properly</p></li><li><p>only print topic if present (#2013)</p></li></ul><h3 id="improvements-16">Improvements:</h3><ul><li><p>support :time_usec (#2023)</p></li><li><p>support <code class="inline">limit</code> on has_many relationships (#2016)</p></li></ul><h2 id="v3-5-9-2025-05-06"><a href="https://github.com/ash-project/ash/compare/v3.5.8...v3.5.9">v3.5.9</a> (2025-05-06)</h2><h3 id="bug-fixes-23">Bug Fixes:</h3><ul><li><p>shortcircuit queries properly</p></li><li><p>ensure that context is set on authorizers in nested field policies</p></li><li><p>accept <code class="inline">private_arguments</code> option in the same way as <code class="inline">defaults</code> in generators</p></li><li><p>handle case where atomic change isn't cleared when converted to static</p></li><li><p>handle case where atomic condition isn't applied to generated validations</p></li></ul><h3 id="improvements-17">Improvements:</h3><ul><li><p>normalize authorizer context in more locations</p></li><li><p>aggressively prune ets logs while retaining important info</p></li><li><p>combination queries (#2009)</p></li></ul><h2 id="v3-5-8-2025-04-30"><a href="https://github.com/ash-project/ash/compare/v3.5.7...v3.5.8">v3.5.8</a> (2025-04-30)</h2><h3 id="bug-fixes-24">Bug Fixes:</h3><ul><li><p>handle <code class="inline">nil</code> type or invalid types more gracefully in type determination</p></li><li><p>properly type expressions based on return values</p></li></ul><h3 id="improvements-18">Improvements:</h3><ul><li><p>add rem/2 expr (#2004)</p></li><li><p>add <a href="Ash.Info.xhtml"><code class="inline">Ash.Info</code></a> for general application information</p></li></ul><h2 id="v3-5-7-2025-04-29"><a href="https://github.com/ash-project/ash/compare/v3.5.6...v3.5.7">v3.5.7</a> (2025-04-29)</h2><h3 id="bug-fixes-25">Bug Fixes:</h3><ul><li><p>Accept field opt in query aggregate (#2001)</p></li><li><p>only return the changeset (#2003)</p></li><li><p>expand types when typing expressions</p></li><li><p>Allow soft-deleting of many-to-many relationships (#1999)</p></li><li><p>properly show timeout errors on read transactions</p></li><li><p>handle values that generate as <code class="inline">nil</code> in map generators</p></li><li><p>sort lazy loaded records post-linking</p></li><li><p>properly attach nested transient calculation dependencies</p></li><li><p>be more lax with lazy_init? newtypes</p></li><li><p>properly return subtype constraints on constraint call</p></li><li><p>handle error cases in atomic changesets better</p></li><li><p>CodeInterface: logic error in <code class="inline">get_by</code> code interfaces. (#1961)</p></li><li><p>CodeInterface: logic error in <code class="inline">get_by</code> code interfaces.</p></li><li><p>crash when sorting by aggregates with non-attribute field (#1986)</p></li><li><p>handle atomic conditions on <code class="inline">{:atomic, ...}</code> changes</p></li><li><p>ensure data layer is loaded before using <a href="https://hexdocs.pm/elixir/Kernel.html#function_exported?/3"><code class="inline">function_exported?/3</code></a></p></li><li><p>ensure that bulk callbacks are only called when appropriate</p></li><li><p>properly update belongs_to records on <code class="inline">relate_and_update</code></p></li></ul><h3 id="improvements-19">Improvements:</h3><ul><li><p>Skip reading query for filter false (#2002)</p></li><li><p>generator for union types</p></li><li><p>Add various DSL options for inspecting resources</p></li><li><p>hide calculations and aggregates when empty</p></li><li><p>hide calculation dep calculations while inspecting</p></li><li><p>Raise an <a href="https://hexdocs.pm/elixir/ArgumentError.html"><code class="inline">ArgumentError</code></a> when generating a changeset using a non-existent action (#1992)</p></li><li><p>add <code class="inline">:tuple</code> builtin type</p></li><li><p>set changeset.load on bulk destroy actions</p></li><li><p>return the error when atomically cascade destroying</p></li><li><p>add a description to map/keyword/struct types</p></li><li><p>Remove duplicate impl of default policy functions (#1985)</p></li><li><p>eagerly expand aggregates in <code class="inline">Ash.aggregate</code></p></li><li><p>accept <code class="inline">context</code> option in generic action code interfaces</p></li></ul><h2 id="v3-5-6-2025-04-15"><a href="https://github.com/ash-project/ash/compare/v3.5.5...v3.5.6">v3.5.6</a> (2025-04-15)</h2><h3 id="bug-fixes-26">Bug Fixes:</h3><ul><li><p>properly deduplicate on lazy relationship loading</p></li><li><p>use correct exceptions and add missing fields to them (#1960)</p></li><li><p>undo incorrect change to trimmed string casting</p></li></ul><h3 id="improvements-20">Improvements:</h3><ul><li><p>add <code class="inline">:__skip__</code> value to seed</p></li><li><p>Allow update action types in Ash.Generator.generate (#1967)</p></li></ul><h2 id="v3-5-5-2025-04-14"><a href="https://github.com/ash-project/ash/compare/v3.5.4...v3.5.5">v3.5.5</a> (2025-04-14)</h2><h3 id="bug-fixes-27">Bug Fixes:</h3><ul><li><p>don't trim strings when <code class="inline">trim?: false</code> is set</p></li><li><p>remove flawed optimization about <code class="inline">is_nil: false</code></p></li><li><p>properly evaluate ci_string concatenation in Elixir</p></li><li><p>don't validate types in gen.resource task.</p></li></ul><h3 id="improvements-21">Improvements:</h3><ul><li><p>add calculation tools to <a href="Ash.Resource.Igniter.xhtml"><code class="inline">Ash.Resource.Igniter</code></a></p></li><li><p>support a <code class="inline">load</code> option on changeset building</p></li></ul><h2 id="v3-5-4-2025-04-10"><a href="https://github.com/ash-project/ash/compare/v3.5.3...v3.5.4">v3.5.4</a> (2025-04-10)</h2><h3 id="bug-fixes-28">Bug Fixes:</h3><ul><li><p>ensure after hooks force return_records on bulk update/destroy</p></li><li><p>add action to changeset for opts fetching in bulk create</p></li><li><p>avoid coercion of datetime to date in start_of_day function (#1958)</p></li><li><p>incorrect start_of_day value when timezone specified</p></li></ul><h2 id="v3-5-3-2025-04-09"><a href="https://github.com/ash-project/ash/compare/v3.5.2...v3.5.3">v3.5.3</a> (2025-04-09)</h2><h3 id="bug-fixes-29">Bug Fixes:</h3><ul><li><p>avoid defining default actions when actions w/ that name exist</p></li><li><p>use the notification logic from bulk update in create (#1951)</p></li><li><p>honor stream_options in read code interfaces</p></li><li><p>Fix filtering with aggregates refers calculation error (#1954)</p></li><li><p>properly provide the changeset to after action hooks</p></li><li><p>set calculation context in <code class="inline">Ash.can</code></p></li><li><p>honor <code class="inline">:*</code> in skip_unknown_inputs in generic actions</p></li><li><p>honor action's <code class="inline">skip_unknown_inputs</code> in generic actions</p></li><li><p>set access<em>from in cascade</em>&lt;update/destroy&gt; (#1948)</p></li><li><p>maintain order of enum values (#1942)</p></li><li><p>carry context around to nested calculations better</p></li><li><p>fill templates in more necessary places</p></li><li><p>set tenant when building query in managed_relationships</p></li></ul><h3 id="improvements-22">Improvements:</h3><ul><li><p>optimize args handling in code interfaces</p></li><li><p>tasks for generating custom modules (#1940)</p></li></ul><h2 id="v3-5-2-2025-03-31"><a href="https://github.com/ash-project/ash/compare/v3.5.1...v3.5.2">v3.5.2</a> (2025-03-31)</h2><h3 id="bug-fixes-30">Bug Fixes:</h3><ul><li><p>match errors on cascade destroy/update</p></li><li><p>handle templated opts in bulk update after batch results</p></li><li><p>support <code class="inline">refs</code> and <code class="inline">args</code> option for <code class="inline">define_calculation</code></p></li><li><p>don't cast arbitrary maps to structs in struct type</p></li></ul><h3 id="improvements-23">Improvements:</h3><ul><li><p>add <code class="inline">default_sort</code> on relationships and queries (#1928)</p></li><li><p>new type recursive validation (#1913)</p></li><li><p>task for generating custom changes module (#1926)</p></li><li><p>better error on <code class="inline">case</code> in ash expressions (#1927)</p></li><li><p>helpful error on incorrectly implemented change modules</p></li><li><p>support <code class="inline">custom_input</code>s in code interfaces</p></li><li><p>Ash.Type.Enum - Add optional description and label value â¦ (#1925)</p></li><li><p>support <code class="inline">exclude_inputs</code> for <code class="inline">define_calculation</code></p></li><li><p>add <code class="inline">exclude_inputs</code> to code interface definitions</p></li><li><p>fix hint for read/generic actions in <code class="inline">NoSuchInput</code></p></li></ul><h2 id="v3-5-1-2025-03-27"><a href="https://github.com/ash-project/ash/compare/v3.5.0...v3.5.1">v3.5.1</a> (2025-03-27)</h2><h3 id="bug-fixes-31">Bug Fixes:</h3><ul><li><p>when reading a record to simulate an update, merge with data</p></li><li><p>more consistent error messaging from present validation</p></li><li><p>can't atomically update a query w/ after_action hooks</p></li></ul><h3 id="improvements-24">Improvements:</h3><ul><li><p>add <code class="inline">Ash.transaction(resources, func, opts)</code> (#1914)</p></li><li><p>set <code class="inline">query_for</code> context on queries</p></li></ul><h2 id="v3-5-0-2025-03-26"><a href="https://github.com/ash-project/ash/compare/v3.4.73...v3.5.0">v3.5.0</a> (2025-03-26)</h2><h3 id="bug-fixes-32">Bug Fixes:</h3><ul><li>don't set <code class="inline">accessing_from</code> on lookups for managed relationships</li></ul><p>This <em>may</em> be a breaking change for some cases, but ultimately we
felt it was too confusing to leave as it was. The semantics of
<code class="inline">accessing_from</code> meant that &quot;all actions done as part of <code class="inline">manage_relationship</code>
were allowed to be performed. This was the intended design, but made it easy
to implement an authorization related bug. Specifcaly, the <code class="inline">on_lookup</code> behavior
would set that context as well, potentially allowing a user to relate something
to a resource that you did not intend them to be able to see.</p><h3 id="improvements-25">Improvements:</h3><ul><li><p>add <code class="inline">tenant()</code> filter template expression (#1909)</p></li><li><p><a href="Ash.Domain.Igniter.xhtml#add_new_code_interface/5"><code class="inline">Ash.Domain.Igniter.add_new_code_interface/5</code></a></p></li><li><p>add <code class="inline">unsafe_to_atom?</code> constraint for <a href="Ash.Type.Atom.xhtml"><code class="inline">Ash.Type.Atom</code></a></p></li><li><p>support <code class="inline">expr(exists(relation))</code> (#1912)</p></li></ul><h2 id="v3-4-73-2025-03-25"><a href="https://github.com/ash-project/ash/compare/v3.4.72...v3.4.73">v3.4.73</a> (2025-03-25)</h2><h3 id="bug-fixes-33">Bug Fixes:</h3><ul><li><p>use attribute names, not structs, for retaining ets update attrs</p></li><li><p>supply reactor with <code class="inline">nil</code> values for non-supplied arguments</p></li></ul><h2 id="v3-4-72-2025-03-25"><a href="https://github.com/ash-project/ash/compare/v3.4.71...v3.4.72">v3.4.72</a> (2025-03-25)</h2><h3 id="bug-fixes-34">Bug Fixes:</h3><ul><li><p>retain loaded fields on ETS data layer update</p></li><li><p>Fixes processing of manual bulk actions, with tests. (#1903)</p></li><li><p>Ensure batch_size is correctly set, return values are nil if not requested.</p></li><li><p>batch_size cond statement, fix batch -&gt; changeset typo.</p></li><li><p>ensure consistent bulk result for <code class="inline">return_records?</code> and <code class="inline">return_errors?</code> types.</p></li><li><p>add action to base query if not present</p></li><li><p>update spark to get missing builders in <code class="inline">spark.formatter</code></p></li><li><p>handle tenancy for built query in cascade destroy/update</p></li><li><p>Improve processing of manual actions during bulk operations (#1883)</p></li></ul><h3 id="improvements-26">Improvements:</h3><ul><li><p>attach a limit to related queries if <code class="inline">from_many?: true</code></p></li><li><p>support atomic actions in <code class="inline">can_</code> code interfaces</p></li><li><p>import the <code class="inline">:reactor</code> dep in <code class="inline">.formatter.exs</code> on install</p></li><li><p>maps,structs,keywords can be atomically updated</p></li><li><p>support anonymous functions in <code class="inline">error_handler</code> option</p></li></ul><h2 id="v3-4-71-2025-03-21"><a href="https://github.com/ash-project/ash/compare/v3.4.70...v3.4.71">v3.4.71</a> (2025-03-21)</h2><h3 id="bug-fixes-35">Bug Fixes:</h3><ul><li><p>prefer new loads when loading relationships</p></li><li><p>put notifications in process context when inside an action</p></li><li><p>consider query tenant when validating aggregate multitenancy</p></li><li><p>update Validations.ActionIs to accept atom or list(atom) (#1893)</p></li></ul><h3 id="improvements-27">Improvements:</h3><ul><li>set <code class="inline">bulk_actions_default_to_errors?</code> to <code class="inline">true</code> in installer</li></ul><h2 id="v3-4-70-2025-03-20"><a href="https://github.com/ash-project/ash/compare/v3.4.69...v3.4.70">v3.4.70</a> (2025-03-20)</h2><h3 id="bug-fixes-36">Bug Fixes:</h3><ul><li><p>compose get_by and action filters properly</p></li><li><p><code class="inline">fields</code> could be nil on exceptions</p></li><li><p>apply runtime supplied loads over top of action loads</p></li><li><p>return records from bulk soft destroy if requested (#1884)</p></li><li><p>ensure error classes are used in code interfaces</p></li></ul><h3 id="improvements-28">Improvements:</h3><ul><li><p>validate multitenancy earlier in bulk actions</p></li><li><p>initialize all types properly at compile time</p></li></ul><h2 id="v3-4-69-2025-03-18"><a href="https://github.com/ash-project/ash/compare/v3.4.68...v3.4.69">v3.4.69</a> (2025-03-18)</h2><h3 id="bug-fixes-37">Bug Fixes:</h3><ul><li><p>apply strict load in <code class="inline">Ash.get</code> properly (#1881)</p></li><li><p>honor tenant in <code class="inline">Ash.Seed.update!</code></p></li><li><p>pattern match error in bulk result</p></li><li><p>match on <code class="inline">{:not_atomic</code> pattern in update actions</p></li><li><p>fix typo: <code class="inline">atomcis</code> -&gt; <code class="inline">atomics</code></p></li><li><p>properly evaluate <code class="inline">Exists{}</code> expressions in runtime filter</p></li><li><p>Fix upsert identity type error (#1872)</p></li><li><p>Fix bulk_create for manual create actions with bulk_create/3 (#1869)</p></li><li><p>ensure loading maps &amp; structs properly load as keyword</p></li><li><p>make the --example installer flag idempotent</p></li><li><p>don't add tenant attribute for <code class="inline">all_tenant?</code> identities upsert keys</p></li><li><p>handle case clause error in <a href="Ash.Filter.xhtml"><code class="inline">Ash.Filter</code></a></p></li><li><p>validate return type of <code class="inline">Ash.Resource.Calculation.init/1</code></p></li><li><p>make <code class="inline">lazy_init</code> work on <code class="inline">NewTypes</code></p></li><li><p>properly parse maps with tuple values in filter parser</p></li><li><p>dump values to native storage type when doing atomic upgrades</p></li><li><p>fix required error deduplication logic</p></li><li><p>undo breaking change, use primary read action loads in <code class="inline">Ash.load!</code></p></li><li><p>don't derive fields for resources in map types</p></li><li><p>make sequence unshrinkable in generators</p></li><li><p>properly handle bulk soft destroy (#1854)</p></li></ul><h3 id="improvements-29">Improvements:</h3><ul><li><p>support a resource &amp; attrs tuple in <code class="inline">seed_generator</code></p></li><li><p>allow is_equal and is_not_equal for compare validation (#1853)</p></li><li><p>return errors and stop on errors by default in bulk actions</p></li><li><p>add config to do read after_action hooks in order</p></li><li><p>add compile flag requiring atomic for default actions</p></li><li><p>types support atomic update by default for non-expr values</p></li><li><p>add <code class="inline">actions.read.pagination.stable_sort</code> customization</p></li><li><p>support inferring struct types from a resource</p></li><li><p>show value in match validation errors</p></li><li><p>disambiguation message on NoSuchFunction</p></li></ul><h2 id="v3-4-68-2025-03-11"><a href="https://github.com/ash-project/ash/compare/v3.4.67...v3.4.68">v3.4.68</a> (2025-03-11)</h2><h3 id="bug-fixes-38">Bug Fixes:</h3><ul><li><p>init nested types in map/keyword/struct types</p></li><li><p>properly handle change with <code class="inline">where</code> validations in bulk (#1843)</p></li><li><p>properly construct <code class="inline">parent_stack</code> for loaded relationships</p></li><li><p>update context tenant from changeset for each change (#1837)</p></li></ul><h3 id="improvements-30">Improvements:</h3><ul><li><p>allow manual reads return <code class="inline">full_count</code> for pagination</p></li><li><p>validate action types in <a href="Ash.xhtml"><code class="inline">Ash</code></a> functions</p></li></ul><h2 id="v3-4-67-2025-03-04"><a href="https://github.com/ash-project/ash/compare/v3.4.66...v3.4.67">v3.4.67</a> (2025-03-04)</h2><h3 id="bug-fixes-39">Bug Fixes:</h3><ul><li>Pass tenant option when seeding resource given by the generator (#1834)</li></ul><h2 id="v3-4-66-2025-03-03"><a href="https://github.com/ash-project/ash/compare/v3.4.65...v3.4.66">v3.4.66</a> (2025-03-03)</h2><h3 id="bug-fixes-40">Bug Fixes:</h3><ul><li><p>handle unparseable relationship sorts &amp; single atom sorts</p></li><li><p>don't allow modifying changeset with atomic conditions</p></li><li><p>don't prevent changing values to <code class="inline">nil</code> when original data is not available</p></li><li><p>propagate invalid reference error when adding calc context to sort (#1827)</p></li><li><p>ensure that we don't try to compare not loaded or forbidden values</p></li><li><p>use <code class="inline">filter</code> not <code class="inline">filters</code> in stale record error</p></li></ul><h3 id="improvements-31">Improvements:</h3><ul><li><p>add <code class="inline">touching?</code> option to changing validation</p></li><li><p>don't show required errors for fields with other errors</p></li><li><p>validate aggregate multitenancy</p></li><li><p>ignore action-defined loads when using <code class="inline">Ash.load</code></p></li></ul><h2 id="v3-4-65-2025-02-25"><a href="https://github.com/ash-project/ash/compare/v3.4.64...v3.4.65">v3.4.65</a> (2025-02-25)</h2><h3 id="bug-fixes-41">Bug Fixes:</h3><ul><li><p>properly enumerate <code class="inline">:_pkey</code> in notifier</p></li><li><p>Always rollback input.resource when running generic actions. (#1817)</p></li><li><p>fix case where batch before/after action callbacks could be skipped</p></li><li><p>return NotFound error in proper cases on bulk interfaces</p></li><li><p>don't eagerly return records on bulk update/destroys</p></li><li><p>ensure actor templates are hydrated for aggregates</p></li><li><p>properly use operator overloads for evaluating operators at runtime</p></li><li><p>Missing case clause for bulk update/destroy with <code class="inline">get?: true</code> in interface (#1806)</p></li><li><p>always run update filter on skipped updates</p></li><li><p>don't change update defaults unless something changes</p></li></ul><h3 id="improvements-32">Improvements:</h3><ul><li><p>better parent resource tracking in expressions</p></li><li><p>Generic actions to raise if they don't have return type but have an return value (#1805)</p></li></ul><h2 id="v3-4-64-2025-02-17"><a href="https://github.com/ash-project/ash/compare/v3.4.63...v3.4.64">v3.4.64</a> (2025-02-17)</h2><h3 id="bug-fixes-42">Bug Fixes:</h3><ul><li><p>use undo action in generic action undo</p></li><li><p>handle generic actions with no return</p></li><li><p>ensure atomic <code class="inline">set_attribute</code> behaves the same as non-atomic</p></li><li><p>Missing actor on aggregate resource call (#1796)</p></li><li><p>Missing actor on aggregate call (#1793)</p></li></ul><h3 id="improvements-33">Improvements:</h3><ul><li><p>support receiving the inputs when undoing generic actions</p></li><li><p>simplify &amp; unify sort/sort_input logic</p></li><li><p>support related sorts everywhere (not just sort_input)</p></li><li><p>add field names to identities (#1786)</p></li></ul><h2 id="v3-4-63-2025-02-11"><a href="https://github.com/ash-project/ash/compare/v3.4.62...v3.4.63">v3.4.63</a> (2025-02-11)</h2><h3 id="bug-fixes-43">Bug Fixes:</h3><ul><li><p>set <code class="inline">read_after_writes</code> to true if generated</p></li><li><p>type cast errors w/ floats &amp; vectors</p></li><li><p>handle case clause error in filters</p></li><li><p>don't return invalid type from vector type</p></li><li><p>don't double process string interpolation expressions</p></li><li><p>Include warning for arguments only when 'things' are arguments (#1785)</p></li><li><p>empty bulk create inputs must still return a stream</p></li><li><p>don't use <code class="inline">authorize_with: :error</code> on data layers that can't do it</p></li><li><p>pass tenant to load in cascade destroy (#1775)</p></li><li><p>add tenant to load in cascade update (#1773)</p></li><li><p>raise errors on partial_success results in bulk actions</p></li><li><p>add <code class="inline">reuse_values?</code> opt to <code class="inline">Ash.can</code> and disable it automatically</p></li><li><p>compile <a href="Ash.PlugHelpers.xhtml"><code class="inline">Ash.PlugHelpers</code></a> even without <a href="https://hexdocs.pm/plug/1.18.1/Plug.html"><code class="inline">Plug</code></a> available</p></li><li><p>expand <code class="inline">opts</code> when using <code class="inline">calculate/3</code></p></li><li><p>handle base resources in <code class="inline">ash.extend</code></p></li><li><p>type system warning on apps w/o solvers</p></li><li><p>Fix no read action exception for through relationship (#1750)</p></li><li><p>always recompile domain on resource changes</p></li><li><p>fix handling of generic action returns with transaction enabled (#1758)</p></li><li><p>type struct handle instance of return error tuple (#1756)</p></li><li><p>Compilation failure when using the <code class="inline">ash_step</code> Reactor DSL. (#1753)</p></li><li><p>pass <code class="inline">authorize?</code> option to <code class="inline">bulk_create</code> in <a href="Ash.Generator.xhtml#generate_many/2"><code class="inline">Ash.Generator.generate_many/2</code></a></p></li></ul><h3 id="improvements-34">Improvements:</h3><ul><li><p>Add string_position expression (#1782)</p></li><li><p>add <code class="inline">dimensions</code> to vector type</p></li><li><p>add filter &amp; transform options for pubsub notifier</p></li><li><p>verify pub_sub actions at compile time</p></li><li><p>more clean boolean filter optimization for <code class="inline">or ==</code></p></li><li><p>add <code class="inline">reuse_values?</code> option for calculate!</p></li><li><p>prefer <code class="inline">calculate/3</code> when reusing values</p></li><li><p>add <a href="Ash.Type.xhtml#c:coerce/2"><code class="inline">Ash.Type.coerce/2</code></a> callback</p></li></ul><h2 id="v3-4-62-2025-01-31"><a href="https://github.com/ash-project/ash/compare/v3.4.61...v3.4.62">v3.4.62</a> (2025-01-31)</h2><h3 id="bug-fixes-44">Bug Fixes:</h3><ul><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] always start transactions when managing relationships</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] handle parent in rel in managed belongs to (#1746)</p></li></ul><h2 id="v3-4-61-2025-01-31"><a href="https://github.com/ash-project/ash/compare/v3.4.60...v3.4.61">v3.4.61</a> (2025-01-31)</h2><h3 id="bug-fixes-45">Bug Fixes:</h3><ul><li><p>[<a href="Ash.Generator.xhtml"><code class="inline">Ash.Generator</code></a>] don't prevent setting manage_relationship inputs in generators</p></li><li><p>[<a href="Ash.Reactor.xhtml"><code class="inline">Ash.Reactor</code></a>] Fix referring to outer steps and inputs in <code class="inline">transaction</code> steps. (#1741)</p></li><li><p>[<a href="Ash.Expr.xhtml"><code class="inline">Ash.Expr</code></a>] always return utc timestamp as result of <code class="inline">start_of_day</code></p></li><li><p>[<a href="Ash.Resource.Change.CascadeDestroy.xhtml"><code class="inline">Ash.Resource.Change.CascadeDestroy</code></a>] support <code class="inline">after_action?</code> option on cascade destroys &amp; better error when it should be used (#1734)</p></li></ul><h3 id="improvements-35">Improvements:</h3><ul><li><p>[<a href="Ash.Resource.xhtml"><code class="inline">Ash.Resource</code></a>] warning on args, preparations or filters on primary reads</p></li><li><p>[<a href="Ash.Reactor.xhtml"><code class="inline">Ash.Reactor</code></a>] Support guards in <a href="Ash.Reactor.xhtml"><code class="inline">Ash.Reactor</code></a> steps. (#1739)</p></li><li><p>[<a href="Mix.Tasks.Ash.Extend.xhtml"><code class="inline">mix ash.extend</code></a>] use <code class="inline">ash.extend</code> and use it instead of <code class="inline">ash.patch.extend</code></p></li></ul><h2 id="v3-4-60-2025-01-27"><a href="https://github.com/ash-project/ash/compare/v3.4.59...v3.4.60">v3.4.60</a> (2025-01-27)</h2><h3 id="bug-fixes-46">Bug Fixes:</h3><ul><li>[<a href="Ash.Expr.xhtml"><code class="inline">Ash.Expr</code></a>] traverse custom expressions when listing refs</li></ul><h2 id="v3-4-59-2025-01-27"><a href="https://github.com/ash-project/ash/compare/v3.4.58...v3.4.59">v3.4.59</a> (2025-01-27)</h2><h3 id="bug-fixes-47">Bug Fixes:</h3><ul><li>[<a href="Ash.Query.xhtml"><code class="inline">Ash.Query</code></a>] better placed validations of aggregate support for data layers</li></ul><h2 id="v3-4-58-2025-01-26"><a href="https://github.com/ash-project/ash/compare/v3.4.57...v3.4.58">v3.4.58</a> (2025-01-26)</h2><h3 id="bug-fixes-48">Bug Fixes:</h3><ul><li>[<a href="Ash.Query.Aggregate.xhtml"><code class="inline">Ash.Query.Aggregate</code></a>] properly check query aggregate support</li></ul><h3 id="improvements-36">Improvements:</h3><ul><li>[<a href="Ash.xhtml"><code class="inline">Ash</code></a>] support <code class="inline">authorize_with</code> option in <code class="inline">Ash.get</code> (#1732)</li></ul><h2 id="v3-4-57-2025-01-23"><a href="https://github.com/ash-project/ash/compare/v3.4.56...v3.4.57">v3.4.57</a> (2025-01-23)</h2><h3 id="bug-fixes-49">Bug Fixes:</h3><ul><li>[<code class="inline">Ash.Resource.Validation.Compare</code>] ensure compare validation doesn't put functions in exceptions</li></ul><h2 id="3-4-56-2025-01-21"><a href="https://github.com/ash-project/ash/compare/v3.4.55...3.4.56">3.4.56</a> (2025-01-21)</h2><h3 id="bug-fixes-50">Bug Fixes:</h3><ul><li><p>[<a href="Ash.xhtml"><code class="inline">Ash</code></a>] don't use <a href="https://hexdocs.pm/elixir/JSON.html"><code class="inline">JSON</code></a> due to library compatibility issues</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] matching in managed_relationships handle_update (#1719)</p></li><li><p>[<a href="Ash.Query.Calculation.xhtml"><code class="inline">Ash.Query.Calculation</code></a>] properly load doubly nested calculation's explicit dependencies</p></li><li><p>[<a href="Ash.Query.Calculation.xhtml"><code class="inline">Ash.Query.Calculation</code></a>] handle related non-expr calculations referenced from expr calcs</p></li><li><p>[<a href="Ash.Query.Calculation.xhtml"><code class="inline">Ash.Query.Calculation</code></a>] simplify and fix path generation for nested relationship path deps</p></li><li><p>[<a href="Ash.xhtml"><code class="inline">Ash</code></a>] don't require multitenancy attribute in <code class="inline">get</code> (#1716)</p></li></ul><h3 id="improvements-37">Improvements:</h3><ul><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] make atomics work even if expr err is not supported (#1718)</p></li><li><p>[<a href="Ash.Query.xhtml"><code class="inline">Ash.Query</code></a>] support error shorthand for <code class="inline">Ash.Query.add_error/2-3</code></p></li><li><p>[<a href="Ash.Generator.xhtml"><code class="inline">Ash.Generator</code></a>] add <code class="inline">uses</code> option for <code class="inline">changeset_generator</code></p></li><li><p>[<a href="Ash.Generator.xhtml"><code class="inline">Ash.Generator</code></a>] add <code class="inline">uses</code> option for <code class="inline">seed_generator</code></p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] Use clearer error message for match validation atomic errors (#1721)</p></li><li><p>[<a href="Ash.Type.xhtml"><code class="inline">Ash.Type</code></a>] Add autogenerate_enabled? to Ash.Type for Ecto compatibility (#1715)</p></li><li><p>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] warn when domain policies would be ignored by resources</p></li><li><p>[<a href="Ash.Domain.xhtml"><code class="inline">Ash.Domain</code></a>] allow policy authorizer to be in authorizers key in domains</p></li></ul><h2 id="v3-4-55-2025-01-13"><a href="https://github.com/ash-project/ash/compare/v3.4.54...v3.4.55">v3.4.55</a> (2025-01-13)</h2><h3 id="bug-fixes-51">Bug Fixes:</h3><ul><li><p>[code interfaces] ensure can_* code interfaces pass arguments to actions</p></li><li><p>[<a href="Ash.xhtml"><code class="inline">Ash</code></a>] case clause error in <code class="inline">Ash.can?</code></p></li><li><p>[<a href="Ash.xhtml"><code class="inline">Ash</code></a>] reset <code class="inline">ash_started_transaction?</code> on bulk create</p></li><li><p>[<a href="Ash.Generator.xhtml"><code class="inline">Ash.Generator</code></a>] handle embedded attributes in attribute generator</p></li><li><p>[<a href="Ash.Generator.xhtml"><code class="inline">Ash.Generator</code></a>] Fix typo in skipped import name (#1704)</p></li><li><p>[<a href="Ash.Generator.xhtml"><code class="inline">Ash.Generator</code></a>] set max_concurrency to 0 for generate_many</p></li><li><p>[<a href="Ash.Generator.xhtml"><code class="inline">Ash.Generator</code></a>] ensure that <code class="inline">once</code> and <code class="inline">sequence</code> behave predictably across tests</p></li></ul><h3 id="improvements-38">Improvements:</h3><ul><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] destroy missing records first in <code class="inline">manage_relationship</code></p></li><li><p>[<a href="Ash.Expr.xhtml"><code class="inline">Ash.Expr</code></a>] add start_of_day function</p></li><li><p>[<a href="Ash.Type.DateTime.xhtml"><code class="inline">Ash.Type.DateTime</code></a>] add <code class="inline">cast_dates_as</code> constraint to <a href="Ash.Type.DateTime.xhtml"><code class="inline">Ash.Type.DateTime</code></a></p></li></ul><h2 id="v3-4-54-2025-01-09"><a href="https://github.com/ash-project/ash/compare/v3.4.53...v3.4.54">v3.4.54</a> (2025-01-09)</h2><h3 id="bug-fixes-52">Bug Fixes:</h3><ul><li><p>[<a href="Ash.Generator.xhtml"><code class="inline">Ash.Generator</code></a>] Fix issues in <a href="Ash.Generator.xhtml#generate_many/2"><code class="inline">Ash.Generator.generate_many/2</code></a> (#1703)</p></li><li><p>[<a href="Ash.Generator.xhtml"><code class="inline">Ash.Generator</code></a>] Don't error if no <code class="inline">after_action</code> is provided to <code class="inline">generate_many</code></p></li><li><p>[<a href="Ash.Generator.xhtml"><code class="inline">Ash.Generator</code></a>] Reuse the changeset actor when calling <code class="inline">bulk_create</code></p></li></ul><h3 id="improvements-39">Improvements:</h3><ul><li><p>[<a href="Ash.Generator.xhtml"><code class="inline">Ash.Generator</code></a>] run notifications for generators</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] <code class="inline">order_is_key</code> option for sorted relationships</p></li></ul><h2 id="v3-4-53-2025-01-08"><a href="https://github.com/ash-project/ash/compare/v3.4.52...v3.4.53">v3.4.53</a> (2025-01-08)</h2><h3 id="bug-fixes-53">Bug Fixes:</h3><ul><li><p>[<a href="Ash.Generator.xhtml"><code class="inline">Ash.Generator</code></a>] properly delegate and handle conflicts in <a href="Ash.Generator.xhtml"><code class="inline">Ash.Generator</code></a></p></li><li><p>[<a href="Ash.Generator.xhtml"><code class="inline">Ash.Generator</code></a>] Replace calls to <code class="inline">create</code> and <code class="inline">create_many</code> with <code class="inline">generate</code> and <code class="inline">generate_many</code> (#1701)</p></li><li><p>[calculations] use nested calculation dependencies from expr if not in expression</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] pattern match error on expression parse failure</p></li><li><p>[<code class="inline">Ash.Test.Resource.Validation.StringLengthTest</code>] handle <code class="inline">string_length</code> on arguments when atomic</p></li></ul><h2 id="v3-4-52-2025-01-06"><a href="https://github.com/ash-project/ash/compare/v3.4.51...v3.4.52">v3.4.52</a> (2025-01-06)</h2><h3 id="bug-fixes-54">Bug Fixes:</h3><ul><li><p>[<a href="Ash.Type.Map.xhtml"><code class="inline">Ash.Type.Map</code></a>]  handle keyword errors from map field type casting</p></li><li><p>[<a href="Mix.Tasks.Ash.Gen.Resource.xhtml"><code class="inline">mix ash.gen.resource</code></a>] ensure extensions &amp; subjects args are unique</p></li></ul><h3 id="improvements-40">Improvements:</h3><ul><li><p>[<code class="inline">ash.gen.resource</code>] validate that names given to <code class="inline">ash.gen.resource</code></p></li><li><p>[<a href="Ash.Generator.xhtml"><code class="inline">Ash.Generator</code></a>] add <a href="Ash.Generator.xhtml#changeset_generator/3"><code class="inline">Ash.Generator.changeset_generator/3</code></a></p></li><li><p>[<a href="Ash.Generator.xhtml"><code class="inline">Ash.Generator</code></a>] add <a href="Ash.Generator.xhtml#seed_generator/2"><code class="inline">Ash.Generator.seed_generator/2</code></a></p></li><li><p>[<a href="Ash.Generator.xhtml"><code class="inline">Ash.Generator</code></a>] only use known keys in generators in <a href="Ash.Generator.xhtml"><code class="inline">Ash.Generator</code></a></p></li><li><p>[<a href="Ash.xhtml"><code class="inline">Ash</code></a>] support <code class="inline">after_action</code> option to <code class="inline">Ash.bulk_create</code></p></li><li><p>[<a href="Mix.Tasks.Ash.Install.xhtml"><code class="inline">mix ash.install</code></a>] set <code class="inline">yes_to_deps</code> when fetching dependencies</p></li><li><p>[<a href="Ash.Query.xhtml"><code class="inline">Ash.Query</code></a>] better error message on non-resource in <a href="Ash.Query.xhtml#new/2"><code class="inline">Ash.Query.new/2</code></a></p></li><li><p>[<code class="inline">Ash.bulk_destroy</code>] handle limited bulk destroys from streams</p></li><li><p>[Code interfaces] bulk actions use <code class="inline">full_read</code> from code interfaces given ids</p></li><li><p>[Code Interfaces] set <code class="inline">limit</code> in code interface to update or destroy one thing</p></li></ul><h2 id="v3-4-51-2025-01-03"><a href="https://github.com/ash-project/ash/compare/v3.4.50...v3.4.51">v3.4.51</a> (2025-01-03)</h2><h3 id="bug-fixes-55">Bug Fixes:</h3><ul><li><p>[<a href="Ash.Resource.xhtml"><code class="inline">Ash.Resource</code></a>] handle ambiguous case of empty params in code interfaces (#1694)</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] discard manage_relationships added inside changes on atomic upgrade</p></li></ul><h2 id="v3-4-50-2025-01-01"><a href="https://github.com/ash-project/ash/compare/v3.4.49...v3.4.50">v3.4.50</a> (2025-01-01)</h2><h3 id="bug-fixes-56">Bug Fixes:</h3><ul><li><p>[<a href="Ash.DataLayer.Ets.xhtml"><code class="inline">Ash.DataLayer.Ets</code></a>, <a href="Ash.DataLayer.Mnesia.xhtml"><code class="inline">Ash.DataLayer.Mnesia</code></a>] properly handle aggregate defaults in ets/mnesia (#1684)</p></li><li><p>[<code class="inline">Ash.Resource.Validation.Changing</code>] use context message instead of default if provided in changing validation (#1677)</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] ensure that <code class="inline">changed?</code> context is set to true for atomics</p></li><li><p>[<a href="Ash.xhtml"><code class="inline">Ash</code></a>] properly match on <code class="inline">return_query?</code> option, avoid raised pattern match error</p></li><li><p>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] ensure that old config applies all aggregate policies</p></li></ul><h3 id="improvements-41">Improvements:</h3><ul><li><p>[<a href="Ash.Generator.xhtml"><code class="inline">Ash.Generator</code></a>] add <a href="Ash.Generator.xhtml#once/2"><code class="inline">Ash.Generator.once/2</code></a></p></li><li><p>[<a href="Ash.Type.Map.xhtml"><code class="inline">Ash.Type.Map</code></a>, <a href="Ash.Type.Keyword.xhtml"><code class="inline">Ash.Type.Keyword</code></a>, <a href="Ash.Type.Struct.xhtml"><code class="inline">Ash.Type.Struct</code></a>] define <code class="inline">generate/1</code> callback for maps, structs, keywords</p></li><li><p>[<a href="Ash.xhtml"><code class="inline">Ash</code></a>] add <code class="inline">data_layer?</code> option to <a href="Ash.xhtml#calculate/3"><code class="inline">Ash.calculate/3</code></a></p></li><li><p>[<a href="Ash.Resource.xhtml"><code class="inline">Ash.Resource</code></a>] Add default code interface options (#1681)</p></li><li><p>[<a href="Ash.Resource.xhtml"><code class="inline">Ash.Resource</code></a>] add <code class="inline">allow_forbidden_field?</code> option to relationships</p></li><li><p>[<a href="Ash.Resource.xhtml"><code class="inline">Ash.Resource</code></a>] add <code class="inline">authorize_read_with</code> option to relationships</p></li><li><p>[<a href="Ash.xhtml"><code class="inline">Ash</code></a>] support <code class="inline">default</code> option in <code class="inline">Ash.first</code> (#1683)</p></li><li><p>[<a href="Ash.Notifier.PubSub.xhtml"><code class="inline">Ash.Notifier.PubSub</code></a>] allow exclusion of certain actions from publish_all (#1680)</p></li><li><p>[<code class="inline">mix igniter.install ash</code>] no prompt about SAT solver unless user is on windows</p></li><li><p>[<a href="Ash.Domain.xhtml"><code class="inline">Ash.Domain</code></a>] add otp_app option to use Ash.Domain</p></li><li><ul><li>[<a href="Ash.xhtml"><code class="inline">Ash</code></a>] add support for <code class="inline">strict?</code> in read options (#1669)</li></ul></li></ul><h2 id="v3-4-49-2024-12-22"><a href="https://github.com/ash-project/ash/compare/v3.4.48...v3.4.49">v3.4.49</a> (2024-12-22)</h2><h3 id="improvements-42">Improvements:</h3><ul><li>[read actions] - add support for <code class="inline">strict?</code> in <code class="inline">Ash.read</code> options. (#1669)</li></ul><h3 id="bug-fixes-57">Bug Fixes:</h3><ul><li>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] ensure that old config applies all aggregate policies</li></ul><p>If you've upgraded to the following configuration this does not affect you:</p><pre><code class="makeup elixir" translate="no"><span class="n">config</span><span class="w"> </span><span class="ss">:ash</span><span class="p">,</span><span class="w"> </span><span class="ss">:policies</span><span class="p">,</span><span class="w"> </span><span class="ss">no_filter_static_forbidden_reads?</span><span class="p">:</span><span class="w"> </span><span class="no">false</span></code></pre><p>You should upgrade regardless, and adopt that new configuration.</p><h2 id="v3-4-48-2024-12-20"><a href="https://github.com/ash-project/ash/compare/v3.4.47...v3.4.48">v3.4.48</a> (2024-12-20)</h2><h3 id="bug-fixes-58">Bug Fixes:</h3><ul><li><p>[calculations] properly update sort calculation expressions</p></li><li><p>[<a href="Ash.Type.Module.xhtml"><code class="inline">Ash.Type.Module</code></a>] handle nil values in <a href="Ash.Type.Module.xhtml"><code class="inline">Ash.Type.Module</code></a></p></li><li><p>[<a href="Ash.Resource.xhtml"><code class="inline">Ash.Resource</code></a>] ensure that <code class="inline">select_by_default?</code> is honored on loads</p></li><li><p>[<a href="Ash.Type.Union.xhtml"><code class="inline">Ash.Type.Union</code></a>] Verify union types constraint on init</p></li><li><p>[loading data] ensure tenant is set on reselection query</p></li></ul><h3 id="improvements-43">Improvements:</h3><ul><li><p>[Igniter] handle igniter not being compiled, and make it optional</p></li><li><p>[<a href="Ash.Generator.xhtml"><code class="inline">Ash.Generator</code></a>] add <a href="Ash.Generator.xhtml#next_in_sequence/3"><code class="inline">Ash.Generator.next_in_sequence/3</code></a></p></li><li><p>[performance] don't reselect unnecessary attributes</p></li><li><p>[pagination] add <code class="inline">show_keysets_for_all_actions?</code> configuration</p><p>Set <code class="inline">config :ash, show_keysets_for_all_actions?, false</code> for significant performance
improvements when reading resources that support keyset pagination. This causes
keysets to only be shown for actions that are actively being paginated with
keyset pagination.</p></li></ul><h2 id="v3-4-47-2024-12-17"><a href="https://github.com/ash-project/ash/compare/v3.4.46...v3.4.47">v3.4.47</a> (2024-12-17)</h2><h3 id="bug-fixes-59">Bug Fixes:</h3><ul><li><p>[<a href="Ash.Query.xhtml"><code class="inline">Ash.Query</code></a>] handle indexed maps and string keys in calculation arguments</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] throw validation error when trying to set public arguments in private_arguments (#1663)</p></li><li><p>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] include <code class="inline">changeset</code> in preflight authorization context</p></li><li><p>[embedded resources] include presence of authorizers in embedded resource optimization</p></li><li><p>[<a href="Ash.DataLayer.xhtml"><code class="inline">Ash.DataLayer</code></a>] don't check data layer compatibility for manual actions</p></li></ul><h3 id="improvements-44">Improvements:</h3><ul><li>[<a href="Ash.Reactor.xhtml"><code class="inline">Ash.Reactor</code></a>]: Always add the notification middleware any time the extension is added. (#1657)</li></ul><h2 id="v3-4-46-2024-12-12"><a href="https://github.com/ash-project/ash/compare/v3.4.45...v3.4.46">v3.4.46</a> (2024-12-12)</h2><h3 id="bug-fixes-60">Bug Fixes:</h3><ul><li><p>[<a href="Ash.Tracer.xhtml"><code class="inline">Ash.Tracer</code></a>] use proper telemetry name for actions</p></li><li><p>[<a href="Ash.Sort.xhtml"><code class="inline">Ash.Sort</code></a>] use atoms for paths in related sorts</p></li></ul><h2 id="v3-4-45-2024-12-10"><a href="https://github.com/ash-project/ash/compare/v3.4.44...v3.4.45">v3.4.45</a> (2024-12-10)</h2><h3 id="bug-fixes-61">Bug Fixes:</h3><ul><li>[<a href="Ash.xhtml"><code class="inline">Ash</code></a>] don't ignore tenant when calling aggregate functions</li></ul><h3 id="improvements-45">Improvements:</h3><ul><li>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] don't log field policies unless logging successful policy breakdowns</li></ul><h2 id="v3-4-44-2024-12-06"><a href="https://github.com/ash-project/ash/compare/v3.4.43...v3.4.44">v3.4.44</a> (2024-12-06)</h2><h3 id="bug-fixes-62">Bug Fixes:</h3><ul><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] use <code class="inline">Ash.read</code> when eager validating relationships</p></li><li><p>[<a href="Ash.Expr.xhtml"><code class="inline">Ash.Expr</code></a>] allow strings in <code class="inline">get_path/2</code></p></li><li><p>[<a href="Ash.Sort.xhtml"><code class="inline">Ash.Sort</code></a>] don't expand calculations until after authorization is complete</p></li><li><p>[<a href="Ash.Resource.Change.GetAndLock.xhtml"><code class="inline">Ash.Resource.Change.GetAndLock</code></a>] don't automatically skip <code class="inline">get_and_lock</code> changes</p></li><li><p>[<a href="Ash.Filter.xhtml"><code class="inline">Ash.Filter</code></a>] handle indexed maps in filter map syntax</p></li><li><p>[<a href="Ash.Filter.xhtml"><code class="inline">Ash.Filter</code></a>] handle case where <code class="inline">%{or</code> is composing a single map</p></li><li><p>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] ensure that <code class="inline">subject</code> is properly set when running field policies</p></li><li><p>[<a href="Ash.Type.xhtml"><code class="inline">Ash.Type</code></a>] fix logic errors in matches_type?/list logic</p></li><li><p>[pagination] add tenant to Aggregate opts when building count query (#1630)</p></li><li><p>[notifications] some notifications not being sent for bulk create actions</p></li><li><p>[validations] negate atomic validation expressions when used as <code class="inline">where</code> conditions (#1624)</p></li><li><p>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] don't double apply action-filters when attaching policy filters (optimization)</p></li><li><p>[<code class="inline">Ash.read</code>] Fix not working skip_unknown_inputs opt of read action (#1596)</p></li><li><p>[<code class="inline">Ash.read</code>] Fix warning when actions.read.argument constraint is violated (#1607)</p></li><li><p>[aggregates] use last relationship's read action properly in aggregate queries</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] finish conversion from <code class="inline">append?</code> to <code class="inline">prepend?</code> option (#1601)</p></li></ul><h3 id="improvements-46">Improvements:</h3><ul><li><p>[<a href="Ash.Type.NewType.xhtml"><code class="inline">Ash.Type.NewType</code></a>] add <code class="inline">lazy_init?</code> option. Allows for recursive embedded types.</p></li><li><p>[<a href="Mix.Tasks.Ash.Gen.Resource.xhtml"><code class="inline">mix ash.gen.resource</code></a>] More Descriptive Error Messages for ash.gen.resource (#1645)</p></li><li><p>[<a href="Ash.Expr.xhtml"><code class="inline">Ash.Expr</code></a>] better type signatures for division</p></li><li><p>[<a href="Ash.Expr.xhtml"><code class="inline">Ash.Expr</code></a>] converge on known types better</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] add <a href="Ash.Changeset.xhtml#force_delete_argument/2"><code class="inline">Ash.Changeset.force_delete_argument/2</code></a></p></li><li><p>[<a href="Ash.Policy.Check.Builtins.xhtml"><code class="inline">Ash.Policy.Check.Builtins</code></a>] add <code class="inline">actor_absent</code> builtin check</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] Warn when <code class="inline">manage_relationship</code> is called without opts (#1408)</p></li><li><p>[<a href="Ash.Resource.Validation.Builtins.xhtml"><code class="inline">Ash.Resource.Validation.Builtins</code></a>] use Comp with attribute_equals and attribute_does_not_equal (#1623)</p></li></ul><h2 id="v3-4-43-2024-11-20"><a href="https://github.com/ash-project/ash/compare/v3.4.42...v3.4.43">v3.4.43</a> (2024-11-20)</h2><h3 id="bug-fixes-63">Bug Fixes:</h3><ul><li>[generic actions] store notifications from simple results (#1591)</li></ul><h2 id="v3-4-42-2024-11-07"><a href="https://github.com/ash-project/ash/compare/v3.4.41...v3.4.42">v3.4.42</a> (2024-11-07)</h2><h3 id="bug-fixes-64">Bug Fixes:</h3><ul><li><p>[<a href="Mix.Tasks.Ash.GenerateLivebook.xhtml"><code class="inline">mix ash.generate_livebook</code></a>] Allow multi-line descriptions to be rendered in Livebook without error (#1590)</p></li><li><p>[<a href="Ash.Policy.Check.ChangingAttributes.xhtml"><code class="inline">Ash.Policy.Check.ChangingAttributes</code></a>] properly handle <code class="inline">changing_attributes</code> check with <code class="inline">from</code> in create (#1584)</p></li></ul><h3 id="improvements-47">Improvements:</h3><ul><li>[<a href="Ash.Type.Union.xhtml"><code class="inline">Ash.Type.Union</code></a>] support map w/ keys <code class="inline">_union_type</code> and <code class="inline">_union_value</code> for union inputs</li></ul><h2 id="v3-4-41-2024-11-05"><a href="https://github.com/ash-project/ash/compare/v3.4.40...v3.4.41">v3.4.41</a> (2024-11-05)</h2><h3 id="bug-fixes-65">Bug Fixes:</h3><ul><li><p>[<a href="Ash.Type.Struct.xhtml"><code class="inline">Ash.Type.Struct</code></a>] don't double wrap casted struct instances in <code class="inline">{:ok, {:ok, ...}}</code></p></li><li><p>[<a href="Ash.Type.Struct.xhtml"><code class="inline">Ash.Type.Struct</code></a>] support mixed key types in input maps for structs</p></li></ul><h2 id="v3-4-40-2024-11-04"><a href="https://github.com/ash-project/ash/compare/v3.4.39...v3.4.40">v3.4.40</a> (2024-11-04)</h2><h3 id="bug-fixes-66">Bug Fixes:</h3><ul><li><p>[<code class="inline">Ash.Actions.Read</code>] don't call <code class="inline">.name</code> on a potentially <code class="inline">nil</code> action</p></li><li><p>[<a href="Ash.Expr.xhtml"><code class="inline">Ash.Expr</code></a>] properly detect <a href="Ash.CustomExpression.xhtml"><code class="inline">Ash.CustomExpression</code></a> as an expr</p></li><li><p>[<a href="Ash.Expr.xhtml"><code class="inline">Ash.Expr</code></a>] accept fragments pointing at non-aliases</p></li><li><p>[<a href="Ash.Expr.xhtml"><code class="inline">Ash.Expr</code></a>] smarter type detection, preferring more concrete types</p></li></ul><h2 id="v3-4-39-2024-11-01"><a href="https://github.com/ash-project/ash/compare/v3.4.38...v3.4.39">v3.4.39</a> (2024-11-01)</h2><h3 id="bug-fixes-67">Bug Fixes:</h3><ul><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] emit warnings about already validated actions in before_action hooks too</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] add missing case clause for <code class="inline">Changeset.atomic_update</code> type cast (#1569)</p></li><li><p>[<a href="Ash.Type.Map.xhtml"><code class="inline">Ash.Type.Map</code></a>] handle case of invalid map/keyword key when type casting</p></li><li><p>[<a href="Ash.Type.Keyword.xhtml"><code class="inline">Ash.Type.Keyword</code></a>] handle case of invalid map/keyword key when type casting</p></li></ul><h3 id="improvements-48">Improvements:</h3><ul><li>[error messages] more better error bread crumbs</li></ul><h2 id="v3-4-38-2024-10-31"><a href="https://github.com/ash-project/ash/compare/v3.4.37...v3.4.38">v3.4.38</a> (2024-10-31)</h2><h3 id="bug-fixes-68">Bug Fixes:</h3><ul><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] detect transaction hooks added by around_transaction and before_transaction &amp; manual actions</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] don't special case <code class="inline">nil</code> change on <code class="inline">force_change_attribute</code></p></li></ul><h3 id="improvements-49">Improvements:</h3><ul><li><p>[<a href="Ash.Domain.xhtml"><code class="inline">Ash.Domain</code></a>] default backwards compatible interface to false for domains</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>, create actions] more and better bread crumbs for changesets &amp; create actions</p></li></ul><h2 id="v3-4-37-2024-10-30"><a href="https://github.com/ash-project/ash/compare/v3.4.36...v3.4.37">v3.4.37</a> (2024-10-30)</h2><h3 id="bug-fixes-69">Bug Fixes:</h3><ul><li><p>[<a href="Ash.Type.Union.xhtml"><code class="inline">Ash.Type.Union</code></a>] handle nil union changing to nil</p></li><li><p>[multitenancy] enforce multitenancy on bulk creation</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] force_change_attribute no longer cares what the old value is</p></li></ul><h3 id="improvements-50">Improvements:</h3><ul><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] allow specifying <code class="inline">return_skipped_upsert?</code> as an option to changeset</p></li><li><p>[<a href="Ash.DataLayer.xhtml"><code class="inline">Ash.DataLayer</code></a>] add <code class="inline">prefer_transaction_for_atomic_updates?</code> data layer callback</p></li><li><p>[<a href="Ash.DataLayer.xhtml"><code class="inline">Ash.DataLayer</code></a>] support <code class="inline">prefer_transaction?</code> on DataLayer</p></li><li><p>[loading data] allow data loading when no primary read action exists</p></li></ul><h2 id="v3-4-36-2024-10-24"><a href="https://github.com/ash-project/ash/compare/v3.4.35...v3.4.36">v3.4.36</a> (2024-10-24)</h2><h3 id="bug-fixes-70">Bug Fixes:</h3><ul><li>[<code class="inline">Ash.stream!</code>] ensure opts are passed through to constructed query in stream</li></ul><h3 id="improvements-51">Improvements:</h3><ul><li>[<a href="Ash.Policy.Check.Builtins.xhtml"><code class="inline">Ash.Policy.Check.Builtins</code></a>] add <code class="inline">just_created_with_action/1</code> check</li></ul><h2 id="v3-4-35-2024-10-22"><a href="https://github.com/ash-project/ash/compare/v3.4.34...v3.4.35">v3.4.35</a> (2024-10-22)</h2><h3 id="bug-fixes-71">Bug Fixes:</h3><ul><li><p>[code interfaces] allow optional code interface args for fields with defaults</p></li><li><p>[atomic updates] write all attributes to atomics list before dispatching to data layer on update query</p></li><li><p>[<a href="Mix.Tasks.Ash.Gen.Resource.xhtml"><code class="inline">mix ash.gen.resource</code></a>] remove multichar aliases from <a href="Mix.Tasks.Ash.Gen.Resource.xhtml"><code class="inline">mix ash.gen.resource</code></a></p></li><li><p>[<a href="Ash.Type.Decimal.xhtml"><code class="inline">Ash.Type.Decimal</code></a>] check nil before calling Decimal.eq? in Type.Decimal.equal? (#1538)</p></li></ul><h2 id="v3-4-34-2024-10-21"><a href="https://github.com/ash-project/ash/compare/v3.4.33...v3.4.34">v3.4.34</a> (2024-10-21)</h2><h3 id="bug-fixes-72">Bug Fixes:</h3><ul><li>[<a href="Mix.Tasks.Ash.Gen.Resource.xhtml"><code class="inline">mix ash.gen.resource</code></a>] properly accept options for <code class="inline">ash.gen.resource</code> in installer</li></ul><h2 id="v3-4-33-2024-10-18"><a href="https://github.com/ash-project/ash/compare/v3.4.32...v3.4.33">v3.4.33</a> (2024-10-18)</h2><h3 id="bug-fixes-73">Bug Fixes:</h3><ul><li><p>[bulk updates] apply attribute multitenancy on bulk update queries</p></li><li><p>[<a href="Ash.Type.Decimal.xhtml"><code class="inline">Ash.Type.Decimal</code></a>] use Decimal.eq? in Ash.Type.Decimal (#1532)</p></li><li><p>[<a href="Ash.Reactor.xhtml"><code class="inline">Ash.Reactor</code></a>]: Don't validate <code class="inline">inputs</code> keys when being transformed. (#1527)</p></li><li><p>[atomic updates] set argument defaults in fully atomic changesets</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] ensure that default values are included in attribute changes</p></li><li><p>[manage_relationship] properly unrelate belongs_to relationships</p></li><li><p>[manage_relationship] ensure unrelated records are removed from the current records list</p></li></ul><h3 id="improvements-52">Improvements:</h3><ul><li><p>[<a href="Ash.Resource.xhtml"><code class="inline">Ash.Resource</code></a>] Conditionally enable transactions on default actions. (#1525)</p></li><li><p>[<a href="Ash.Seed.xhtml"><code class="inline">Ash.Seed</code></a>] ash seed upsert! function (#1522)</p></li><li><p>[code interfaces] Add compile-time checks for <code class="inline">code_interface</code> arguments in Resource and Domain (#1523)</p></li></ul><h2 id="v3-4-32-2024-10-14"><a href="https://github.com/ash-project/ash/compare/v3.4.31...v3.4.32">v3.4.32</a> (2024-10-14)</h2><h3 id="improvements-53">Improvements:</h3><ul><li>[<a href="Mix.Tasks.Ash.Gen.Resource.xhtml"><code class="inline">mix ash.gen.resource</code></a>] use new <code class="inline">:csv</code> option type from igniter</li></ul><h2 id="v3-4-31-2024-10-14"><a href="https://github.com/ash-project/ash/compare/v3.4.30...v3.4.31">v3.4.31</a> (2024-10-14)</h2><h3 id="bug-fixes-74">Bug Fixes:</h3><ul><li>[all actions] allow strings in generic action skip_unknown_inputs</li></ul><h2 id="v3-4-30-2024-10-14"><a href="https://github.com/ash-project/ash/compare/v3.4.29...v3.4.30">v3.4.30</a> (2024-10-14)</h2><h3 id="bug-fixes-75">Bug Fixes:</h3><ul><li>[all actions] add <code class="inline">tracer</code> option to generic action opts</li></ul><h2 id="v3-4-29-2024-10-13"><a href="https://github.com/ash-project/ash/compare/v3.4.28...v3.4.29">v3.4.29</a> (2024-10-13)</h2><h3 id="bug-fixes-76">Bug Fixes:</h3><ul><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] clear change from atomics as well</p></li><li><p>[read actions] properly invoke notify callback in read actions</p></li></ul><h3 id="improvements-54">Improvements:</h3><ul><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] better ergonomics for atomic updates</p></li><li><p>[changeset, action inputs, queries] add <code class="inline">private_arguments</code> option</p></li><li><p>[<a href="Ash.ActionInput.xhtml"><code class="inline">Ash.ActionInput</code></a>] validate <code class="inline">Ash.ActionInput.for_action</code> opts</p></li><li><p>[<a href="Ash.Type.NewType.xhtml"><code class="inline">Ash.Type.NewType</code></a>] allow additional callbacks in <a href="Ash.Type.NewType.xhtml"><code class="inline">Ash.Type.NewType</code></a></p></li></ul><h2 id="v3-4-28-2024-10-10"><a href="https://github.com/ash-project/ash/compare/v3.4.27...v3.4.28">v3.4.28</a> (2024-10-10)</h2><h3 id="improvements-55">Improvements:</h3><ul><li>[upserts] support lazy evaluation of skipped upsert records</li></ul><h2 id="v3-4-27-2024-10-10"><a href="https://github.com/ash-project/ash/compare/v3.4.26...v3.4.27">v3.4.27</a> (2024-10-10)</h2><h3 id="improvements-56">Improvements:</h3><ul><li>[upserts] emit StaleRecordError on skipped upsert</li></ul><h2 id="v3-4-26-2024-10-08"><a href="https://github.com/ash-project/ash/compare/v3.4.25...v3.4.26">v3.4.26</a> (2024-10-08)</h2><h3 id="bug-fixes-77">Bug Fixes:</h3><ul><li><p>[query building] properly hydrate sort with parent context</p></li><li><p>[query building] handle nested parent references in runtime expression logic</p></li><li><p>[query building] set parent stack when hydrating references in related queries</p></li></ul><h2 id="v3-4-25-2024-10-07"><a href="https://github.com/ash-project/ash/compare/v3.4.24...v3.4.25">v3.4.25</a> (2024-10-07)</h2><h3 id="bug-fixes-78">Bug Fixes:</h3><ul><li><p>[igniter] honor --yes or -y option when adding a satsolver</p></li><li><p>[query building] don't error on type casting against expressions</p></li></ul><h2 id="v3-4-24-2024-10-07"><a href="https://github.com/ash-project/ash/compare/v3.4.23...v3.4.24">v3.4.24</a> (2024-10-07)</h2><h3 id="bug-fixes-79">Bug Fixes:</h3><ul><li><p>[policies] short-circuit policy condition evaluation when checking all conditions</p></li><li><p>[query building] properly hydrate aggregate calculations &amp; fields</p></li></ul><h3 id="improvements-57">Improvements:</h3><ul><li>[policies] re-introduce removed behavior to short circuit policy conditions</li></ul><h2 id="v3-4-23-2024-10-03"><a href="https://github.com/ash-project/ash/compare/v3.4.22...v3.4.23">v3.4.23</a> (2024-10-03)</h2><h3 id="bug-fixes-80">Bug Fixes:</h3><ul><li><p>[loading data] don't rewrite calculation dependencies through not loaded/forbidden fields</p></li><li><p>[loading data] honor <code class="inline">reuse_values?</code> when lazy loading relationships</p></li></ul><h2 id="v03-4-22-2024-10-01"><a href="https://github.com/ash-project/ash/compare/v3.4.21...v03.4.22">v03.4.22</a> (2024-10-01)</h2><h3 id="features-1">Features:</h3><ul><li>[<a href="Ash.Reactor.xhtml"><code class="inline">Ash.Reactor</code></a>] Add the ability to specify action context in steps. (#1477)</li></ul><h3 id="bug-fixes-81">Bug Fixes:</h3><ul><li><p>[<a href="Ash.Query.xhtml"><code class="inline">Ash.Query</code></a>] properly merge query calculations when one side is empty</p></li><li><p>[<a href="Ash.Query.xhtml"><code class="inline">Ash.Query</code></a>] remove expensive calculation reification step that is no longer necessary</p></li><li><p>[<a href="Ash.Sort.xhtml"><code class="inline">Ash.Sort</code></a>] handle expression calculations that reference fields in input sorting</p></li><li><p>[<a href="Ash.Sort.xhtml"><code class="inline">Ash.Sort</code></a>] properly apply field policies to all filter expressions</p></li><li><p>[<a href="Ash.Type.Struct.xhtml"><code class="inline">Ash.Type.Struct</code></a>] better error message on missing <code class="inline">instance_of</code> constraint on load-through</p></li><li><p>[authorization] select minimal data in authorization queries</p></li><li><p>[<a href="Ash.Query.xhtml"><code class="inline">Ash.Query</code></a>] calling <code class="inline">for_read/2..4</code> should raise an <a href="https://hexdocs.pm/elixir/ArgumentError.html"><code class="inline">ArgumentError</code></a> when the specified action doesn't exist. (#1479)</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] detect non-changing but setting attributes to honor <code class="inline">require_attributes</code> on update</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] set right defaults for <code class="inline">action_select</code> (#1476)</p></li><li><p>[<a href="Ash.Expr.xhtml"><code class="inline">Ash.Expr</code></a>] don't resolve references when falling back to elixir handling for expressions</p></li></ul><h3 id="improvements-58">Improvements:</h3><ul><li><p>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] disallow 2-tuple expression checks, to resolve ambiguity</p></li><li><p>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] rewrite and drastically simplify policy -&gt; solver expression logic</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] properly handle bypasses of atomic constraint casting</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] ensure that action_select sets attributes to <code class="inline">%Ash.NotLoaded{}</code></p></li><li><p>[<a href="Ash.Query.Calculation.xhtml"><code class="inline">Ash.Query.Calculation</code></a>] add <code class="inline">Ash.Query.Calculation.from_resource_calculation</code></p></li><li><p>[<a href="Ash.Query.Calculation.xhtml"><code class="inline">Ash.Query.Calculation</code></a>] fallback to runtime calculations when expressions aren't supported</p></li><li><p>[<a href="Ash.Type.DateTime.xhtml"><code class="inline">Ash.Type.DateTime</code></a>] handle iso8601 dates in datetime cast</p></li><li><p>[<a href="Ash.DataLayer.xhtml"><code class="inline">Ash.DataLayer</code></a>] add data layer capability for action select</p></li><li><p>[<a href="Ash.Query.Calculation.xhtml"><code class="inline">Ash.Query.Calculation</code></a>] inspect calculations in queries more fluidly</p></li><li><p>[<a href="Ash.Resource.Igniter.xhtml"><code class="inline">Ash.Resource.Igniter</code></a>] add_identity for <a href="Ash.Resource.Igniter.xhtml"><code class="inline">Ash.Resource.Igniter</code></a></p></li></ul><h2 id="v3-4-21-2024-09-24"><a href="https://github.com/ash-project/ash/compare/v3.4.20...v3.4.21">v3.4.21</a> (2024-09-24)</h2><h3 id="bug-fixes-82">Bug Fixes:</h3><ul><li><p>[<a href="Ash.xhtml"><code class="inline">Ash</code></a>] handle <code class="inline">nil</code> result in <code class="inline">Ash.first</code></p></li><li><p>[bulk actions] add checks for <code class="inline">around_transaction</code> and <code class="inline">around_action</code> in bulk (#1474)</p></li><li><p>[<a href="Ash.Query.Aggregate.xhtml"><code class="inline">Ash.Query.Aggregate</code></a>] include distinct from queries in aggregate query</p></li><li><p>[read actions] reselect required attributes unless <code class="inline">reuse_values?</code> is <code class="inline">true</code></p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] properly return <code class="inline">{:not_atomic</code> while applying atomic changes</p></li></ul><h3 id="improvements-59">Improvements:</h3><ul><li>[<a href="Ash.Query.Aggregate.xhtml"><code class="inline">Ash.Query.Aggregate</code></a>] proper error on unsupported aggregates</li></ul><h2 id="v3-4-20-2024-09-23"><a href="https://github.com/ash-project/ash/compare/v3.4.19...v3.4.20">v3.4.20</a> (2024-09-23)</h2><h3 id="bug-fixes-83">Bug Fixes:</h3><ul><li>[read actions] don't double-load data on bulk update reads</li></ul><h3 id="improvements-60">Improvements:</h3><ul><li><p>[<a href="Ash.xhtml"><code class="inline">Ash</code></a>] support more formats in <code class="inline">Ash.can</code></p></li><li><p>[<a href="Ash.xhtml"><code class="inline">Ash</code></a>] add <code class="inline">validate?</code> option to <code class="inline">Ash.can</code>/<code class="inline">Ash.can?</code></p></li></ul><h2 id="v3-4-19-2024-09-21"><a href="https://github.com/ash-project/ash/compare/v3.4.18...v3.4.19">v3.4.19</a> (2024-09-21)</h2><h3 id="bug-fixes-84">Bug Fixes:</h3><ul><li>[<a href="Ash.Resource.xhtml"><code class="inline">Ash.Resource</code></a>] properly generate bypasses with <code class="inline">Ash.Resource.Igniter.add_bypass/2</code></li></ul><h3 id="improvements-61">Improvements:</h3><ul><li><p>[<a href="Ash.Sort.xhtml"><code class="inline">Ash.Sort</code></a>] support nested fields in input sorts</p></li><li><p>[optimization] optimize the reselection of necessary attributes on lazy loading</p></li><li><p>[<a href="Ash.Resource.xhtml"><code class="inline">Ash.Resource</code></a>, optimization] optimize <a href="Ash.Resource.xhtml#selected?/2"><code class="inline">Ash.Resource.selected?/2</code></a> in light of 3.0 changes</p></li></ul><h2 id="v3-4-18-2024-09-20"><a href="https://github.com/ash-project/ash/compare/v3.4.17...v3.4.18">v3.4.18</a> (2024-09-20)</h2><h3 id="bug-fixes-85">Bug Fixes:</h3><ul><li><p>[<a href="Ash.Resource.Change.OptimisticLock.xhtml"><code class="inline">Ash.Resource.Change.OptimisticLock</code></a>] properly increment version in optimist lock's non-atomic branch</p></li><li><p>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] ensure that policy group compile time validations are enforced</p></li><li><p>[bulk updates] ensure that around_transaction and around_action hooks incur simple updates</p></li></ul><h2 id="v3-4-17-2024-09-19"><a href="https://github.com/ash-project/ash/compare/v3.4.16...v3.4.17">v3.4.17</a> (2024-09-19)</h2><h3 id="bug-fixes-86">Bug Fixes:</h3><ul><li><p>[<a href="Ash.Query.xhtml"><code class="inline">Ash.Query</code></a>] handle more types in <code class="inline">Ash.Query.unload</code></p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] properly escape changeset.select in <code class="inline">Ash.Changeset.ensure_selected</code> (#1466)</p></li></ul><h3 id="improvements-62">Improvements:</h3><ul><li><p>[<a href="Ash.Tracer.xhtml"><code class="inline">Ash.Tracer</code></a>] add span &amp; telemetry events for running calculations</p></li><li><p>[<a href="Ash.Policy.Check.Builtins.xhtml"><code class="inline">Ash.Policy.Check.Builtins</code></a>] validate action types in <code class="inline">action_type</code> check</p></li></ul><h2 id="v3-4-16-2024-09-18"><a href="https://github.com/ash-project/ash/compare/v3.4.15...v3.4.16">v3.4.16</a> (2024-09-18)</h2><h3 id="bug-fixes-87">Bug Fixes:</h3><ul><li>[<a href="Ash.Seed.xhtml"><code class="inline">Ash.Seed</code></a>] ensure Ash.Seed always sets action_select</li></ul><h3 id="improvements-63">Improvements:</h3><ul><li><p>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] properly log successful policy breakdowns with extra info</p></li><li><p>[<a href="Ash.Filter.xhtml"><code class="inline">Ash.Filter</code></a>] add <code class="inline">Ash.Filter.fetch_simple_equality_predicate</code></p></li></ul><h2 id="v3-4-15-2024-09-17"><a href="https://github.com/ash-project/ash/compare/v3.4.14...v3.4.15">v3.4.15</a> (2024-09-17)</h2><h3 id="improvements-64">Improvements:</h3><ul><li>[<a href="Ash.Query.xhtml"><code class="inline">Ash.Query</code></a>] add <code class="inline">load</code> option to <code class="inline">Ash.Query.for_read</code></li></ul><h2 id="v3-4-14-2024-09-17"><a href="https://github.com/ash-project/ash/compare/v3.4.13...v3.4.14">v3.4.14</a> (2024-09-17)</h2><h3 id="bug-fixes-88">Bug Fixes:</h3><ul><li>[<a href="Mix.Tasks.Ash.Gen.Domain.xhtml"><code class="inline">mix ash.gen.domain</code></a>] properly detect domains that don't exist yet in <code class="inline">ash.gen.domain</code></li></ul><h2 id="v3-4-13-2024-09-17"><a href="https://github.com/ash-project/ash/compare/v3.4.12...v3.4.13">v3.4.13</a> (2024-09-17)</h2><h3 id="bug-fixes-89">Bug Fixes:</h3><ul><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] honor <code class="inline">skip_global_validations?</code> on fully atomic changesets</p></li><li><p>[<a href="Ash.Sort.xhtml"><code class="inline">Ash.Sort</code></a>] ensure calculation context is fully propagated to sort statements</p></li><li><p>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] ensure that <code class="inline">resource</code> context is set for expanding filter descriptions</p></li></ul><h2 id="v3-4-12-2024-09-16"><a href="https://github.com/ash-project/ash/compare/v3.4.11...v3.4.12">v3.4.12</a> (2024-09-16)</h2><h3 id="bug-fixes-90">Bug Fixes:</h3><ul><li>[<a href="Ash.Seed.xhtml"><code class="inline">Ash.Seed</code></a>] ensure that action_select is set on seeding data</li></ul><h3 id="improvements-65">Improvements:</h3><ul><li><p>[<a href="Ash.Resource.Igniter.xhtml"><code class="inline">Ash.Resource.Igniter</code></a>] add more resource updating logic</p></li><li><p>[<a href="Ash.Resource.Igniter.xhtml"><code class="inline">Ash.Resource.Igniter</code></a>] add <code class="inline">_new</code> options for Ash.Resource.Igniter</p></li></ul><h2 id="v3-4-11-2024-09-13"><a href="https://github.com/ash-project/ash/compare/v3.4.10...v3.4.11">v3.4.11</a> (2024-09-13)</h2><h3 id="improvements-66">Improvements:</h3><ul><li>[igniter] update igniter and fix deprecation warnings</li></ul><h2 id="v3-4-10-2024-09-13"><a href="https://github.com/ash-project/ash/compare/v3.4.9...v3.4.10">v3.4.10</a> (2024-09-13)</h2><h3 id="bug-fixes-91">Bug Fixes:</h3><ul><li>[<a href="Mix.Tasks.Ash.Patch.Extend.xhtml"><code class="inline">mix ash.patch.extend</code></a>] properly add all types of extensions in <a href="Mix.Tasks.Ash.Patch.Extend.xhtml"><code class="inline">mix ash.patch.extend</code></a></li></ul><h2 id="v3-4-9-2024-09-13"><a href="https://github.com/ash-project/ash/compare/v3.4.8...v3.4.9">v3.4.9</a> (2024-09-13)</h2><h3 id="bug-fixes-92">Bug Fixes:</h3><ul><li><p>[field policies] ensure that field policies don't interfere with relationship loading</p></li><li><p>[bulk actions] properly merge provided context in atomic bulk actions</p></li><li><p>[managed relationships] properly handle rollbacks from <code class="inline">DBConnection</code> failures for belongs to relationships</p></li><li><p>[<a href="Ash.Resource.Igniter.xhtml"><code class="inline">Ash.Resource.Igniter</code></a>] don't generate doubly nested policies when adding policies in igniter</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] fix Ash.Changeset.manage_relationships/4 for list primary keys (#1455)</p></li><li><p>[<a href="Ash.Filter.xhtml"><code class="inline">Ash.Filter</code></a>] Handle Ash.Query.filter for array values (#1452)</p></li><li><p>[<a href="Ash.Type.Time.xhtml"><code class="inline">Ash.Type.Time</code></a>] cast embedded time properly (#1451)</p></li><li><p>[create actions] require private/non-accepted attributes <em>after</em> before action hooks instead of <em>before</em></p></li><li><p>[built in after_action change] we cannot assume that <code class="inline">after_action/1</code> can be done atomically</p><p>Previously, when you did <code class="inline">change after_action/3</code> in a resource, we would assume it was safe to be done atomically.
But because we cannot guarantee that your hook does not access <code class="inline">changeset.data</code>, it is not safe to make that assumption.</p><p>Instead, you must define a module change, and explicitly define <code class="inline">atomic/3</code>.</p></li></ul><h3 id="improvements-67">Improvements:</h3><ul><li><p>[<a href="Ash.Error.Forbidden.Policy.xhtml"><code class="inline">Ash.Error.Forbidden.Policy</code></a>] small improvements for policy breakdown formatting</p></li><li><p>[<a href="Ash.Type.Union.xhtml"><code class="inline">Ash.Type.Union</code></a>] honor a <code class="inline">_union_type</code> type param when casting unions</p></li><li><p>[create/update/destroy actions] add system for <code class="inline">action_select</code>, which can limit selects from mutations</p><p>Callers can <code class="inline">select</code> when calling create/update/destroy actions, but those selects were not previously honored
by data layers. The reason for this is that often actions will require more fields than the fields that the caller
requests. Now, you can specify <code class="inline">action_select</code> in the action, and the data layer will honor that.</p><p>Additionally, the new <code class="inline">select_by_default?</code> flag on attributes causes the attribute to automatically not be selected
for update actions.</p></li><li><p>[attributes] support <code class="inline">select_by_default?</code> flag on attributes. This defaults to <code class="inline">true</code>.</p></li></ul><h2 id="v3-4-8-2024-09-09"><a href="https://github.com/ash-project/ash/compare/v3.4.7...v3.4.8">v3.4.8</a> (2024-09-09)</h2><h3 id="bug-fixes-93">Bug Fixes:</h3><ul><li><p>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] support passing a forbidden error for policy breakdowns per the docs</p></li><li><p>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] don't report the action as the actor for policy breakdowns</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a>] check <code class="inline">changeset.action</code> before raising a required primary action error</p></li><li><p>[bulk actions] ensure proper return types for <code class="inline">:stream</code> strategy bulk update/destroys</p></li></ul><h2 id="v3-4-7-2024-09-06"><a href="https://github.com/ash-project/ash/compare/v3.4.6...v3.4.7">v3.4.7</a> (2024-09-06)</h2><h3 id="improvements-68">Improvements:</h3><ul><li>[<a href="Ash.Resource.Igniter.xhtml"><code class="inline">Ash.Resource.Igniter</code></a>] add <code class="inline">add_bypass</code> and <code class="inline">add_policy</code> igniter utilities</li></ul><h2 id="v3-4-6-2024-09-06"><a href="https://github.com/ash-project/ash/compare/v3.4.5...v3.4.6">v3.4.6</a> (2024-09-06)</h2><h3 id="bug-fixes-94">Bug Fixes:</h3><ul><li><p>[loading relationships] don't select destination attributes that don't exist</p></li><li><p>[<a href="Ash.Filter.Runtime.xhtml"><code class="inline">Ash.Filter.Runtime</code></a>] properly pass actor when running filters at runtime</p></li><li><p>[<a href="Ash.Type.Struct.xhtml"><code class="inline">Ash.Type.Struct</code></a>] misplaced curly bracket when handling struct type casting</p></li><li><p>[bulk/atomic updates] properly leverage atomic upgrade read action for an update action</p></li></ul><h3 id="improvements-69">Improvements:</h3><ul><li><p>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] show informative error explaining the use of filter checks with create actions</p></li><li><p>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] show the actor's primary key in policy breakdowns</p></li><li><p>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] add an expanded description option to checks</p></li><li><p>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] use expanded description to display filled in filter templates in policy breakdowns</p></li><li><p>[<a href="Ash.Changeset.xhtml"><code class="inline">Ash.Changeset</code></a> ] Add <a href="Ash.Changeset.xhtml#is_valid/1"><code class="inline">Ash.Changeset.is_valid/1</code></a> guard. (#1437)</p></li></ul><h2 id="v3-4-5-2024-09-05"><a href="https://github.com/ash-project/ash/compare/v3.4.4...v3.4.5">v3.4.5</a> (2024-09-05)</h2><h3 id="bug-fixes-95">Bug Fixes:</h3><ul><li>[update actions] fix type definition for <code class="inline">atomic_upgrade_with</code></li></ul><h2 id="v3-4-4-2024-09-05"><a href="https://github.com/ash-project/ash/compare/v3.4.3...v3.4.4">v3.4.4</a> (2024-09-05)</h2><h2 id="v3-4-3-2024-09-04"><a href="https://github.com/ash-project/ash/compare/v3.4.2...v3.4.3">v3.4.3</a> (2024-09-04)</h2><h3 id="bug-fixes-96">Bug Fixes:</h3><ul><li>[loading relationships] properly await tasks from lazy loading multiple relationships</li></ul><h2 id="v3-4-2-2024-09-04"><a href="https://github.com/ash-project/ash/compare/v3.4.1...v3.4.2">v3.4.2</a> (2024-09-04)</h2><h3 id="bug-fixes-97">Bug Fixes:</h3><ul><li><p>[soft destroys] honor <code class="inline">return_destroyed?</code> in soft destroy actions</p></li><li><p>[<a href="Ash.Resource.Change.xhtml"><code class="inline">Ash.Resource.Change</code></a>] correctly handle return values of batch callbacks (#1424)</p></li><li><p>[read actions] ensure that async limiter is cleared up front</p></li><li><p>[bulk creates] honor bulk upsert condition (#1432)</p></li><li><p>[bulk updates] ensure that update_defaults are set on streaming updates</p></li><li><p>[bulk actions] honor <code class="inline">skip_global_validations?</code> in bulk actions</p></li><li><p>[pagination] honor the <code class="inline">countable</code> option in pagination</p></li><li><p>[read actions] return proper data shape when doing a read in a transaction</p></li><li><p>[notifications] ensure that <code class="inline">from</code> is properly set on all notifications</p></li><li><p>[notifications] fix typo in bulk destroy not clearing ash_started_transaction state</p></li><li><p>[calculations] traverse calculated relationships when rewriting transient calculation values</p></li><li><p>[calculations] don't unload calculation dependencies when <code class="inline">lazy?</code> is set</p></li><li><p>[<a href="Ash.DataLayer.Ets.xhtml"><code class="inline">Ash.DataLayer.Ets</code></a>] handle no_attributes when joining lateral join relationship data</p></li><li><p>[<a href="Ash.DataLayer.Ets.xhtml"><code class="inline">Ash.DataLayer.Ets</code></a>] fix ets lateral join source field usage</p></li><li><p>[<a href="Ash.DataLayer.Ets.xhtml"><code class="inline">Ash.DataLayer.Ets</code></a>] properly apply distinct in ets</p></li></ul><h3 id="improvements-with-backwards-compatibility-configurations">Improvements with backwards compatibility configurations</h3><p>These configurations default to the current behavior, but in 4.0 (someday) will
be removed, and the new option will be the only option.</p><ul><li>[pagination] make default page type configurable, defaulting to <code class="inline">:offset</code>.</li></ul><pre><code class="makeup elixir" translate="no"><span class="c1"># set this configuration to adopt the new preferred behavior</span><span class="w">
</span><span class="n">config</span><span class="w"> </span><span class="ss">:ash</span><span class="p">,</span><span class="w">
  </span><span class="ss">default_page_type</span><span class="p">:</span><span class="w"> </span><span class="ss">:keyset</span></code></pre><ul><li>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] make read policies more consistent, always preferring to filter over raise</li></ul><p>Currently, some read actions can still return a <code class="inline">Forbidden</code> error, even
though policies are meant to filter out records by default. Now, it will always
filter, unless you set <code class="inline">access_type :strict</code> in the policy.</p><pre><code class="makeup elixir" translate="no"><span class="c1"># set this configuration to adopt the new preferred behavior</span><span class="w">
</span><span class="n">config</span><span class="w"> </span><span class="ss">:ash</span><span class="p">,</span><span class="w"> </span><span class="ss">:policies</span><span class="p">,</span><span class="w">
  </span><span class="ss">no_filter_static_forbidden_reads?</span><span class="p">:</span><span class="w"> </span><span class="no">false</span></code></pre><h3 id="improvements-70">Improvements:</h3><ul><li><p>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] show an explanation when a forbidden is because no policies applied</p></li><li><p>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] error at compile for bypasses that will have no effect</p></li><li><p>[<a href="Ash.Resource.ManualRead.xhtml"><code class="inline">Ash.Resource.ManualRead</code></a>] add <code class="inline">load_relationships/5</code> callback to manual reads</p></li><li><p>[<a href="Mix.Tasks.Ash.Gen.Resource.xhtml"><code class="inline">mix ash.gen.resource</code></a>] add <code class="inline">uuid-v7-primary-key</code> option to <a href="Mix.Tasks.Ash.Gen.Resource.xhtml"><code class="inline">mix ash.gen.resource</code></a></p></li><li><p>[<a href="Ash.Resource.Change.CascadeUpdate.xhtml"><code class="inline">Ash.Resource.Change.CascadeUpdate</code></a>] add cascade update built in change (#1398)</p></li><li><p>[<a href="Ash.Resource.Change.CascadeDestroy.xhtml"><code class="inline">Ash.Resource.Change.CascadeDestroy</code></a>] add <code class="inline">read_action</code> option to <code class="inline">cascade_destroy</code></p></li><li><p>[inline aggregates] support <code class="inline">expr</code> and <code class="inline">expr_type</code> options when building aggregates</p></li><li><p>[create actions] Implement condition for upsert (#1386)</p></li><li><p>[optimization] do not add relationship filter when building relationship authorization</p></li><li><p>[optimization] don't list telemetry handlers if app is compiling</p></li><li><p>[optimization] do not call tracer <code class="inline">set_metadata</code> with span type that it ignores (#1400)</p></li><li><p>[optimization] optimize filter expr traversal</p></li><li><p>[optimization] Add a case for handling mapsets in Filter.map (#1427)</p></li><li><p>[optimization] Cache always selected fields and use mapsets for building select list (#1428)</p></li><li><p>[optimization] add pattern for Ash.Query.Call in Filter.map (#1416)</p></li><li><p>[optimization] prevent unnecessary calls to <code class="inline">Ash.load</code></p></li><li><p>[optimization] cache action known inputs individually</p></li><li><p>[optimization] cache action required inputs all together</p></li><li><p>[optimization] optimize to avoid inspects in changesets</p></li><li><p>[optimization] optimize to avoid expensive <code class="inline">String.valid?</code> check in uuid type</p></li><li><p>[optimization] add <code class="inline">async?</code> option to calculations, default to false</p></li><li><p>[optimization] optimize field checking for loading fields in query</p></li><li><p>[optimization] allow functions in tracers for lazy loading metadata</p></li><li><p>[optimization] don't start processes for single items in list</p></li><li><p>[optimization] Optimize option validation with compile time validators (#1387)</p></li></ul><h2 id="v3-4-1-2024-08-13"><a href="https://github.com/ash-project/ash/compare/v3.4.0...v3.4.1">v3.4.1</a> (2024-08-13)</h2><h3 id="bug-fixes-98">Bug Fixes:</h3><ul><li>[authorization] properly pass actor, action, tenant etc. to lazy loaded relationships</li></ul><h2 id="v3-4-0-2024-08-12"><a href="https://github.com/ash-project/ash/compare/v3.3.3...v3.4.0">v3.4.0</a> (2024-08-12)</h2><h3 id="features-2">Features:</h3><ul><li><p>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] add policy groups</p></li><li><p>[authorization] support <code class="inline">authorize_with</code> option on <code class="inline">Ash.read</code>, allowing to error if any forbidden matching data exists</p></li><li><p>[<a href="Ash.Resource.xhtml"><code class="inline">Ash.Resource</code></a>] Add <code class="inline">@type t</code> typespec to resource if it doesn't exist</p></li></ul><h3 id="bug-fixes-99">Bug Fixes:</h3><ul><li><p>[calculations] remove pattern match error when exceptions come from calculations</p></li><li><p>[calculations] resolve nested expression calculation references in runtime filters</p></li><li><p>[arrays] Fix error with nil value on structure types (#1380)</p></li><li><p>[bulk actions] Pass options without :templated tuple to after_batch (#1376)</p></li><li><p>[bulk actions] <code class="inline">after_batch</code> arguments for <code class="inline">bulk_create</code> with <code class="inline">return_records?</code> disabled (#1371)</p></li><li><p>[bulk actions] set <code class="inline">upsert?</code> option when managing relationships in bulk creation</p></li><li><p>[<a href="Ash.Resource.xhtml"><code class="inline">Ash.Resource</code></a>] check for <code class="inline">nil</code> resource_calculation in <a href="Ash.Resource.xhtml#loaded?/2"><code class="inline">Ash.Resource.loaded?/2</code></a></p></li><li><p>[<a href="Ash.Expr.xhtml"><code class="inline">Ash.Expr</code></a>] properly consider not-loaded record calculations as <code class="inline">:unknown</code></p></li><li><p>[atomic updates] handle <code class="inline">nil</code> in atomic array casting</p></li><li><p>[aggregates] respect previously validated-for-action query for aggregates</p></li><li><p>[<a href="Mix.Tasks.Ash.Gen.Resource.xhtml"><code class="inline">mix ash.gen.resource</code></a>] use <code class="inline">timestamps()</code> instead of <code class="inline">timestamps</code></p></li><li><p>[belongs_to relationships] prefer <code class="inline">source_attribute</code> is required, instead of relationship name</p></li></ul><h3 id="improvements-71">Improvements:</h3><ul><li><p>[performance] optimizations around allocating strings</p></li><li><p>[performance] optimizations around list operations for embedded resources</p></li><li><p>[performance] prune calculations made unnecessary by field policies</p></li><li><p>[performance] add optimized path for casting embeds when they are simple</p></li><li><p>[performance] add <code class="inline">include_embedded_source_by_default?</code> config to optimize embeds</p></li><li><p>[error messages] show proper error message when trying to accept non-writable attributes</p></li><li><p>[error messages] add &quot;hints&quot; to <code class="inline">NoSuchInput</code> errors to make any errors clearer</p></li><li><p>[<a href="Ash.Expr.xhtml"><code class="inline">Ash.Expr</code></a>] warn on usage of <code class="inline">== nil</code></p></li><li><p>[<a href="Ash.Expr.xhtml"><code class="inline">Ash.Expr</code></a>] implement <a href="Comp.xhtml"><code class="inline">Comp</code></a> for atoms &amp; strings, comparing atoms as strings</p></li><li><p>[embedded resources] increase cases where embedded attribute can be updated atomically</p></li><li><p>[<a href="Ash.Type.Struct.xhtml"><code class="inline">Ash.Type.Struct</code></a>] support <code class="inline">:fields</code> constraint on <code class="inline">:struct</code> type, enabling persistence</p></li><li><p>[bulk actions] Warn on bulk action <code class="inline">return_stream?</code> without any other <code class="inline">return_*?</code> options enabled. (#1370)</p></li><li><p>[calculations] ensure the called calculation function is always in the stacktrace</p></li><li><p>[dependencies] remove <code class="inline">:comparable</code> as a dependency</p></li><li><p>[<a href="Ash.Resource.xhtml"><code class="inline">Ash.Resource</code></a>] Add default values to resulting Resource struct (#1364)</p></li></ul><h2 id="v3-3-3-2024-08-01"><a href="https://github.com/ash-project/ash/compare/v3.3.2...v3.3.3">v3.3.3</a> (2024-08-01)</h2><h3 id="bug-fixes-100">Bug Fixes:</h3><ul><li>delete ash_notifications from pdict after reading</li></ul><h2 id="v3-3-2-2024-08-01"><a href="https://github.com/ash-project/ash/compare/v3.3.1...v3.3.2">v3.3.2</a> (2024-08-01)</h2><h3 id="bug-fixes-101">Bug Fixes:</h3><ul><li><p>[<a href="Ash.Igniter.xhtml"><code class="inline">Ash.Igniter</code></a>] properly parse multiple occurrences of :keep arguments</p></li><li><p>[calculations] properly key nested calculations and add additional tests</p></li><li><p>[calculations] pass relationship path down when merging query loads</p></li><li><p>[<a href="Mix.Tasks.Ash.Codegen.xhtml"><code class="inline">mix ash.codegen</code></a>] don't set <code class="inline">--name nil</code> when calling codegen tasks</p></li><li><p>[<a href="Ash.Filter.xhtml"><code class="inline">Ash.Filter</code></a>] fix behavior of synthesized joins across data layers</p></li></ul><h3 id="improvements-72">Improvements:</h3><ul><li>[<a href="Mix.Tasks.Ash.Gen.Resource.xhtml"><code class="inline">mix ash.gen.resource</code></a>] add <code class="inline">--timestamps</code> argument to add timestamps to the resource</li></ul><h2 id="v3-3-1-2024-07-30"><a href="https://github.com/ash-project/ash/compare/v3.3.0...v3.3.1">v3.3.1</a> (2024-07-30)</h2><h3 id="bug-fixes-102">Bug Fixes:</h3><ul><li><p>[<a href="Mix.Tasks.Ash.Gen.Domain.xhtml"><code class="inline">mix ash.gen.domain</code></a>] properly parse domain module in <a href="Mix.Tasks.Ash.Gen.Domain.xhtml"><code class="inline">mix ash.gen.domain</code></a></p></li><li><p>[<a href="Ash.Resource.Change.xhtml"><code class="inline">Ash.Resource.Change</code></a>, <a href="Ash.Resource.Validation.xhtml"><code class="inline">Ash.Resource.Validation</code></a>] properly handle mixed atomic &amp; non-atomic validations/changes</p></li><li><p>[<a href="Ash.Filter.xhtml"><code class="inline">Ash.Filter</code></a>] properly find data layer predicates when name is provided as a string</p></li><li><p>[relationships] set <code class="inline">accessing_from</code> and join read action for many_to_many relationships correctly (#1355)</p></li></ul><h3 id="improvements-73">Improvements:</h3><ul><li>[<a href="Ash.Resource.Change.xhtml"><code class="inline">Ash.Resource.Change</code></a>] implement <code class="inline">change/3</code> automatically if batch callbacks are defined</li></ul><h2 id="v3-3-0-2024-07-27"><a href="https://github.com/ash-project/ash/compare/v3.2.6...v3.3.0">v3.3.0</a> (2024-07-27)</h2><h3 id="features-3">Features:</h3><ul><li>[<a href="Ash.Type.File.xhtml"><code class="inline">Ash.Type.File</code></a>] Add Ash.Type.File (#1337)</li></ul><h3 id="bug-fixes-103">Bug Fixes:</h3><ul><li><p>[bulk actions] ensure that statuses are set correctly on bulk actions</p></li><li><p>[bulk actions] properly transfer process context(tracers) for bulk actions</p></li><li><p>[embedded resources] properly display identity/primary key mismatch error on lists of embeds</p></li><li><p>[<a href="Ash.Type.NewType.xhtml"><code class="inline">Ash.Type.NewType</code></a>] apply constraints to NewType even when casting an array (#1341)</p></li><li><p>[<a href="Ash.Query.xhtml"><code class="inline">Ash.Query</code></a>] pass reuse_values? true when loading in Ash.Query.apply_to/2 (#1346)</p></li><li><p>[code interfaces] honor <code class="inline">skip_unknown_inputs</code> in code interfaces</p></li><li><p>[notifications] don't gather notifications except for in the top level transaction starter</p></li><li><p>[generic actions] support <code class="inline">skip_unknown_inputs</code> on generic actions</p></li><li><p>[atomic updates] ensure <code class="inline">changed?</code> context is set on atomic changesets (we assume it is <code class="inline">true</code>, its up to extensions to handle)</p></li><li><p>[<a href="Ash.Type.CiString.xhtml"><code class="inline">Ash.Type.CiString</code></a>, <a href="Ash.Type.String.xhtml"><code class="inline">Ash.Type.String</code></a>] Update string/ci_string generators to ensure min_length (#1335)</p></li><li><p>[<a href="Ash.xhtml"><code class="inline">Ash</code></a>] handle <code class="inline">{record, action, input}</code> types in <code class="inline">Ash.can?</code></p></li><li><p>[bulk actions] only call <code class="inline">batch_change</code> if it is defined, never <code class="inline">change</code> in bulk create</p></li></ul><h3 id="improvements-74">Improvements:</h3><ul><li><p>[<a href="Mix.Tasks.Ash.Gen.Resource.xhtml"><code class="inline">mix ash.gen.resource</code></a>] better positional argument handling with igniter</p></li><li><p>[<a href="Ash.Expr.xhtml"><code class="inline">Ash.Expr</code></a>] use <code class="inline">:utc_datetime_usec</code> for <code class="inline">now()</code> return type</p></li><li><p>[<a href="Mix.Tasks.Ash.Install.xhtml"><code class="inline">mix ash.install</code></a>] don't install sat solver in initial installation</p></li><li><p>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] validate that a solver exists at compile time when using policies</p></li><li><p>[<a href="Ash.Type.Enum.xhtml"><code class="inline">Ash.Type.Enum</code></a>] Expose type t() on Ash.Type.Enum implementations (#1338)</p></li><li><p>[<a href="Ash.Resource.xhtml"><code class="inline">Ash.Resource</code></a>] add :* as a valid value in <code class="inline">skip_unknown_inputs</code></p></li><li><p>[<a href="Ash.Resource.xhtml"><code class="inline">Ash.Resource</code></a>] add <code class="inline">skip_unknown_inputs</code> to individual actions</p></li><li><p>[embedded resources] add <code class="inline">skip_unknown_inputs</code> constraint to embedded resources</p></li><li><p>[embedded resources] automatically fall back to a default domain when working with embeds</p></li><li><p>[<a href="Ash.xhtml"><code class="inline">Ash</code></a>] handle 3 tuple in <code class="inline">Ash.can?</code></p></li><li><p>[<a href="Ash.Error.xhtml"><code class="inline">Ash.Error</code></a>] add <code class="inline">Ash.Error.error_descriptions</code></p></li></ul><h2 id="v3-2-6-2024-07-22"><a href="https://github.com/ash-project/ash/compare/v3.2.5...v3.2.6">v3.2.6</a> (2024-07-22)</h2><h3 id="bug-fixes-104">Bug Fixes:</h3><ul><li><p>[bulk actions] fallback to <code class="inline">authorize_with</code> when authorizing bulk destroy actions</p></li><li><p>[bulk actions] don't refer to non-existent <code class="inline">batch_change/4</code></p></li></ul><h3 id="improvements-75">Improvements:</h3><ul><li>[bulk actions] Replace incorrect function_exported?-checks in bulk-actions, add has-defs for change modules (#1330)</li></ul><h2 id="v3-2-5-2024-07-22"><a href="https://github.com/ash-project/ash/compare/v3.2.4...v3.2.5">v3.2.5</a> (2024-07-22)</h2><h3 id="bug-fixes-105">Bug Fixes:</h3><ul><li><p>[destroy actions] apply atomic validations on non-bulk destroy actions</p></li><li><p>[<a href="Ash.Policy.Info.xhtml"><code class="inline">Ash.Policy.Info</code></a>] add default to private_fields_policy in Ash.Policy.Info (#1329)</p></li><li><p>[relating_to_actor] make <code class="inline">relating_to_actor</code> built-in-check aware of atomics</p></li><li><p>[<a href="Ash.Expr.xhtml"><code class="inline">Ash.Expr</code></a>] remove redundant overload of <code class="inline">Ash.Expr.get_path</code> (#1328)</p></li><li><p>[<a href="Ash.Type.NewType.xhtml"><code class="inline">Ash.Type.NewType</code></a>] cast_input/2 of Ash.Type.NewType returning :ok (#1324)</p></li><li><p>[<a href="Ash.Reactor.xhtml"><code class="inline">Ash.Reactor</code></a>] warnings emitted by removed reactor behaviour function. (#1325)</p></li></ul><h3 id="improvements-76">Improvements:</h3><ul><li><p>[bulk actions] add <code class="inline">authorize_with</code> fallback option to bulk actions</p></li><li><p>[<a href="Ash.Policy.Authorizer.xhtml"><code class="inline">Ash.Policy.Authorizer</code></a>] allow policy conditions to be applied inside their block</p></li></ul><h2 id="v3-2-4-2024-07-18"><a href="https://github.com/ash-project/ash/compare/v3.2.3...v3.2.4">v3.2.4</a> (2024-07-18)</h2><h3 id="bug-fixes-106">Bug Fixes:</h3><ul><li>[transaction hooks] fix warning on transaction hooks violating their semantics</li></ul><h2 id="v3-2-3-2024-07-18"><a href="https://github.com/ash-project/ash/compare/v3.2.2...v3.2.3">v3.2.3</a> (2024-07-18)</h2><h3 id="bug-fixes-107">Bug Fixes:</h3><ul><li><p>[<a href="Mix.Tasks.Ash.Patch.Extend.xhtml"><code class="inline">mix ash.patch.extend</code></a>] properly convert extension string into a module</p></li><li><p>[<a href="Mix.Tasks.Ash.Patch.Extend.xhtml"><code class="inline">mix ash.patch.extend</code></a>] only display available to extend</p></li><li><p>[<a href="Mix.Tasks.Ash.Install.xhtml"><code class="inline">mix ash.install</code></a>] mix igniter.install ash --example case clause error (#1317)</p></li><li><p>[multitenancy] only use attribute for filtering when multitenancy strategy == :attribute</p></li></ul><h3 id="improvements-77">Improvements:</h3><ul><li>[<a href="Ash.Resource.Igniter.xhtml"><code class="inline">Ash.Resource.Igniter</code></a>] Add <code class="inline">Ash.Resource.Igniter.domain</code> to get the domain of a resource</li></ul><h2 id="v3-2-2-2024-07-17"><a href="https://github.com/ash-project/ash/compare/v3.2.1...v3.2.2">v3.2.2</a> (2024-07-17)</h2><h3 id="features-4">Features:</h3><ul><li>[<a href="Ash.Reactor.xhtml"><code class="inline">Ash.Reactor</code></a>] Add ash_step wrapper (#1311)</li></ul><h3 id="bug-fixes-108">Bug Fixes:</h3><ul><li><p>[bulk destroys] honor atomic validations in destroy actions using <code class="inline">filter</code></p></li><li><p>[Ash.Type.Vector] handle casting nil vectors (#1316)</p></li><li><p>[Ash.Type] don't override <code class="inline">nil</code> handling in <a href="Ash.Type.xhtml#cast_input/3"><code class="inline">Ash.Type.cast_input/3</code></a></p></li></ul><h2 id="v3-2-1-2024-07-17"><a href="https://github.com/ash-project/ash/compare/v3.2.0...v3.2.1">v3.2.1</a> (2024-07-17)</h2><h3 id="bug-fixes-109">Bug Fixes:</h3><ul><li><p>properly honor the <code class="inline">include_nil?</code> option</p></li><li><p>store after_action hooks added outside of changes for atomic upgrade</p></li><li><p>don't use <code class="inline">type/3</code> in string interpolation</p></li><li><p>properly pass <code class="inline">include_nil?</code> from when building query aggregates</p></li></ul><h3 id="improvements-78">Improvements:</h3><ul><li>allow skipping initialization of types in unions</li></ul><h2 id="v3-2-0-2024-07-15"><a href="https://github.com/ash-project/ash/compare/v3.1.8...v3.2.0">v3.2.0</a> (2024-07-15)</h2><h3 id="features-5">Features:</h3><ul><li>[field policies] Allow field policies to hide private fields (#1289)</li></ul><p>Use the <code class="inline">private_fields :include | :show | :hide</code> option in the <code class="inline">field_policies</code> section of your resource to control how private fields are handled by field policies.</p><p>For example:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># hide all private fields when authorizing</span><span class="w">
</span><span class="n">field_policies</span><span class="w"> </span><span class="ss">:hide</span><span class="w">

</span><span class="c1"># the current behavior. Private fields are ignored by field policies</span><span class="w">
</span><span class="n">field_policies</span><span class="w"> </span><span class="ss">:show</span><span class="w">

</span><span class="c1"># private fields can have field policies like any other field</span><span class="w">
</span><span class="n">field_policies</span><span class="w"> </span><span class="ss">:include</span></code></pre><h3 id="improvements-79">Improvements:</h3><ul><li><p>[<a href="Ash.Domain.Igniter.xhtml"><code class="inline">Ash.Domain.Igniter</code></a>] add <a href="Ash.Domain.Igniter.xhtml#list_domains/1"><code class="inline">Ash.Domain.Igniter.list_domains/1</code></a></p></li><li><p>[<a href="Ash.Resource.Igniter.xhtml"><code class="inline">Ash.Resource.Igniter</code></a>] add <a href="Ash.Resource.Igniter.xhtml#list_resources/1"><code class="inline">Ash.Resource.Igniter.list_resources/1</code></a></p></li></ul><h2 id="v3-1-8-2024-07-14"><a href="https://github.com/ash-project/ash/compare/v3.1.7...v3.1.8">v3.1.8</a> (2024-07-14)</h2><h3 id="bug-fixes-110">Bug Fixes:</h3><ul><li>[bulk actions] use <code class="inline">unpaginated_read</code> when simulating streaming for low limit queries</li></ul><h2 id="v3-1-7-2024-07-14"><a href="https://github.com/ash-project/ash/compare/v3.1.6...v3.1.7">v3.1.7</a> (2024-07-14)</h2><h3 id="bug-fixes-111">Bug Fixes:</h3><ul><li><p>[Ash.Query] don't use <code class="inline">:same</code> return type for most operators</p></li><li><p>[Ash.Query] don't use returns as basis type unless explicitly allowed</p></li></ul><h2 id="v3-1-6-2024-07-14"><a href="https://github.com/ash-project/ash/compare/v3.1.5...v3.1.6">v3.1.6</a> (2024-07-14)</h2><h3 id="bug-fixes-112">Bug Fixes:</h3><ul><li><p>[Ash.Query] ensure <code class="inline">today</code> has properly configured returns type</p></li><li><p>[Ash.Type] module type apply_constraints for nil fix (#1313)</p></li></ul><h2 id="v3-1-5-2024-07-14"><a href="https://github.com/ash-project/ash/compare/v3.1.4...v3.1.5">v3.1.5</a> (2024-07-14)</h2><h3 id="bug-fixes-113">Bug Fixes:</h3><ul><li>[Ash.Type] don't specify that <code class="inline">get_path</code> is a predicate function</li></ul><h3 id="improvements-80">Improvements:</h3><ul><li><p>[Ash.Expr] add <code class="inline">Ash.Expr.determine_type(mod, children)</code></p></li><li><p>[Ash.Query] add return typing to functions</p></li></ul><h2 id="v3-1-4-2024-07-13"><a href="https://github.com/ash-project/ash/compare/v3.1.3...v3.1.4">v3.1.4</a> (2024-07-13)</h2><h3 id="bug-fixes-114">Bug Fixes:</h3><ul><li><p>[code interface] properly omit destroyed result in code interfaces</p></li><li><p>[Ash.Type.Integer] properly compare <code class="inline">expr</code> to <code class="inline">min</code> with <code class="inline">min</code> integer constraint</p></li><li><p>[Ash.Reactor] Make action ctx-values from reactor-ctx take precedence if set. (#1308)</p></li></ul><h3 id="improvements-81">Improvements:</h3><ul><li><p>[Ash.Resource.Change] support returning a list of atomics from atomic change callbacks</p></li><li><p>[Ash.Type] add <code class="inline">cast_atomic_constraints</code> callback and use it in core types</p></li><li><p>[Ash.Expr] improve type signature for <code class="inline">if/3</code></p></li><li><p>[Ash.Expr] simpler and/or short circuiting</p></li></ul><h2 id="v3-1-3-2024-07-11"><a href="https://github.com/ash-project/ash/compare/v3.1.2...v3.1.3">v3.1.3</a> (2024-07-11)</h2><h3 id="bug-fixes-115">Bug Fixes:</h3><ul><li><p>[bulk actions] ensure that errors in queries do not raise in atomic upgrades/single atomics</p></li><li><p>[Ash.Type.Integer] use correct constraint when validating min int (#1298)</p></li><li><p>[Ash.Filter] don't refer to private attributes when parsing filter inputs that refer to relationships (#1280)</p></li></ul><h3 id="improvements-82">Improvements:</h3><ul><li>[Ash.Query] add <code class="inline">strict?</code> option to <code class="inline">Ash.Query.load</code> (#1302)</li></ul><h2 id="v3-1-2-2024-07-10"><a href="https://github.com/ash-project/ash/compare/v3.1.1...v3.1.2">v3.1.2</a> (2024-07-10)</h2><h3 id="bug-fixes-116">Bug Fixes:</h3><ul><li>[bulk actions] ensure that manual action configurations are honored for bulk actions</li></ul><h2 id="v3-1-1-2024-07-10"><a href="https://github.com/ash-project/ash/compare/v3.1.0...v3.1.1">v3.1.1</a> (2024-07-10)</h2><h3 id="bug-fixes-117">Bug Fixes:</h3><ul><li>[ash.install] installer doesn't need to add spark as a dependency, just run its installer</li></ul><h2 id="v3-1-0-2024-07-09"><a href="https://github.com/ash-project/ash/compare/v3.0.16...v3.1.0">v3.1.0</a> (2024-07-09)</h2><h3 id="features-6">Features:</h3><ul><li><p>[Generators] add <a href="Mix.Tasks.Ash.Install.xhtml"><code class="inline">mix ash.install</code></a> (call with <code class="inline">mix igniter.install ash</code>)</p></li><li><p>[Generators] add <a href="Mix.Tasks.Ash.Gen.Resource.xhtml"><code class="inline">mix ash.gen.resource</code></a></p></li><li><p>[Generators] add <a href="Mix.Tasks.Ash.Gen.BaseResource.xhtml"><code class="inline">mix ash.gen.base_resource</code></a></p></li><li><p>[Generators] add <a href="Mix.Tasks.Ash.Gen.Domain.xhtml"><code class="inline">mix ash.gen.domain</code></a></p></li><li><p>[Generators] add <a href="Mix.Tasks.Ash.Extend.xhtml"><code class="inline">mix ash.extend</code></a></p></li><li><p>[Ash.Type.UUIDv7] Add built in <a href="Ash.Type.UUIDv7.xhtml"><code class="inline">Ash.Type.UUIDv7</code></a> type, and <code class="inline">uuid_v7_primary_key</code> builder</p></li></ul><h3 id="bug-fixes-118">Bug Fixes:</h3><ul><li><p>[atomics] sort primary key changes ahead of others in atomic changes</p></li><li><p>[Ash.Changeet] fix typespec for Changeset.around_transaction/2 (#1292)</p></li><li><p>[multitenancy] ensure tenancy is always enforced on create/update/destroy actions</p></li><li><p>[loading relationships] lateral join on <code class="inline">from_many? true</code> relationships</p></li><li><p>[calculations] don't reuse calculations/aggregates if <code class="inline">authorize?</code> is true</p></li><li><p>[aggregates] ensure aggregate context is fully configured in <code class="inline">Ash.aggregate</code></p></li><li><p>[bulk actions] properly transfer changeset.context on streamed batch changesets</p></li><li><p>[bulk actions] ensure notifications are dispatched from bulk actions</p></li><li><p>[lazy loading] lazy-loading logic for calculations/aggregates was inversed (#1275)</p></li><li><p>[error handling] properly match on async task exceptions</p></li><li><p>[policies] ensure <code class="inline">context</code> is available in policy template expressions</p></li><li><p>[policies] ensure forbidden errors behave the same when using implicit bulk version of code interface functions</p></li><li><p>[manual relationships] compare keys in manual relationships when using 'complex' types (#1270)</p></li><li><p>[Ash.Filter] cover more cases in filter input parsing (#1261)</p></li><li><p>[has_one relationships] automatically set <code class="inline">from_many?</code> if a <code class="inline">has_one</code> has a <code class="inline">sort</code> applied</p></li><li><p>[Ash.Filter] fix match error when synthesizing joins across data layers</p></li><li><p>[Ash.DataLayer.Ets] properly support multitenancy when referencing relationships</p></li><li><p>[Ash.Type.Union] initialize &amp; validate each subtype of a union</p></li></ul><h3 id="improvements-83">Improvements:</h3><ul><li><p>[Ash.Type.Enum] allow overriding <code class="inline">cast_stored/2</code> and <code class="inline">dump_to_native/2</code></p></li><li><p>[Ash.DataLayer.Simple] support offset in the simple data layer</p></li><li><p>[Ash.Changeset] allow after_action hooks in fully atomic changesets</p></li></ul><h2 id="v3-0-16-2024-06-21"><a href="https://github.com/ash-project/ash/compare/v3.0.15...v3.0.16">v3.0.16</a> (2024-06-21)</h2><h3 id="bug-fixes-119">Bug Fixes:</h3><ul><li><p>[bulk updates] use the proper opts when calling manual updates in bulk updates</p></li><li><p>[pagination] apply pagination at runtime for non lateral join queries</p></li><li><p>[multitenancy] consider multitenancy when checking if through-join is unique</p></li><li><p>[Ash.Changeset] don't run any <code class="inline">before_action</code> hooks if changeset is invalidated in prior hook</p></li><li><p>[atomic upgrade] only prevent atomic upgrade when hooks were explicitly added</p></li></ul><h3 id="improvements-84">Improvements:</h3><ul><li>[Ash.Error] retain error context on overridden messages</li></ul><h2 id="v3-0-15-2024-06-18"><a href="https://github.com/ash-project/ash/compare/v3.0.14...v3.0.15">v3.0.15</a> (2024-06-18)</h2><h3 id="improvements-85">Improvements:</h3><ul><li><p>[Ash.Type] add optional <code class="inline">matches_type?/2</code> callback to <a href="Ash.Type.xhtml"><code class="inline">Ash.Type</code></a></p></li><li><p>[Ash.Domain] add <code class="inline">backwards_compatible_interface?</code> option to <code class="inline">use Ash.Domain</code></p></li></ul><h2 id="v3-0-14-2024-06-18"><a href="https://github.com/ash-project/ash/compare/v3.0.13...v3.0.14">v3.0.14</a> (2024-06-18)</h2><h3 id="bug-fixes-120">Bug Fixes:</h3><ul><li><p>[many-to-many relationships] apply join relationship filter when loading many_to_many relationships</p></li><li><p>[Ash.Query] ensure we honor any computed select changes when loading through attributes</p></li></ul><h3 id="improvements-86">Improvements:</h3><ul><li>[Ash.Policy.Authorier] add <code class="inline">subject</code> and <code class="inline">context</code> keys to policy context</li></ul><h2 id="v3-0-13-2024-06-17"><a href="https://github.com/ash-project/ash/compare/v3.0.12...v3.0.13">v3.0.13</a> (2024-06-17)</h2><h3 id="bug-fixes-121">Bug Fixes:</h3><ul><li><p>[parallelism] don't start async limiter tasks if async is disabled</p></li><li><p>[Ash.Domain] properly set default timeout to <code class="inline">:infinity</code></p></li><li><p>[upserts] pass down <code class="inline">identity</code> when doing upserts, for new feature support</p></li><li><p>[Ash.Changeset] ensure that <code class="inline">before_transaction</code> hook errors fail the operation</p></li><li><p>[Ash.Changeset] ensure that <code class="inline">before_transaction</code> hook errors still trigger <code class="inline">after_transaction</code> hooks</p></li><li><p>[bulk updates] abort bulk updates on before transaction hook errors</p></li></ul><h2 id="v3-0-12-2024-06-14"><a href="https://github.com/ash-project/ash/compare/v3.0.11...v3.0.12">v3.0.12</a> (2024-06-14)</h2><h3 id="bug-fixes-122">Bug Fixes:</h3><ul><li><p>[atomic updates] fix expression interpolation for cast_atomic for integer, decimal, float</p></li><li><p>[generic actions] set default argument values on generic actions</p></li><li><p>[generic actions] support <a href="https://hexdocs.pm/elixir/Kernel.SpecialForms.html#%5E/1"><code class="inline">^arg/1</code></a> and similar constructions in filter policies on generic actions</p></li></ul><h3 id="improvements-87">Improvements:</h3><ul><li>[Ash.Resource] set a <code class="inline">module</code> when validating accepts</li></ul><h2 id="v3-0-11-2024-06-11"><a href="https://github.com/ash-project/ash/compare/v3.0.10...v3.0.11">v3.0.11</a> (2024-06-11)</h2><h3 id="bug-fixes-123">Bug Fixes:</h3><ul><li><p>[loading through attributes] only apply load through for attributes that are being selected directly</p></li><li><p>[relationship loading] ensure we lateral join with <code class="inline">from_many?: true</code> or any <code class="inline">:many</code> cardinality relationships</p></li><li><p>[create/update/destroy actions] correctly load paginated relationships after create, update, delete (#1229)</p></li><li><p>[bulk create/update/destroy] load relationships on bulk operations (#1234)</p></li><li><p>[Ash.Type.Atom] return proper <code class="inline">{:ok, value}</code> from <code class="inline">Ash.Type.Atom.apply_constraints/2</code></p></li><li><p>[Ash.Filter] fix the compare/2 implementations (#1232)</p></li><li><p>[Ash.Filter] return proper value from short-circuit filter hydration</p></li><li><p>[Ash.Seed] fix seed not working when :<strong>keep_nil</strong> is generated using seed_input (#1228)</p></li><li><p>[Ash.Generator] pass resource to Ash.Seed.seed! in Ash.Generator.seed! (#1227)</p></li></ul><h3 id="improvements-88">Improvements:</h3><ul><li><p>[Ash.Resource] validate <code class="inline">require_attributes</code> (error) and <code class="inline">allow_nil_input</code> (warning) at compile time</p></li><li><p>[Ash.Seed] add tenant option to Ash.Seed.seed! (#1230)</p></li></ul><h2 id="v3-0-10-2024-06-06"><a href="https://github.com/ash-project/ash/compare/v3.0.9...v3.0.10">v3.0.10</a> (2024-06-06)</h2><h3 id="bug-fixes-124">Bug Fixes:</h3><ul><li><p>[Ash.Union] ensure that union types w/ explicit tags have constraints applied</p></li><li><p>[multitenancy] don't update tenant on update, instead enforce it</p></li><li><p>[compare/2 validation] Do not compare nil values in <code class="inline">compare</code> validation (#1223)</p></li><li><p>[bulk actions] ensure context is properly set on bulk manual action invocations</p></li></ul><h3 id="improvements-89">Improvements:</h3><ul><li><p>[Ash.Resource] detect invalid resources placed in relationships on domains verifier</p></li><li><p>[Ash.Resource] warn at compile time on types that don't define <code class="inline">atomic_update/2</code></p></li></ul><h2 id="v3-0-9-2024-05-31"><a href="https://github.com/ash-project/ash/compare/v3.0.8...v3.0.9">v3.0.9</a> (2024-05-31)</h2><h3 id="bug-fixes-125">Bug Fixes:</h3><ul><li><p>[Ash.Filter] use correct boolean operation names in Filter.find/4 (#1214)</p></li><li><p>[aggregates] when hydrating nested aggregates, use correct related resource/path pair</p></li><li><p>[aggregates] retain <code class="inline">ref_path</code> when authorizing aggregates</p></li><li><p>[relationship loading] ensure that belongs_to relationships are properly not reloaded with <code class="inline">lazy?: true</code></p></li><li><p>[bulk actions] implement rollback on after hooks for bulk actions</p></li><li><p>[bulk actions] check if in transaction before trying to roll it back</p></li></ul><h3 id="improvements-90">Improvements:</h3><ul><li>compatibility with elixir 1.17</li></ul><h2 id="v3-0-8-2024-05-28"><a href="https://github.com/ash-project/ash/compare/v3.0.7...v3.0.8">v3.0.8</a> (2024-05-28)</h2><h3 id="bug-fixes-126">Bug Fixes:</h3><ul><li><p>[bulk updates] missing <code class="inline">else</code> caused manual updates not to work with <code class="inline">bulk_update</code></p></li><li><p>[Ash.Policy.Authorizer] properly compose multiple filter-checks in policy conditions</p></li><li><p>[Ash.Policy.Authorizer] properly honor trailing policies that are constantly false</p></li></ul><h3 id="improvements-91">Improvements:</h3><ul><li>[Ash.Notifier] verify notifiers all use the <a href="Ash.Notifier.xhtml"><code class="inline">Ash.Notifier</code></a> behaviour</li></ul><h2 id="v3-0-7-2024-05-24"><a href="https://github.com/ash-project/ash/compare/v3.0.6...v3.0.7">v3.0.7</a> (2024-05-24)</h2><h3 id="improvements-92">Improvements:</h3><ul><li><p>[identities] support <code class="inline">nils_distinct?</code> on identities</p></li><li><p>[identities] support <code class="inline">where</code> option on <code class="inline">identities</code></p></li><li><p>[identities] allow calculations in identity keys</p></li></ul><h2 id="v3-0-6-2024-05-23"><a href="https://github.com/ash-project/ash/compare/v3.0.5...v3.0.6">v3.0.6</a> (2024-05-23)</h2><h3 id="bug-fixes-127">Bug Fixes:</h3><ul><li><p>[policies] don't raise an error when authorizing against previous values without atomic upgrades</p></li><li><p>[calculations] handle subquery-requiring calculations in <code class="inline">calculate/2</code>, ensuring we have a primary key</p></li><li><p>[Ash.DataLayer] resolve mixup between atomic upsert vs update capability of datalayers (#1198)</p></li></ul><h2 id="v3-0-5-2024-05-23"><a href="https://github.com/ash-project/ash/compare/v3.0.4...v3.0.5">v3.0.5</a> (2024-05-23)</h2><h3 id="bug-fixes-128">Bug Fixes:</h3><ul><li>[mix ash.*] only use <code class="inline">Mix.deps_tree</code> if defined (its only defined for elixir 1.15+)</li></ul><h3 id="improvements-93">Improvements:</h3><ul><li><p>[atomic upgrade] add <code class="inline">atomic_upgrade?</code> flag to update/destroy actions</p></li><li><p>[atomic upgrade] do not do atomic upgrade by default unless <code class="inline">require_atomic?</code> is <code class="inline">true</code></p></li><li><p>[atomic upgrade] allow configuring the read action used by atomic upgrades</p></li></ul><h2 id="v3-0-4-2024-05-22"><a href="https://github.com/ash-project/ash/compare/v3.0.3...v3.0.4">v3.0.4</a> (2024-05-22)</h2><h3 id="bug-fixes-129">Bug Fixes:</h3><ul><li>[bulk update/destroy] ensure that all notifications are sent</li></ul><h2 id="3-0-3-2024-05-22"><a href="https://github.com/ash-project/ash/compare/v3.0.2...3.0.3">3.0.3</a> (2024-05-22)</h2><h3 id="features-7">Features:</h3><ul><li><p>[relationship pagination] allow retrieving the count of paginated relationships (#1183)</p></li><li><p>[Ash.Reactor] Add <code class="inline">bulk_create</code> step type.</p></li><li><p>[Ash.Reactor] Add <code class="inline">bulk_update</code> step type. (#1185)</p></li></ul><h3 id="bug-fixes-130">Bug Fixes:</h3><ul><li><p>[Ash.Actions.Read] properly hydrate and scope sorts with query context</p></li><li><p>[Ash.Changeset] handle list of atomic conditions coming from atomic validation implementation (#1194) (#1195)</p></li><li><p>[embedded resources] handle nil value for old_values when casting arrays (#1191)</p></li><li><p>[Ash.Query] use <a href="Ash.Sort.xhtml#parse_input/3"><code class="inline">Ash.Sort.parse_input/3</code></a> in <a href="Ash.Query.xhtml#sort_input/2"><code class="inline">Ash.Query.sort_input/2</code></a></p></li><li><p>[Ash.Resource.Validation.Changing] works correctly in atomics, and can eagerly detect changing (#1178)</p></li><li><p>[atomic updates] check the where condition before checking validation atomicity (#1177)</p></li><li><p>[bulk actions] don't emit after batch notifications if <code class="inline">notify?: false</code></p></li><li><p>[Ash.Resource] prefer resource domain over option domain (#1176)</p></li><li><p>[bulk update/destroy] don't require domain for empty stream bulk update and destroy (#1175)</p></li><li><p>[Ash.Generator] only return valid non nil values items from generator (#1121)</p></li><li><p>[bulk destroy] properly validate action when calling bulk destroy</p></li><li><p>[code interface] allow all strategies for bulk actions in code interfaces by default</p></li><li><p>[code interfaces] honor <code class="inline">get?</code> for bulk update/bulk destroy</p></li></ul><h3 id="improvements-94">Improvements:</h3><ul><li><p>[Ash.Query] support anonymous aggregates and calculations in sorts</p></li><li><p>[sensitive fields] Implement <code class="inline">show_sensitive?</code> config (#1180)</p></li><li><p>[Ash.Query] support <code class="inline">filter_input</code> and <code class="inline">sort_input</code> in <a href="Ash.Query.xhtml#build/2"><code class="inline">Ash.Query.build/2</code></a></p></li><li><p>[Ash.Changeset] add <code class="inline">template_requires_actor</code> check for changesets</p></li><li><p>[bulk update/destroy] don't use queries for streaming if they have hooks</p></li><li><p>[Ash.Policy.Check.ChangingAttributes] consider <code class="inline">from: nil</code> in <code class="inline">changing_attributes/1</code> check</p></li></ul><h2 id="v3-0-2-2024-05-15"><a href="https://github.com/ash-project/ash/compare/v3.0.1...v3.0.2">v3.0.2</a> (2024-05-15)</h2><h3 id="improvements-95">Improvements:</h3><ul><li><p>[Ash.Expr] add pattern matching for clarity on values accepted by <code class="inline">ref/1</code> and <code class="inline">ref/2</code></p></li><li><p>[Ash.Expr] add <code class="inline">can_return_nil?/1</code> callback to Ash expressions, allowing for various optimizations</p></li><li><p>[Ash.Type.NewType] raise argument error on unknown options in <a href="Ash.Type.NewType.xhtml"><code class="inline">Ash.Type.NewType</code></a>. Helps with typos &amp; misunderstandings</p></li><li><p>[embedded resources] use the <code class="inline">source</code> configuration for attributes in embedded resources (it was previously just ignored)</p></li><li><p>[Ash.Policy.Authorizer] better type specification for checks, to get better autocomplete and compile time validation</p></li><li><p>[Ash.Error.Invalid.NoSuchInput] added a <code class="inline">did_you_mean</code> field and used it in the error message</p></li></ul><h3 id="bug-fixes-131">Bug Fixes:</h3><ul><li><p>[Ash.Resource] properly persist simple_notifiers (they were being ignored before)</p></li><li><p>[code interface] accept single ids in code interface as subject for destroy/update</p></li><li><p>[bulk update] ensure that the <code class="inline">changed?</code> context is set in after action hooks on batches</p></li><li><p>[relationships] allow for inferred domains when authorizing join queries</p></li><li><p>[Ash.Expr] don't treat <code class="inline">nil</code> as not a valid value when type casting lists</p></li><li><p>[atomic upgrade] keep data's metadata in atomic upgraded update (#1165)</p></li></ul><h2 id="v3-0-1-2024-05-14"><a href="https://github.com/ash-project/ash/compare/v3.0.0...v3.0.1">v3.0.1</a> (2024-05-14)</h2><h3 id="features-8">Features:</h3><ul><li>[Ash.Resource.Change.Builtins] Add <code class="inline">cascade_destroy</code> to builtin changes.</li></ul><h3 id="bug-fixes-132">Bug Fixes:</h3><ul><li><p>[calculations] calculation eager evaluation bug caused <code class="inline">exists</code> to eager evaluate when we didn't actually have the related data</p></li><li><p>[field policies] fix field policy rewrite errors on non-success cases (#1163)</p></li><li><p>[embedded resources] fix embedded resource authorization (#1159) (#1160)</p></li><li><p>infinite recursion if query is empty (#1158)</p></li><li><p>[Ash.DataLayer.Ets] ensure that changeset filters are honored in ETS destroy/update_query</p></li><li><p>[update/destroy actions] don't rollback transactions on stale records, ignore stale records in bulk actions</p></li><li><p>[bulk creates] don't check required belongs to fields until after setting them in bulk creation</p></li><li><p>[code interface] check require_reference? when generating update code interface (#1152)</p></li></ul><h2 id="v3-0-0"><a href="https://github.com/ash-project/ash/compare/v3.0.0...2.0">v3.0.0</a></h2><h2 id="3-0">3.0</h2><p>We are starting the changelog fresh. See <code class="inline">documentation/2.0-CHANGELOG.md</code> in GitHub for the old changelogs.</p><h3 id="breaking-changes">Breaking Changes:</h3><p>For a guide on adjusting to these breaking changes, see the <a href="upgrading-to-3-0.xhtml">upgrade guide</a></p><ul><li>[Ash.Api] has been renamed to <a href="Ash.Domain.xhtml"><code class="inline">Ash.Domain</code></a>, and references to the concept have been renamed as well, i.e in options and in the DSL</li><li>[Ash] we now call functions on this, instead of the domain. i.e <code class="inline">Ash.create</code> and <code class="inline">Ash.read</code>. The generated functions are now marked as deprecated</li><li>[Ash] remove process context functionality. You can no longer store the actor/tenant in the context with <code class="inline">Ash.set_actor</code> and so on</li><li>[private?] deprecate <code class="inline">private?: false</code> in favor of the more explicit <code class="inline">public?: true</code></li><li>[default_accept] default <code class="inline">default_accept</code> is now <code class="inline">[]</code></li><li>[action lifecycle] after transaction hooks cannot be added from inside of other lifecycle hooks</li><li>[Ash.NotLoaded] use <code class="inline">%Ash.NotLoaded{}</code> for unselected values, instead of <code class="inline">nil</code></li><li>[require_atomic?] now defaults to <code class="inline">true</code>, requiring opt-out of atomic behavior</li><li>[authorization] default <code class="inline">api.authorization.authorize</code> to <code class="inline">:by_default</code></li><li>[Ash.Registry] has been removed</li><li>[actions] <code class="inline">domain</code> must always be known when constructing changesets</li><li>[Ash.Notifier] <code class="inline">requires_original_data?/2</code> callback defaults to <code class="inline">false</code></li><li>[Ash.Notifier.PubSub] default to <code class="inline">previous_values?: false</code>, allowing notifications to be sent for atomic updates</li><li>[unknown inputs] all action invocations now use <code class="inline">UnknownInput</code> errors when given an input they don't accept</li><li>[policies] <code class="inline">requires_original_data?/2</code> callback on checks defaults to <code class="inline">false</code></li><li>[Ash.Calculation] has been renamed to <a href="Ash.Resource.Calculation.xhtml"><code class="inline">Ash.Resource.Calculation</code></a></li><li>[Ash.Resource.Calculation] &quot;strict mode&quot; has been added and defaults to <code class="inline">true</code>. This causes only explicitly requested fields from relationships to be loaded</li><li>[Ash.Query.Calculation] positional arguments are now an options list</li><li>[calculations] anonymous function calculations in a resource now take lists and return lists, instead of a single record (like standard calculations do)</li><li>[context] The context argument passed to many different callbacks is now a struct, tailored to that specific context. For example, in a calculation you will receive an <a href="Ash.Resource.Calculation.Context.xhtml"><code class="inline">Ash.Resource.Calculation.Context</code></a></li><li>[after_action/before_action] These builtin changes now accept a 3rd context argument</li><li>[picosat_elixir] is now optional (<code class="inline">simple_sat</code> is now an alternative)</li><li>[Ash.Changeset] <code class="inline">Ash.Changeset.new!</code> has been removed</li><li>[Ash.Changeset] <code class="inline">Ash.Changeset.new/2</code> has been removed (<a href="Ash.Changeset.xhtml#new/1"><code class="inline">Ash.Changeset.new/1</code></a> is still available)</li><li>[Ash.Changeset] <code class="inline">changeset.filters</code> is now <code class="inline">changeset.filter</code></li><li>[Ash.Changeset] reverse order of before action &amp; before transaction hooks. They now run in the action they are added. They used to run in reverse order.</li><li>[Ash.CiString] <a href="Ash.CiString.xhtml#new/1"><code class="inline">Ash.CiString.new/1</code></a> returns <code class="inline">nil</code> on <code class="inline">nil</code> input</li><li>[belongs_to.attribute_writable?] add <code class="inline">attribute_public?</code> for controlling publicity, and default <code class="inline">attribute_writable?</code> to <code class="inline">true</code>.</li><li>[Ash.Filter.TemplateHelpers] removed, all functions needed for expressions are now defined in <a href="Ash.Expr.xhtml"><code class="inline">Ash.Expr</code></a></li><li>[Ash.Expr] keyword lists are no longer special cased in ash expressions, and requiring pinning like any other value.</li><li>[Ash.Resource] default read actions are now paginatable with keyset and offset pagination (but pagination is not required)</li><li>[Ash.Resource] default actions require explicit accept lists (or will use <code class="inline">default_accept</code>). i.e <code class="inline">defaults [:read, create: [:first_name, :last_name]]</code></li><li>[Ash.Resource] <code class="inline">simple_notifiers</code> is now an option to <code class="inline">use Ash.Resource</code>, instead of being in the DSL at <code class="inline">resource.simple_notifiers</code></li><li>[Ash.Flow] has been removed and put in its own package <code class="inline">ash_flow</code>. It is being deprecated in favor of <a href="https://hexdocs.pm/reactor/0.15.6/Reactor.html"><code class="inline">Reactor</code></a></li><li>[Ash.Error] the implementation has been extracted out to <a href="https://hexdocs.pm/splode/0.2.9/Splode.html"><code class="inline">Splode</code></a>. Defining new <a href="Ash.Error.xhtml"><code class="inline">Ash.Error</code></a>s is now done by defining a new <a href="https://hexdocs.pm/splode/0.2.9/Splode.Error.html"><code class="inline">Splode.Error</code></a></li><li>[Ash.Query] swap position of sort order and arguments in calculation sorting, i.e instead of <code class="inline">calculation: {:asc, %{...args}}</code> it is now <code class="inline">calculation: {%{...args}, :asc}</code></li><li>[Ash.Resource.Aggregate] add <code class="inline">include_nil?</code> aggregate option, and default it to <code class="inline">false</code> (so <code class="inline">list</code> and <code class="inline">first</code> aggregates do not consider <code class="inline">nil</code> values by default)</li><li>[Ash.Policy.FilterCheck] now accepts <code class="inline">context</code> arguments, like <code class="inline">Ash.Policy.FilterCheckWithContext</code></li><li>[Ash.Policy.FilterCheckWithContext] has been removed, use <a href="Ash.Policy.FilterCheck.xhtml"><code class="inline">Ash.Policy.FilterCheck</code></a></li></ul><h3 id="features-9">Features:</h3><ul><li>[Ash.Type] add new remove_nil_items? array type constraint (#1116)</li><li>[Ash.Query] Paginatable relationships (#1050)</li><li>[Ash.DataLayer] new <code class="inline">calculate/3</code> callback that allows for data layers to compute the result of expressions outside the context of a query. Used to power <a href="Ash.xhtml#calculate/3"><code class="inline">Ash.calculate/3</code></a>.</li><li>[validations] new builtin validations, <code class="inline">attributes_present/2</code> and <code class="inline">attributes_absent/2</code></li><li>[multitenancy] configurable multitenancy behaviour on read actions (#1030)</li><li>[Ash.Reactor] Add new <code class="inline">change</code> step type which can be used to modify changesets.</li><li>[Ash.Changeset] add <code class="inline">Ash.Changeset.update_change/2</code> function and builtin change (#976)</li><li>[Ash.Domain] code interfaces can now be defined on the domain</li><li>[Ash.Domain] policies can now be defined on the domain, and will run before resource policies</li><li>[Ash.ToTenant] add <a href="Ash.ToTenant.xhtml"><code class="inline">Ash.ToTenant</code></a>, allowing for passing arbitrary values as tenants</li><li>[Ash] add <code class="inline">Ash.read_first</code> (like <code class="inline">Ash.read_one</code>, but applies a limit automatically)</li><li>[Ash] support a second optional <code class="inline">input</code> option for <code class="inline">create</code>, <code class="inline">update</code> and <code class="inline">destroy</code>, allowing for things like <code class="inline">Ash.create!(Post, %{text: &quot;text&quot;}, opts)</code></li><li>[sensitive?] support <code class="inline">sensitive?</code> option in query aggregate/calculation (#963)</li><li>[Ash.Resource] support <code class="inline">require_reference?: false</code> on code interfaces, for when an update or destroy action uniquely identifies a record (or for bulk update/destroy)</li><li>[Ash.Resource] notifiers can now be specified for specific actions, using the <code class="inline">notifiers</code> option</li><li>[mix ash.rollback] delegates to extensions to trigger their rollback tasks</li><li>[Ash.Query] add <a href="Ash.Query.xhtml#apply_to/3"><code class="inline">Ash.Query.apply_to/3</code></a>, to &quot;apply&quot; the query to a set of records (i.e filter, sort, distinct, etc.)</li><li>[Ash.CustomExpression] Use <a href="Ash.CustomExpression.xhtml"><code class="inline">Ash.CustomExpression</code></a> to extend Ash's expression syntax in a data-layer agnostic way</li><li>[code interface] Code interface functions now support bulk actions, in a &quot;do what I mean&quot; way. For example: <code class="inline">Domain.deactive(post)</code> can also be <code class="inline">Post |&gt; Ash.Query.filter(active == true) |&gt; Domain.deactive()</code></li></ul><h3 id="improvements-96">Improvements:</h3><ul><li>[Ash.Actions.Sort] allow providing a stream of records to sort, and performance improvements</li><li>[bulk actions] add <code class="inline">read_action</code> option to bulk actions (#1088)</li><li>[Ash.stream] support streaming with offset, or even <em>no</em> pagination</li><li>[Ash.DataLayer.Ets] add debug logging, similar to ecto query debug logging</li><li>[Ash.DataLayer.Ets] support update_query, destroy_query and <a href="Ash.Changeset.xhtml#filter/2"><code class="inline">Ash.Changeset.filter/2</code></a></li><li>[Embedded resources] don't add <code class="inline">autogenerated_id</code> to embeds if they don't have a primary key</li><li>[Ash.Resource] you can now omit the return type of generic actions, indicating it either succeeds or fails, returning <code class="inline">:ok</code> or <code class="inline">{:error, error}</code></li><li>[Ash.Resource] Generic actions can now accept a Reactor module, running it directly. (#993)</li><li>[Ash.Resource] support <code class="inline">allow_nil_input</code> dsl option in update/destroy actions (#964)</li><li>[Ash.Resource] The <code class="inline">filter</code> option can now be supplied multiple times in read actions and in relationships. They will be combined with <code class="inline">and</code></li><li>[Ash.Resource] private attributes can now be accepted as action inputs</li><li>[Ash.Expr] is now imported automatically into places you will likely use it, like changes, validations, checks and calculations.</li><li>[Ash.Query] is now required automatically in places you will likely use it, as above</li><li>[sortable?] fields may mark themselves as unusable in sorts by using <code class="inline">sortable? false</code></li><li>[sensitive?] calculations and aggregates may now also be marked as <code class="inline">sensitive?</code></li></ul><h3 id="bug-fixes-133">Bug Fixes:</h3><ul><li>[Ash.Type] apply array type <code class="inline">nil_items?</code> constraint after item constraints are applied (#1115)</li><li>[Ash.DataLayer.Ets] fix ETS data layer's support for lateral joining</li><li>[bulk actions] ensure transaction is rolled back on data layer errors during streaming</li><li>[bulk actions] set <code class="inline">notify?: true</code> when <code class="inline">return_notifications?: true</code> is set</li><li>[Ash.Changeset] <code class="inline">attributes_present?/2</code> -&gt; <code class="inline">attribute_present?/2</code></li><li>[Ash.Filter] don't eager evaluate <code class="inline">type/3</code> because data layers require type information</li><li>[Ash.Changeset] when comparing identities for <code class="inline">manage_relationship</code>, we now properly cast the values. Before, <code class="inline">&quot;1&quot;</code> and <code class="inline">1</code> were not considered equal for integer primary keys/identity fields</li><li>Many more bug fixes were added, but few are relevant enough to list here</li></ul>

  </body>
</html>
