<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
      xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <title>Write Queries - ash v3.5.33</title>
    <meta name="generator" content="ExDoc v0.38.2" />
    <link type="text/css" rel="stylesheet" href="dist/epub-elixir-FNUUKFP7.css" />
    <script src="dist/epub-4WIP524F.js"></script>

  </head>
  <body class="content-inner">

    <h1 id="content">Write Queries</h1>
<pre><code class="makeup elixir" translate="no"><span class="nc">Mix</span><span class="o">.</span><span class="n">install</span><span class="p" data-group-id="0868071322-1">(</span><span class="p" data-group-id="0868071322-2">[</span><span class="p" data-group-id="0868071322-3">{</span><span class="ss">:ash</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~&gt; 3.0&quot;</span><span class="p" data-group-id="0868071322-3">}</span><span class="p" data-group-id="0868071322-2">]</span><span class="p">,</span><span class="w">
  </span><span class="ss">consolidate_protocols</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="w">
</span><span class="p" data-group-id="0868071322-1">)</span><span class="w">

</span><span class="nc">Application</span><span class="o">.</span><span class="n">put_env</span><span class="p" data-group-id="0868071322-4">(</span><span class="ss">:ash</span><span class="p">,</span><span class="w"> </span><span class="ss">:validate_domain_resource_inclusion?</span><span class="p">,</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="0868071322-4">)</span><span class="w">
</span><span class="nc">Application</span><span class="o">.</span><span class="n">put_env</span><span class="p" data-group-id="0868071322-5">(</span><span class="ss">:ash</span><span class="p">,</span><span class="w"> </span><span class="ss">:validate_domain_config_inclusion?</span><span class="p">,</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="0868071322-5">)</span><span class="w">

</span><span class="nc">ExUnit</span><span class="o">.</span><span class="n">start</span><span class="p" data-group-id="0868071322-6">(</span><span class="p" data-group-id="0868071322-6">)</span></code></pre><h2 id="introduction">Introduction</h2><p>Here we will show practical examples of using <a href="Ash.Query.xhtml"><code class="inline">Ash.Query</code></a>. To understand more about its capabilities, limitations, and design, see the module docs of <a href="Ash.Query.xhtml"><code class="inline">Ash.Query</code></a>.</p><p>This guide is here to provide a slew of examples, for more information on any given function or option please search the documentation. Please propose additions
for any useful patterns that are not demonstrated here!</p><h2 id="setup">Setup</h2><p>First, lets create some resources and some data to query.</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">MyApp.Posts</span><span class="w"> </span><span class="k" data-group-id="7353758528-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Ash.Domain</span><span class="w">

  </span><span class="n">resources</span><span class="w"> </span><span class="k" data-group-id="7353758528-2">do</span><span class="w">
    </span><span class="n">resource</span><span class="w"> </span><span class="nc">MyApp.Posts.Post</span><span class="w">
    </span><span class="n">resource</span><span class="w"> </span><span class="nc">MyApp.Posts.Comment</span><span class="w">
  </span><span class="k" data-group-id="7353758528-2">end</span><span class="w">
</span><span class="k" data-group-id="7353758528-1">end</span><span class="w">

</span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">MyApp.Posts.Post</span><span class="w"> </span><span class="k" data-group-id="7353758528-3">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Ash.Resource</span><span class="p">,</span><span class="w">
    </span><span class="ss">domain</span><span class="p">:</span><span class="w"> </span><span class="nc">MyApp.Posts</span><span class="p">,</span><span class="w">
    </span><span class="ss">data_layer</span><span class="p">:</span><span class="w"> </span><span class="nc">Ash.DataLayer.Ets</span><span class="w">

  </span><span class="n">actions</span><span class="w"> </span><span class="k" data-group-id="7353758528-4">do</span><span class="w">
    </span><span class="n">defaults</span><span class="w"> </span><span class="p" data-group-id="7353758528-5">[</span><span class="ss">:read</span><span class="p">,</span><span class="w"> </span><span class="ss">:destroy</span><span class="p">,</span><span class="w"> </span><span class="ss">create</span><span class="p">:</span><span class="w"> </span><span class="ss">:*</span><span class="p" data-group-id="7353758528-5">]</span><span class="w">
  </span><span class="k" data-group-id="7353758528-4">end</span><span class="w">
  
  </span><span class="n">attributes</span><span class="w"> </span><span class="k" data-group-id="7353758528-6">do</span><span class="w">
    </span><span class="n">uuid_primary_key</span><span class="w"> </span><span class="ss">:id</span><span class="w">
    
    </span><span class="n">attribute</span><span class="w"> </span><span class="ss">:text</span><span class="p">,</span><span class="w"> </span><span class="ss">:string</span><span class="w"> </span><span class="k" data-group-id="7353758528-7">do</span><span class="w">
      </span><span class="n">allow_nil?</span><span class="w"> </span><span class="no">false</span><span class="w">
      </span><span class="n">public?</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="k" data-group-id="7353758528-7">end</span><span class="w">
  </span><span class="k" data-group-id="7353758528-6">end</span><span class="w">

  </span><span class="n">calculations</span><span class="w"> </span><span class="k" data-group-id="7353758528-8">do</span><span class="w">
    </span><span class="n">calculate</span><span class="w"> </span><span class="ss">:text_length</span><span class="p">,</span><span class="w"> </span><span class="ss">:integer</span><span class="p">,</span><span class="w"> </span><span class="n">expr</span><span class="p" data-group-id="7353758528-9">(</span><span class="n">string_length</span><span class="p" data-group-id="7353758528-10">(</span><span class="n">text</span><span class="p" data-group-id="7353758528-10">)</span><span class="p" data-group-id="7353758528-9">)</span><span class="w">
  </span><span class="k" data-group-id="7353758528-8">end</span><span class="w">

  </span><span class="n">aggregates</span><span class="w"> </span><span class="k" data-group-id="7353758528-11">do</span><span class="w">
    </span><span class="n">count</span><span class="w"> </span><span class="ss">:count_of_comments</span><span class="p">,</span><span class="w"> </span><span class="ss">:comments</span><span class="w">
  </span><span class="k" data-group-id="7353758528-11">end</span><span class="w">

  </span><span class="n">relationships</span><span class="w"> </span><span class="k" data-group-id="7353758528-12">do</span><span class="w">
    </span><span class="n">has_many</span><span class="w"> </span><span class="ss">:comments</span><span class="p">,</span><span class="w"> </span><span class="nc">MyApp.Posts.Comment</span><span class="w"> </span><span class="k" data-group-id="7353758528-13">do</span><span class="w">
      </span><span class="n">public?</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="k" data-group-id="7353758528-13">end</span><span class="w">
  </span><span class="k" data-group-id="7353758528-12">end</span><span class="w">
</span><span class="k" data-group-id="7353758528-3">end</span><span class="w">

</span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">MyApp.Posts.Comment</span><span class="w"> </span><span class="k" data-group-id="7353758528-14">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Ash.Resource</span><span class="p">,</span><span class="w">
    </span><span class="ss">domain</span><span class="p">:</span><span class="w"> </span><span class="nc">MyApp.Posts</span><span class="p">,</span><span class="w">
    </span><span class="ss">data_layer</span><span class="p">:</span><span class="w"> </span><span class="nc">Ash.DataLayer.Ets</span><span class="w">

  </span><span class="n">actions</span><span class="w"> </span><span class="k" data-group-id="7353758528-15">do</span><span class="w">
    </span><span class="n">defaults</span><span class="w"> </span><span class="p" data-group-id="7353758528-16">[</span><span class="ss">:read</span><span class="p">,</span><span class="w"> </span><span class="ss">:destroy</span><span class="p">,</span><span class="w"> </span><span class="ss">create</span><span class="p">:</span><span class="w"> </span><span class="ss">:*</span><span class="p" data-group-id="7353758528-16">]</span><span class="w">
  </span><span class="k" data-group-id="7353758528-15">end</span><span class="w">
  
  </span><span class="n">attributes</span><span class="w"> </span><span class="k" data-group-id="7353758528-17">do</span><span class="w">
    </span><span class="n">uuid_primary_key</span><span class="w"> </span><span class="ss">:id</span><span class="w">
    </span><span class="n">attribute</span><span class="w"> </span><span class="ss">:text</span><span class="p">,</span><span class="w"> </span><span class="ss">:string</span><span class="w"> </span><span class="k" data-group-id="7353758528-18">do</span><span class="w">
      </span><span class="n">allow_nil?</span><span class="w"> </span><span class="no">false</span><span class="w">
      </span><span class="n">public?</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="k" data-group-id="7353758528-18">end</span><span class="w">
  </span><span class="k" data-group-id="7353758528-17">end</span><span class="w">

  </span><span class="n">relationships</span><span class="w"> </span><span class="k" data-group-id="7353758528-19">do</span><span class="w">
    </span><span class="n">belongs_to</span><span class="w"> </span><span class="ss">:post</span><span class="p">,</span><span class="w"> </span><span class="nc">MyApp.Posts.Post</span><span class="w"> </span><span class="k" data-group-id="7353758528-20">do</span><span class="w">
      </span><span class="n">public?</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="k" data-group-id="7353758528-20">end</span><span class="w">
  </span><span class="k" data-group-id="7353758528-19">end</span><span class="w">
</span><span class="k" data-group-id="7353758528-14">end</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="6211806532-1">{</span><span class="ss">:module</span><span class="p">,</span><span class="w"> </span><span class="nc">MyApp.Posts.Comment</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6211806532-2">&lt;&lt;</span><span class="mi">70</span><span class="p">,</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="mi">82</span><span class="p">,</span><span class="w"> </span><span class="mi">49</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">110</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="6211806532-2">&gt;&gt;</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="6211806532-3">[</span><span class="w">
   </span><span class="nc">Ash.Expr</span><span class="p">,</span><span class="w">
   </span><span class="nc">Ash.Resource.Dsl.Relationships.BelongsTo</span><span class="p">,</span><span class="w">
   </span><span class="nc">Ash.Resource.Dsl.Relationships.ManyToMany</span><span class="p">,</span><span class="w">
   </span><span class="nc">Ash.Resource.Dsl.Relationships.HasMany</span><span class="p">,</span><span class="w">
   </span><span class="nc">Ash.Resource.Dsl.Relationships.HasOne</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="6211806532-4">%{</span><span class="n">...</span><span class="p" data-group-id="6211806532-4">}</span><span class="w">
 </span><span class="p" data-group-id="6211806532-3">]</span><span class="p" data-group-id="6211806532-1">}</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="c1"># Get rid of any existing comments/posts</span><span class="w">
</span><span class="nc">Ash</span><span class="o">.</span><span class="n">bulk_destroy!</span><span class="p" data-group-id="8751572176-1">(</span><span class="nc">MyApp.Posts.Comment</span><span class="p">,</span><span class="w"> </span><span class="ss">:destroy</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8751572176-2">%{</span><span class="p" data-group-id="8751572176-2">}</span><span class="p" data-group-id="8751572176-1">)</span><span class="w">
</span><span class="nc">Ash</span><span class="o">.</span><span class="n">bulk_destroy!</span><span class="p" data-group-id="8751572176-3">(</span><span class="nc">MyApp.Posts.Post</span><span class="p">,</span><span class="w"> </span><span class="ss">:destroy</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8751572176-4">%{</span><span class="p" data-group-id="8751572176-4">}</span><span class="p" data-group-id="8751572176-3">)</span><span class="w">

</span><span class="c1"># Create some posts</span><span class="w">
</span><span class="n">post1</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="nc">Ash</span><span class="o">.</span><span class="n">create!</span><span class="p" data-group-id="8751572176-5">(</span><span class="nc">MyApp.Posts.Post</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8751572176-6">%{</span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;First post about Ash!&quot;</span><span class="p" data-group-id="8751572176-6">}</span><span class="p" data-group-id="8751572176-5">)</span><span class="w">

</span><span class="n">post2</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="nc">Ash</span><span class="o">.</span><span class="n">create!</span><span class="p" data-group-id="8751572176-7">(</span><span class="nc">MyApp.Posts.Post</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8751572176-8">%{</span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Learning to write queries&quot;</span><span class="p" data-group-id="8751572176-8">}</span><span class="p" data-group-id="8751572176-7">)</span><span class="w">

</span><span class="n">comment1</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="nc">Ash</span><span class="o">.</span><span class="n">create!</span><span class="p" data-group-id="8751572176-9">(</span><span class="nc">MyApp.Posts.Comment</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8751572176-10">%{</span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Great post!&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">post_id</span><span class="p">:</span><span class="w"> </span><span class="n">post1</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="8751572176-10">}</span><span class="p" data-group-id="8751572176-9">)</span><span class="w">

</span><span class="n">comment2</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="nc">Ash</span><span class="o">.</span><span class="n">create!</span><span class="p" data-group-id="8751572176-11">(</span><span class="nc">MyApp.Posts.Comment</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8751572176-12">%{</span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Very helpful!&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">post_id</span><span class="p">:</span><span class="w"> </span><span class="n">post1</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="8751572176-12">}</span><span class="p" data-group-id="8751572176-11">)</span><span class="w">

</span><span class="n">comment3</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="nc">Ash</span><span class="o">.</span><span class="n">create!</span><span class="p" data-group-id="8751572176-13">(</span><span class="nc">MyApp.Posts.Comment</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8751572176-14">%{</span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Thanks for the explanation&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">post_id</span><span class="p">:</span><span class="w"> </span><span class="n">post2</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="8751572176-14">}</span><span class="p" data-group-id="8751572176-13">)</span><span class="w">

</span><span class="c1"># Store the created records in module attributes for later use</span><span class="w">
</span><span class="n">posts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8751572176-15">[</span><span class="n">post1</span><span class="p">,</span><span class="w"> </span><span class="n">post2</span><span class="p" data-group-id="8751572176-15">]</span><span class="w">
</span><span class="n">comments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8751572176-16">[</span><span class="n">comment1</span><span class="p">,</span><span class="w"> </span><span class="n">comment2</span><span class="p">,</span><span class="w"> </span><span class="n">comment3</span><span class="p" data-group-id="8751572176-16">]</span><span class="w">

</span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="8751572176-17">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Created </span><span class="si" data-group-id="8751572176-18">#{</span><span class="n">length</span><span class="p" data-group-id="8751572176-19">(</span><span class="n">posts</span><span class="p" data-group-id="8751572176-19">)</span><span class="si" data-group-id="8751572176-18">}</span><span class="s"> posts and </span><span class="si" data-group-id="8751572176-20">#{</span><span class="n">length</span><span class="p" data-group-id="8751572176-21">(</span><span class="n">comments</span><span class="p" data-group-id="8751572176-21">)</span><span class="si" data-group-id="8751572176-20">}</span><span class="s"> comments!&quot;</span><span class="p" data-group-id="8751572176-17">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="w">
</span><span class="mi">23</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">15.097</span><span class="w"> </span><span class="p" data-group-id="7975419391-1">[</span><span class="n">debug</span><span class="p" data-group-id="7975419391-1">]</span><span class="w"> </span><span class="ss">ETS</span><span class="p">:</span><span class="w"> </span><span class="nc">Destroying</span><span class="w"> </span><span class="nc">MyApp.Posts.Comment</span><span class="w">


</span><span class="mi">23</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">15.104</span><span class="w"> </span><span class="p" data-group-id="7975419391-2">[</span><span class="n">debug</span><span class="p" data-group-id="7975419391-2">]</span><span class="w"> </span><span class="ss">ETS</span><span class="p">:</span><span class="w"> </span><span class="nc">Destroying</span><span class="w"> </span><span class="nc">MyApp.Posts.Post</span><span class="w">


</span><span class="mi">23</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">15.110</span><span class="w"> </span><span class="p" data-group-id="7975419391-3">[</span><span class="n">debug</span><span class="p" data-group-id="7975419391-3">]</span><span class="w"> </span><span class="nc">Creating</span><span class="w"> </span><span class="nc">MyApp.Posts.Post</span><span class="p">:</span><span class="w">

</span><span class="p" data-group-id="7975419391-4">%{</span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eafcb80f-8c90-4c16-8a29-cf0c28964d9b&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;First post about Ash!&quot;</span><span class="p" data-group-id="7975419391-4">}</span><span class="w">


</span><span class="mi">23</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">15.110</span><span class="w"> </span><span class="p" data-group-id="7975419391-5">[</span><span class="n">debug</span><span class="p" data-group-id="7975419391-5">]</span><span class="w"> </span><span class="nc">Creating</span><span class="w"> </span><span class="nc">MyApp.Posts.Post</span><span class="p">:</span><span class="w">

</span><span class="p" data-group-id="7975419391-6">%{</span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2f22973b-f1cd-4d2d-b241-d7c53bf097d3&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Learning to write queries&quot;</span><span class="p" data-group-id="7975419391-6">}</span><span class="w">


</span><span class="mi">23</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">15.111</span><span class="w"> </span><span class="p" data-group-id="7975419391-7">[</span><span class="n">debug</span><span class="p" data-group-id="7975419391-7">]</span><span class="w"> </span><span class="nc">Creating</span><span class="w"> </span><span class="nc">MyApp.Posts.Comment</span><span class="p">:</span><span class="w">

</span><span class="p" data-group-id="7975419391-8">%{</span><span class="w">
  </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;05863bdd-38eb-4e0e-9ff7-f23f65639ec3&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Great post!&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">post_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eafcb80f-8c90-4c16-8a29-cf0c28964d9b&quot;</span><span class="w">
</span><span class="p" data-group-id="7975419391-8">}</span><span class="w">


</span><span class="mi">23</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">15.111</span><span class="w"> </span><span class="p" data-group-id="7975419391-9">[</span><span class="n">debug</span><span class="p" data-group-id="7975419391-9">]</span><span class="w"> </span><span class="nc">Creating</span><span class="w"> </span><span class="nc">MyApp.Posts.Comment</span><span class="p">:</span><span class="w">

</span><span class="p" data-group-id="7975419391-10">%{</span><span class="w">
  </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;437b6966-2929-4e12-94cc-5807adf60c3e&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Very helpful!&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">post_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eafcb80f-8c90-4c16-8a29-cf0c28964d9b&quot;</span><span class="w">
</span><span class="p" data-group-id="7975419391-10">}</span><span class="w">


</span><span class="mi">23</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">15.111</span><span class="w"> </span><span class="p" data-group-id="7975419391-11">[</span><span class="n">debug</span><span class="p" data-group-id="7975419391-11">]</span><span class="w"> </span><span class="nc">Creating</span><span class="w"> </span><span class="nc">MyApp.Posts.Comment</span><span class="p">:</span><span class="w">

</span><span class="p" data-group-id="7975419391-12">%{</span><span class="w">
  </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;09aaffc4-bca7-4848-8b05-2d1ca11aba33&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Thanks for the explanation&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">post_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2f22973b-f1cd-4d2d-b241-d7c53bf097d3&quot;</span><span class="w">
</span><span class="p" data-group-id="7975419391-12">}</span><span class="w">


</span><span class="nc">Created</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">comments!</span></code></pre><pre><code class="makeup output" translate="no"><span class="ss">:ok</span></code></pre><h3 id="basic-queries">Basic Queries</h3><p>Let's start with some basic query examples. To use <a href="Ash.Query.xhtml#filter/2"><code class="inline">Ash.Query.filter/2</code></a>, we'll need to
<code class="inline">require Ash.Query</code>.</p><pre><code class="makeup elixir" translate="no"><span class="kn">require</span><span class="w"> </span><span class="nc">Ash.Query</span></code></pre><pre><code class="makeup output" translate="no"><span class="nc">Ash.Query</span></code></pre><h2 id="read-everything">Read everything</h2><pre><code class="makeup elixir" translate="no"><span class="c1"># with a lot of data, you probably shouldn&#39;t do this</span><span class="w">
</span><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="7451378959-1">(</span><span class="nc">MyApp.Posts.Post</span><span class="p" data-group-id="7451378959-1">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="9777082811-1">[</span><span class="w">
  </span><span class="p" data-group-id="9777082811-2">#</span><span class="nc" data-group-id="9777082811-2">MyApp.Posts.Post</span><span class="p" data-group-id="9777082811-2">&lt;</span><span class="w">
    </span><span class="ss">text_length</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9777082811-3">#</span><span class="nc" data-group-id="9777082811-3">Ash.NotLoaded</span><span class="p" data-group-id="9777082811-3">&lt;</span><span class="ss">:calculation</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:text_length</span><span class="p" data-group-id="9777082811-3">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">count_of_comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9777082811-4">#</span><span class="nc" data-group-id="9777082811-4">Ash.NotLoaded</span><span class="p" data-group-id="9777082811-4">&lt;</span><span class="ss">:aggregate</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:count_of_comments</span><span class="p" data-group-id="9777082811-4">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9777082811-5">#</span><span class="nc" data-group-id="9777082811-5">Ash.NotLoaded</span><span class="p" data-group-id="9777082811-5">&lt;</span><span class="ss">:relationship</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:comments</span><span class="p" data-group-id="9777082811-5">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">__meta__</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9777082811-6">#</span><span class="nc" data-group-id="9777082811-6">Ecto.Schema.Metadata</span><span class="p" data-group-id="9777082811-6">&lt;</span><span class="ss">:loaded</span><span class="p" data-group-id="9777082811-6">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2f22973b-f1cd-4d2d-b241-d7c53bf097d3&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Learning to write queries&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9777082811-7">%{</span><span class="p" data-group-id="9777082811-7">}</span><span class="p">,</span><span class="w">
    </span><span class="ss">calculations</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9777082811-8">%{</span><span class="p" data-group-id="9777082811-8">}</span><span class="p">,</span><span class="w">
    </span><span class="n">...</span><span class="w">
  </span><span class="p" data-group-id="9777082811-2">&gt;</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="9777082811-9">#</span><span class="nc" data-group-id="9777082811-9">MyApp.Posts.Post</span><span class="p" data-group-id="9777082811-9">&lt;</span><span class="w">
    </span><span class="ss">text_length</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9777082811-10">#</span><span class="nc" data-group-id="9777082811-10">Ash.NotLoaded</span><span class="p" data-group-id="9777082811-10">&lt;</span><span class="ss">:calculation</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:text_length</span><span class="p" data-group-id="9777082811-10">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">count_of_comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9777082811-11">#</span><span class="nc" data-group-id="9777082811-11">Ash.NotLoaded</span><span class="p" data-group-id="9777082811-11">&lt;</span><span class="ss">:aggregate</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:count_of_comments</span><span class="p" data-group-id="9777082811-11">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9777082811-12">#</span><span class="nc" data-group-id="9777082811-12">Ash.NotLoaded</span><span class="p" data-group-id="9777082811-12">&lt;</span><span class="ss">:relationship</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:comments</span><span class="p" data-group-id="9777082811-12">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">__meta__</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9777082811-13">#</span><span class="nc" data-group-id="9777082811-13">Ecto.Schema.Metadata</span><span class="p" data-group-id="9777082811-13">&lt;</span><span class="ss">:loaded</span><span class="p" data-group-id="9777082811-13">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eafcb80f-8c90-4c16-8a29-cf0c28964d9b&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;First post about Ash!&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9777082811-14">%{</span><span class="p" data-group-id="9777082811-14">}</span><span class="p">,</span><span class="w">
    </span><span class="ss">calculations</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9777082811-15">%{</span><span class="p" data-group-id="9777082811-15">}</span><span class="p">,</span><span class="w">
    </span><span class="n">...</span><span class="w">
  </span><span class="p" data-group-id="9777082811-9">&gt;</span><span class="w">
</span><span class="p" data-group-id="9777082811-1">]</span></code></pre><h2 id="count-all-comments">Count all comments</h2><pre><code class="makeup elixir" translate="no"><span class="nc">MyApp.Posts.Comment</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">count!</span><span class="p" data-group-id="7196660679-1">(</span><span class="p" data-group-id="7196660679-1">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="mi">3</span></code></pre><h2 id="filtering">Filtering</h2><pre><code class="makeup elixir" translate="no"><span class="nc">MyApp.Posts.Post</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="0690829344-1">(</span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">^</span><span class="n">post1</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="0690829344-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="0690829344-2">(</span><span class="p" data-group-id="0690829344-2">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="8055107530-1">[</span><span class="w">
  </span><span class="p" data-group-id="8055107530-2">#</span><span class="nc" data-group-id="8055107530-2">MyApp.Posts.Post</span><span class="p" data-group-id="8055107530-2">&lt;</span><span class="w">
    </span><span class="ss">text_length</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="8055107530-3">#</span><span class="nc" data-group-id="8055107530-3">Ash.NotLoaded</span><span class="p" data-group-id="8055107530-3">&lt;</span><span class="ss">:calculation</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:text_length</span><span class="p" data-group-id="8055107530-3">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">count_of_comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="8055107530-4">#</span><span class="nc" data-group-id="8055107530-4">Ash.NotLoaded</span><span class="p" data-group-id="8055107530-4">&lt;</span><span class="ss">:aggregate</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:count_of_comments</span><span class="p" data-group-id="8055107530-4">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="8055107530-5">#</span><span class="nc" data-group-id="8055107530-5">Ash.NotLoaded</span><span class="p" data-group-id="8055107530-5">&lt;</span><span class="ss">:relationship</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:comments</span><span class="p" data-group-id="8055107530-5">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">__meta__</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="8055107530-6">#</span><span class="nc" data-group-id="8055107530-6">Ecto.Schema.Metadata</span><span class="p" data-group-id="8055107530-6">&lt;</span><span class="ss">:loaded</span><span class="p" data-group-id="8055107530-6">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eafcb80f-8c90-4c16-8a29-cf0c28964d9b&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;First post about Ash!&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="8055107530-7">%{</span><span class="p" data-group-id="8055107530-7">}</span><span class="p">,</span><span class="w">
    </span><span class="ss">calculations</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="8055107530-8">%{</span><span class="p" data-group-id="8055107530-8">}</span><span class="p">,</span><span class="w">
    </span><span class="n">...</span><span class="w">
  </span><span class="p" data-group-id="8055107530-2">&gt;</span><span class="w">
</span><span class="p" data-group-id="8055107530-1">]</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="nc">MyApp.Posts.Post</span><span class="w">
</span><span class="c1"># you can filter on calculations</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="8364038028-1">(</span><span class="n">text_length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">25</span><span class="p" data-group-id="8364038028-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="8364038028-2">(</span><span class="p" data-group-id="8364038028-2">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="0444678950-1">[</span><span class="w">
  </span><span class="p" data-group-id="0444678950-2">#</span><span class="nc" data-group-id="0444678950-2">MyApp.Posts.Post</span><span class="p" data-group-id="0444678950-2">&lt;</span><span class="w">
    </span><span class="ss">text_length</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0444678950-3">#</span><span class="nc" data-group-id="0444678950-3">Ash.NotLoaded</span><span class="p" data-group-id="0444678950-3">&lt;</span><span class="ss">:calculation</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:text_length</span><span class="p" data-group-id="0444678950-3">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">count_of_comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0444678950-4">#</span><span class="nc" data-group-id="0444678950-4">Ash.NotLoaded</span><span class="p" data-group-id="0444678950-4">&lt;</span><span class="ss">:aggregate</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:count_of_comments</span><span class="p" data-group-id="0444678950-4">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0444678950-5">#</span><span class="nc" data-group-id="0444678950-5">Ash.NotLoaded</span><span class="p" data-group-id="0444678950-5">&lt;</span><span class="ss">:relationship</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:comments</span><span class="p" data-group-id="0444678950-5">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">__meta__</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0444678950-6">#</span><span class="nc" data-group-id="0444678950-6">Ecto.Schema.Metadata</span><span class="p" data-group-id="0444678950-6">&lt;</span><span class="ss">:loaded</span><span class="p" data-group-id="0444678950-6">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2f22973b-f1cd-4d2d-b241-d7c53bf097d3&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Learning to write queries&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0444678950-7">%{</span><span class="p" data-group-id="0444678950-7">}</span><span class="p">,</span><span class="w">
    </span><span class="ss">calculations</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0444678950-8">%{</span><span class="p" data-group-id="0444678950-8">}</span><span class="p">,</span><span class="w">
    </span><span class="n">...</span><span class="w">
  </span><span class="p" data-group-id="0444678950-2">&gt;</span><span class="w">
</span><span class="p" data-group-id="0444678950-1">]</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="nc">MyApp.Posts.Post</span><span class="w">
</span><span class="c1"># you can filter on aggregates</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="8298969775-1">(</span><span class="n">count_of_comments</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="8298969775-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="8298969775-2">(</span><span class="p" data-group-id="8298969775-2">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="8056924425-1">[</span><span class="w">
  </span><span class="p" data-group-id="8056924425-2">#</span><span class="nc" data-group-id="8056924425-2">MyApp.Posts.Post</span><span class="p" data-group-id="8056924425-2">&lt;</span><span class="w">
    </span><span class="ss">text_length</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="8056924425-3">#</span><span class="nc" data-group-id="8056924425-3">Ash.NotLoaded</span><span class="p" data-group-id="8056924425-3">&lt;</span><span class="ss">:calculation</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:text_length</span><span class="p" data-group-id="8056924425-3">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">count_of_comments</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="ss">comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="8056924425-4">#</span><span class="nc" data-group-id="8056924425-4">Ash.NotLoaded</span><span class="p" data-group-id="8056924425-4">&lt;</span><span class="ss">:relationship</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:comments</span><span class="p" data-group-id="8056924425-4">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">__meta__</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="8056924425-5">#</span><span class="nc" data-group-id="8056924425-5">Ecto.Schema.Metadata</span><span class="p" data-group-id="8056924425-5">&lt;</span><span class="ss">:loaded</span><span class="p" data-group-id="8056924425-5">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eafcb80f-8c90-4c16-8a29-cf0c28964d9b&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;First post about Ash!&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="8056924425-6">%{</span><span class="p" data-group-id="8056924425-6">}</span><span class="p">,</span><span class="w">
    </span><span class="ss">calculations</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="8056924425-7">%{</span><span class="p" data-group-id="8056924425-7">}</span><span class="p">,</span><span class="w">
    </span><span class="n">...</span><span class="w">
  </span><span class="p" data-group-id="8056924425-2">&gt;</span><span class="w">
</span><span class="p" data-group-id="8056924425-1">]</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="nc">MyApp.Posts.Post</span><span class="w">
</span><span class="c1"># use `filter_input` to filter based on user input</span><span class="w">
</span><span class="c1"># it only allows accessing public fields</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">filter_input</span><span class="p" data-group-id="1983658308-1">(</span><span class="p" data-group-id="1983658308-2">%{</span><span class="ss">count_of_comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1983658308-3">%{</span><span class="ss">eq</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1983658308-3">}</span><span class="p" data-group-id="1983658308-2">}</span><span class="p" data-group-id="1983658308-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="1983658308-4">(</span><span class="p" data-group-id="1983658308-4">)</span></code></pre><h2 id="sorting">Sorting</h2><pre><code class="makeup elixir" translate="no"><span class="nc">MyApp.Posts.Post</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">sort</span><span class="p" data-group-id="6384078139-1">(</span><span class="ss">:text</span><span class="p" data-group-id="6384078139-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="6384078139-2">(</span><span class="p" data-group-id="6384078139-2">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="4806996992-1">[</span><span class="w">
  </span><span class="p" data-group-id="4806996992-2">#</span><span class="nc" data-group-id="4806996992-2">MyApp.Posts.Post</span><span class="p" data-group-id="4806996992-2">&lt;</span><span class="w">
    </span><span class="ss">text_length</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4806996992-3">#</span><span class="nc" data-group-id="4806996992-3">Ash.NotLoaded</span><span class="p" data-group-id="4806996992-3">&lt;</span><span class="ss">:calculation</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:text_length</span><span class="p" data-group-id="4806996992-3">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">count_of_comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4806996992-4">#</span><span class="nc" data-group-id="4806996992-4">Ash.NotLoaded</span><span class="p" data-group-id="4806996992-4">&lt;</span><span class="ss">:aggregate</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:count_of_comments</span><span class="p" data-group-id="4806996992-4">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4806996992-5">#</span><span class="nc" data-group-id="4806996992-5">Ash.NotLoaded</span><span class="p" data-group-id="4806996992-5">&lt;</span><span class="ss">:relationship</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:comments</span><span class="p" data-group-id="4806996992-5">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">__meta__</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4806996992-6">#</span><span class="nc" data-group-id="4806996992-6">Ecto.Schema.Metadata</span><span class="p" data-group-id="4806996992-6">&lt;</span><span class="ss">:loaded</span><span class="p" data-group-id="4806996992-6">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eafcb80f-8c90-4c16-8a29-cf0c28964d9b&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;First post about Ash!&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4806996992-7">%{</span><span class="p" data-group-id="4806996992-7">}</span><span class="p">,</span><span class="w">
    </span><span class="ss">calculations</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4806996992-8">%{</span><span class="p" data-group-id="4806996992-8">}</span><span class="p">,</span><span class="w">
    </span><span class="n">...</span><span class="w">
  </span><span class="p" data-group-id="4806996992-2">&gt;</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="4806996992-9">#</span><span class="nc" data-group-id="4806996992-9">MyApp.Posts.Post</span><span class="p" data-group-id="4806996992-9">&lt;</span><span class="w">
    </span><span class="ss">text_length</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4806996992-10">#</span><span class="nc" data-group-id="4806996992-10">Ash.NotLoaded</span><span class="p" data-group-id="4806996992-10">&lt;</span><span class="ss">:calculation</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:text_length</span><span class="p" data-group-id="4806996992-10">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">count_of_comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4806996992-11">#</span><span class="nc" data-group-id="4806996992-11">Ash.NotLoaded</span><span class="p" data-group-id="4806996992-11">&lt;</span><span class="ss">:aggregate</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:count_of_comments</span><span class="p" data-group-id="4806996992-11">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4806996992-12">#</span><span class="nc" data-group-id="4806996992-12">Ash.NotLoaded</span><span class="p" data-group-id="4806996992-12">&lt;</span><span class="ss">:relationship</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:comments</span><span class="p" data-group-id="4806996992-12">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">__meta__</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4806996992-13">#</span><span class="nc" data-group-id="4806996992-13">Ecto.Schema.Metadata</span><span class="p" data-group-id="4806996992-13">&lt;</span><span class="ss">:loaded</span><span class="p" data-group-id="4806996992-13">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2f22973b-f1cd-4d2d-b241-d7c53bf097d3&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Learning to write queries&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4806996992-14">%{</span><span class="p" data-group-id="4806996992-14">}</span><span class="p">,</span><span class="w">
    </span><span class="ss">calculations</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4806996992-15">%{</span><span class="p" data-group-id="4806996992-15">}</span><span class="p">,</span><span class="w">
    </span><span class="n">...</span><span class="w">
  </span><span class="p" data-group-id="4806996992-9">&gt;</span><span class="w">
</span><span class="p" data-group-id="4806996992-1">]</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="c1"># Apply multiple sorts</span><span class="w">
</span><span class="nc">MyApp.Posts.Post</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">sort</span><span class="p" data-group-id="1856935576-1">(</span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="ss">:asc</span><span class="p">,</span><span class="w"> </span><span class="ss">count_of_comments</span><span class="p">:</span><span class="w"> </span><span class="ss">:desc</span><span class="p" data-group-id="1856935576-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="1856935576-2">(</span><span class="p" data-group-id="1856935576-2">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="0789344299-1">[</span><span class="w">
  </span><span class="p" data-group-id="0789344299-2">#</span><span class="nc" data-group-id="0789344299-2">MyApp.Posts.Post</span><span class="p" data-group-id="0789344299-2">&lt;</span><span class="w">
    </span><span class="ss">text_length</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0789344299-3">#</span><span class="nc" data-group-id="0789344299-3">Ash.NotLoaded</span><span class="p" data-group-id="0789344299-3">&lt;</span><span class="ss">:calculation</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:text_length</span><span class="p" data-group-id="0789344299-3">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">count_of_comments</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="ss">comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0789344299-4">#</span><span class="nc" data-group-id="0789344299-4">Ash.NotLoaded</span><span class="p" data-group-id="0789344299-4">&lt;</span><span class="ss">:relationship</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:comments</span><span class="p" data-group-id="0789344299-4">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">__meta__</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0789344299-5">#</span><span class="nc" data-group-id="0789344299-5">Ecto.Schema.Metadata</span><span class="p" data-group-id="0789344299-5">&lt;</span><span class="ss">:loaded</span><span class="p" data-group-id="0789344299-5">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eafcb80f-8c90-4c16-8a29-cf0c28964d9b&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;First post about Ash!&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0789344299-6">%{</span><span class="p" data-group-id="0789344299-6">}</span><span class="p">,</span><span class="w">
    </span><span class="ss">calculations</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0789344299-7">%{</span><span class="p" data-group-id="0789344299-7">}</span><span class="p">,</span><span class="w">
    </span><span class="n">...</span><span class="w">
  </span><span class="p" data-group-id="0789344299-2">&gt;</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="0789344299-8">#</span><span class="nc" data-group-id="0789344299-8">MyApp.Posts.Post</span><span class="p" data-group-id="0789344299-8">&lt;</span><span class="w">
    </span><span class="ss">text_length</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0789344299-9">#</span><span class="nc" data-group-id="0789344299-9">Ash.NotLoaded</span><span class="p" data-group-id="0789344299-9">&lt;</span><span class="ss">:calculation</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:text_length</span><span class="p" data-group-id="0789344299-9">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">count_of_comments</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0789344299-10">#</span><span class="nc" data-group-id="0789344299-10">Ash.NotLoaded</span><span class="p" data-group-id="0789344299-10">&lt;</span><span class="ss">:relationship</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:comments</span><span class="p" data-group-id="0789344299-10">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">__meta__</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0789344299-11">#</span><span class="nc" data-group-id="0789344299-11">Ecto.Schema.Metadata</span><span class="p" data-group-id="0789344299-11">&lt;</span><span class="ss">:loaded</span><span class="p" data-group-id="0789344299-11">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2f22973b-f1cd-4d2d-b241-d7c53bf097d3&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Learning to write queries&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0789344299-12">%{</span><span class="p" data-group-id="0789344299-12">}</span><span class="p">,</span><span class="w">
    </span><span class="ss">calculations</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0789344299-13">%{</span><span class="p" data-group-id="0789344299-13">}</span><span class="p">,</span><span class="w">
    </span><span class="n">...</span><span class="w">
  </span><span class="p" data-group-id="0789344299-8">&gt;</span><span class="w">
</span><span class="p" data-group-id="0789344299-1">]</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="c1"># use `sort_input` to sort based on user input</span><span class="w">
</span><span class="c1"># it only allows accessing public fields</span><span class="w">
</span><span class="nc">MyApp.Posts.Post</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">sort_input</span><span class="p" data-group-id="1509223703-1">(</span><span class="s">&quot;text,-count_of_comments&quot;</span><span class="p" data-group-id="1509223703-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="1509223703-2">(</span><span class="p" data-group-id="1509223703-2">)</span></code></pre><h2 id="distinct">Distinct</h2><pre><code class="makeup elixir" translate="no"><span class="nc">MyApp.Posts.Comment</span><span class="w">
</span><span class="c1"># only one comment per post</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">distinct</span><span class="p" data-group-id="6463959979-1">(</span><span class="ss">:post_id</span><span class="p" data-group-id="6463959979-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="6463959979-2">(</span><span class="p" data-group-id="6463959979-2">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="7296986826-1">[</span><span class="w">
  </span><span class="p" data-group-id="7296986826-2">#</span><span class="nc" data-group-id="7296986826-2">MyApp.Posts.Comment</span><span class="p" data-group-id="7296986826-2">&lt;</span><span class="w">
    </span><span class="ss">post</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7296986826-3">#</span><span class="nc" data-group-id="7296986826-3">Ash.NotLoaded</span><span class="p" data-group-id="7296986826-3">&lt;</span><span class="ss">:relationship</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="7296986826-3">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">__meta__</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7296986826-4">#</span><span class="nc" data-group-id="7296986826-4">Ecto.Schema.Metadata</span><span class="p" data-group-id="7296986826-4">&lt;</span><span class="ss">:loaded</span><span class="p" data-group-id="7296986826-4">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;09aaffc4-bca7-4848-8b05-2d1ca11aba33&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Thanks for the explanation&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">post_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2f22973b-f1cd-4d2d-b241-d7c53bf097d3&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7296986826-5">%{</span><span class="p" data-group-id="7296986826-5">}</span><span class="p">,</span><span class="w">
    </span><span class="ss">calculations</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7296986826-6">%{</span><span class="p" data-group-id="7296986826-6">}</span><span class="p">,</span><span class="w">
    </span><span class="n">...</span><span class="w">
  </span><span class="p" data-group-id="7296986826-2">&gt;</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="7296986826-7">#</span><span class="nc" data-group-id="7296986826-7">MyApp.Posts.Comment</span><span class="p" data-group-id="7296986826-7">&lt;</span><span class="w">
    </span><span class="ss">post</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7296986826-8">#</span><span class="nc" data-group-id="7296986826-8">Ash.NotLoaded</span><span class="p" data-group-id="7296986826-8">&lt;</span><span class="ss">:relationship</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="7296986826-8">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">__meta__</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7296986826-9">#</span><span class="nc" data-group-id="7296986826-9">Ecto.Schema.Metadata</span><span class="p" data-group-id="7296986826-9">&lt;</span><span class="ss">:loaded</span><span class="p" data-group-id="7296986826-9">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;05863bdd-38eb-4e0e-9ff7-f23f65639ec3&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Great post!&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">post_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eafcb80f-8c90-4c16-8a29-cf0c28964d9b&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7296986826-10">%{</span><span class="p" data-group-id="7296986826-10">}</span><span class="p">,</span><span class="w">
    </span><span class="ss">calculations</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7296986826-11">%{</span><span class="p" data-group-id="7296986826-11">}</span><span class="p">,</span><span class="w">
    </span><span class="n">...</span><span class="w">
  </span><span class="p" data-group-id="7296986826-7">&gt;</span><span class="w">
</span><span class="p" data-group-id="7296986826-1">]</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="nc">MyApp.Posts.Comment</span><span class="w">
</span><span class="c1"># only one comment per post_id &amp; text combination</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">distinct</span><span class="p" data-group-id="2111302617-1">(</span><span class="p" data-group-id="2111302617-2">[</span><span class="ss">:post_id</span><span class="p">,</span><span class="w"> </span><span class="ss">:text</span><span class="p" data-group-id="2111302617-2">]</span><span class="p" data-group-id="2111302617-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="2111302617-3">(</span><span class="p" data-group-id="2111302617-3">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="0457090552-1">[</span><span class="w">
  </span><span class="p" data-group-id="0457090552-2">#</span><span class="nc" data-group-id="0457090552-2">MyApp.Posts.Comment</span><span class="p" data-group-id="0457090552-2">&lt;</span><span class="w">
    </span><span class="ss">post</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0457090552-3">#</span><span class="nc" data-group-id="0457090552-3">Ash.NotLoaded</span><span class="p" data-group-id="0457090552-3">&lt;</span><span class="ss">:relationship</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="0457090552-3">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">__meta__</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0457090552-4">#</span><span class="nc" data-group-id="0457090552-4">Ecto.Schema.Metadata</span><span class="p" data-group-id="0457090552-4">&lt;</span><span class="ss">:loaded</span><span class="p" data-group-id="0457090552-4">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;09aaffc4-bca7-4848-8b05-2d1ca11aba33&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Thanks for the explanation&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">post_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2f22973b-f1cd-4d2d-b241-d7c53bf097d3&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0457090552-5">%{</span><span class="p" data-group-id="0457090552-5">}</span><span class="p">,</span><span class="w">
    </span><span class="ss">calculations</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0457090552-6">%{</span><span class="p" data-group-id="0457090552-6">}</span><span class="p">,</span><span class="w">
    </span><span class="n">...</span><span class="w">
  </span><span class="p" data-group-id="0457090552-2">&gt;</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="0457090552-7">#</span><span class="nc" data-group-id="0457090552-7">MyApp.Posts.Comment</span><span class="p" data-group-id="0457090552-7">&lt;</span><span class="w">
    </span><span class="ss">post</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0457090552-8">#</span><span class="nc" data-group-id="0457090552-8">Ash.NotLoaded</span><span class="p" data-group-id="0457090552-8">&lt;</span><span class="ss">:relationship</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="0457090552-8">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">__meta__</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0457090552-9">#</span><span class="nc" data-group-id="0457090552-9">Ecto.Schema.Metadata</span><span class="p" data-group-id="0457090552-9">&lt;</span><span class="ss">:loaded</span><span class="p" data-group-id="0457090552-9">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;05863bdd-38eb-4e0e-9ff7-f23f65639ec3&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Great post!&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">post_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eafcb80f-8c90-4c16-8a29-cf0c28964d9b&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0457090552-10">%{</span><span class="p" data-group-id="0457090552-10">}</span><span class="p">,</span><span class="w">
    </span><span class="ss">calculations</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0457090552-11">%{</span><span class="p" data-group-id="0457090552-11">}</span><span class="p">,</span><span class="w">
    </span><span class="n">...</span><span class="w">
  </span><span class="p" data-group-id="0457090552-7">&gt;</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="0457090552-12">#</span><span class="nc" data-group-id="0457090552-12">MyApp.Posts.Comment</span><span class="p" data-group-id="0457090552-12">&lt;</span><span class="w">
    </span><span class="ss">post</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0457090552-13">#</span><span class="nc" data-group-id="0457090552-13">Ash.NotLoaded</span><span class="p" data-group-id="0457090552-13">&lt;</span><span class="ss">:relationship</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="0457090552-13">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">__meta__</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0457090552-14">#</span><span class="nc" data-group-id="0457090552-14">Ecto.Schema.Metadata</span><span class="p" data-group-id="0457090552-14">&lt;</span><span class="ss">:loaded</span><span class="p" data-group-id="0457090552-14">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;437b6966-2929-4e12-94cc-5807adf60c3e&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Very helpful!&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">post_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eafcb80f-8c90-4c16-8a29-cf0c28964d9b&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0457090552-15">%{</span><span class="p" data-group-id="0457090552-15">}</span><span class="p">,</span><span class="w">
    </span><span class="ss">calculations</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0457090552-16">%{</span><span class="p" data-group-id="0457090552-16">}</span><span class="p">,</span><span class="w">
    </span><span class="n">...</span><span class="w">
  </span><span class="p" data-group-id="0457090552-12">&gt;</span><span class="w">
</span><span class="p" data-group-id="0457090552-1">]</span></code></pre><h2 id="load-calculations-aggregates">Load calculations/aggregates</h2><pre><code class="makeup elixir" translate="no"><span class="nc">MyApp.Posts.Post</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">load</span><span class="p" data-group-id="7376094306-1">(</span><span class="p" data-group-id="7376094306-2">[</span><span class="ss">:count_of_comments</span><span class="p">,</span><span class="w"> </span><span class="ss">:text_length</span><span class="p" data-group-id="7376094306-2">]</span><span class="p" data-group-id="7376094306-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="7376094306-3">(</span><span class="p" data-group-id="7376094306-3">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="7376094306-4">(</span><span class="o">&amp;</span><span class="nc">Map</span><span class="o">.</span><span class="n">take</span><span class="p" data-group-id="7376094306-5">(</span><span class="ni">&amp;1</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7376094306-6">[</span><span class="ss">:text</span><span class="p">,</span><span class="w"> </span><span class="ss">:count_of_comments</span><span class="p">,</span><span class="w"> </span><span class="ss">:text_length</span><span class="p" data-group-id="7376094306-6">]</span><span class="p" data-group-id="7376094306-5">)</span><span class="p" data-group-id="7376094306-4">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="8437180964-1">[</span><span class="w">
  </span><span class="p" data-group-id="8437180964-2">%{</span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Learning to write queries&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">text_length</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">count_of_comments</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="8437180964-2">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="8437180964-3">%{</span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;First post about Ash!&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">text_length</span><span class="p">:</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w"> </span><span class="ss">count_of_comments</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="8437180964-3">}</span><span class="w">
</span><span class="p" data-group-id="8437180964-1">]</span></code></pre><h2 id="load-relationships">Load relationships</h2><pre><code class="makeup elixir" translate="no"><span class="nc">MyApp.Posts.Post</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">load</span><span class="p" data-group-id="5608227713-1">(</span><span class="ss">:comments</span><span class="p" data-group-id="5608227713-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="5608227713-2">(</span><span class="p" data-group-id="5608227713-2">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">at</span><span class="p" data-group-id="5608227713-3">(</span><span class="mi">0</span><span class="p" data-group-id="5608227713-3">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="1512873191-1">#</span><span class="nc" data-group-id="1512873191-1">MyApp.Posts.Post</span><span class="p" data-group-id="1512873191-1">&lt;</span><span class="w">
  </span><span class="ss">text_length</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1512873191-2">#</span><span class="nc" data-group-id="1512873191-2">Ash.NotLoaded</span><span class="p" data-group-id="1512873191-2">&lt;</span><span class="ss">:calculation</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:text_length</span><span class="p" data-group-id="1512873191-2">&gt;</span><span class="p">,</span><span class="w">
  </span><span class="ss">count_of_comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1512873191-3">#</span><span class="nc" data-group-id="1512873191-3">Ash.NotLoaded</span><span class="p" data-group-id="1512873191-3">&lt;</span><span class="ss">:aggregate</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:count_of_comments</span><span class="p" data-group-id="1512873191-3">&gt;</span><span class="p">,</span><span class="w">
  </span><span class="ss">comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1512873191-4">[</span><span class="w">
    </span><span class="p" data-group-id="1512873191-5">#</span><span class="nc" data-group-id="1512873191-5">MyApp.Posts.Comment</span><span class="p" data-group-id="1512873191-5">&lt;</span><span class="w">
      </span><span class="ss">post</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1512873191-6">#</span><span class="nc" data-group-id="1512873191-6">Ash.NotLoaded</span><span class="p" data-group-id="1512873191-6">&lt;</span><span class="ss">:relationship</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="1512873191-6">&gt;</span><span class="p">,</span><span class="w">
      </span><span class="ss">__meta__</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1512873191-7">#</span><span class="nc" data-group-id="1512873191-7">Ecto.Schema.Metadata</span><span class="p" data-group-id="1512873191-7">&lt;</span><span class="ss">:loaded</span><span class="p" data-group-id="1512873191-7">&gt;</span><span class="p">,</span><span class="w">
      </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;09aaffc4-bca7-4848-8b05-2d1ca11aba33&quot;</span><span class="p">,</span><span class="w">
      </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Thanks for the explanation&quot;</span><span class="p">,</span><span class="w">
      </span><span class="ss">post_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2f22973b-f1cd-4d2d-b241-d7c53bf097d3&quot;</span><span class="p">,</span><span class="w">
      </span><span class="ss">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1512873191-8">%{</span><span class="p" data-group-id="1512873191-8">}</span><span class="p">,</span><span class="w">
      </span><span class="ss">calculations</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1512873191-9">%{</span><span class="p" data-group-id="1512873191-9">}</span><span class="p">,</span><span class="w">
      </span><span class="n">...</span><span class="w">
    </span><span class="p" data-group-id="1512873191-5">&gt;</span><span class="w">
  </span><span class="p" data-group-id="1512873191-4">]</span><span class="p">,</span><span class="w">
  </span><span class="ss">__meta__</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1512873191-10">#</span><span class="nc" data-group-id="1512873191-10">Ecto.Schema.Metadata</span><span class="p" data-group-id="1512873191-10">&lt;</span><span class="ss">:loaded</span><span class="p" data-group-id="1512873191-10">&gt;</span><span class="p">,</span><span class="w">
  </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2f22973b-f1cd-4d2d-b241-d7c53bf097d3&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Learning to write queries&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1512873191-11">%{</span><span class="p" data-group-id="1512873191-11">}</span><span class="p">,</span><span class="w">
  </span><span class="ss">calculations</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1512873191-12">%{</span><span class="p" data-group-id="1512873191-12">}</span><span class="p">,</span><span class="w">
  </span><span class="n">...</span><span class="w">
</span><span class="p" data-group-id="1512873191-1">&gt;</span></code></pre><h2 id="limit-offset">Limit &amp; Offset</h2><pre><code class="makeup elixir" translate="no"><span class="nc">MyApp.Posts.Post</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">limit</span><span class="p" data-group-id="4588328084-1">(</span><span class="mi">1</span><span class="p" data-group-id="4588328084-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="4588328084-2">(</span><span class="p" data-group-id="4588328084-2">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="5070662961-1">[</span><span class="w">
  </span><span class="p" data-group-id="5070662961-2">#</span><span class="nc" data-group-id="5070662961-2">MyApp.Posts.Post</span><span class="p" data-group-id="5070662961-2">&lt;</span><span class="w">
    </span><span class="ss">text_length</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5070662961-3">#</span><span class="nc" data-group-id="5070662961-3">Ash.NotLoaded</span><span class="p" data-group-id="5070662961-3">&lt;</span><span class="ss">:calculation</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:text_length</span><span class="p" data-group-id="5070662961-3">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">count_of_comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5070662961-4">#</span><span class="nc" data-group-id="5070662961-4">Ash.NotLoaded</span><span class="p" data-group-id="5070662961-4">&lt;</span><span class="ss">:aggregate</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:count_of_comments</span><span class="p" data-group-id="5070662961-4">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5070662961-5">#</span><span class="nc" data-group-id="5070662961-5">Ash.NotLoaded</span><span class="p" data-group-id="5070662961-5">&lt;</span><span class="ss">:relationship</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:comments</span><span class="p" data-group-id="5070662961-5">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">__meta__</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5070662961-6">#</span><span class="nc" data-group-id="5070662961-6">Ecto.Schema.Metadata</span><span class="p" data-group-id="5070662961-6">&lt;</span><span class="ss">:loaded</span><span class="p" data-group-id="5070662961-6">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2f22973b-f1cd-4d2d-b241-d7c53bf097d3&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Learning to write queries&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5070662961-7">%{</span><span class="p" data-group-id="5070662961-7">}</span><span class="p">,</span><span class="w">
    </span><span class="ss">calculations</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5070662961-8">%{</span><span class="p" data-group-id="5070662961-8">}</span><span class="p">,</span><span class="w">
    </span><span class="n">...</span><span class="w">
  </span><span class="p" data-group-id="5070662961-2">&gt;</span><span class="w">
</span><span class="p" data-group-id="5070662961-1">]</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="nc">MyApp.Posts.Post</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">offset</span><span class="p" data-group-id="4767360187-1">(</span><span class="mi">1</span><span class="p" data-group-id="4767360187-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="4767360187-2">(</span><span class="p" data-group-id="4767360187-2">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="4949429377-1">[</span><span class="w">
  </span><span class="p" data-group-id="4949429377-2">#</span><span class="nc" data-group-id="4949429377-2">MyApp.Posts.Post</span><span class="p" data-group-id="4949429377-2">&lt;</span><span class="w">
    </span><span class="ss">text_length</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4949429377-3">#</span><span class="nc" data-group-id="4949429377-3">Ash.NotLoaded</span><span class="p" data-group-id="4949429377-3">&lt;</span><span class="ss">:calculation</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:text_length</span><span class="p" data-group-id="4949429377-3">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">count_of_comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4949429377-4">#</span><span class="nc" data-group-id="4949429377-4">Ash.NotLoaded</span><span class="p" data-group-id="4949429377-4">&lt;</span><span class="ss">:aggregate</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:count_of_comments</span><span class="p" data-group-id="4949429377-4">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4949429377-5">#</span><span class="nc" data-group-id="4949429377-5">Ash.NotLoaded</span><span class="p" data-group-id="4949429377-5">&lt;</span><span class="ss">:relationship</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:comments</span><span class="p" data-group-id="4949429377-5">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">__meta__</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4949429377-6">#</span><span class="nc" data-group-id="4949429377-6">Ecto.Schema.Metadata</span><span class="p" data-group-id="4949429377-6">&lt;</span><span class="ss">:loaded</span><span class="p" data-group-id="4949429377-6">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eafcb80f-8c90-4c16-8a29-cf0c28964d9b&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;First post about Ash!&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4949429377-7">%{</span><span class="p" data-group-id="4949429377-7">}</span><span class="p">,</span><span class="w">
    </span><span class="ss">calculations</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4949429377-8">%{</span><span class="p" data-group-id="4949429377-8">}</span><span class="p">,</span><span class="w">
    </span><span class="n">...</span><span class="w">
  </span><span class="p" data-group-id="4949429377-2">&gt;</span><span class="w">
</span><span class="p" data-group-id="4949429377-1">]</span></code></pre><h2 id="pagination">Pagination</h2><pre><code class="makeup elixir" translate="no"><span class="c1"># Offset Pagination</span><span class="w">

</span><span class="nc">MyApp.Posts.Post</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">page</span><span class="p" data-group-id="3938584878-1">(</span><span class="ss">limit</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="3938584878-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="3938584878-2">(</span><span class="p" data-group-id="3938584878-2">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="7997498537-1">%</span><span class="nc" data-group-id="7997498537-1">Ash.Page.Offset</span><span class="p" data-group-id="7997498537-1">{</span><span class="w">
  </span><span class="ss">results</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7997498537-2">[</span><span class="w">
    </span><span class="p" data-group-id="7997498537-3">#</span><span class="nc" data-group-id="7997498537-3">MyApp.Posts.Post</span><span class="p" data-group-id="7997498537-3">&lt;</span><span class="w">
      </span><span class="ss">text_length</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7997498537-4">#</span><span class="nc" data-group-id="7997498537-4">Ash.NotLoaded</span><span class="p" data-group-id="7997498537-4">&lt;</span><span class="ss">:calculation</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:text_length</span><span class="p" data-group-id="7997498537-4">&gt;</span><span class="p">,</span><span class="w">
      </span><span class="ss">count_of_comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7997498537-5">#</span><span class="nc" data-group-id="7997498537-5">Ash.NotLoaded</span><span class="p" data-group-id="7997498537-5">&lt;</span><span class="ss">:aggregate</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:count_of_comments</span><span class="p" data-group-id="7997498537-5">&gt;</span><span class="p">,</span><span class="w">
      </span><span class="ss">comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7997498537-6">#</span><span class="nc" data-group-id="7997498537-6">Ash.NotLoaded</span><span class="p" data-group-id="7997498537-6">&lt;</span><span class="ss">:relationship</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:comments</span><span class="p" data-group-id="7997498537-6">&gt;</span><span class="p">,</span><span class="w">
      </span><span class="ss">__meta__</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7997498537-7">#</span><span class="nc" data-group-id="7997498537-7">Ecto.Schema.Metadata</span><span class="p" data-group-id="7997498537-7">&lt;</span><span class="ss">:loaded</span><span class="p" data-group-id="7997498537-7">&gt;</span><span class="p">,</span><span class="w">
      </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2f22973b-f1cd-4d2d-b241-d7c53bf097d3&quot;</span><span class="p">,</span><span class="w">
      </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Learning to write queries&quot;</span><span class="p">,</span><span class="w">
      </span><span class="ss">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7997498537-8">%{</span><span class="p" data-group-id="7997498537-8">}</span><span class="p">,</span><span class="w">
      </span><span class="ss">calculations</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7997498537-9">%{</span><span class="p" data-group-id="7997498537-9">}</span><span class="p">,</span><span class="w">
      </span><span class="n">...</span><span class="w">
    </span><span class="p" data-group-id="7997498537-3">&gt;</span><span class="w">
  </span><span class="p" data-group-id="7997498537-2">]</span><span class="p">,</span><span class="w">
  </span><span class="ss">limit</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="ss">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="ss">count</span><span class="p">:</span><span class="w"> </span><span class="no">nil</span><span class="p">,</span><span class="w">
  </span><span class="ss">more?</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="w">
</span><span class="p" data-group-id="7997498537-1">}</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="c1"># Keyset pagination</span><span class="w">

</span><span class="n">first_post</span><span class="w"> </span><span class="o">=</span><span class="w"> 
  </span><span class="nc">MyApp.Posts.Post</span><span class="w">
  </span><span class="c1"># You can paginate using `Ash.Query.page/1`</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">page</span><span class="p" data-group-id="6759689484-1">(</span><span class="ss">limit</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="6759689484-1">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="6759689484-2">(</span><span class="p" data-group-id="6759689484-2">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Map</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="6759689484-3">(</span><span class="ss">:results</span><span class="p" data-group-id="6759689484-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">at</span><span class="p" data-group-id="6759689484-4">(</span><span class="mi">0</span><span class="p" data-group-id="6759689484-4">)</span><span class="w">
  
</span><span class="nc">MyApp.Posts.Post</span><span class="w">
</span><span class="c1"># Or using the `page` option</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="6759689484-5">(</span><span class="ss">page</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6759689484-6">[</span><span class="ss">limit</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">after</span><span class="p">:</span><span class="w"> </span><span class="n">first_post</span><span class="o">.</span><span class="c">__metadata__</span><span class="o">.</span><span class="n">keyset</span><span class="p" data-group-id="6759689484-6">]</span><span class="p" data-group-id="6759689484-5">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="4761896337-1">%</span><span class="nc" data-group-id="4761896337-1">Ash.Page.Keyset</span><span class="p" data-group-id="4761896337-1">{</span><span class="w">
  </span><span class="ss">results</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4761896337-2">[</span><span class="w">
    </span><span class="p" data-group-id="4761896337-3">#</span><span class="nc" data-group-id="4761896337-3">MyApp.Posts.Post</span><span class="p" data-group-id="4761896337-3">&lt;</span><span class="w">
      </span><span class="ss">text_length</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4761896337-4">#</span><span class="nc" data-group-id="4761896337-4">Ash.NotLoaded</span><span class="p" data-group-id="4761896337-4">&lt;</span><span class="ss">:calculation</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:text_length</span><span class="p" data-group-id="4761896337-4">&gt;</span><span class="p">,</span><span class="w">
      </span><span class="ss">count_of_comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4761896337-5">#</span><span class="nc" data-group-id="4761896337-5">Ash.NotLoaded</span><span class="p" data-group-id="4761896337-5">&lt;</span><span class="ss">:aggregate</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:count_of_comments</span><span class="p" data-group-id="4761896337-5">&gt;</span><span class="p">,</span><span class="w">
      </span><span class="ss">comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4761896337-6">#</span><span class="nc" data-group-id="4761896337-6">Ash.NotLoaded</span><span class="p" data-group-id="4761896337-6">&lt;</span><span class="ss">:relationship</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:comments</span><span class="p" data-group-id="4761896337-6">&gt;</span><span class="p">,</span><span class="w">
      </span><span class="ss">__meta__</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4761896337-7">#</span><span class="nc" data-group-id="4761896337-7">Ecto.Schema.Metadata</span><span class="p" data-group-id="4761896337-7">&lt;</span><span class="ss">:loaded</span><span class="p" data-group-id="4761896337-7">&gt;</span><span class="p">,</span><span class="w">
      </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eafcb80f-8c90-4c16-8a29-cf0c28964d9b&quot;</span><span class="p">,</span><span class="w">
      </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;First post about Ash!&quot;</span><span class="p">,</span><span class="w">
      </span><span class="ss">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4761896337-8">%{</span><span class="p" data-group-id="4761896337-8">}</span><span class="p">,</span><span class="w">
      </span><span class="ss">calculations</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4761896337-9">%{</span><span class="p" data-group-id="4761896337-9">}</span><span class="p">,</span><span class="w">
      </span><span class="n">...</span><span class="w">
    </span><span class="p" data-group-id="4761896337-3">&gt;</span><span class="w">
  </span><span class="p" data-group-id="4761896337-2">]</span><span class="p">,</span><span class="w">
  </span><span class="ss">count</span><span class="p">:</span><span class="w"> </span><span class="no">nil</span><span class="p">,</span><span class="w">
  </span><span class="ss">before</span><span class="p">:</span><span class="w"> </span><span class="no">nil</span><span class="p">,</span><span class="w">
  </span><span class="ss">after</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;g2wAAAABbQAAACQyZjIyOTczYi1mMWNkLTRkMmQtYjI0MS1kN2M1M2JmMDk3ZDNq&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">limit</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="ss">more?</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="w">
</span><span class="p" data-group-id="4761896337-1">}</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="nc">MyApp.Posts.Post</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">page</span><span class="p" data-group-id="9030631548-1">(</span><span class="ss">limit</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="9030631548-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="9030631548-2">(</span><span class="p" data-group-id="9030631548-2">)</span><span class="w">
</span><span class="c1"># you can ask for :next, :prev, :first, :last, or a page number</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">page!</span><span class="p" data-group-id="9030631548-3">(</span><span class="ss">:next</span><span class="p" data-group-id="9030631548-3">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="3583880013-1">%</span><span class="nc" data-group-id="3583880013-1">Ash.Page.Offset</span><span class="p" data-group-id="3583880013-1">{</span><span class="w">
  </span><span class="ss">results</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3583880013-2">[</span><span class="w">
    </span><span class="p" data-group-id="3583880013-3">#</span><span class="nc" data-group-id="3583880013-3">MyApp.Posts.Post</span><span class="p" data-group-id="3583880013-3">&lt;</span><span class="w">
      </span><span class="ss">text_length</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3583880013-4">#</span><span class="nc" data-group-id="3583880013-4">Ash.NotLoaded</span><span class="p" data-group-id="3583880013-4">&lt;</span><span class="ss">:calculation</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:text_length</span><span class="p" data-group-id="3583880013-4">&gt;</span><span class="p">,</span><span class="w">
      </span><span class="ss">count_of_comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3583880013-5">#</span><span class="nc" data-group-id="3583880013-5">Ash.NotLoaded</span><span class="p" data-group-id="3583880013-5">&lt;</span><span class="ss">:aggregate</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:count_of_comments</span><span class="p" data-group-id="3583880013-5">&gt;</span><span class="p">,</span><span class="w">
      </span><span class="ss">comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3583880013-6">#</span><span class="nc" data-group-id="3583880013-6">Ash.NotLoaded</span><span class="p" data-group-id="3583880013-6">&lt;</span><span class="ss">:relationship</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:comments</span><span class="p" data-group-id="3583880013-6">&gt;</span><span class="p">,</span><span class="w">
      </span><span class="ss">__meta__</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3583880013-7">#</span><span class="nc" data-group-id="3583880013-7">Ecto.Schema.Metadata</span><span class="p" data-group-id="3583880013-7">&lt;</span><span class="ss">:loaded</span><span class="p" data-group-id="3583880013-7">&gt;</span><span class="p">,</span><span class="w">
      </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eafcb80f-8c90-4c16-8a29-cf0c28964d9b&quot;</span><span class="p">,</span><span class="w">
      </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;First post about Ash!&quot;</span><span class="p">,</span><span class="w">
      </span><span class="ss">aggregates</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3583880013-8">%{</span><span class="p" data-group-id="3583880013-8">}</span><span class="p">,</span><span class="w">
      </span><span class="ss">calculations</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3583880013-9">%{</span><span class="p" data-group-id="3583880013-9">}</span><span class="p">,</span><span class="w">
      </span><span class="n">...</span><span class="w">
    </span><span class="p" data-group-id="3583880013-3">&gt;</span><span class="w">
  </span><span class="p" data-group-id="3583880013-2">]</span><span class="p">,</span><span class="w">
  </span><span class="ss">limit</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="ss">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="ss">count</span><span class="p">:</span><span class="w"> </span><span class="no">nil</span><span class="p">,</span><span class="w">
  </span><span class="ss">more?</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="w">
</span><span class="p" data-group-id="3583880013-1">}</span></code></pre>

  </body>
</html>
